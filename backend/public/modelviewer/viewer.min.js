/*! For license information please see viewer.min.js.LICENSE.txt */
(() => {
  "use strict";
  var t, e;
  (window.requestAnimFrame =
    window.requestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    window.oRequestAnimationFrame ||
    window.msRequestAnimationFrame ||
    function (t, e) {
      window.setTimeout(t, 1e3 / 60);
    }),
    (jQuery.support.cors = !0),
    $.ajaxTransport
      ? ($.ajaxSetup({ flatOptions: { renderer: !0 } }),
        $.ajaxTransport("+binary", function (t, e, i) {
          if (
            window.FormData &&
            ((t.dataType && "binary" == t.dataType) ||
              (t.data &&
                ((window.ArrayBuffer && t.data instanceof ArrayBuffer) ||
                  (window.Blob && t.data instanceof Blob))))
          )
            return {
              send: function (e, i) {
                var s = new XMLHttpRequest(),
                  r = t.url,
                  n = t.type,
                  a = t.responseType || "blob",
                  o = t.data || null;
                t.renderer &&
                  s.addEventListener("progress", function (e) {
                    e.lengthComputable &&
                      (t.renderer.downloads[this.responseURL]
                        ? (t.renderer.downloads[this.responseURL].loaded =
                            e.loaded)
                        : (t.renderer.downloads[this.responseURL] = {
                            loaded: e.loaded,
                            total: e.total,
                          }),
                      t.renderer.updateProgress());
                  }),
                  s.addEventListener("load", function () {
                    t.renderer &&
                      (delete t.renderer.downloads[this.responseURL],
                      t.renderer.updateProgress());
                    var e = {};
                    (e[t.dataType] = s.response),
                      i(s.status, s.statusText, e, s.getAllResponseHeaders());
                  }),
                  s.open(n, r, !0),
                  (s.responseType = a),
                  s.send(o);
              },
              abort: function () {
                i.abort();
              },
            };
        }))
      : ((t = $.httpData),
        ($.httpData = function (e, i, s) {
          return "binary" == i ? e.response : t(e, i, s);
        }),
        $.ajaxSetup({
          beforeSend: function (t, e) {
            "binary" == e.dataType &&
              ((t.responseType = e.responseType || "arraybuffer"),
              t.addEventListener(
                "progress",
                function (t) {
                  e.renderer &&
                    t.lengthComputable &&
                    (e.renderer.downloads[this.responseURL]
                      ? (e.renderer.downloads[this.responseURL].loaded =
                          t.loaded)
                      : (e.renderer.downloads[this.responseURL] = {
                          loaded: t.loaded,
                          total: t.total,
                        }),
                    e.renderer.updateProgress());
                },
                !1
              ),
              t.addEventListener(
                "load",
                function () {
                  e.renderer &&
                    (delete e.renderer.downloads[this.responseURL],
                    e.renderer.updateProgress());
                },
                !1
              ));
          },
        })),
    (Math.randomInt =
      Math.randomInt ||
      function (t, e) {
        return Math.floor(Math.random() * (e - t)) + t;
      }),
    "function" != typeof Object.create &&
      (Object.create =
        ((e = function () {}),
        function (t) {
          if (arguments.length > 1)
            throw Error("Second argument not supported");
          if ("object" != typeof t)
            throw TypeError("Argument must be an object");
          e.prototype = t;
          var i = new e();
          return (e.prototype = null), i;
        })),
    (window.console = window.console || {
      log: function () {},
      error: function () {},
      warn: function () {},
    });
  let i = Float32Array;
  function s(t, e, s) {
    const r = new i(3);
    return t && (r[0] = t), e && (r[1] = e), s && (r[2] = s), r;
  }
  function r(t, e, s) {
    return (
      ((s = s || new i(3))[0] = t[0] + e[0]),
      (s[1] = t[1] + e[1]),
      (s[2] = t[2] + e[2]),
      s
    );
  }
  function n(t, e, s) {
    return (
      ((s = s || new i(3))[0] = t[0] * e[0]),
      (s[1] = t[1] * e[1]),
      (s[2] = t[2] * e[2]),
      s
    );
  }
  let a = Float32Array;
  function o(t) {
    return (
      ((t = t || new a(16))[0] = 1),
      (t[1] = 0),
      (t[2] = 0),
      (t[3] = 0),
      (t[4] = 0),
      (t[5] = 1),
      (t[6] = 0),
      (t[7] = 0),
      (t[8] = 0),
      (t[9] = 0),
      (t[10] = 1),
      (t[11] = 0),
      (t[12] = 0),
      (t[13] = 0),
      (t[14] = 0),
      (t[15] = 1),
      t
    );
  }
  function h(t, e) {
    e = e || new a(16);
    const i = t[0],
      s = t[1],
      r = t[2],
      n = t[3],
      o = t[4],
      h = t[5],
      l = t[6],
      u = t[7],
      c = t[8],
      d = t[9],
      f = t[10],
      g = t[11],
      b = t[12],
      _ = t[13],
      p = t[14],
      m = t[15],
      x = f * m,
      v = p * g,
      T = l * m,
      w = p * u,
      y = l * g,
      A = f * u,
      E = r * m,
      M = p * n,
      C = r * g,
      S = f * n,
      F = r * u,
      I = l * n,
      k = c * _,
      D = b * d,
      R = o * _,
      U = b * h,
      O = o * d,
      B = c * h,
      P = i * _,
      z = b * s,
      N = i * d,
      G = c * s,
      L = i * h,
      j = o * s,
      Y = x * h + w * d + y * _ - (v * h + T * d + A * _),
      H = v * s + E * d + S * _ - (x * s + M * d + C * _),
      q = T * s + M * h + F * _ - (w * s + E * h + I * _),
      V = A * s + C * h + I * d - (y * s + S * h + F * d),
      X = 1 / (i * Y + o * H + c * q + b * V);
    return (
      (e[0] = X * Y),
      (e[1] = X * H),
      (e[2] = X * q),
      (e[3] = X * V),
      (e[4] = X * (v * o + T * c + A * b - (x * o + w * c + y * b))),
      (e[5] = X * (x * i + M * c + C * b - (v * i + E * c + S * b))),
      (e[6] = X * (w * i + E * o + I * b - (T * i + M * o + F * b))),
      (e[7] = X * (y * i + S * o + F * c - (A * i + C * o + I * c))),
      (e[8] = X * (k * u + U * g + O * m - (D * u + R * g + B * m))),
      (e[9] = X * (D * n + P * g + G * m - (k * n + z * g + N * m))),
      (e[10] = X * (R * n + z * u + L * m - (U * n + P * u + j * m))),
      (e[11] = X * (B * n + N * u + j * g - (O * n + G * u + L * g))),
      (e[12] = X * (R * f + B * p + D * l - (O * p + k * l + U * f))),
      (e[13] = X * (N * p + k * r + z * f - (P * f + G * p + D * r))),
      (e[14] = X * (P * l + j * p + U * r - (L * p + R * r + z * l))),
      (e[15] = X * (L * f + O * r + G * l - (N * l + j * f + B * r))),
      e
    );
  }
  function l(t, e, i) {
    i = i || s();
    const r = e[0],
      n = e[1],
      a = e[2],
      o = r * t[3] + n * t[7] + a * t[11] + t[15];
    return (
      (i[0] = (r * t[0] + n * t[4] + a * t[8] + t[12]) / o),
      (i[1] = (r * t[1] + n * t[5] + a * t[9] + t[13]) / o),
      (i[2] = (r * t[2] + n * t[6] + a * t[10] + t[14]) / o),
      i
    );
  }
  function u(t, e, i) {
    i = i || s();
    const r = e[0],
      n = e[1],
      a = e[2];
    return (
      (i[0] = r * t[0] + n * t[4] + a * t[8]),
      (i[1] = r * t[1] + n * t[5] + a * t[9]),
      (i[2] = r * t[2] + n * t[6] + a * t[10]),
      i
    );
  }
  const c = 5120,
    d = 5121,
    f = 5122,
    g = 5123,
    b = 5124,
    _ = 5125,
    p = 5126,
    m = {};
  {
    const t = m;
    (t[c] = Int8Array),
      (t[d] = Uint8Array),
      (t[f] = Int16Array),
      (t[g] = Uint16Array),
      (t[b] = Int32Array),
      (t[_] = Uint32Array),
      (t[p] = Float32Array),
      (t[32819] = Uint16Array),
      (t[32820] = Uint16Array),
      (t[33635] = Uint16Array),
      (t[5131] = Uint16Array),
      (t[33640] = Uint32Array),
      (t[35899] = Uint32Array),
      (t[35902] = Uint32Array),
      (t[36269] = Uint32Array),
      (t[34042] = Uint32Array);
  }
  function x(t) {
    if (t instanceof Int8Array) return c;
    if (t instanceof Uint8Array) return d;
    if (t instanceof Uint8ClampedArray) return d;
    if (t instanceof Int16Array) return f;
    if (t instanceof Uint16Array) return g;
    if (t instanceof Int32Array) return b;
    if (t instanceof Uint32Array) return _;
    if (t instanceof Float32Array) return p;
    throw new Error("unsupported typed array type");
  }
  function v(t) {
    if (t === Int8Array) return c;
    if (t === Uint8Array) return d;
    if (t === Uint8ClampedArray) return d;
    if (t === Int16Array) return f;
    if (t === Uint16Array) return g;
    if (t === Int32Array) return b;
    if (t === Uint32Array) return _;
    if (t === Float32Array) return p;
    throw new Error("unsupported typed array type");
  }
  function T(t) {
    const e = m[t];
    if (!e) throw new Error("unknown gl type");
    return e;
  }
  const w =
    "undefined" != typeof SharedArrayBuffer
      ? function (t) {
          return (
            t &&
            t.buffer &&
            (t.buffer instanceof ArrayBuffer ||
              t.buffer instanceof SharedArrayBuffer)
          );
        }
      : function (t) {
          return t && t.buffer && t.buffer instanceof ArrayBuffer;
        };
  function y(...t) {
    console.error(...t);
  }
  const A = new Map();
  function E(t, e) {
    if (!t || "object" != typeof t) return !1;
    let i = A.get(e);
    i || ((i = new WeakMap()), A.set(e, i));
    let s = i.get(t);
    if (void 0 === s) {
      const r = Object.prototype.toString.call(t);
      (s = r.substring(8, r.length - 1) === e), i.set(t, s);
    }
    return s;
  }
  function M(t, e) {
    return "undefined" != typeof WebGLTexture && E(e, "WebGLTexture");
  }
  const C = 35044,
    S = 34962,
    F = 34963,
    I = 34660,
    k = 5120,
    D = 5121,
    R = 5122,
    U = 5123,
    O = 5124,
    B = 5125,
    P = 5126,
    z = { attribPrefix: "" };
  function N(t, e, i, s, r) {
    t.bindBuffer(e, i), t.bufferData(e, s, r || C);
  }
  function G(t, e, i, s) {
    if (((r = e), "undefined" != typeof WebGLBuffer && E(r, "WebGLBuffer")))
      return e;
    var r;
    i = i || S;
    const n = t.createBuffer();
    return N(t, i, n, e, s), n;
  }
  function L(t) {
    return "indices" === t;
  }
  function j(t) {
    return t.length ? t : t.data;
  }
  const Y = /coord|texture/i,
    H = /color|colour/i;
  function q(t, e, i) {
    return (
      t.numComponents ||
      t.size ||
      (function (t, e) {
        let i;
        if (((i = Y.test(t) ? 2 : H.test(t) ? 4 : 3), e % i > 0))
          throw new Error(
            `Can not guess numComponents for attribute '${t}'. Tried ${i} but ${e} values is not evenly divisible by ${i}. You should specify it.`
          );
        return i;
      })(e, i || j(t).length)
    );
  }
  function V(t, e) {
    if (w(t)) return t;
    if (w(t.data)) return t.data;
    Array.isArray(t) && (t = { data: t });
    let i = t.type ? X(t.type) : void 0;
    return i || (i = L(e) ? Uint16Array : Float32Array), new i(t.data);
  }
  function X(t) {
    return "number" == typeof t ? T(t) : t || Float32Array;
  }
  function K(t, e) {
    return {
      buffer: e.buffer,
      numValues: 24,
      type: ((i = e.type), "number" == typeof i ? i : i ? v(i) : P),
      arrayType: X(e.type),
    };
    var i;
  }
  function W(t, e) {
    const i = e.data || e,
      s = X(e.type),
      r = i * s.BYTES_PER_ELEMENT,
      n = t.createBuffer();
    return (
      t.bindBuffer(S, n),
      t.bufferData(S, r, e.drawType || C),
      { buffer: n, numValues: i, type: v(s), arrayType: s }
    );
  }
  function Z(t, e, i) {
    const s = V(e, i);
    return {
      arrayType: s.constructor,
      buffer: G(t, s, void 0, e.drawType),
      type: x(s),
      numValues: 0,
    };
  }
  function J(t, e) {
    const i = {};
    return (
      Object.keys(e).forEach(function (s) {
        if (!L(s)) {
          const n = e[s],
            a = n.attrib || n.name || n.attribName || z.attribPrefix + s;
          if (n.value) {
            if (!Array.isArray(n.value) && !w(n.value))
              throw new Error("array.value is not array or typedarray");
            i[a] = { value: n.value };
          } else {
            let e;
            e =
              n.buffer && n.buffer instanceof WebGLBuffer
                ? K
                : "number" == typeof n || "number" == typeof n.data
                ? W
                : Z;
            const {
                buffer: o,
                type: h,
                numValues: l,
                arrayType: u,
              } = e(t, n, s),
              c =
                void 0 !== n.normalize
                  ? n.normalize
                  : (r = u) === Int8Array || r === Uint8Array,
              d = q(n, s, l);
            i[a] = {
              buffer: o,
              numComponents: d,
              type: h,
              normalize: c,
              stride: n.stride || 0,
              offset: n.offset || 0,
              divisor: void 0 === n.divisor ? void 0 : n.divisor,
              drawType: n.drawType,
            };
          }
        }
        var r;
      }),
      t.bindBuffer(S, null),
      i
    );
  }
  const Q = ["position", "positions", "a_position"];
  function tt(t, e) {
    let i, s;
    for (
      s = 0;
      s < Q.length &&
      ((i = Q[s]), !(i in e)) &&
      ((i = z.attribPrefix + i), !(i in e));
      ++s
    );
    s === Q.length && (i = Object.keys(e)[0]);
    const r = e[i];
    if (!r.buffer) return 1;
    t.bindBuffer(S, r.buffer);
    const n = t.getBufferParameter(S, I);
    t.bindBuffer(S, null);
    var a;
    const o =
        n /
        ((a = r.type) === k || a === D
          ? 1
          : a === R || a === U
          ? 2
          : a === O || a === B || a === P
          ? 4
          : 0),
      h = r.numComponents || r.size,
      l = o / h;
    if (l % 1 != 0)
      throw new Error(`numComponents ${h} not correct for length ${length}`);
    return l;
  }
  function et(t, e, i) {
    const s = J(t, e),
      r = Object.assign({}, i || {});
    r.attribs = Object.assign({}, i ? i.attribs : {}, s);
    const n = e.indices;
    if (n) {
      const e = V(n, "indices");
      (r.indices = G(t, e, F)),
        (r.numElements = e.length),
        (r.elementType = x(e));
    } else r.numElements || (r.numElements = tt(t, r.attribs));
    return r;
  }
  function it(t, e, i) {
    const s = "indices" === i ? F : S;
    return G(t, V(e, i), s);
  }
  function st(t, e) {
    const i = {};
    return (
      Object.keys(e).forEach(function (s) {
        i[s] = it(t, e[s], s);
      }),
      e.indices
        ? ((i.numElements = e.indices.length),
          (i.elementType = x(V(e.indices))))
        : (i.numElements = (function (t) {
            let e, i;
            for (i = 0; i < Q.length && ((e = Q[i]), !(e in t)); ++i);
            i === Q.length && (e = Object.keys(t)[0]);
            const s = t[e],
              r = j(s).length;
            if (void 0 === r) return 1;
            const n = q(s, e),
              a = r / n;
            if (r % n > 0)
              throw new Error(`numComponents ${n} not correct for length ${r}`);
            return a;
          })(e)),
      i
    );
  }
  function rt(t, e) {
    let i = 0;
    return (
      (t.push = function () {
        for (let e = 0; e < arguments.length; ++e) {
          const s = arguments[e];
          if (s instanceof Array || w(s))
            for (let e = 0; e < s.length; ++e) t[i++] = s[e];
          else t[i++] = s;
        }
      }),
      (t.reset = function (t) {
        i = t || 0;
      }),
      (t.numComponents = e),
      Object.defineProperty(t, "numElements", {
        get: function () {
          return (this.length / this.numComponents) | 0;
        },
      }),
      t
    );
  }
  function nt(t, e, i) {
    return rt(new (i || Float32Array)(t * e), t);
  }
  function at(t, e, i) {
    const s = t.length,
      r = new Float32Array(3);
    for (let n = 0; n < s; n += 3)
      i(e, [t[n], t[n + 1], t[n + 2]], r),
        (t[n] = r[0]),
        (t[n + 1] = r[1]),
        (t[n + 2] = r[2]);
  }
  function ot(t, e, i) {
    i = i || s();
    const r = e[0],
      n = e[1],
      a = e[2];
    return (
      (i[0] = r * t[0] + n * t[1] + a * t[2]),
      (i[1] = r * t[4] + n * t[5] + a * t[6]),
      (i[2] = r * t[8] + n * t[9] + a * t[10]),
      i
    );
  }
  function ht(t, e) {
    return at(t, e, u), t;
  }
  function lt(t, e) {
    return at(t, h(e), ot), t;
  }
  function ut(t, e) {
    return at(t, e, l), t;
  }
  function ct(t, e) {
    return (
      Object.keys(t).forEach(function (i) {
        const s = t[i];
        i.indexOf("pos") >= 0
          ? ut(s, e)
          : i.indexOf("tan") >= 0 || i.indexOf("binorm") >= 0
          ? ht(s, e)
          : i.indexOf("norm") >= 0 && lt(s, e);
      }),
      t
    );
  }
  function dt(t, e, i) {
    return (
      (t = t || 2),
      {
        position: {
          numComponents: 2,
          data: [
            (e = e || 0) + -1 * (t *= 0.5),
            (i = i || 0) + -1 * t,
            e + 1 * t,
            i + -1 * t,
            e + -1 * t,
            i + 1 * t,
            e + 1 * t,
            i + 1 * t,
          ],
        },
        normal: [0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1],
        texcoord: [0, 0, 1, 0, 0, 1, 1, 1],
        indices: [0, 1, 2, 2, 1, 3],
      }
    );
  }
  function ft(t, e, i, s, r) {
    (t = t || 1), (e = e || 1), (i = i || 1), (s = s || 1), (r = r || o());
    const n = (i + 1) * (s + 1),
      a = nt(3, n),
      h = nt(3, n),
      l = nt(2, n);
    for (let r = 0; r <= s; r++)
      for (let n = 0; n <= i; n++) {
        const o = n / i,
          u = r / s;
        a.push(t * o - 0.5 * t, 0, e * u - 0.5 * e),
          h.push(0, 1, 0),
          l.push(o, u);
      }
    const u = i + 1,
      c = nt(3, i * s * 2, Uint16Array);
    for (let t = 0; t < s; t++)
      for (let e = 0; e < i; e++)
        c.push((t + 0) * u + e, (t + 1) * u + e, (t + 0) * u + e + 1),
          c.push((t + 1) * u + e, (t + 1) * u + e + 1, (t + 0) * u + e + 1);
    return ct({ position: a, normal: h, texcoord: l, indices: c }, r);
  }
  function gt(t, e, i, s, r, n, a) {
    if (e <= 0 || i <= 0)
      throw new Error("subdivisionAxis and subdivisionHeight must be > 0");
    (s = s || 0), (n = n || 0);
    const o = (r = r || Math.PI) - s,
      h = (a = a || 2 * Math.PI) - n,
      l = (e + 1) * (i + 1),
      u = nt(3, l),
      c = nt(3, l),
      d = nt(2, l);
    for (let r = 0; r <= i; r++)
      for (let a = 0; a <= e; a++) {
        const l = a / e,
          f = r / i,
          g = h * l + n,
          b = o * f + s,
          _ = Math.sin(g),
          p = Math.cos(g),
          m = Math.sin(b),
          x = p * m,
          v = Math.cos(b),
          T = _ * m;
        u.push(t * x, t * v, t * T), c.push(x, v, T), d.push(1 - l, f);
      }
    const f = e + 1,
      g = nt(3, e * i * 2, Uint16Array);
    for (let t = 0; t < e; t++)
      for (let e = 0; e < i; e++)
        g.push((e + 0) * f + t, (e + 0) * f + t + 1, (e + 1) * f + t),
          g.push((e + 1) * f + t, (e + 0) * f + t + 1, (e + 1) * f + t + 1);
    return { position: u, normal: c, texcoord: d, indices: g };
  }
  const bt = [
    [3, 7, 5, 1],
    [6, 2, 0, 4],
    [6, 7, 3, 2],
    [0, 1, 5, 4],
    [7, 6, 4, 5],
    [2, 3, 1, 0],
  ];
  function _t(t) {
    const e = (t = t || 1) / 2,
      i = [
        [-e, -e, -e],
        [+e, -e, -e],
        [-e, +e, -e],
        [+e, +e, -e],
        [-e, -e, +e],
        [+e, -e, +e],
        [-e, +e, +e],
        [+e, +e, +e],
      ],
      s = [
        [1, 0, 0],
        [-1, 0, 0],
        [0, 1, 0],
        [0, -1, 0],
        [0, 0, 1],
        [0, 0, -1],
      ],
      r = [
        [1, 0],
        [0, 0],
        [0, 1],
        [1, 1],
      ],
      n = nt(3, 24),
      a = nt(3, 24),
      o = nt(2, 24),
      h = nt(3, 12, Uint16Array);
    for (let t = 0; t < 6; ++t) {
      const e = bt[t];
      for (let h = 0; h < 4; ++h) {
        const l = i[e[h]],
          u = s[t],
          c = r[h];
        n.push(l), a.push(u), o.push(c);
      }
      const l = 4 * t;
      h.push(l + 0, l + 1, l + 2), h.push(l + 0, l + 2, l + 3);
    }
    return { position: n, normal: a, texcoord: o, indices: h };
  }
  function pt(t, e, i, s, r, n, a) {
    if (s < 3) throw new Error("radialSubdivisions must be 3 or greater");
    if (r < 1) throw new Error("verticalSubdivisions must be 1 or greater");
    const o = void 0 === n || n,
      h = void 0 === a || a,
      l = (o ? 2 : 0) + (h ? 2 : 0),
      u = (s + 1) * (r + 1 + l),
      c = nt(3, u),
      d = nt(3, u),
      f = nt(2, u),
      g = nt(3, s * (r + l / 2) * 2, Uint16Array),
      b = s + 1,
      _ = Math.atan2(t - e, i),
      p = Math.cos(_),
      m = Math.sin(_),
      x = r + (h ? 2 : 0);
    for (let n = o ? -2 : 0; n <= x; ++n) {
      let a,
        o = n / r,
        h = i * o;
      n < 0
        ? ((h = 0), (o = 1), (a = t))
        : n > r
        ? ((h = i), (o = 1), (a = e))
        : (a = t + (n / r) * (e - t)),
        (-2 !== n && n !== r + 2) || ((a = 0), (o = 0)),
        (h -= i / 2);
      for (let t = 0; t < b; ++t) {
        const e = Math.sin((t * Math.PI * 2) / s),
          i = Math.cos((t * Math.PI * 2) / s);
        c.push(e * a, h, i * a),
          n < 0
            ? d.push(0, -1, 0)
            : n > r
            ? d.push(0, 1, 0)
            : 0 === a
            ? d.push(0, 0, 0)
            : d.push(e * p, m, i * p),
          f.push(t / s, 1 - o);
      }
    }
    for (let t = 0; t < r + l; ++t)
      if (!((1 === t && o) || (t === r + l - 2 && h)))
        for (let e = 0; e < s; ++e)
          g.push(b * (t + 0) + 0 + e, b * (t + 0) + 1 + e, b * (t + 1) + 1 + e),
            g.push(
              b * (t + 0) + 0 + e,
              b * (t + 1) + 1 + e,
              b * (t + 1) + 0 + e
            );
    return { position: c, normal: d, texcoord: f, indices: g };
  }
  function mt(t, e) {
    e = e || [];
    const i = [];
    for (let s = 0; s < t.length; s += 4) {
      const r = t[s],
        n = t.slice(s + 1, s + 4);
      n.push.apply(n, e);
      for (let t = 0; t < r; ++t) i.push.apply(i, n);
    }
    return i;
  }
  function xt() {
    const t = [
        0, 0, 0, 0, 150, 0, 30, 0, 0, 0, 150, 0, 30, 150, 0, 30, 0, 0, 30, 0, 0,
        30, 30, 0, 100, 0, 0, 30, 30, 0, 100, 30, 0, 100, 0, 0, 30, 60, 0, 30,
        90, 0, 67, 60, 0, 30, 90, 0, 67, 90, 0, 67, 60, 0, 0, 0, 30, 30, 0, 30,
        0, 150, 30, 0, 150, 30, 30, 0, 30, 30, 150, 30, 30, 0, 30, 100, 0, 30,
        30, 30, 30, 30, 30, 30, 100, 0, 30, 100, 30, 30, 30, 60, 30, 67, 60, 30,
        30, 90, 30, 30, 90, 30, 67, 60, 30, 67, 90, 30, 0, 0, 0, 100, 0, 0, 100,
        0, 30, 0, 0, 0, 100, 0, 30, 0, 0, 30, 100, 0, 0, 100, 30, 0, 100, 30,
        30, 100, 0, 0, 100, 30, 30, 100, 0, 30, 30, 30, 0, 30, 30, 30, 100, 30,
        30, 30, 30, 0, 100, 30, 30, 100, 30, 0, 30, 30, 0, 30, 60, 30, 30, 30,
        30, 30, 30, 0, 30, 60, 0, 30, 60, 30, 30, 60, 0, 67, 60, 30, 30, 60, 30,
        30, 60, 0, 67, 60, 0, 67, 60, 30, 67, 60, 0, 67, 90, 30, 67, 60, 30, 67,
        60, 0, 67, 90, 0, 67, 90, 30, 30, 90, 0, 30, 90, 30, 67, 90, 30, 30, 90,
        0, 67, 90, 30, 67, 90, 0, 30, 90, 0, 30, 150, 30, 30, 90, 30, 30, 90, 0,
        30, 150, 0, 30, 150, 30, 0, 150, 0, 0, 150, 30, 30, 150, 30, 0, 150, 0,
        30, 150, 30, 30, 150, 0, 0, 0, 0, 0, 0, 30, 0, 150, 30, 0, 0, 0, 0, 150,
        30, 0, 150, 0,
      ],
      e = mt([
        18, 0, 0, 1, 18, 0, 0, -1, 6, 0, 1, 0, 6, 1, 0, 0, 6, 0, -1, 0, 6, 1, 0,
        0, 6, 0, 1, 0, 6, 1, 0, 0, 6, 0, -1, 0, 6, 1, 0, 0, 6, 0, -1, 0, 6, -1,
        0, 0,
      ]),
      i = mt(
        [
          18, 200, 70, 120, 18, 80, 70, 200, 6, 70, 200, 210, 6, 200, 200, 70,
          6, 210, 100, 70, 6, 210, 160, 70, 6, 70, 180, 210, 6, 100, 70, 210, 6,
          76, 210, 100, 6, 140, 210, 80, 6, 90, 130, 110, 6, 160, 160, 220,
        ],
        [255]
      ),
      s = t.length / 3,
      r = {
        position: nt(3, s),
        texcoord: nt(2, s),
        normal: nt(3, s),
        color: nt(4, s, Uint8Array),
        indices: nt(3, s / 3, Uint16Array),
      };
    r.position.push(t),
      r.texcoord.push([
        0.22, 0.19, 0.22, 0.79, 0.34, 0.19, 0.22, 0.79, 0.34, 0.79, 0.34, 0.19,
        0.34, 0.19, 0.34, 0.31, 0.62, 0.19, 0.34, 0.31, 0.62, 0.31, 0.62, 0.19,
        0.34, 0.43, 0.34, 0.55, 0.49, 0.43, 0.34, 0.55, 0.49, 0.55, 0.49, 0.43,
        0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1,
        0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1,
        0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0,
        0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1,
        0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0,
        0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0,
        0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0,
      ]),
      r.normal.push(e),
      r.color.push(i);
    for (let t = 0; t < s; ++t) r.indices.push(t);
    return r;
  }
  function vt(t, e, i, s, a, o, h) {
    if (a <= 0) throw new Error("subdivisionDown must be > 0");
    const l = (h = h || 1) - (o = o || 0),
      u = 2 * (a + 1) * 4,
      c = nt(3, u),
      d = nt(3, u),
      f = nt(2, u);
    function g(t, e, i) {
      return t + (e - t) * i;
    }
    function b(e, i, h, u, b, _) {
      for (let p = 0; p <= a; p++) {
        const m = i / 1,
          x = p / a,
          v = 2 * (m - 0.5),
          T = (o + x * l) * Math.PI,
          w = Math.sin(T),
          y = Math.cos(T),
          A = g(t, e, w),
          E = v * s,
          M = y * t,
          C = w * A;
        c.push(E, M, C);
        const S = r(n([0, w, y], h), u);
        d.push(S), f.push(m * b + _, x);
      }
    }
    for (let t = 0; t < 2; t++) {
      const s = 2 * (t / 1 - 0.5);
      b(e, t, [1, 1, 1], [0, 0, 0], 1, 0),
        b(e, t, [0, 0, 0], [s, 0, 0], 0, 0),
        b(i, t, [1, 1, 1], [0, 0, 0], 1, 0),
        b(i, t, [0, 0, 0], [s, 0, 0], 0, 1);
    }
    const _ = nt(3, 2 * a * 4, Uint16Array);
    function p(t, e) {
      for (let i = 0; i < a; ++i)
        _.push(t + i + 0, t + i + 1, e + i + 0),
          _.push(t + i + 1, e + i + 1, e + i + 0);
    }
    const m = a + 1;
    return (
      p(0 * m, 4 * m),
      p(5 * m, 7 * m),
      p(6 * m, 2 * m),
      p(3 * m, 1 * m),
      { position: c, normal: d, texcoord: f, indices: _ }
    );
  }
  function Tt(t, e, i, s, r, n) {
    return pt(t, t, e, i, s, r, n);
  }
  function wt(t, e, i, s, r, n) {
    if (i < 3) throw new Error("radialSubdivisions must be 3 or greater");
    if (s < 3) throw new Error("verticalSubdivisions must be 3 or greater");
    r = r || 0;
    const a = (n = n || 2 * Math.PI) - r,
      o = i + 1,
      h = s + 1,
      l = o * h,
      u = nt(3, l),
      c = nt(3, l),
      d = nt(2, l),
      f = nt(3, i * s * 2, Uint16Array);
    for (let n = 0; n < h; ++n) {
      const h = n / s,
        l = h * Math.PI * 2,
        f = Math.sin(l),
        g = t + f * e,
        b = Math.cos(l),
        _ = b * e;
      for (let t = 0; t < o; ++t) {
        const e = t / i,
          s = r + e * a,
          n = Math.sin(s),
          o = Math.cos(s),
          l = n * g,
          p = o * g,
          m = n * f,
          x = o * f;
        u.push(l, _, p), c.push(m, b, x), d.push(e, 1 - h);
      }
    }
    for (let t = 0; t < s; ++t)
      for (let e = 0; e < i; ++e) {
        const i = 1 + e,
          s = 1 + t;
        f.push(o * t + e, o * s + e, o * t + i),
          f.push(o * s + e, o * s + i, o * t + i);
      }
    return { position: u, normal: c, texcoord: d, indices: f };
  }
  function yt(t, e, i, s, r) {
    if (e < 3) throw new Error("divisions must be at least 3");
    (r = r || 1), (s = s || 0);
    const n = (e + 1) * ((i = i || 1) + 1),
      a = nt(3, n),
      o = nt(3, n),
      h = nt(2, n),
      l = nt(3, i * e * 2, Uint16Array);
    let u = 0;
    const c = t - s,
      d = e + 1;
    for (let t = 0; t <= i; ++t) {
      const n = s + c * Math.pow(t / i, r);
      for (let s = 0; s <= e; ++s) {
        const r = (2 * Math.PI * s) / e,
          c = n * Math.cos(r),
          f = n * Math.sin(r);
        if (
          (a.push(c, 0, f),
          o.push(0, 1, 0),
          h.push(1 - s / e, t / i),
          t > 0 && s !== e)
        ) {
          const t = u + (s + 1),
            e = u + s,
            i = u + s - d,
            r = u + (s + 1) - d;
          l.push(t, e, i), l.push(t, i, r);
        }
      }
      u += e + 1;
    }
    return { position: a, normal: o, texcoord: h, indices: l };
  }
  function At(t) {
    return function (e) {
      return st(e, t.apply(this, Array.prototype.slice.call(arguments, 1)));
    };
  }
  function Et(t) {
    return function (e) {
      return et(e, t.apply(null, Array.prototype.slice.call(arguments, 1)));
    };
  }
  Et(xt),
    At(xt),
    Et(_t),
    At(_t),
    Et(ft),
    At(ft),
    Et(gt),
    At(gt),
    Et(pt),
    At(pt),
    Et(dt),
    At(dt),
    Et(vt),
    At(vt),
    Et(Tt),
    At(Tt),
    Et(wt),
    At(wt),
    Et(yt),
    At(yt);
  function Mt(t) {
    return !!t.texStorage2D;
  }
  const Ct = (function () {
    const t = {},
      e = {};
    return function (i, s) {
      return (
        (function (i) {
          const s = i.constructor.name;
          if (!t[s]) {
            for (const t in i)
              if ("number" == typeof i[t]) {
                const s = e[i[t]];
                e[i[t]] = s ? `${s} | ${t}` : t;
              }
            t[s] = !0;
          }
        })(i),
        e[s] || ("number" == typeof s ? `0x${s.toString(16)}` : s)
      );
    };
  })();
  new Uint8Array([128, 192, 255, 255]),
    (function () {
      let t;
    })();
  const St = 6406,
    Ft = 6407,
    It = 6408,
    kt = 6409,
    Dt = 6410,
    Rt = 6402,
    Ut = 34041,
    Ot = 33319,
    Bt = 33320,
    Pt = 6403,
    zt = 36244,
    Nt = 36248,
    Gt = 36249,
    Lt = {};
  {
    const t = Lt;
    (t[St] = { numColorComponents: 1 }),
      (t[kt] = { numColorComponents: 1 }),
      (t[Dt] = { numColorComponents: 2 }),
      (t[Ft] = { numColorComponents: 3 }),
      (t[It] = { numColorComponents: 4 }),
      (t[Pt] = { numColorComponents: 1 }),
      (t[zt] = { numColorComponents: 1 }),
      (t[Ot] = { numColorComponents: 2 }),
      (t[Bt] = { numColorComponents: 2 }),
      (t[Ft] = { numColorComponents: 3 }),
      (t[Nt] = { numColorComponents: 3 }),
      (t[It] = { numColorComponents: 4 }),
      (t[Gt] = { numColorComponents: 4 }),
      (t[Rt] = { numColorComponents: 1 }),
      (t[Ut] = { numColorComponents: 2 });
  }
  const jt = y;
  function Yt(t) {
    return "undefined" != typeof document && document.getElementById
      ? document.getElementById(t)
      : null;
  }
  const Ht = 33984,
    qt = 34962,
    Vt = 35713,
    Xt = 35714,
    Kt = 35632,
    Wt = 35633,
    Zt = 35981,
    Jt = 35718,
    $t = 35721,
    Qt = 35971,
    te = 35382,
    ee = 35396,
    ie = 35398,
    se = 35392,
    re = 35395,
    ne = 5126,
    ae = 5124,
    oe = 5125,
    he = 3553,
    le = 34067,
    ue = 32879,
    ce = 35866,
    de = {};
  function fe(t, e) {
    return de[e].bindPoint;
  }
  function ge(t, e) {
    return function (i) {
      t.uniform1i(e, i);
    };
  }
  function be(t, e) {
    return function (i) {
      t.uniform1iv(e, i);
    };
  }
  function _e(t, e) {
    return function (i) {
      t.uniform2iv(e, i);
    };
  }
  function pe(t, e) {
    return function (i) {
      t.uniform3iv(e, i);
    };
  }
  function me(t, e) {
    return function (i) {
      t.uniform4iv(e, i);
    };
  }
  function xe(t, e, i, s) {
    const r = fe(0, e);
    return Mt(t)
      ? function (e) {
          let n, a;
          !e || M(0, e)
            ? ((n = e), (a = null))
            : ((n = e.texture), (a = e.sampler)),
            t.uniform1i(s, i),
            t.activeTexture(Ht + i),
            t.bindTexture(r, n),
            t.bindSampler(i, a);
        }
      : function (e) {
          t.uniform1i(s, i), t.activeTexture(Ht + i), t.bindTexture(r, e);
        };
  }
  function ve(t, e, i, s, r) {
    const n = fe(0, e),
      a = new Int32Array(r);
    for (let t = 0; t < r; ++t) a[t] = i + t;
    return Mt(t)
      ? function (e) {
          t.uniform1iv(s, a),
            e.forEach(function (e, s) {
              let r, o;
              t.activeTexture(Ht + a[s]),
                !e || M(0, e)
                  ? ((r = e), (o = null))
                  : ((r = e.texture), (o = e.sampler)),
                t.bindSampler(i, o),
                t.bindTexture(n, r);
            });
        }
      : function (e) {
          t.uniform1iv(s, a),
            e.forEach(function (e, i) {
              t.activeTexture(Ht + a[i]), t.bindTexture(n, e);
            });
        };
  }
  function Te(t, e) {
    return function (i) {
      if (i.value)
        switch ((t.disableVertexAttribArray(e), i.value.length)) {
          case 4:
            t.vertexAttrib4fv(e, i.value);
            break;
          case 3:
            t.vertexAttrib3fv(e, i.value);
            break;
          case 2:
            t.vertexAttrib2fv(e, i.value);
            break;
          case 1:
            t.vertexAttrib1fv(e, i.value);
            break;
          default:
            throw new Error(
              "the length of a float constant value must be between 1 and 4!"
            );
        }
      else
        t.bindBuffer(qt, i.buffer),
          t.enableVertexAttribArray(e),
          t.vertexAttribPointer(
            e,
            i.numComponents || i.size,
            i.type || ne,
            i.normalize || !1,
            i.stride || 0,
            i.offset || 0
          ),
          t.vertexAttribDivisor && t.vertexAttribDivisor(e, i.divisor || 0);
    };
  }
  function we(t, e) {
    return function (i) {
      if (i.value) {
        if ((t.disableVertexAttribArray(e), 4 !== i.value.length))
          throw new Error("The length of an integer constant value must be 4!");
        t.vertexAttrib4iv(e, i.value);
      } else
        t.bindBuffer(qt, i.buffer),
          t.enableVertexAttribArray(e),
          t.vertexAttribIPointer(
            e,
            i.numComponents || i.size,
            i.type || ae,
            i.stride || 0,
            i.offset || 0
          ),
          t.vertexAttribDivisor && t.vertexAttribDivisor(e, i.divisor || 0);
    };
  }
  function ye(t, e) {
    return function (i) {
      if (i.value) {
        if ((t.disableVertexAttribArray(e), 4 !== i.value.length))
          throw new Error(
            "The length of an unsigned integer constant value must be 4!"
          );
        t.vertexAttrib4uiv(e, i.value);
      } else
        t.bindBuffer(qt, i.buffer),
          t.enableVertexAttribArray(e),
          t.vertexAttribIPointer(
            e,
            i.numComponents || i.size,
            i.type || oe,
            i.stride || 0,
            i.offset || 0
          ),
          t.vertexAttribDivisor && t.vertexAttribDivisor(e, i.divisor || 0);
    };
  }
  function Ae(t, e, i) {
    const s = i.size,
      r = i.count;
    return function (i) {
      t.bindBuffer(qt, i.buffer);
      const n = i.size || i.numComponents || s,
        a = n / r,
        o = i.type || ne,
        h = de[o].size * n,
        l = i.normalize || !1,
        u = i.offset || 0,
        c = h / r;
      for (let s = 0; s < r; ++s)
        t.enableVertexAttribArray(e + s),
          t.vertexAttribPointer(e + s, a, o, l, h, u + c * s),
          t.vertexAttribDivisor && t.vertexAttribDivisor(e + s, i.divisor || 0);
    };
  }
  (de[5126] = {
    Type: Float32Array,
    size: 4,
    setter: function (t, e) {
      return function (i) {
        t.uniform1f(e, i);
      };
    },
    arraySetter: function (t, e) {
      return function (i) {
        t.uniform1fv(e, i);
      };
    },
  }),
    (de[35664] = {
      Type: Float32Array,
      size: 8,
      setter: function (t, e) {
        return function (i) {
          t.uniform2fv(e, i);
        };
      },
      cols: 2,
    }),
    (de[35665] = {
      Type: Float32Array,
      size: 12,
      setter: function (t, e) {
        return function (i) {
          t.uniform3fv(e, i);
        };
      },
      cols: 3,
    }),
    (de[35666] = {
      Type: Float32Array,
      size: 16,
      setter: function (t, e) {
        return function (i) {
          t.uniform4fv(e, i);
        };
      },
      cols: 4,
    }),
    (de[ae] = { Type: Int32Array, size: 4, setter: ge, arraySetter: be }),
    (de[35667] = { Type: Int32Array, size: 8, setter: _e, cols: 2 }),
    (de[35668] = { Type: Int32Array, size: 12, setter: pe, cols: 3 }),
    (de[35669] = { Type: Int32Array, size: 16, setter: me, cols: 4 }),
    (de[5125] = {
      Type: Uint32Array,
      size: 4,
      setter: function (t, e) {
        return function (i) {
          t.uniform1ui(e, i);
        };
      },
      arraySetter: function (t, e) {
        return function (i) {
          t.uniform1uiv(e, i);
        };
      },
    }),
    (de[36294] = {
      Type: Uint32Array,
      size: 8,
      setter: function (t, e) {
        return function (i) {
          t.uniform2uiv(e, i);
        };
      },
      cols: 2,
    }),
    (de[36295] = {
      Type: Uint32Array,
      size: 12,
      setter: function (t, e) {
        return function (i) {
          t.uniform3uiv(e, i);
        };
      },
      cols: 3,
    }),
    (de[36296] = {
      Type: Uint32Array,
      size: 16,
      setter: function (t, e) {
        return function (i) {
          t.uniform4uiv(e, i);
        };
      },
      cols: 4,
    }),
    (de[35670] = { Type: Uint32Array, size: 4, setter: ge, arraySetter: be }),
    (de[35671] = { Type: Uint32Array, size: 8, setter: _e, cols: 2 }),
    (de[35672] = { Type: Uint32Array, size: 12, setter: pe, cols: 3 }),
    (de[35673] = { Type: Uint32Array, size: 16, setter: me, cols: 4 }),
    (de[35674] = {
      Type: Float32Array,
      size: 32,
      setter: function (t, e) {
        return function (i) {
          t.uniformMatrix2fv(e, !1, i);
        };
      },
      rows: 2,
      cols: 2,
    }),
    (de[35675] = {
      Type: Float32Array,
      size: 48,
      setter: function (t, e) {
        return function (i) {
          t.uniformMatrix3fv(e, !1, i);
        };
      },
      rows: 3,
      cols: 3,
    }),
    (de[35676] = {
      Type: Float32Array,
      size: 64,
      setter: function (t, e) {
        return function (i) {
          t.uniformMatrix4fv(e, !1, i);
        };
      },
      rows: 4,
      cols: 4,
    }),
    (de[35685] = {
      Type: Float32Array,
      size: 32,
      setter: function (t, e) {
        return function (i) {
          t.uniformMatrix2x3fv(e, !1, i);
        };
      },
      rows: 2,
      cols: 3,
    }),
    (de[35686] = {
      Type: Float32Array,
      size: 32,
      setter: function (t, e) {
        return function (i) {
          t.uniformMatrix2x4fv(e, !1, i);
        };
      },
      rows: 2,
      cols: 4,
    }),
    (de[35687] = {
      Type: Float32Array,
      size: 48,
      setter: function (t, e) {
        return function (i) {
          t.uniformMatrix3x2fv(e, !1, i);
        };
      },
      rows: 3,
      cols: 2,
    }),
    (de[35688] = {
      Type: Float32Array,
      size: 48,
      setter: function (t, e) {
        return function (i) {
          t.uniformMatrix3x4fv(e, !1, i);
        };
      },
      rows: 3,
      cols: 4,
    }),
    (de[35689] = {
      Type: Float32Array,
      size: 64,
      setter: function (t, e) {
        return function (i) {
          t.uniformMatrix4x2fv(e, !1, i);
        };
      },
      rows: 4,
      cols: 2,
    }),
    (de[35690] = {
      Type: Float32Array,
      size: 64,
      setter: function (t, e) {
        return function (i) {
          t.uniformMatrix4x3fv(e, !1, i);
        };
      },
      rows: 4,
      cols: 3,
    }),
    (de[35678] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: he,
    }),
    (de[35680] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: le,
    }),
    (de[35679] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: ue,
    }),
    (de[35682] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: he,
    }),
    (de[36289] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: ce,
    }),
    (de[36292] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: ce,
    }),
    (de[36293] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: le,
    }),
    (de[36298] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: he,
    }),
    (de[36299] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: ue,
    }),
    (de[36300] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: le,
    }),
    (de[36303] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: ce,
    }),
    (de[36306] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: he,
    }),
    (de[36307] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: ue,
    }),
    (de[36308] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: le,
    }),
    (de[36311] = {
      Type: null,
      size: 0,
      setter: xe,
      arraySetter: ve,
      bindPoint: ce,
    });
  const Ee = {};
  (Ee[5126] = { size: 4, setter: Te }),
    (Ee[35664] = { size: 8, setter: Te }),
    (Ee[35665] = { size: 12, setter: Te }),
    (Ee[35666] = { size: 16, setter: Te }),
    (Ee[ae] = { size: 4, setter: we }),
    (Ee[35667] = { size: 8, setter: we }),
    (Ee[35668] = { size: 12, setter: we }),
    (Ee[35669] = { size: 16, setter: we }),
    (Ee[5125] = { size: 4, setter: ye }),
    (Ee[36294] = { size: 8, setter: ye }),
    (Ee[36295] = { size: 12, setter: ye }),
    (Ee[36296] = { size: 16, setter: ye }),
    (Ee[35670] = { size: 4, setter: we }),
    (Ee[35671] = { size: 8, setter: we }),
    (Ee[35672] = { size: 12, setter: we }),
    (Ee[35673] = { size: 16, setter: we }),
    (Ee[35674] = { size: 4, setter: Ae, count: 2 }),
    (Ee[35675] = { size: 9, setter: Ae, count: 3 }),
    (Ee[35676] = { size: 16, setter: Ae, count: 4 });
  const Me = /ERROR:\s*\d+:(\d+)/gi;
  const Ce = /^[ \t]*\n/;
  function Se(t) {
    let e = 0;
    return (
      Ce.test(t) && ((e = 1), (t = t.replace(Ce, ""))),
      { lineOffset: e, shaderSource: t }
    );
  }
  function Fe(t, e) {
    return (
      t.errorCallback(e),
      t.callback &&
        setTimeout(() => {
          t.callback(`${e}\n${t.errors.join("\n")}`);
        }),
      null
    );
  }
  function Ie(t, e, i, s) {
    s = s || jt;
    if (!t.getShaderParameter(i, Vt)) {
      const r = t.getShaderInfoLog(i),
        { lineOffset: n, shaderSource: a } = Se(t.getShaderSource(i)),
        o = `${(function (t, e = "", i = 0) {
          const s = [...e.matchAll(Me)],
            r = new Map(
              s.map((t, i) => {
                const r = parseInt(t[1]),
                  n = s[i + 1],
                  a = n ? n.index : e.length;
                return [r - 1, e.substring(t.index, a)];
              })
            );
          return t
            .split("\n")
            .map((t, e) => {
              const s = r.get(e);
              return `${e + 1 + i}: ${t}${s ? `\n\n^^^ ${s}` : ""}`;
            })
            .join("\n");
        })(a, r, n)}\nError compiling ${Ct(t, e)}: ${r}`;
      return s(o), o;
    }
    return "";
  }
  function ke(t, e, i) {
    let s, r, n;
    if (
      ("function" == typeof e && ((i = e), (e = void 0)),
      "function" == typeof t)
    )
      (i = t), (t = void 0);
    else if (t && !Array.isArray(t)) {
      const e = t;
      (i = e.errorCallback),
        (t = e.attribLocations),
        (s = e.transformFeedbackVaryings),
        (r = e.transformFeedbackMode),
        (n = e.callback);
    }
    const a = i || jt,
      o = [],
      h = {
        errorCallback(t, ...e) {
          o.push(t), a(t, ...e);
        },
        transformFeedbackVaryings: s,
        transformFeedbackMode: r,
        callback: n,
        errors: o,
      };
    {
      let i = {};
      Array.isArray(t)
        ? t.forEach(function (t, s) {
            i[t] = e ? e[s] : s;
          })
        : (i = t || {}),
        (h.attribLocations = i);
    }
    return h;
  }
  const De = ["VERTEX_SHADER", "FRAGMENT_SHADER"];
  const Re = (t = 0) => new Promise((e) => setTimeout(e, t));
  function Ue(t, e, i) {
    const s = t.createProgram(),
      {
        attribLocations: r,
        transformFeedbackVaryings: n,
        transformFeedbackMode: a,
      } = ke(i);
    for (let i = 0; i < e.length; ++i) {
      let r = e[i];
      if ("string" == typeof r) {
        const e = Yt(r),
          n = e ? e.text : r;
        let a = t[De[i]];
        e &&
          e.type &&
          (a =
            ((o = e.type).indexOf("frag") >= 0
              ? Kt
              : o.indexOf("vert") >= 0
              ? Wt
              : void 0) || a),
          (r = t.createShader(a)),
          t.shaderSource(r, Se(n).shaderSource),
          t.compileShader(r),
          t.attachShader(s, r);
      }
    }
    var o;
    Object.entries(r).forEach(([e, i]) => t.bindAttribLocation(s, i, e));
    {
      let e = n;
      e &&
        (e.attribs && (e = e.attribs),
        Array.isArray(e) || (e = Object.keys(e)),
        t.transformFeedbackVaryings(s, e, a || Zt));
    }
    return t.linkProgram(s), s;
  }
  function Oe(t, e, i, s, r) {
    const n = ke(i, s, r),
      a = new Set(e),
      o = Ue(t, e, n);
    function h(t, e) {
      const i = ze(t, e, n.errorCallback);
      return (
        i &&
          (function (t, e, i) {
            const s = t.getAttachedShaders(e);
            for (const e of s) i.has(e) && t.deleteShader(e);
            t.deleteProgram(e);
          })(t, e, a),
        i
      );
    }
    if (!n.callback) return h(t, o) ? void 0 : o;
    Pe(t, o).then(() => {
      const e = h(t, o);
      n.callback(e, e ? void 0 : o);
    });
  }
  function Be(t) {
    return function (e, i, ...s) {
      return new Promise((r, n) => {
        const a = ke(...s);
        (a.callback = (t, e) => {
          t ? n(t) : r(e);
        }),
          t(e, i, a);
      });
    };
  }
  Be(Oe), Be($e);
  async function Pe(t, e) {
    const i = t.getExtension("KHR_parallel_shader_compile"),
      s = i
        ? (t, e) => t.getProgramParameter(e, i.COMPLETION_STATUS_KHR)
        : () => !0;
    let r = 0;
    do {
      await Re(r), (r = 1e3 / 60);
    } while (!s(t, e));
  }
  function ze(t, e, i) {
    i = i || jt;
    if (!t.getProgramParameter(e, Xt)) {
      const s = t.getProgramInfoLog(e);
      i(`Error in program linking: ${s}`);
      return `${s}\n${t
        .getAttachedShaders(e)
        .map((e) => Ie(t, t.getShaderParameter(e, t.SHADER_TYPE), e, i))
        .filter((t) => t)
        .join("\n")}`;
    }
  }
  function Ne(t, e, i, s, r) {
    return Oe(t, e, i, s, r);
  }
  function Ge(t) {
    const e = t.name;
    return e.startsWith("gl_") || e.startsWith("webgl_");
  }
  const Le = /(\.|\[|]|\w+)/g,
    je = (t) => t >= "0" && t <= "9";
  function Ye(t, e, i, s) {
    const r = t.split(Le).filter((t) => "" !== t);
    let n = 0,
      a = "";
    for (;;) {
      const t = r[n++];
      a += t;
      const o = je(t[0]),
        h = o ? parseInt(t) : t;
      o && (a += r[n++]);
      if (n === r.length) {
        i[h] = e;
        break;
      }
      {
        const t = r[n++],
          e = "[" === t,
          o = i[h] || (e ? [] : {});
        (i[h] = o),
          (i = o),
          (s[a] =
            s[a] ||
            (function (t) {
              return function (e) {
                Xe(t, e);
              };
            })(o)),
          (a += t);
      }
    }
  }
  function He(t, e) {
    let i = 0;
    function s(e, s, r) {
      const n = s.name.endsWith("[0]"),
        a = s.type,
        o = de[a];
      if (!o) throw new Error(`unknown type: 0x${a.toString(16)}`);
      let h;
      if (o.bindPoint) {
        const e = i;
        (i += s.size),
          (h = n
            ? o.arraySetter(t, a, e, r, s.size)
            : o.setter(t, a, e, r, s.size));
      } else h = o.arraySetter && n ? o.arraySetter(t, r) : o.setter(t, r);
      return (h.location = r), h;
    }
    const r = {},
      n = {},
      a = t.getProgramParameter(e, Jt);
    for (let i = 0; i < a; ++i) {
      const a = t.getActiveUniform(e, i);
      if (Ge(a)) continue;
      let o = a.name;
      o.endsWith("[0]") && (o = o.substr(0, o.length - 3));
      const h = t.getUniformLocation(e, a.name);
      if (h) {
        const t = s(0, a, h);
        (r[o] = t), Ye(o, t, n, r);
      }
    }
    return r;
  }
  function qe(t, e) {
    const i = {},
      s = t.getProgramParameter(e, Qt);
    for (let r = 0; r < s; ++r) {
      const s = t.getTransformFeedbackVarying(e, r);
      i[s.name] = { index: r, type: s.type, size: s.size };
    }
    return i;
  }
  function Ve(t, e) {
    const i = t.getProgramParameter(e, Jt),
      s = [],
      r = [];
    for (let n = 0; n < i; ++n) {
      r.push(n), s.push({});
      const i = t.getActiveUniform(e, n);
      s[n].name = i.name;
    }
    [
      ["UNIFORM_TYPE", "type"],
      ["UNIFORM_SIZE", "size"],
      ["UNIFORM_BLOCK_INDEX", "blockNdx"],
      ["UNIFORM_OFFSET", "offset"],
    ].forEach(function (i) {
      const n = i[0],
        a = i[1];
      t.getActiveUniforms(e, r, t[n]).forEach(function (t, e) {
        s[e][a] = t;
      });
    });
    const n = {},
      a = t.getProgramParameter(e, te);
    for (let i = 0; i < a; ++i) {
      const s = t.getActiveUniformBlockName(e, i),
        r = {
          index: t.getUniformBlockIndex(e, s),
          usedByVertexShader: t.getActiveUniformBlockParameter(e, i, ee),
          usedByFragmentShader: t.getActiveUniformBlockParameter(e, i, ie),
          size: t.getActiveUniformBlockParameter(e, i, se),
          uniformIndices: t.getActiveUniformBlockParameter(e, i, re),
        };
      (r.used = r.usedByVertexShader || r.usedByFragmentShader), (n[s] = r);
    }
    return { blockSpecs: n, uniformData: s };
  }
  function Xe(t, e) {
    for (const i in e) {
      const s = t[i];
      "function" == typeof s ? s(e[i]) : Xe(t[i], e[i]);
    }
  }
  function Ke(t, ...e) {
    const i = t.uniformSetters || t,
      s = e.length;
    for (let t = 0; t < s; ++t) {
      const s = e[t];
      if (Array.isArray(s)) {
        const t = s.length;
        for (let e = 0; e < t; ++e) Ke(i, s[e]);
      } else
        for (const t in s) {
          const e = i[t];
          e && e(s[t]);
        }
    }
  }
  function We(t, e) {
    const i = {},
      s = t.getProgramParameter(e, $t);
    for (let r = 0; r < s; ++r) {
      const s = t.getActiveAttrib(e, r);
      if (Ge(s)) continue;
      const n = t.getAttribLocation(e, s.name),
        a = Ee[s.type],
        o = a.setter(t, n, a);
      (o.location = n), (i[s.name] = o);
    }
    return i;
  }
  function Ze(t, e) {
    const i = { program: e, uniformSetters: He(t, e), attribSetters: We(t, e) };
    return (
      Mt(t) &&
        ((i.uniformBlockSpec = Ve(t, e)), (i.transformFeedbackInfo = qe(t, e))),
      i
    );
  }
  const Je = /\s|{|}|;/;
  function $e(t, e, i, s, r) {
    const n = ke(i, s, r),
      a = [];
    if (
      ((e = e.map(function (t) {
        if (!Je.test(t)) {
          const e = Yt(t);
          if (e) t = e.text;
          else {
            const e = `no element with id: ${t}`;
            n.errorCallback(e), a.push(e);
          }
        }
        return t;
      })),
      a.length)
    )
      return Fe(n, "");
    const o = n.callback;
    o &&
      (n.callback = (e, i) => {
        o(e, e ? void 0 : Ze(t, i));
      });
    const h = Ne(t, e, n);
    return h ? Ze(t, h) : null;
  }
  function Qe(t, e, i, s, r) {
    for (const [n, a] of Object.entries(e)) {
      const o = { ...r },
        h = i[n];
      Array.isArray(h) || Object.assign(o, h);
      const l = ze(t, a, o.errorCallback);
      if (l) {
        for (const i of Object.values(e)) {
          const e = t.getAttachedShaders(i);
          t.deleteProgram(i);
          for (const i of e) s.has(i) || t.deleteShader(i);
        }
        return l;
      }
    }
  }
  function ti(t, e, i = {}) {
    const s = new Set(),
      r = Object.fromEntries(
        Object.entries(e).map(([e, r]) => {
          const n = { ...i },
            a = Array.isArray(r) ? r : r.shaders;
          return (
            Array.isArray(r) || Object.assign(n, r),
            a.forEach(s.add, s),
            [e, Ue(t, a, n)]
          );
        })
      );
    if (i.callback)
      return void (async function (t, e) {
        for (const i of Object.values(e)) await Pe(t, i);
      })(t, r).then(() => {
        const n = Qe(t, r, e, s, i);
        i.callback(n, n ? void 0 : r);
      });
    return Qe(t, r, e, s, i) ? void 0 : r;
  }
  function ei(t, e, i) {
    function s(t, e) {
      return Object.fromEntries(
        Object.entries(e).map(([e, i]) => [e, Ze(t, i)])
      );
    }
    const r = (i = ke(i)).callback;
    r &&
      (i.callback = (e, i) => {
        r(e, e ? void 0 : s(t, i));
      });
    const n = ti(t, e, i);
    if (!r && n) return s(t, n);
  }
  Be(ti), Be(ei);
  const ii = 36096,
    si = 33306,
    ri = {};
  (ri[34041] = si),
    (ri[6401] = 36128),
    (ri[36168] = 36128),
    (ri[6402] = ii),
    (ri[33189] = ii),
    (ri[33190] = ii),
    (ri[36012] = ii),
    (ri[35056] = si),
    (ri[36013] = si);
  const ni = {};
  (ni[32854] = !0),
    (ni[32855] = !0),
    (ni[36194] = !0),
    (ni[34041] = !0),
    (ni[33189] = !0),
    (ni[6401] = !0),
    (ni[36168] = !0);
  var ai = {};
  const oi = {
    position: 3,
    normal: 3,
    tangent: 3,
    texcoord: 2,
    texcoord0: 2,
    texcoord1: 2,
    texcoord2: 2,
  };
  var hi = {};
  class li {
    constructor() {
      this.attribs = {};
    }
    disableAll() {
      for (let t in this.attribs)
        this.gl.disableVertexAttribArray(this.attribs[t]);
      this.attribs = {};
    }
    enable(t, e) {
      this.gl = t;
      var i = {};
      for (let r in e) {
        var s = e[r];
        void 0 !== s.loc &&
          (void 0 === this.attribs[s.loc] && t.enableVertexAttribArray(s.loc),
          t.vertexAttribPointer(s.loc, s.size, s.type, !1, s.stride, s.offset),
          (i[s.loc] = s.loc),
          (this.attribs[r] = null));
      }
      for (let t in this.attribs);
      this.attribs = i;
    }
  }
  class ui {
    static CreateProgramAttributes(t, e) {
      var i = {},
        s = 0;
      for (let a in e) {
        var r = e[a],
          n = oi[a];
        (i[r] = { type: t.FLOAT, size: n, offset: 4 * s }), (s += n);
      }
      for (let t in i) i[t].stride = 4 * s;
      return i;
    }
    CleanUpPrograms() {
      hi = {};
    }
    ReleaseProgram(t) {}
    static _GetProgram(t) {
      return hi[t];
    }
    static RegisterProgram(t, e) {
      if (!hi[t]) {
        var i = e.shaders;
        hi[t] = { shaders: [i[0], i[1]], attributes: e.attributes };
      }
      return hi[t];
    }
    static GetProgram(t, e, i, s) {
      var r = hi[e],
        n = "";
      for (var a in i) n += a + ":" + i[a] + "-";
      if (!r) {
        var o = e.split("."),
          h = ai[o[0]][o[1]];
        h && (r = ui.RegisterProgram(e, h));
      }
      if (!r) throw "Program not registered: " + o;
      r.programInfo || (r.programInfo = {}),
        (r.programInfo[n] = ui.CompileProgram(t, r.shaders, i)),
        (s =
          s || (r.attributes && ui.CreateProgramAttributes(t, r.attributes)));
      var l = r.programInfo[n];
      if (s)
        for (var a in s) {
          var u = l.attribSetters[a];
          u && ((s[a] = s[a] || {}), (s[a].loc = u.location));
        }
      return (l.attributes = s), l;
    }
    static CompileProgram(t, e, i, s) {
      var r = "";
      for (var n in i) {
        var a = i[n];
        r = "#define " + n + " " + (null === a ? "" : a) + "\n";
      }
      var o = {};
      const h = $e(t, [r + e[0], r + e[1]], null, null);
      if (s)
        for (var n in s) {
          var l = h.attribSetters[n];
          l && ((s[n] = s[n] || {}), (s[n].loc = l.location));
        }
      for (var n in h.uniformSetters) o[n] = h.uniformSetters[n].location;
      return (h.uniforms = o), h;
    }
  }
  var ci = new ui(),
    di = 1e-6,
    fi = "undefined" != typeof Float32Array ? Float32Array : Array;
  Math.random;
  Math.PI;
  function gi() {
    var t = new fi(3);
    return fi != Float32Array && ((t[0] = 0), (t[1] = 0), (t[2] = 0)), t;
  }
  function bi(t) {
    var e = t[0],
      i = t[1],
      s = t[2];
    return Math.hypot(e, i, s);
  }
  function _i(t, e, i) {
    var s = new fi(3);
    return (s[0] = t), (s[1] = e), (s[2] = i), s;
  }
  function pi(t, e) {
    return (t[0] = e[0]), (t[1] = e[1]), (t[2] = e[2]), t;
  }
  function mi(t, e, i, s) {
    return (t[0] = e), (t[1] = i), (t[2] = s), t;
  }
  function xi(t, e, i) {
    return (t[0] = e[0] + i[0]), (t[1] = e[1] + i[1]), (t[2] = e[2] + i[2]), t;
  }
  function vi(t, e, i) {
    return (t[0] = e[0] - i[0]), (t[1] = e[1] - i[1]), (t[2] = e[2] - i[2]), t;
  }
  function Ti(t, e, i) {
    return (t[0] = e[0] * i[0]), (t[1] = e[1] * i[1]), (t[2] = e[2] * i[2]), t;
  }
  function wi(t, e, i) {
    return (
      (t[0] = Math.min(e[0], i[0])),
      (t[1] = Math.min(e[1], i[1])),
      (t[2] = Math.min(e[2], i[2])),
      t
    );
  }
  function yi(t, e, i) {
    return (
      (t[0] = Math.max(e[0], i[0])),
      (t[1] = Math.max(e[1], i[1])),
      (t[2] = Math.max(e[2], i[2])),
      t
    );
  }
  function Ai(t, e, i) {
    return (t[0] = e[0] * i), (t[1] = e[1] * i), (t[2] = e[2] * i), t;
  }
  function Ei(t, e, i, s) {
    return (
      (t[0] = e[0] + i[0] * s),
      (t[1] = e[1] + i[1] * s),
      (t[2] = e[2] + i[2] * s),
      t
    );
  }
  function Mi(t) {
    var e = t[0],
      i = t[1],
      s = t[2];
    return e * e + i * i + s * s;
  }
  function Ci(t, e) {
    return (t[0] = -e[0]), (t[1] = -e[1]), (t[2] = -e[2]), t;
  }
  function Si(t, e) {
    var i = e[0],
      s = e[1],
      r = e[2],
      n = i * i + s * s + r * r;
    return (
      n > 0 && (n = 1 / Math.sqrt(n)),
      (t[0] = e[0] * n),
      (t[1] = e[1] * n),
      (t[2] = e[2] * n),
      t
    );
  }
  function Fi(t, e) {
    return t[0] * e[0] + t[1] * e[1] + t[2] * e[2];
  }
  function Ii(t, e, i) {
    var s = e[0],
      r = e[1],
      n = e[2],
      a = i[0],
      o = i[1],
      h = i[2];
    return (
      (t[0] = r * h - n * o), (t[1] = n * a - s * h), (t[2] = s * o - r * a), t
    );
  }
  function ki(t, e, i, s) {
    var r = e[0],
      n = e[1],
      a = e[2];
    return (
      (t[0] = r + s * (i[0] - r)),
      (t[1] = n + s * (i[1] - n)),
      (t[2] = a + s * (i[2] - a)),
      t
    );
  }
  function Di(t, e, i) {
    var s = e[0],
      r = e[1],
      n = e[2],
      a = i[3] * s + i[7] * r + i[11] * n + i[15];
    return (
      (a = a || 1),
      (t[0] = (i[0] * s + i[4] * r + i[8] * n + i[12]) / a),
      (t[1] = (i[1] * s + i[5] * r + i[9] * n + i[13]) / a),
      (t[2] = (i[2] * s + i[6] * r + i[10] * n + i[14]) / a),
      t
    );
  }
  function Ri(t, e, i) {
    var s = e[0],
      r = e[1],
      n = e[2];
    return (
      (t[0] = s * i[0] + r * i[3] + n * i[6]),
      (t[1] = s * i[1] + r * i[4] + n * i[7]),
      (t[2] = s * i[2] + r * i[5] + n * i[8]),
      t
    );
  }
  Math.hypot ||
    (Math.hypot = function () {
      for (var t = 0, e = arguments.length; e--; )
        t += arguments[e] * arguments[e];
      return Math.sqrt(t);
    });
  var Ui,
    Oi = vi,
    Bi = bi;
  Ui = gi();
  function Pi() {
    var t = new fi(16);
    return (
      fi != Float32Array &&
        ((t[1] = 0),
        (t[2] = 0),
        (t[3] = 0),
        (t[4] = 0),
        (t[6] = 0),
        (t[7] = 0),
        (t[8] = 0),
        (t[9] = 0),
        (t[11] = 0),
        (t[12] = 0),
        (t[13] = 0),
        (t[14] = 0)),
      (t[0] = 1),
      (t[5] = 1),
      (t[10] = 1),
      (t[15] = 1),
      t
    );
  }
  function zi(t, e) {
    return (
      (t[0] = e[0]),
      (t[1] = e[1]),
      (t[2] = e[2]),
      (t[3] = e[3]),
      (t[4] = e[4]),
      (t[5] = e[5]),
      (t[6] = e[6]),
      (t[7] = e[7]),
      (t[8] = e[8]),
      (t[9] = e[9]),
      (t[10] = e[10]),
      (t[11] = e[11]),
      (t[12] = e[12]),
      (t[13] = e[13]),
      (t[14] = e[14]),
      (t[15] = e[15]),
      t
    );
  }
  function Ni(t, e, i, s, r, n, a, o, h, l, u, c, d, f, g, b) {
    var _ = new fi(16);
    return (
      (_[0] = t),
      (_[1] = e),
      (_[2] = i),
      (_[3] = s),
      (_[4] = r),
      (_[5] = n),
      (_[6] = a),
      (_[7] = o),
      (_[8] = h),
      (_[9] = l),
      (_[10] = u),
      (_[11] = c),
      (_[12] = d),
      (_[13] = f),
      (_[14] = g),
      (_[15] = b),
      _
    );
  }
  function Gi(t) {
    return (
      (t[0] = 1),
      (t[1] = 0),
      (t[2] = 0),
      (t[3] = 0),
      (t[4] = 0),
      (t[5] = 1),
      (t[6] = 0),
      (t[7] = 0),
      (t[8] = 0),
      (t[9] = 0),
      (t[10] = 1),
      (t[11] = 0),
      (t[12] = 0),
      (t[13] = 0),
      (t[14] = 0),
      (t[15] = 1),
      t
    );
  }
  function Li(t, e) {
    if (t === e) {
      var i = e[1],
        s = e[2],
        r = e[3],
        n = e[6],
        a = e[7],
        o = e[11];
      (t[1] = e[4]),
        (t[2] = e[8]),
        (t[3] = e[12]),
        (t[4] = i),
        (t[6] = e[9]),
        (t[7] = e[13]),
        (t[8] = s),
        (t[9] = n),
        (t[11] = e[14]),
        (t[12] = r),
        (t[13] = a),
        (t[14] = o);
    } else
      (t[0] = e[0]),
        (t[1] = e[4]),
        (t[2] = e[8]),
        (t[3] = e[12]),
        (t[4] = e[1]),
        (t[5] = e[5]),
        (t[6] = e[9]),
        (t[7] = e[13]),
        (t[8] = e[2]),
        (t[9] = e[6]),
        (t[10] = e[10]),
        (t[11] = e[14]),
        (t[12] = e[3]),
        (t[13] = e[7]),
        (t[14] = e[11]),
        (t[15] = e[15]);
    return t;
  }
  function ji(t, e) {
    var i = e[0],
      s = e[1],
      r = e[2],
      n = e[3],
      a = e[4],
      o = e[5],
      h = e[6],
      l = e[7],
      u = e[8],
      c = e[9],
      d = e[10],
      f = e[11],
      g = e[12],
      b = e[13],
      _ = e[14],
      p = e[15],
      m = i * o - s * a,
      x = i * h - r * a,
      v = i * l - n * a,
      T = s * h - r * o,
      w = s * l - n * o,
      y = r * l - n * h,
      A = u * b - c * g,
      E = u * _ - d * g,
      M = u * p - f * g,
      C = c * _ - d * b,
      S = c * p - f * b,
      F = d * p - f * _,
      I = m * F - x * S + v * C + T * M - w * E + y * A;
    return I
      ? ((I = 1 / I),
        (t[0] = (o * F - h * S + l * C) * I),
        (t[1] = (r * S - s * F - n * C) * I),
        (t[2] = (b * y - _ * w + p * T) * I),
        (t[3] = (d * w - c * y - f * T) * I),
        (t[4] = (h * M - a * F - l * E) * I),
        (t[5] = (i * F - r * M + n * E) * I),
        (t[6] = (_ * v - g * y - p * x) * I),
        (t[7] = (u * y - d * v + f * x) * I),
        (t[8] = (a * S - o * M + l * A) * I),
        (t[9] = (s * M - i * S - n * A) * I),
        (t[10] = (g * w - b * v + p * m) * I),
        (t[11] = (c * v - u * w - f * m) * I),
        (t[12] = (o * E - a * C - h * A) * I),
        (t[13] = (i * C - s * E + r * A) * I),
        (t[14] = (b * x - g * T - _ * m) * I),
        (t[15] = (u * T - c * x + d * m) * I),
        t)
      : null;
  }
  function Yi(t, e, i) {
    var s = e[0],
      r = e[1],
      n = e[2],
      a = e[3],
      o = e[4],
      h = e[5],
      l = e[6],
      u = e[7],
      c = e[8],
      d = e[9],
      f = e[10],
      g = e[11],
      b = e[12],
      _ = e[13],
      p = e[14],
      m = e[15],
      x = i[0],
      v = i[1],
      T = i[2],
      w = i[3];
    return (
      (t[0] = x * s + v * o + T * c + w * b),
      (t[1] = x * r + v * h + T * d + w * _),
      (t[2] = x * n + v * l + T * f + w * p),
      (t[3] = x * a + v * u + T * g + w * m),
      (x = i[4]),
      (v = i[5]),
      (T = i[6]),
      (w = i[7]),
      (t[4] = x * s + v * o + T * c + w * b),
      (t[5] = x * r + v * h + T * d + w * _),
      (t[6] = x * n + v * l + T * f + w * p),
      (t[7] = x * a + v * u + T * g + w * m),
      (x = i[8]),
      (v = i[9]),
      (T = i[10]),
      (w = i[11]),
      (t[8] = x * s + v * o + T * c + w * b),
      (t[9] = x * r + v * h + T * d + w * _),
      (t[10] = x * n + v * l + T * f + w * p),
      (t[11] = x * a + v * u + T * g + w * m),
      (x = i[12]),
      (v = i[13]),
      (T = i[14]),
      (w = i[15]),
      (t[12] = x * s + v * o + T * c + w * b),
      (t[13] = x * r + v * h + T * d + w * _),
      (t[14] = x * n + v * l + T * f + w * p),
      (t[15] = x * a + v * u + T * g + w * m),
      t
    );
  }
  function Hi(t, e, i) {
    var s,
      r,
      n,
      a,
      o,
      h,
      l,
      u,
      c,
      d,
      f,
      g,
      b = i[0],
      _ = i[1],
      p = i[2];
    return (
      e === t
        ? ((t[12] = e[0] * b + e[4] * _ + e[8] * p + e[12]),
          (t[13] = e[1] * b + e[5] * _ + e[9] * p + e[13]),
          (t[14] = e[2] * b + e[6] * _ + e[10] * p + e[14]),
          (t[15] = e[3] * b + e[7] * _ + e[11] * p + e[15]))
        : ((s = e[0]),
          (r = e[1]),
          (n = e[2]),
          (a = e[3]),
          (o = e[4]),
          (h = e[5]),
          (l = e[6]),
          (u = e[7]),
          (c = e[8]),
          (d = e[9]),
          (f = e[10]),
          (g = e[11]),
          (t[0] = s),
          (t[1] = r),
          (t[2] = n),
          (t[3] = a),
          (t[4] = o),
          (t[5] = h),
          (t[6] = l),
          (t[7] = u),
          (t[8] = c),
          (t[9] = d),
          (t[10] = f),
          (t[11] = g),
          (t[12] = s * b + o * _ + c * p + e[12]),
          (t[13] = r * b + h * _ + d * p + e[13]),
          (t[14] = n * b + l * _ + f * p + e[14]),
          (t[15] = a * b + u * _ + g * p + e[15])),
      t
    );
  }
  function qi(t, e, i) {
    var s = i[0],
      r = i[1],
      n = i[2];
    return (
      (t[0] = e[0] * s),
      (t[1] = e[1] * s),
      (t[2] = e[2] * s),
      (t[3] = e[3] * s),
      (t[4] = e[4] * r),
      (t[5] = e[5] * r),
      (t[6] = e[6] * r),
      (t[7] = e[7] * r),
      (t[8] = e[8] * n),
      (t[9] = e[9] * n),
      (t[10] = e[10] * n),
      (t[11] = e[11] * n),
      (t[12] = e[12]),
      (t[13] = e[13]),
      (t[14] = e[14]),
      (t[15] = e[15]),
      t
    );
  }
  function Vi(t, e, i) {
    var s = Math.sin(i),
      r = Math.cos(i),
      n = e[4],
      a = e[5],
      o = e[6],
      h = e[7],
      l = e[8],
      u = e[9],
      c = e[10],
      d = e[11];
    return (
      e !== t &&
        ((t[0] = e[0]),
        (t[1] = e[1]),
        (t[2] = e[2]),
        (t[3] = e[3]),
        (t[12] = e[12]),
        (t[13] = e[13]),
        (t[14] = e[14]),
        (t[15] = e[15])),
      (t[4] = n * r + l * s),
      (t[5] = a * r + u * s),
      (t[6] = o * r + c * s),
      (t[7] = h * r + d * s),
      (t[8] = l * r - n * s),
      (t[9] = u * r - a * s),
      (t[10] = c * r - o * s),
      (t[11] = d * r - h * s),
      t
    );
  }
  function Xi(t, e, i) {
    var s = Math.sin(i),
      r = Math.cos(i),
      n = e[0],
      a = e[1],
      o = e[2],
      h = e[3],
      l = e[4],
      u = e[5],
      c = e[6],
      d = e[7];
    return (
      e !== t &&
        ((t[8] = e[8]),
        (t[9] = e[9]),
        (t[10] = e[10]),
        (t[11] = e[11]),
        (t[12] = e[12]),
        (t[13] = e[13]),
        (t[14] = e[14]),
        (t[15] = e[15])),
      (t[0] = n * r + l * s),
      (t[1] = a * r + u * s),
      (t[2] = o * r + c * s),
      (t[3] = h * r + d * s),
      (t[4] = l * r - n * s),
      (t[5] = u * r - a * s),
      (t[6] = c * r - o * s),
      (t[7] = d * r - h * s),
      t
    );
  }
  function Ki(t, e, i) {
    var s = e[0],
      r = e[1],
      n = e[2],
      a = e[3],
      o = s + s,
      h = r + r,
      l = n + n,
      u = s * o,
      c = s * h,
      d = s * l,
      f = r * h,
      g = r * l,
      b = n * l,
      _ = a * o,
      p = a * h,
      m = a * l;
    return (
      (t[0] = 1 - (f + b)),
      (t[1] = c + m),
      (t[2] = d - p),
      (t[3] = 0),
      (t[4] = c - m),
      (t[5] = 1 - (u + b)),
      (t[6] = g + _),
      (t[7] = 0),
      (t[8] = d + p),
      (t[9] = g - _),
      (t[10] = 1 - (u + f)),
      (t[11] = 0),
      (t[12] = i[0]),
      (t[13] = i[1]),
      (t[14] = i[2]),
      (t[15] = 1),
      t
    );
  }
  function Wi(t, e) {
    return (t[0] = e[12]), (t[1] = e[13]), (t[2] = e[14]), t;
  }
  function Zi(t, e) {
    var i = e[0],
      s = e[1],
      r = e[2],
      n = e[4],
      a = e[5],
      o = e[6],
      h = e[8],
      l = e[9],
      u = e[10];
    return (
      (t[0] = Math.hypot(i, s, r)),
      (t[1] = Math.hypot(n, a, o)),
      (t[2] = Math.hypot(h, l, u)),
      t
    );
  }
  var Ji = function (t, e, i, s, r) {
    var n,
      a = 1 / Math.tan(e / 2);
    return (
      (t[0] = a / i),
      (t[1] = 0),
      (t[2] = 0),
      (t[3] = 0),
      (t[4] = 0),
      (t[5] = a),
      (t[6] = 0),
      (t[7] = 0),
      (t[8] = 0),
      (t[9] = 0),
      (t[11] = -1),
      (t[12] = 0),
      (t[13] = 0),
      (t[15] = 0),
      null != r && r !== 1 / 0
        ? ((n = 1 / (s - r)), (t[10] = (r + s) * n), (t[14] = 2 * r * s * n))
        : ((t[10] = -1), (t[14] = -2 * s)),
      t
    );
  };
  var $i = Yi;
  const Qi = { 2: "Wowhead", 3: "LolKing", 6: "HeroKing", 7: "DestinyDB" };
  class ts {
    constructor(t) {
      if (!t.type || !Qi[t.type]) throw "Viewer error: Bad viewer type given";
      if (!t.container) throw "Viewer error: Bad container given";
      if (!t.aspect) throw "Viewer error: Bad aspect ratio given";
      if (!t.contentPath) throw "Viewer error: No content path given";
      (this.type = t.type),
        (this.container = t.container),
        (this.aspect = parseFloat(t.aspect)),
        (this.renderer = null),
        (this.options = t);
      const e = this.container.width(),
        i = Math.round(e / this.aspect);
      this.init(e, i);
    }
    destroy() {
      this.renderer && this.renderer.destroy(),
        (this.options = null),
        (this.container = null);
    }
    init(t, e) {
      if (
        void 0 !== typeof window.Uint8Array &&
        void 0 !== typeof window.DataView
      )
        try {
          const t = document.createElement("canvas");
          if (
            !(
              t.getContext("webgl", { alpha: !1 }) ||
              t.getContext("experimental-webgl", { alpha: !1 })
            )
          )
            return void console.log("viewer init failed");
        } catch (t) {
          return void console.log("viewer init failed");
        }
      (this.mode = 1),
        (this.renderer = new jl(this)),
        this.renderer.resize(t, e),
        this.renderer.init();
    }
    setAdaptiveMode(t) {
      this.renderer.setAdaptiveMode(t);
    }
    setZoom(t) {
      this.renderer.zoom.target = t;
    }
    setOffset(t, e) {
      this.renderer.setTranslation(t, e, 0);
    }
    setFullscreen(t) {
      t ? ts.requestFullscreen(this.renderer.canvas[0]) : ts.exitFullscreen();
    }
    method(t, e) {
      return (
        void 0 === e && (e = []),
        this.renderer ? this.renderer.method(t, [].concat(e)) : null
      );
    }
    option(t, e) {
      return void 0 !== e && (this.options[t] = e), this.options[t];
    }
    static isFullscreen() {
      return !!(
        document.fullscreenElement ||
        document.webkitFullscreenElement ||
        document.mozFullScreenElement ||
        document.msFullscreenElement
      );
    }
    static requestFullscreen(t) {
      document.fullscreenElement ||
        document.webkitFullscreenElement ||
        document.mozFullScreenElement ||
        document.msFullscreenElement ||
        (t.requestFullscreen
          ? t.requestFullscreen()
          : t.webkitRequestFullscreen
          ? t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)
          : t.mozRequestFullScreen
          ? t.mozRequestFullScreen()
          : t.msRequestFullscreen && t.msRequestFullscreen());
    }
    static exitFullscreen() {
      (document.fullscreenElement ||
        document.webkitFullscreenElement ||
        document.mozFullScreenElement ||
        document.msFullscreenElement) &&
        (document.exitFullscreen
          ? document.exitFullscreen()
          : document.webkitExitFullscreen
          ? document.webkitExitFullscreen()
          : document.mozCancelFullScreen
          ? document.mozCancelFullScreen()
          : document.msExitFullscreen && document.msExitFullscreen());
    }
  }
  const es = ts;
  const is = class {
    constructor(t, e, i) {
      (this.g = t),
        (this.f = e),
        (this.dc = i),
        (this.ba = !1),
        (this.e = t.createBuffer()),
        (this.f = 0);
    }
    a(t) {
      const e = this.g;
      e.bindBuffer(e.ELEMENT_ARRAY_BUFFER, this.e),
        !this.ba || this.f < t.byteLength
          ? (e.bufferData(
              e.ELEMENT_ARRAY_BUFFER,
              t,
              this.dc ? e.DYNAMIC_DRAW : e.STATIC_DRAW
            ),
            (this.f = t.byteLength),
            (this.ba = !0))
          : e.bufferSubData(e.ELEMENT_ARRAY_BUFFER, 0, t),
        e.bindBuffer(e.ELEMENT_ARRAY_BUFFER, null);
    }
    c() {
      return this.f;
    }
    b() {
      const t = this.g;
      t.bindBuffer(t.ELEMENT_ARRAY_BUFFER, this.e);
    }
    d() {
      const t = this.g;
      t.bindBuffer(t.ELEMENT_ARRAY_BUFFER, null);
    }
  };
  const ss = class {
    constructor(t, e, i) {
      (this.ba = t),
        (this.f = e),
        (this.e = i),
        (this.dc = !1),
        (this.g = t.createBuffer()),
        (this.f = 0);
    }
    b() {
      const t = this.ba;
      t.bindBuffer(t.ARRAY_BUFFER, this.g);
    }
    d() {
      const t = this.ba;
      t.bindBuffer(t.ARRAY_BUFFER, null);
    }
    a(t) {
      const e = this.ba;
      e.bindBuffer(e.ARRAY_BUFFER, this.g),
        !this.dc || this.f < t.byteLength
          ? (e.bufferData(
              e.ARRAY_BUFFER,
              t,
              this.e ? e.DYNAMIC_DRAW : e.STATIC_DRAW
            ),
            (this.dc = !0),
            (this.f = t.byteLength))
          : e.bufferSubData(e.ARRAY_BUFFER, 0, t),
        e.bindBuffer(e.ARRAY_BUFFER, null);
    }
    c() {
      return this.f;
    }
  };
  var rs;
  !(function (t) {
    (t[(t.GFLOAT = 0)] = "GFLOAT"),
      (t[(t.GUNSIGNED_BYTE = 1)] = "GUNSIGNED_BYTE");
  })(rs || (rs = {}));
  class ns {
    constructor(t, e, i, s, r, n) {
      (this.d = t),
        (this.e = e),
        (this.b = i),
        (this.a = s),
        (this.c = r),
        (this.f = n);
    }
  }
  function as(t, e) {
    switch (e) {
      case rs.GFLOAT:
        return t.FLOAT;
      case rs.GUNSIGNED_BYTE:
        return t.UNSIGNED_BYTE;
    }
  }
  const os = class {
    constructor(t, e) {
      (this.ba = t),
        (this.f = e),
        (this.dc = null),
        (this.e = []),
        (this.dc = e.createVertexArrayOES());
    }
    c(t) {
      this.ba;
      this.d(), t.b(), this.b(), this.e.push(t);
    }
    a(t, e) {
      const i = this.ba;
      this.d(), t.b();
      for (const t of e)
        i.enableVertexAttribArray(t.d),
          i.vertexAttribPointer(t.d, t.e, as(i, t.b), t.a, t.c, t.f);
      this.b(), this.e.push(t);
    }
    d() {
      this.f.bindVertexArrayOES(this.dc);
    }
    b() {
      this.f.bindVertexArrayOES(null);
    }
  };
  const hs = class {
    constructor(t, e) {
      (this.e = t), (this.ba = e), (this.dc = []);
    }
    c(t) {
      this.f = t;
    }
    a(t, e) {
      this.dc.push({ buffer: t, bindings: e });
    }
    d() {
      const t = this.e;
      this.f.b();
      const e = this.ba.c();
      for (const e of this.dc) {
        e.b.b();
        for (const i of e.a)
          this.ba.e(i.d),
            t.vertexAttribPointer(i.d, i.e, as(t, i.b), i.a, i.c, i.f);
      }
      this.ba.b(e);
    }
    b() {}
  };
  class ls {}
  class us {
    constructor(t, e, i, s) {
      (this.a = t), (this.c = e), (this.d = i), (this.b = s);
    }
  }
  class cs {
    constructor(t, e) {
      (this.b = t), (this.a = e);
    }
  }
  class ds {
    constructor(t, e) {
      (this.a = t), (this.b = e);
    }
  }
  class fs extends ls {}
  const gs = class extends fs {
    constructor(t, e, i, s) {
      super(), (this.e = t), (this.d = e), (this.cba = i), (this.ba = s);
    }
    a() {
      return this.cba.f;
    }
    b(t) {
      const e = this.cba;
      t.b(this.d),
        t.i(e.f),
        t.h(e.e),
        t.e(e.a),
        t.g(e.b),
        t.j(e.c),
        t.c(e.d),
        Ke(this.d.d(), this.ba);
    }
  };
  const bs = class {
    constructor(t, e, i, s) {
      if (
        ((this.c = t),
        (this.ba = $e(t, [i, s], Object.keys(e), null)),
        !this.ba)
      )
        throw "Failed to create program";
    }
    a() {
      this.c.useProgram(this.ba.program);
    }
    d() {
      return this.ba;
    }
  };
  class _s {
    static h(t) {
      const e = 32767 & t;
      return e < ps.length
        ? ps[e]
        : (WH.debug("Unknown shader effect:", e),
          ["PS_Combiners_Opaque", "VS_Diffuse_T1"]);
    }
    static c(t, e) {
      let i = "";
      if (-1e3 == t && 3 == e) return "Skin";
      if (32768 & t) return _s.h(t)[0];
      if (1 == e) i = 112 & t ? "PS_Combiners_Mod" : "PS_Combiners_Opaque";
      else {
        i =
          (112 & t ? "PS_Combiners_Mod" : "PS_Combiners_Opaque") +
          "_" +
          (112 & t
            ? [
                "Opaque",
                "Mod",
                "Mod",
                "Add",
                "Mod2x",
                "Mod",
                "Mod2xNA",
                "AddNA",
              ]
            : [
                "Opaque",
                "Mod",
                "Mod",
                "AddAlpha",
                "Mod2x",
                "Mod",
                "Mod2xNA",
                "AddAlpha",
              ])[7 & t];
      }
      return i;
    }
    static a(t, e) {
      let i = "";
      if (-1e3 == t && 3 == e) i = "T1_T1_T1";
      else {
        if (32768 & t) return _s.h(t)[1];
        i =
          1 == e
            ? 128 & t
              ? "Env"
              : 16384 & t
              ? "T2"
              : "T1"
            : 128 & t
            ? 8 & t
              ? "Env_Env"
              : "Env_T1"
            : 8 & t
            ? "T1_Env"
            : 16384 & t
            ? "T1_T2"
            : "T1_T1";
      }
      return "VS_Diffuse_" + i;
    }
    static d(t, e, i) {
      const s = _s.c(t, e),
        r = _s.a(t, e),
        n = "Wow." + r + "_" + s;
      if (ui._GetProgram(n)) return { name: n };
      const a = {
        shaders: [_s.e(r, i), _s.g(r, s, !1)],
        attributes: {
          position: "aPosition",
          normal: "aNormal",
          texcoord0: "aTexCoord0",
          texcoord1: "aTexCoord1",
        },
      };
      return ui.RegisterProgram(n, a), { name: n };
    }
    static b(t) {
      const e = {},
        i = {
          texcoord1: function (t, e) {
            t.INPUT_TEXCOORD1 = "aTexCoord" + e;
          },
        };
      for (let s in t.options) {
        const r = t.options[s];
        i[s](e, r);
      }
      return { name: "Wow." + t.name, config: e };
    }
    static f(t) {
      var e = "";
      if (
        ((e += "lTexCoord1 = (uTextureMatrix1 * vec4(vTexCoord1, 0, 1)).st;\n"),
        (e += "lTexCoord2 = (uTextureMatrix2 * vec4(vTexCoord2, 0, 1)).st;\n"),
        "VS" === t.slice(0, 2))
      ) {
        let i = (t = t.slice(3)).split("_"),
          s = i[0];
        if ("Diffuse" === s || "Color" === s) {
          (e = ""), i.splice(0, 1);
          let s = {
              T1: ["uTextureMatrix1", "vTexCoord1"],
              T2: ["uTextureMatrix2", "vTexCoord2"],
              T3: ["", "aTexCoord2"],
              Env: ["", "texEnv"],
            },
            r = 1;
          for (let n in i)
            s[i[n]]
              ? (s[i[n]][0] && "texEnv" != s[i[n]][1]
                  ? (e +=
                      "lTexCoord" +
                      r +
                      " = (" +
                      s[i[n]][0] +
                      " * vec4(" +
                      s[i[n]][1] +
                      ", 0, 1)).st;\n")
                  : "texEnv" == s[i[n]][1]
                  ? (e += "lTexCoord" + r + " = texEnv;\n")
                  : (e +=
                      "lTexCoord" +
                      r +
                      " = (uTextureMatrix" +
                      r +
                      " * vec4(" +
                      s[i[n]][1] +
                      ", 0, 1)).st;\n"),
                r++)
              : WH.debug("Missing vertex shader def?", t);
        }
      }
      return e;
    }
    static e(t, e) {
      var i;
      return (
        "attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord0;\nattribute vec2 aTexCoord1;\nattribute vec3 aColor;\n" +
        ((i = { SKINNING: e }).SKINNING
          ? "attribute vec4 aBoneWeights;\nattribute vec4 aBones;\n"
          : "") +
        "varying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nuniform mat4 uModelMatrix;\nuniform mat4 uPanningMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uInvTranspViewModelMat;\nuniform mat4 uProjMatrix;\nuniform vec3 uCameraPos;\n" +
        (i.SKINNING
          ? "uniform sampler2D uBoneMatricesTex;\n#define ROW0_U ((0.5 + 0.0) / 4.)\n#define ROW1_U ((0.5 + 1.0) / 4.)\n#define ROW2_U ((0.5 + 2.0) / 4.)\n#define ROW3_U ((0.5 + 3.0) / 4.)\nconst float numBones = 256.0;\nmat4 getBoneMatrix(float boneNdx) {\nfloat v = (boneNdx + 0.5) / numBones;\nreturn mat4(\ntexture2D(uBoneMatricesTex, vec2(ROW0_U, v)),\ntexture2D(uBoneMatricesTex, vec2(ROW1_U, v)),\ntexture2D(uBoneMatricesTex, vec2(ROW2_U, v)),\ntexture2D(uBoneMatricesTex, vec2(ROW3_U, v))\n);\n}\nhighp mat4 transpose(in highp mat4 inMatrix) {\nhighp vec4 i0 = inMatrix[0];\nhighp vec4 i1 = inMatrix[1];\nhighp vec4 i2 = inMatrix[2];\nhighp vec4 i3 = inMatrix[3];\nhighp mat4 outMatrix = mat4(\nvec4(i0.x, i1.x, i2.x, i3.x),\nvec4(i0.y, i1.y, i2.y, i3.y),\nvec4(i0.z, i1.z, i2.z, i3.z),\nvec4(i0.w, i1.w, i2.w, i3.w)\n);\nreturn outMatrix;\n}\nmat4 inverse(mat4 m) {\nfloat\na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\nb00 = a00 * a11 - a01 * a10,\nb01 = a00 * a12 - a02 * a10,\nb02 = a00 * a13 - a03 * a10,\nb03 = a01 * a12 - a02 * a11,\nb04 = a01 * a13 - a03 * a11,\nb05 = a02 * a13 - a03 * a12,\nb06 = a20 * a31 - a21 * a30,\nb07 = a20 * a32 - a22 * a30,\nb08 = a20 * a33 - a23 * a30,\nb09 = a21 * a32 - a22 * a31,\nb10 = a21 * a33 - a23 * a31,\nb11 = a22 * a33 - a23 * a32,\ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\nreturn mat4(\na11 * b11 - a12 * b10 + a13 * b09,\na02 * b10 - a01 * b11 - a03 * b09,\na31 * b05 - a32 * b04 + a33 * b03,\na22 * b04 - a21 * b05 - a23 * b03,\na12 * b08 - a10 * b11 - a13 * b07,\na00 * b11 - a02 * b08 + a03 * b07,\na32 * b02 - a30 * b05 - a33 * b01,\na20 * b05 - a22 * b02 + a23 * b01,\na10 * b10 - a11 * b08 + a13 * b06,\na01 * b08 - a00 * b10 - a03 * b06,\na30 * b04 - a31 * b02 + a33 * b00,\na21 * b02 - a20 * b04 - a23 * b00,\na11 * b07 - a10 * b09 - a12 * b06,\na00 * b09 - a01 * b07 + a02 * b06,\na31 * b01 - a30 * b03 - a32 * b00,\na20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n"
          : "") +
        "void main(void) {\nmat4 boneTransformMat =  mat4(1.0);\n" +
        (i.SKINNING
          ? "if (length(aBoneWeights) > 0.0) {\nboneTransformMat =  mat4(0.0);\nfor (int i = 0; i < 4; i++) {\nboneTransformMat += getBoneMatrix(aBones[i]) * aBoneWeights[i];\n}\n}\nmat4 viewModelMat = uViewMatrix * uModelMatrix * boneTransformMat;\nmat4 invTranspViewModelMat = transpose(inverse(viewModelMat));\n"
          : "mat4 viewModelMat = uViewMatrix * uModelMatrix;\nmat4 invTranspViewModelMat = uInvTranspViewModelMat;\n") +
        "vec4 pos = viewModelMat * vec4(aPosition, 1);\nvPosition = pos.rgb;\ngl_Position = uProjMatrix * pos;\nvTexCoord1 = aTexCoord0;\nvTexCoord2 = aTexCoord1;\nvNormal = normalize((invTranspViewModelMat * vec4(aNormal, 0.0)).xyz);\n}\n"
      );
    }
    static g(t, e, i) {
      let s = ms[e];
      s ||
        (WH.debug("Missing pixel shader def", e),
        (s = ms[(e = "PS_Combiners_Opaque_Mod")]));
      let r = "\t\t" + s.slice(1, s.length).join("\n\t\t");
      for (let t = 0; t < s[0]; t++) {
        let e = t + 1;
        r =
          "vec4 tex" +
          t +
          " = texture2D(uTexture" +
          e +
          ", lTexCoord" +
          e +
          ".st);\n" +
          r;
      }
      let n = this.f(t);
      var a;
      return (
        "precision mediump float;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vTexCoord1;\nvarying vec2 vTexCoord2;\nvarying vec2 vTexCoord3;\nvarying vec2 vTexCoord4;\nuniform bool uHasAlpha;\nuniform bool uHasSpecEmiss;\nuniform bool uHasEmissiveGlowing;\nuniform int uBlendMode;\nuniform bool uUnlit;\nuniform vec4 uColor;\nuniform vec4 uAmbientColor;\nuniform vec4 uDiffuseColor;\nuniform vec4 uPrimaryColor;\nuniform vec4 uSecondaryColor;\nuniform vec3 uLightDir1;\nuniform vec3 uLightDir2;\nuniform vec3 uLightDir3;\nuniform mat4 uTextureMatrix1;\nuniform mat4 uTextureMatrix2;\nuniform mat4 uTextureMatrix3;\nuniform mat4 uTextureMatrix4;\nuniform sampler2D uTexture1;\nuniform sampler2D uTexture2;\nuniform sampler2D uTexture3;\nuniform sampler2D uTexture4;\nuniform sampler2D uAlpha;\nuniform vec4 uTexSampleAlpha;\n" +
        ((a = { EXCERPT_TEX_COORD: n, EXCERPT_BASE: r, GRADIENT: i }).GRADIENT
          ? "uniform vec4 u_gradGradientColors_0;\nuniform vec4 u_gradGradientColors_1;\nuniform vec4 u_gradGradientColors_2;\nuniform vec4 u_gradEdgeColor;\nuniform vec4 u_gradBoundingBox;\nuniform vec4 u_gradUpVec;\nuniform vec4 u_gradFlags;\nuniform vec4 u_mulLum_OpaqMat;\n"
          : "") +
        "vec2 sphereMap(vec3 vertex, vec3 normal) {\nvec3 normPos = (normalize(vertex.xyz));\nvec3 reflection = reflect(normPos, normalize(normal));\nreflection = vec3(reflection.x, reflection.y, reflection.z + 1.0);\nvec2 texCoord = ((normalize(reflection).xy * 0.5) + vec2(0.5));\nreturn texCoord;\n}\nvoid main(void) {\nvec2 lTexCoord1 = vec2(0.0);\nvec2 lTexCoord2 = vec2(0.0);\nvec2 lTexCoord3 = vec2(0.0);\nvec4 _output = vec4(1.0);\nvec4 _input = uColor;\nvec3 _specular = vec3(0.0);\nvec2 texEnv = sphereMap(vPosition.xyz,normalize(vNormal.xyz));\n" +
        (a.EXCERPT_TEX_COORD ? a.EXCERPT_TEX_COORD : "") +
        (a.EXCERPT_BASE ? a.EXCERPT_BASE : "") +
        "_output.a = _output.a * uDiffuseColor.a;\nif (uBlendMode == 13) {\n_output.a = _output.a * _input.a;\n} else if (uBlendMode == 1) {\nif (_output.a < (128.0/255.0))\ndiscard;\n_output.a = _input.a;\n} else if (uBlendMode == 0) {\n_output.a = _input.a;\n} else {\n_output.a = _output.a * _input.a;\n}\nif (!uUnlit) {\nvec4 litColor = uAmbientColor;\nvec3 normal = normalize(vNormal);\nfloat dp = max(0.0, dot(normal, uLightDir1));\nlitColor += uPrimaryColor * dp;\ndp = max(0.0, dot(normal, uLightDir2));\nlitColor += uSecondaryColor * dp;\ndp = max(0.0, dot(normal, uLightDir3));\nlitColor += uSecondaryColor * dp;\nlitColor = clamp(litColor, vec4(0,0,0,0), vec4(1,1,1,1));\n_output.rgb *= (litColor * uDiffuseColor).rgb;\n}\n_output += vec4(_specular, 0.0);\n" +
        (a.GRADIENT
          ? "float power = u_gradEdgeColor.w;\nfloat midValue = u_gradGradientColors_2.w;\nfloat opaqueMaterial = u_mulLum_OpaqMat.y;\nfloat lum = clamp(dot(_output.xyz, vec3(0.212599993, 0.715200007, 0.0722000003)), 0.0, 1.0);\nfloat val0 = 0.0;\nfloat val1 = midValue;\nif (lum > midValue) {\nval0 = midValue;\nval1 = 1.0;\n}\nfloat lerpValue = clamp(((lum - val0) / (val1 - val0)), 0.0, 1.0);\nvec3 gradColor0 = u_gradGradientColors_0.xyz;\nvec3 gradColor1 = u_gradGradientColors_1.xyz;\nif (lum > midValue) {\ngradColor0 = u_gradGradientColors_1.xyz;\ngradColor1 = u_gradGradientColors_2.xyz;\n}\nvec3 gradientColor = mix(gradColor0, gradColor1, vec3(lerpValue));\nbool flipNormal = ((u_gradGradientColors_0.w > 0.0) && (vNormal.z > 0.0));\nvec3 normal = flipNormal ? -vNormal.xyz : vNormal.xyz;\nvec2 term = vec2(dot(-(vPosition.xyz), normal), dot(normalize(-(vPosition.xyz)), (normal * vec3(0.05, 0.05, 1.0))));\nvec2 invTerm = (vec2(1.0) - clamp(term, 0.0, 1.0));\nvec2 f = (invTerm * invTerm);\nfloat fresnel_rim = pow((f.x + f.y), power);\nbool disableHeightFade = bool(u_gradFlags.x);\nfloat visMod = 0.0;\nvec4 res = _output;\nvec3 distVecTest = vec3(0,0,0);\nif (!(disableHeightFade))\n{\nvec3 distVec = (vPosition - u_gradBoundingBox.xyz);\nfloat _dot = dot(distVec, u_gradUpVec.xyz);\nfloat relHeight = (_dot * u_gradBoundingBox.w);\nbool invertHeightFade = bool(u_gradFlags.w);\ndistVecTest = vec3(relHeight);\nrelHeight = invertHeightFade ? clamp((1.0 - relHeight), 0.0, 1.0) : relHeight;\nfloat visMod = clamp((relHeight * 1.66666663), 0.0, 0.899999976);\nvisMod = (visMod * visMod);\nres = vec4(_output.r, _output.g, _output.b, (_output.w * visMod));\n}\nvec3 lerp = mix(gradientColor, u_gradEdgeColor.xyz, vec3(fresnel_rim));\nfloat multiplyLum = u_mulLum_OpaqMat.x;\nif (bool(multiplyLum))\n{\nres = vec4(lerp.xyz, (res.w * lum));\n}\nelse\n{\nres = vec4(lerp.xyz, res.w);\n}\n_output = mix(_output, res, vec4(u_gradFlags.y));\n_output = vec4(_output.xyz, res.a * _output.a);\n"
          : "") +
        "gl_FragColor = _output;\n}\n"
      );
    }
  }
  const ps = [
      [
        "PS_Combiners_Opaque_Mod2xNA_Alpha",
        "VS_Diffuse_T1_Env",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Opaque_AddAlpha",
        "VS_Diffuse_T1_Env",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Opaque_AddAlpha_Alpha",
        "VS_Diffuse_T1_Env",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Opaque_Mod2xNA_Alpha_Add",
        "VS_Diffuse_T1_Env_T1",
        "HS_T1_T2_T3",
        "DS_T1_T2_T3",
      ],
      [
        "PS_Combiners_Mod_AddAlpha",
        "VS_Diffuse_T1_Env",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Opaque_AddAlpha",
        "VS_Diffuse_T1_T1",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      ["PS_Combiners_Mod_AddAlpha", "VS_Diffuse_T1_T1", "HS_T1_T2", "DS_T1_T2"],
      [
        "PS_Combiners_Mod_AddAlpha_Alpha",
        "VS_Diffuse_T1_Env",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Opaque_Alpha_Alpha",
        "VS_Diffuse_T1_Env",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Opaque_Mod2xNA_Alpha_3s",
        "VS_Diffuse_T1_Env_T1",
        "HS_T1_T2_T3",
        "DS_T1_T2_T3",
      ],
      [
        "PS_Combiners_Opaque_AddAlpha_Wgt",
        "VS_Diffuse_T1_T1",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Mod_Add_Alpha",
        "VS_Diffuse_T1_Env",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Opaque_ModNA_Alpha",
        "VS_Diffuse_T1_Env",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Mod_AddAlpha_Wgt",
        "VS_Diffuse_T1_Env",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Mod_AddAlpha_Wgt",
        "VS_Diffuse_T1_T1",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Opaque_AddAlpha_Wgt",
        "VS_Diffuse_T1_T2",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Opaque_Mod_Add_Wgt",
        "VS_Diffuse_T1_Env",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha",
        "VS_Diffuse_T1_Env_T1",
        "HS_T1_T2_T3",
        "DS_T1_T2_T3",
      ],
      ["PS_Combiners_Mod_Dual_Crossfade", "VS_Diffuse_T1", "HS_T1", "DS_T1"],
      ["PS_Combiners_Mod_Depth", "VS_Diffuse_EdgeFade_T1", "HS_T1", "DS_T1"],
      [
        "PS_Combiners_Opaque_Mod2xNA_Alpha_Alpha",
        "VS_Diffuse_T1_Env_T2",
        "HS_T1_T2_T3",
        "DS_T1_T2_T3",
      ],
      [
        "PS_Combiners_Mod_Mod",
        "VS_Diffuse_EdgeFade_T1_T2",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      [
        "PS_Combiners_Mod_Masked_Dual_Crossfade",
        "VS_Diffuse_T1_T2",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      ["PS_Combiners_Opaque_Alpha", "VS_Diffuse_T1_T1", "HS_T1_T2", "DS_T1_T2"],
      [
        "PS_Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha",
        "VS_Diffuse_T1_Env_T2",
        "HS_T1_T2_T3",
        "DS_T1_T2_T3",
      ],
      ["PS_Combiners_Mod_Depth", "VS_Diffuse_EdgeFade_Env", "HS_T1", "DS_T1"],
      ["PS_Guild", "VS_Diffuse_T1_T2_T1", "HS_T1_T2_T3", "DS_T1_T2"],
      ["PS_Guild_NoBorder", "VS_Diffuse_T1_T2", "HS_T1_T2", "DS_T1_T2_T3"],
      ["PS_Guild_Opaque", "VS_Diffuse_T1_T2_T1", "HS_T1_T2_T3", "DS_T1_T2"],
      ["PS_Illum", "VS_Diffuse_T1_T1", "HS_T1_T2", "DS_T1_T2"],
      [
        "PS_Combiners_Mod_Mod_Mod_Const",
        "VS_Diffuse_T1_T2_T3",
        "HS_T1_T2_T3",
        "DS_T1_T2_T3",
      ],
      [
        "PS_Combiners_Mod_Mod_Mod_Const",
        "VS_Color_T1_T2_T3",
        "HS_T1_T2_T3",
        "DS_T1_T2_T3",
      ],
      ["PS_Combiners_Opaque", "VS_Diffuse_T1", "HS_T1", "DS_T1"],
      [
        "PS_Combiners_Mod_Mod2x",
        "VS_Diffuse_EdgeFade_T1_T2",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
      ["PS_Combiners_Mod", "VS_Diffuse_EdgeFade_T1", "HS_T1_T2", "DS_T1_T2"],
      [
        "PS_Combiners_Mod_Mod_Depth",
        "VS_Diffuse_EdgeFade_T1_T2",
        "HS_T1_T2",
        "DS_T1_T2",
      ],
    ],
    ms = {
      PS_Combiners_Add: [
        1,
        "_output.rgb = _input.rgb + tex0.rgb;",
        "_output.a = _input.a + tex0.a;",
      ],
      PS_Combiners_Decal: [
        1,
        "_output.rgb = mix(_input.rgb, tex0.rgb, _input.a);",
        "_output.a = _input.a;",
      ],
      PS_Combiners_Fade: [
        1,
        "_output.rgb = mix(tex0.rgb, _input.rgb, _input.a);",
        "_output.a = _input.a;",
      ],
      PS_Combiners_Mod: [
        1,
        "_output.rgb = _input.rgb * tex0.rgb;",
        "_output.a = tex0.a;",
      ],
      PS_Combiners_Mod2x: [
        1,
        "_output.rgb = _input.rgb * tex0.rgb * 2.0;",
        "_output.a = tex0.a * 2.0;",
      ],
      PS_Combiners_Opaque: [
        1,
        "_output.rgb = _input.rgb * tex0.rgb;",
        "_output.a = 1.0;",
      ],
      PS_Combiners_Add_Add: [
        2,
        "_output.rgb = (_input.rgb + tex0.rgb) + tex1.rgb;",
        "_output.a = (_input.a + tex0.a) + tex1.a;",
      ],
      PS_Combiners_Add_Mod: [
        2,
        "_output.rgb = (_input.rgb + tex0.rgb) * tex1.rgb;",
        "_output.a = (_input.a + tex0.a) * tex1.a;",
      ],
      PS_Combiners_Add_Mod2x: [
        2,
        "_output.rgb = (_input.rgb + tex0.rgb) * tex1.rgb * 2.0;",
        "_output.a = (_input.a + tex0.a) * tex1.a * 2.0;",
      ],
      PS_Combiners_Add_Opaque: [
        2,
        "_output.rgb = (_input.rgb + tex0.rgb) * tex1.rgb;",
        "_output.a = _input.a + tex0.a;",
      ],
      PS_Combiners_Mod_AddNA: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb);",
        "_output.a = tex0.a;",
        "_specular = tex1.rgb;",
      ],
      PS_Combiners_Mod_Mod: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;",
        "_output.a = tex0.a * tex1.a;",
      ],
      PS_Combiners_Mod_Mod2x: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;",
        "_output.a = tex0.a * tex1.a * 2.0;",
      ],
      PS_Combiners_Mod_Add: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb);",
        "_output.a = tex0.a + tex1.a;",
        "_specular = tex1.rgb;",
      ],
      PS_Combiners_Mod_Mod2xNA: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;",
        "_output.a = tex0.a;",
      ],
      PS_Combiners_Mod_Opaque: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;",
        "_output.a = tex0.a;",
      ],
      PS_Combiners_Mod2x_Add: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * 2.0 + tex1.rgb;",
        "_output.a = (tex0.a) * 2.0 + tex1.a;",
      ],
      PS_Combiners_Mod2x_Mod2x: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 4.0;",
        "_output.a = (tex0.a) * tex1.a * 4.0;",
      ],
      PS_Combiners_Mod2x_Opaque: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;",
        "_output.a = tex0.a * 2.0;",
      ],
      PS_Combiners_Opaque_Add: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) + tex1.rgb;",
        "_output.a = _input.a + tex1.a;",
      ],
      PS_Combiners_Opaque_AddAlpha: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb);",
        "_specular = (tex1.rgb * tex1.a);",
      ],
      PS_Combiners_Opaque_AddAlpha_Wgt: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb);",
        "_specular = (tex1.rgb * tex1.a) * uTexSampleAlpha.g;",
      ],
      PS_Combiners_Opaque_AddAlpha_Alpha: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb);",
        "_specular = (tex1.rgb * tex1.a * (1.0 - tex0.a));",
      ],
      PS_Combiners_Opaque_AddNA: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) + tex1.rgb;",
        "_output.a = _input.a;",
      ],
      PS_Combiners_Opaque_Mod: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;",
        "_output.a = tex1.a;",
      ],
      PS_Combiners_Opaque_Mod2x: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;",
        "_output.a = tex1.a * 2.0;",
      ],
      PS_Combiners_Opaque_Mod2xNA: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb * 2.0;",
        "",
      ],
      PS_Combiners_Opaque_Mod2xNA_Alpha: [
        2,
        "_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.0, tex0.rgb, vec3(tex0.a));",
        "",
      ],
      PS_Combiners_Opaque_Opaque: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;",
        "",
      ],
      PS_Combiners_Opaque_Mod2xNA_Alpha_Add: [
        3,
        "_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.0, tex0.rgb, vec3(tex0.a));",
        "_specular = tex2.rgb * tex2.a * uTexSampleAlpha.b;",
      ],
      PS_Combiners_Mod_Mod_Mod_Const: [
        3,
        "_output.rgb = _input.rgb * (tex0 * tex1 * tex2).rgb;",
        "_output.a = (tex0 * tex1 * tex2).a;",
      ],
      PS_Combiners_Mod_AddAlpha: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb);",
        "_output.a = tex0.a;",
        "_specular = tex1.rgb * tex1.a;",
      ],
      PS_Combiners_Mod_AddAlpha_Wgt: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb);",
        "_output.a = tex0.a;",
        "_specular = tex1.rgb * tex1.a * uTexSampleAlpha.g;",
      ],
      PS_Combiners_Mod_AddAlpha_Alpha: [
        2,
        "_output.rgb = _input.rgb * tex0.rgb;",
        "_output.a = (tex0.a + tex1.a * (0.3 * tex1.r + 0.59 * tex1.g + 0.11 * tex1.b));",
        "_specular = tex1.rgb * tex1.a * (1.0 - tex0.a);",
      ],
      PS_Combiners_Opaque_Mod_Add_Wgt: [
        2,
        "_output.rgb = _input.rgb * mix(tex0.rgb, tex1.rgb, vec3(tex1.a));",
        "_specular = (tex0.rgb * tex0.a) * uTexSampleAlpha.r;",
      ],
      PS_Guild: [
        3,
        "_output.rgb = _input.rgb * mix(tex0.rgb * mix(vec3(1.0, 1.0, 1.0), tex1.rgb * vec3(1.0, 1.0, 1.0), vec3(tex1.a)), tex2.rgb * vec3(1.0, 1.0, 1.0), vec3(tex2.a));",
        "_output.a = tex0.a;",
      ],
      PS_Guild_Opaque: [
        3,
        "_output.rgb = _input.rgb * mix(tex0.rgb * mix(vec3(1.0, 1.0, 1.0), tex1.rgb * vec3(1.0, 1.0, 1.0), vec3(tex1.a)), tex2.rgb * vec3(1.0, 1.0, 1.0), vec3(tex2.a));",
        "",
      ],
      PS_Guild_NoBorder: [
        2,
        "_output.rgb = _input.rgb * tex0.rgb * mix(vec3(1.0, 1.0, 1.0), tex1.rgb * vec3(1.0, 1.0, 1.0), vec3(tex1.a));",
        "_output.a = tex0.a;",
      ],
      PS_Combiners_Opaque_Alpha_Alpha: [
        2,
        "_output.rgb = _input.rgb * mix(mix(tex0.rgb, tex1.rgb, vec3(tex1.a)), tex0.rgb, vec3(tex0.a));",
        "",
      ],
      PS_Combiners_Opaque_Mod2xNA_Alpha_3s: [
        3,
        "_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.0, tex2.rgb, vec3(tex2.a));",
      ],
      PS_Combiners_Mod_Add_Alpha: [
        2,
        "_output.rgb = _input.rgb * tex0.rgb;",
        "_output.a = (tex0.a + tex1.a);",
        "_specular = tex1.rgb * (1.0 - tex0.a);",
      ],
      PS_Combiners_Opaque_ModNA_Alpha: [
        2,
        "_output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb, tex0.rgb, vec3(tex0.a));",
        "",
      ],
      PS_Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha: [
        3,
        "float glowOpacity = clamp((tex2.a * vec4(1.0, 1.0, 1.0, 1.0).z), 0.0, 1.0); _output.rgb = _input.rgb * mix(tex0.rgb * tex1.rgb * 2.000000, tex0.rgb, vec3(tex0.a)) * (1.0 - glowOpacity);",
        "_specular = tex2.rgb * glowOpacity;",
      ],
      PS_Combiners_Opaque_Mod2xNA_Alpha_Alpha: [
        3,
        "_output.rgb = _input.rgb * mix(mix(tex0.rgb * tex1.rgb * 2.000000, tex2.rgb, vec3(tex2.a)), tex0.rgb, vec3(tex0.a));",
        "",
      ],
      PS_Combiners_Mod_Depth: [
        1,
        "_output.rgb = _input.rgb * tex0.rgb;",
        "_output.a = tex0.a;",
      ],
      PS_Combiners_Opaque_Alpha: [
        2,
        "_output.rgb = _input.rgb * mix(tex0.rgb, tex1.rgb, vec3(tex1.a));",
        "",
      ],
      Skin: [
        3,
        "//Fresnel Rim\r\nif (uHasSpecEmiss) {\r\n    vec3 emissiveColor = tex2.rgb;\r\n    vec3 emissiveTerm = tex2.rgb;\r\n    if (uHasEmissiveGlowing) {\r\n        vec3 eyeVec_120 = vPosition.xyz;\r\n        vec3 t121 = -(eyeVec_120);\r\n        vec2 term_126 = vec2(dot(t121, vNormal), dot(normalize(t121), (vNormal * vec3(0.0500000007, 0.0500000007, 1.0))));\r\n        vec2 invTerm_128 = (vec2(1.0) - clamp(term_126, 0.0, 1.0));\r\n        vec2 f_129 = (invTerm_128 * invTerm_128);\r\n        float fresnel_rim_133 = pow((f_129.x + f_129.y), 0.600000024);\r\n        vec3 t136 = (tex2.rgb /*+ ((vec3(0.0500000007, 0.0, 0.400000006) * 1.0) * fresnel_rim_133)*/);\r\n        emissiveColor = vec3(t136.r, tex2.g, t136.b);\r\n\r\n        float t267 = dot(normalize(vNormal),  normalize(-(vPosition.xyz)));\r\n        emissiveTerm = mix(vec3(0.0), 2.0*emissiveColor, vec3(pow(clamp(t267, 0.0, 1.0), (( 128.0 * (tex2.a)) + 9.99999975e-006))));\r\n    }\r\n\r\n    _output.rgb = _input.rgb * tex0.rgb + tex1.rgb + emissiveTerm.rgb;\r\n} else {\r\n    _output.rgb = _input.rgb * tex0.rgb;\r\n}\r\n_output.a = tex0.a; //\r\n",
      ],
      PS_Combiners_Mod_Dual_Crossfade: [
        3,
        "_output.rgb = _input.rgb * mix(mix(tex0, texture2D(uTexture2,vTexCoord1), vec4(clamp(uTexSampleAlpha.g, 0.000000, 1.000000))), texture2D(uTexture3,vTexCoord1), vec4(clamp(uTexSampleAlpha.b, 0.000000, 1.000000))).rgb;",
        "_output.a = mix(mix(tex0, texture2D(uTexture2,vTexCoord1), vec4(clamp(uTexSampleAlpha.g, 0.000000, 1.000000))), texture2D(uTexture3,vTexCoord1), vec4(clamp(uTexSampleAlpha.b, 0.000000, 1.000000))).a;",
      ],
      PS_Combiners_Mod_Masked_Dual_Crossfade: [
        4,
        "_output.rgb = _input.rgb * mix(mix(tex0, texture2D(uTexture2,texCoord), vec4(clamp(uTexSampleAlpha.g, 0.000000, 1.000000))), texture2D(uTexture3,texCoord), vec4(clamp(uTexSampleAlpha.b, 0.000000, 1.000000))).rgb;",
        "_output.a = mix(mix(tex0, texture2D(uTexture2,texCoord), vec4(clamp(uTexSampleAlpha.g, 0.000000, 1.000000))), texture2D(uTexture3,texCoord), vec4(clamp(uTexSampleAlpha.b, 0.000000, 1.000000))).a * texture(uTexture4,texCoord2).a;",
      ],
      PS_Combiners_Mod_Mod_Depth: [
        2,
        "_output.rgb = (_input.rgb * tex0.rgb) * tex1.rgb;",
        "_output.a = tex0.a * tex1.a;",
      ],
    },
    xs = _s;
  const vs = class {
    constructor(t) {
      (this.d = t), (this.a = new Set());
    }
    c() {
      const t = this.a;
      return (this.a = new Set()), t;
    }
    e(t) {
      this.a.has(t) || (this.d.enableVertexAttribArray(t), this.a.add(t));
    }
    b(t) {
      const e = this.d;
      [...t]
        .filter((t) => !this.a.has(t))
        .forEach((t) => e.disableVertexAttribArray(t));
    }
  };
  const Ts = class {};
  const ws = class {};
  const ys = class extends ws {};
  function As() {
    var t = new fi(4);
    return (
      fi != Float32Array && ((t[0] = 0), (t[1] = 0), (t[2] = 0), (t[3] = 0)), t
    );
  }
  function Es(t, e, i, s) {
    var r = new fi(4);
    return (r[0] = t), (r[1] = e), (r[2] = i), (r[3] = s), r;
  }
  function Ms(t, e) {
    return (t[0] = e[0]), (t[1] = e[1]), (t[2] = e[2]), (t[3] = e[3]), t;
  }
  function Cs(t, e, i, s, r) {
    return (t[0] = e), (t[1] = i), (t[2] = s), (t[3] = r), t;
  }
  function Ss(t, e, i) {
    return (
      (t[0] = e[0] + i[0]),
      (t[1] = e[1] + i[1]),
      (t[2] = e[2] + i[2]),
      (t[3] = e[3] + i[3]),
      t
    );
  }
  function Fs(t, e, i) {
    return (
      (t[0] = e[0] - i[0]),
      (t[1] = e[1] - i[1]),
      (t[2] = e[2] - i[2]),
      (t[3] = e[3] - i[3]),
      t
    );
  }
  function Is(t, e, i) {
    return (
      (t[0] = e[0] * i),
      (t[1] = e[1] * i),
      (t[2] = e[2] * i),
      (t[3] = e[3] * i),
      t
    );
  }
  function ks(t) {
    var e = t[0],
      i = t[1],
      s = t[2],
      r = t[3];
    return Math.hypot(e, i, s, r);
  }
  function Ds(t, e) {
    var i = e[0],
      s = e[1],
      r = e[2],
      n = e[3],
      a = i * i + s * s + r * r + n * n;
    return (
      a > 0 && (a = 1 / Math.sqrt(a)),
      (t[0] = i * a),
      (t[1] = s * a),
      (t[2] = r * a),
      (t[3] = n * a),
      t
    );
  }
  function Rs(t, e, i) {
    var s = e[0],
      r = e[1],
      n = e[2],
      a = e[3];
    return (
      (t[0] = i[0] * s + i[4] * r + i[8] * n + i[12] * a),
      (t[1] = i[1] * s + i[5] * r + i[9] * n + i[13] * a),
      (t[2] = i[2] * s + i[6] * r + i[10] * n + i[14] * a),
      (t[3] = i[3] * s + i[7] * r + i[11] * n + i[15] * a),
      t
    );
  }
  var Us = ks;
  !(function () {
    var t = As();
  })();
  const Os = class extends ys {
    constructor(t, e) {
      super(),
        (this.j = e),
        (this.f = gi()),
        (this.i = _i(0, 0, 0)),
        (this.h = As()),
        (this.ed = Es(0, 0, 0, 0)),
        (this.g = new ss(t, (40 * e.length) / 4, !0)),
        this.dc(e);
    }
    ba(t, e) {
      const i = this.cba;
      let s = this.j.length;
      for (let r = 0; r < s; ++r) {
        if (!e.has(r)) continue;
        mi(this.i, 0, 0, 0), Cs(this.ed, 0, 0, 0, 0);
        const s = this.j[r];
        let n = !1;
        for (let e = 0; e < 4; ++e) {
          const i = s.d[e] / 255;
          if (i > 0) {
            const r = t[s.g[e]];
            Di(this.f, s.e, r.c),
              Rs(this.h, s.b, r.w),
              (this.i[0] = this.i[0] + this.f[0] * i),
              (this.i[1] = this.i[1] + this.f[1] * i),
              (this.i[2] = this.i[2] + this.f[2] * i),
              (this.ed[0] = this.ed[0] + this.h[0] * i),
              (this.ed[1] = this.ed[1] + this.h[1] * i),
              (this.ed[2] = this.ed[2] + this.h[2] * i),
              (n = !0);
          }
        }
        if (n) {
          let t = 10 * r;
          (i[t++] = this.i[0]),
            (i[t++] = this.i[1]),
            (i[t++] = this.i[2]),
            (i[t++] = this.ed[0]),
            (i[t++] = this.ed[1]),
            (i[t++] = this.ed[2]);
        }
      }
      this.g.a(this.cba);
    }
    dc(t) {
      const e = (40 * t.length) / 4;
      this.cba = new Float32Array(e);
      const i = this.cba,
        s = t;
      let r = 0;
      for (let t = 0; t < s.length; ++t)
        (i[r++] = s[t].e[0]),
          (i[r++] = s[t].e[1]),
          (i[r++] = s[t].e[2]),
          (i[r++] = s[t].b[0]),
          (i[r++] = s[t].b[1]),
          (i[r++] = s[t].b[2]),
          (i[r++] = s[t].f),
          (i[r++] = s[t].i),
          (i[r++] = s[t].a),
          (i[r++] = s[t].h);
      this.g.a(this.cba);
    }
    a(t) {
      this.g.a(t);
    }
    c() {
      return this.g.c();
    }
    b() {
      this.g.b();
    }
    d() {
      this.g.d();
    }
  };
  const Bs = class extends ys {
    constructor(t, e) {
      super(),
        (this.cba = e),
        (this.f = new ss(t, 48 * e.length, !0)),
        this.dc(e);
    }
    ba(t, e) {}
    dc(t) {
      const e = 48 * t.length;
      this.ed = new Uint8Array(e);
      let i = new DataView(this.ed.buffer);
      const s = t;
      let r = 0;
      for (let t = 0; t < s.length; ++t)
        i.setFloat32(r, s[t].e[0], !0),
          (r += 4),
          i.setFloat32(r, s[t].e[1], !0),
          (r += 4),
          i.setFloat32(r, s[t].e[2], !0),
          (r += 4),
          i.setFloat32(r, s[t].b[0], !0),
          (r += 4),
          i.setFloat32(r, s[t].b[1], !0),
          (r += 4),
          i.setFloat32(r, s[t].b[2], !0),
          (r += 4),
          i.setUint8(r, s[t].g[0]),
          (r += 1),
          i.setUint8(r, s[t].g[1]),
          (r += 1),
          i.setUint8(r, s[t].g[2]),
          (r += 1),
          i.setUint8(r, s[t].g[3]),
          (r += 1),
          i.setUint8(r, s[t].d[0]),
          (r += 1),
          i.setUint8(r, s[t].d[1]),
          (r += 1),
          i.setUint8(r, s[t].d[2]),
          (r += 1),
          i.setUint8(r, s[t].d[3]),
          (r += 1),
          i.setFloat32(r, s[t].f, !0),
          (r += 4),
          i.setFloat32(r, s[t].i, !0),
          (r += 4),
          i.setFloat32(r, s[t].a, !0),
          (r += 4),
          i.setFloat32(r, s[t].h, !0),
          (r += 4);
      this.f.a(this.ed);
    }
    a(t) {
      this.f.a(t);
    }
    c() {
      return this.f.c();
    }
    b() {
      this.f.b();
    }
    d() {
      this.f.d();
    }
  };
  const Ps = class {
    b() {
      return {};
    }
    a(t) {}
  };
  const zs = class {
    constructor(t, e) {
      (this.ba = t),
        (this.c = e),
        (this.c = 256),
        (this.d = new Float32Array(16 * this.c)),
        (this.e = t.createTexture()),
        t.bindTexture(t.TEXTURE_2D, this.e),
        t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, t.NEAREST),
        t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MAG_FILTER, t.NEAREST),
        t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.CLAMP_TO_EDGE),
        t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.CLAMP_TO_EDGE),
        t.bindTexture(t.TEXTURE_2D, null);
    }
    b() {
      return { uBoneMatricesTex: this.e };
    }
    a(t) {
      const e = Math.min(256, t.length);
      for (let i = 0; i < e; i++) this.d.set(t[i].c, 16 * i);
      const i = this.ba;
      i.bindTexture(i.TEXTURE_2D, this.e),
        i.texImage2D(
          i.TEXTURE_2D,
          0,
          i.RGBA,
          4,
          this.c,
          0,
          i.RGBA,
          i.FLOAT,
          this.d
        ),
        i.bindTexture(i.TEXTURE_2D, null);
    }
  };
  var Ns;
  !(function (t) {
    (t[(t.aPosition = 0)] = "aPosition"),
      (t[(t.aNormal = 1)] = "aNormal"),
      (t[(t.aTexCoord0 = 2)] = "aTexCoord0"),
      (t[(t.aTexCoord1 = 3)] = "aTexCoord1");
  })(Ns || (Ns = {}));
  const Gs = {
      aPosition: Ns.aPosition,
      aNormal: Ns.aNormal,
      aTexCoord0: Ns.aTexCoord0,
      aTexCoord1: Ns.aTexCoord1,
    },
    Ls = [
      new ns(Ns.aPosition, 3, rs.GFLOAT, !1, 40, 0),
      new ns(Ns.aNormal, 3, rs.GFLOAT, !1, 40, 12),
      new ns(Ns.aTexCoord0, 2, rs.GFLOAT, !1, 40, 24),
      new ns(Ns.aTexCoord1, 2, rs.GFLOAT, !1, 40, 32),
    ];
  var js;
  !(function (t) {
    (t[(t.aPosition = 0)] = "aPosition"),
      (t[(t.aNormal = 1)] = "aNormal"),
      (t[(t.aBones = 2)] = "aBones"),
      (t[(t.aBoneWeights = 3)] = "aBoneWeights"),
      (t[(t.aTexCoord0 = 4)] = "aTexCoord0"),
      (t[(t.aTexCoord1 = 5)] = "aTexCoord1");
  })(js || (js = {}));
  const Ys = {
      aPosition: js.aPosition,
      aNormal: js.aNormal,
      aBones: js.aBones,
      aBoneWeights: js.aBoneWeights,
      aTexCoord0: js.aTexCoord0,
      aTexCoord1: js.aTexCoord1,
    },
    Hs = [
      new ns(js.aPosition, 3, rs.GFLOAT, !1, 48, 0),
      new ns(js.aNormal, 3, rs.GFLOAT, !1, 48, 12),
      new ns(js.aBones, 4, rs.GUNSIGNED_BYTE, !1, 48, 24),
      new ns(js.aBoneWeights, 4, rs.GUNSIGNED_BYTE, !0, 48, 28),
      new ns(js.aTexCoord0, 2, rs.GFLOAT, !1, 48, 32),
      new ns(js.aTexCoord1, 2, rs.GFLOAT, !1, 48, 40),
    ];
  var qs;
  !(function (t) {
    (t[(t.aPosition = 0)] = "aPosition"),
      (t[(t.aColor = 1)] = "aColor"),
      (t[(t.aTexcoord0 = 2)] = "aTexcoord0"),
      (t[(t.aTexcoord1 = 3)] = "aTexcoord1"),
      (t[(t.aTexcoord2 = 4)] = "aTexcoord2"),
      (t[(t.aAlphaCutoff = 5)] = "aAlphaCutoff");
  })(qs || (qs = {}));
  const Vs = {
      [qs.aPosition]: qs.aPosition,
      [qs.aColor]: qs.aColor,
      [qs.aTexcoord0]: qs.aTexcoord0,
      [qs.aTexcoord1]: qs.aTexcoord1,
      [qs.aTexcoord2]: qs.aTexcoord2,
      [qs.aAlphaCutoff]: qs.aAlphaCutoff,
    },
    Xs = [
      new ns(qs.aPosition, 3, rs.GFLOAT, !1, 56, 0),
      new ns(qs.aColor, 4, rs.GFLOAT, !1, 56, 12),
      new ns(qs.aTexcoord0, 2, rs.GFLOAT, !1, 56, 28),
      new ns(qs.aTexcoord1, 2, rs.GFLOAT, !1, 56, 36),
      new ns(qs.aTexcoord2, 2, rs.GFLOAT, !1, 56, 44),
      new ns(qs.aAlphaCutoff, 1, rs.GFLOAT, !1, 56, 52),
    ];
  var Ks;
  !(function (t) {
    (t[(t.aPosition = 0)] = "aPosition"),
      (t[(t.aColor = 1)] = "aColor"),
      (t[(t.aTexcoord0 = 2)] = "aTexcoord0");
  })(Ks || (Ks = {}));
  const Ws = {
      [Ks.aPosition]: Ks.aPosition,
      [Ks.aColor]: Ks.aColor,
      [Ks.aTexcoord0]: Ks.aTexcoord0,
    },
    Zs = [
      new ns(Ks.aPosition, 3, rs.GFLOAT, !1, 36, 0),
      new ns(Ks.aColor, 4, rs.GFLOAT, !1, 36, 12),
      new ns(Ks.aTexcoord0, 2, rs.GFLOAT, !1, 36, 28),
    ];
  const Js = class {
    constructor(t, e) {
      (this.lk = t),
        (this.ba = e),
        (this.ji = new Map()),
        (this.fe = new vs(t.ba()));
      const i = t.ba();
      (this.hg = i.createTexture()),
        i.bindTexture(i.TEXTURE_2D, this.hg),
        i.texImage2D(
          i.TEXTURE_2D,
          0,
          i.RGBA,
          1,
          1,
          0,
          i.RGBA,
          i.UNSIGNED_BYTE,
          new Uint8Array([0, 0, 0, 0])
        ),
        i.bindTexture(i.TEXTURE_2D, null);
    }
    dc() {
      throw new Error("Method not implemented.");
    }
    j() {
      return this.lk;
    }
    l(t) {
      return new is(this.lk.ba(), t, !1);
    }
    o(t) {
      return this.lk.m ? new Bs(this.lk.ba(), t) : new Os(this.lk.ba(), t);
    }
    d(t) {
      return new ss(this.lk.ba(), t, !0);
    }
    g(t) {
      return new ss(this.lk.ba(), t, !0);
    }
    n(t, e) {
      const i = this.lk.dc(),
        s = i ? new os(this.lk.ba(), i) : new hs(this.lk.ba(), this.fe),
        r = this.lk.m ? Hs : Ls;
      return s.a(t, r), s.c(e), s;
    }
    e(t, e) {
      const i = this.lk.dc(),
        s = i ? new os(this.lk.ba(), i) : new hs(this.lk.ba(), this.fe);
      return s.c(e), s.a(t, Xs), s;
    }
    h(t, e) {
      const i = this.lk.dc(),
        s = i ? new os(this.lk.ba(), i) : new hs(this.lk.ba(), this.fe);
      return s.c(e), s.a(t, Zs), s;
    }
    f(t, e, i, s) {
      return this.lk.m ? new zs(this.lk.ba(), t) : new Ps();
    }
    i(t, e, i) {
      const s = xs.c(i.a, i.c.length),
        r = xs.a(i.a, i.c.length),
        n = "Wow." + r + "_" + s + (i.b ? "_gradient" : "");
      let a;
      this.ji.has(n)
        ? (a = this.ji.get(n))
        : ((a = new bs(
            this.lk.ba(),
            this.lk.m ? Ys : Gs,
            xs.e(r, this.lk.m),
            xs.g(r, s, i.b)
          )),
          this.ji.set(n, a));
      const o = Object.assign(
        Object.assign(Object.assign({}, this.ba), t.b()),
        i.d
      );
      for (let t = 0; t < Math.max(i.c.length, 4); t++) {
        let e = t < i.c.length ? i.c[t].e : this.hg;
        o["uTexture" + (t + 1).toString()] = e;
      }
      return new gs(this.lk.ba(), a, e, o);
    }
    c(t, e, i) {
      const s = Object.assign(
        Object.assign(Object.assign({}, this.ba), t.b()),
        i.a
      );
      let r;
      const n = "ParticleShader";
      this.ji.has(n)
        ? (r = this.ji.get(n))
        : ((r = new bs(
            this.lk.ba(),
            Vs,
            "attribute vec3 aPosition;\r\nattribute vec4 aColor;\r\nattribute vec2 aTexcoord0;\r\nattribute vec2 aTexcoord1;\r\nattribute vec2 aTexcoord2;\r\nattribute float aAlphaCutoff;\r\n\r\nvarying vec4 vColor;\r\nvarying vec2 vTexcoord0;\r\nvarying vec2 vTexcoord1;\r\nvarying vec2 vTexcoord2;\r\nvarying float vAlphaCutoff;\r\n\r\nuniform mat4 uModelMatrix;\r\nuniform mat4 uViewMatrix;\r\nuniform mat4 uProjMatrix;\r\n\r\nvoid main(void) {\r\n    vec4 pos = vec4(aPosition, 1);\r\n\r\n    gl_Position = uProjMatrix * pos;\r\n\r\n    vColor = aColor;\r\n    vTexcoord0 = aTexcoord0;\r\n    vTexcoord1 = aTexcoord1;\r\n    vTexcoord2 = aTexcoord2;\r\n    vAlphaCutoff = aAlphaCutoff;\r\n}",
            "precision mediump float;\r\n\r\nvarying vec4 vColor;\r\nvarying vec2 vTexcoord0;\r\nvarying vec2 vTexcoord1;\r\nvarying vec2 vTexcoord2;\r\nvarying float vAlphaCutoff;\r\n\r\nuniform bool uHasTexture;\r\nuniform bool uHasTexture2;\r\nuniform bool uHasTexture3;\r\nuniform bool uHasAlpha;\r\nuniform int uBlendMode;\r\nuniform int uPixelShader;\r\nuniform sampler2D uTexture0;\r\nuniform sampler2D uTexture1;\r\nuniform sampler2D uTexture2;\r\nuniform float uAlphaTreshold;\r\n\r\nuniform float alphaMult;\r\nuniform float colorMult;\r\n\r\nvoid main(void) {\r\n    float lo_thresh = 0.01;\r\n    vec4 color = vec4(1, 1, 1, 1);\r\n    vec4 tex = vec4(1, 1, 1, 1);\r\n    vec4 tex2 = vec4(1, 1, 1, 1);\r\n    vec4 tex3 = vec4(1, 1, 1, 1);\r\n    if (uHasTexture) {\r\n        tex = texture2D(uTexture0, vTexcoord0).rgba;\r\n    }\r\n    if (uHasTexture2) {\r\n        tex2 = texture2D(uTexture1, vTexcoord1).rgba;\r\n    }\r\n    if (uHasTexture3) {\r\n        tex3 = texture2D(uTexture2, vTexcoord2).rgba;\r\n    }\r\n    vec4 finalColor = vec4((tex * vColor ).rgb, tex.a*vColor.a );\r\n    vec3 matDiffuse = vec3(1.0);\r\n    float opacity = 1.0;\r\n    if (uPixelShader == 0) {\r\n        matDiffuse = vColor.xyz * tex.rgb;\r\n        opacity = tex.a*vColor.a;\r\n    } else if (uPixelShader == 1) {\r\n        vec4 textureMod = tex*tex2;\r\n        float texAlpha = (textureMod.w * tex3.w);\r\n        opacity = texAlpha*vColor.a;\r\n        matDiffuse = vColor.xyz * 4.0 * textureMod.rgb;\r\n    } else if (uPixelShader == 2) {\r\n        vec4 textureMod = tex*tex2*tex3;\r\n        float texAlpha = (textureMod.w);\r\n        opacity = texAlpha*vColor.a;\r\n        matDiffuse = vColor.xyz * textureMod.rgb;\r\n    } else if (uPixelShader == 3) {\r\n        vec4 textureMod = tex*tex2*tex3;\r\n        float texAlpha = (textureMod.w);\r\n        opacity = texAlpha*vColor.a;\r\n\r\n        matDiffuse = vColor.xyz * textureMod.rgb;\r\n    } else if (uPixelShader == 4) {\r\n        discard;\r\n    }\r\n\r\n    finalColor = vec4(matDiffuse.rgb * colorMult, opacity * alphaMult);\r\n\r\n    if (finalColor.a < vAlphaCutoff ) discard;\r\n    if (finalColor.a < uAlphaTreshold ) discard;\r\n    gl_FragColor = finalColor;\r\n}\r\n"
          )),
          this.ji.set(n, r));
      for (let t = 0; t < i.b.length; t++)
        i.b[t] && (s["uTexture" + t.toString()] = i.b[t].e);
      return new gs(this.lk.ba(), r, e, s);
    }
    a(t, e, i) {
      const s = Object.assign(
        Object.assign(Object.assign({}, this.ba), t.b()),
        i.b
      );
      let r;
      const n = "RibbonShader";
      return (
        this.ji.has(n)
          ? (r = this.ji.get(n))
          : ((r = new bs(
              this.lk.ba(),
              Ws,
              "attribute vec3 aPosition;\r\nattribute vec4 aColor;\r\nattribute vec2 aTexcoord0;\r\n\r\nuniform mat4 uViewMatrix;\r\nuniform mat4 uProjMatrix;\r\n\r\nvarying vec4 vColor;\r\nvarying vec2 vTexcoord0;\r\n\r\nvoid main() {\r\n    vec4 aPositionVec4 = vec4(aPosition, 1);\r\n    vColor = aColor;\r\n    vTexcoord0 = aTexcoord0;\r\n\r\n    gl_Position = uProjMatrix * uViewMatrix * aPositionVec4;\r\n}\r\n\r\n\r\n",
              "precision mediump float;\r\n\r\nvarying vec4 vColor;\r\nvarying vec2 vTexcoord0;\r\nuniform sampler2D uTexture;\r\n\r\nvoid main() {\r\n    vec4 tex = texture2D(uTexture, vTexcoord0).rgba;\r\n    gl_FragColor = vec4((vColor.rgb*tex.rgb), tex.a * vColor.a );\r\n}\r\n"
            )),
            this.ji.set(n, r)),
        (s["uTexture".toString()] = i.a[0].e),
        new gs(this.lk.ba(), r, e, s)
      );
    }
    b(t, e, i, s) {
      const r = this.lk.ba();
      let n = new Ts();
      return (
        (n.g = e),
        (n.c = t.b),
        (n.h = r.TRIANGLES),
        (n.f = t.c),
        (n.e = t.a),
        (n.b = s),
        (n.a = i),
        n
      );
    }
    m(t, e, i, s) {
      const r = this.lk.ba();
      let n = new Ts();
      return (
        (n.g = e),
        (n.c = t.b),
        (n.h = r.TRIANGLE_STRIP),
        (n.f = t.c),
        (n.e = t.a),
        (n.b = s),
        (n.a = i),
        n
      );
    }
    k(t) {
      const e = this.lk.ba(),
        i = e.createTexture();
      function s(t) {
        return 0 == (t & (t - 1));
      }
      e.bindTexture(e.TEXTURE_2D, i),
        e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !1),
        e.texImage2D(e.TEXTURE_2D, 0, e.RGBA, e.RGBA, e.UNSIGNED_BYTE, t),
        s(t.width) && s(t.height)
          ? e.generateMipmap(e.TEXTURE_2D)
          : (e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_S, e.CLAMP_TO_EDGE),
            e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_T, e.CLAMP_TO_EDGE),
            e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, e.LINEAR));
      const r = this.lk.g;
      return (
        r &&
          e.texParameteri(
            e.TEXTURE_2D,
            r.TEXTURE_MAX_ANISOTROPY_EXT,
            this.lk.j
          ),
        i
      );
    }
  };
  var $s;
  !(function (t) {
    (t[(t.GxBlend_UNDEFINED = -1)] = "GxBlend_UNDEFINED"),
      (t[(t.GxBlend_Opaque = 0)] = "GxBlend_Opaque"),
      (t[(t.GxBlend_AlphaKey = 1)] = "GxBlend_AlphaKey"),
      (t[(t.GxBlend_Alpha = 2)] = "GxBlend_Alpha"),
      (t[(t.GxBlend_Add = 3)] = "GxBlend_Add"),
      (t[(t.GxBlend_Mod = 4)] = "GxBlend_Mod"),
      (t[(t.GxBlend_Mod2x = 5)] = "GxBlend_Mod2x"),
      (t[(t.GxBlend_ModAdd = 6)] = "GxBlend_ModAdd"),
      (t[(t.GxBlend_InvSrcAlphaAdd = 7)] = "GxBlend_InvSrcAlphaAdd"),
      (t[(t.GxBlend_InvSrcAlphaOpaque = 8)] = "GxBlend_InvSrcAlphaOpaque"),
      (t[(t.GxBlend_SrcAlphaOpaque = 9)] = "GxBlend_SrcAlphaOpaque"),
      (t[(t.GxBlend_NoAlphaAdd = 10)] = "GxBlend_NoAlphaAdd"),
      (t[(t.GxBlend_ConstantAlpha = 11)] = "GxBlend_ConstantAlpha"),
      (t[(t.GxBlend_Screen = 12)] = "GxBlend_Screen"),
      (t[(t.GxBlend_BlendAdd = 13)] = "GxBlend_BlendAdd"),
      (t[(t.GxBlend_MAX = 14)] = "GxBlend_MAX");
  })($s || ($s = {}));
  const Qs = $s;
  const tr = class {
    constructor(t) {
      (this.n = t),
        (this.k = -1),
        (this.o = -1),
        (this.ji = -1),
        (this.t = -1),
        (this.dc = -1),
        (this.s = Qs.GxBlend_UNDEFINED),
        (this.m = null),
        (this.q = null),
        (this.l = null),
        (this.hg = null),
        (this.p = null);
    }
    ba() {
      (this.k = -1),
        (this.o = -1),
        (this.ji = -1),
        (this.t = -1),
        (this.dc = -1),
        (this.s = Qs.GxBlend_UNDEFINED),
        (this.m = null),
        (this.q = null),
        (this.l = null),
        (this.hg = null),
        (this.p = null);
    }
    i(t) {
      this.s != t && (this.r(t), (this.s = t));
    }
    e(t) {
      const e = t ? 1 : 0;
      e != this.k && (this.n.depthMask(t), (this.k = e));
    }
    h(t) {
      const e = t ? 1 : 0;
      e != this.o &&
        (t
          ? this.n.enable(this.n.DEPTH_TEST)
          : this.n.disable(this.n.DEPTH_TEST),
        (this.o = e));
    }
    g(t) {
      const e = t ? 1 : 0;
      e != this.ji &&
        (t ? this.n.enable(this.n.CULL_FACE) : this.n.disable(this.n.CULL_FACE),
        (this.ji = e));
    }
    c(t) {
      const e = t ? 1 : 0;
      e != this.t &&
        (t ? this.n.frontFace(this.n.CCW) : this.n.frontFace(this.n.CW),
        (this.t = e));
    }
    j(t) {
      this.dc != t &&
        (this.n.colorMask((1 & t) > 0, (2 & t) > 0, (4 & t) > 0, (8 & t) > 0),
        (this.dc = t));
    }
    d(t) {
      this.q != t && (t ? t.b() : t.d(), (this.q = t));
    }
    a(t) {
      this.m != t && (t ? t.b() : t.d(), (this.m = t));
    }
    f(t) {
      this.l != t &&
        (t ? t.d() : this.l.b(),
        (this.l = t),
        (this.m = null),
        (this.q = null));
    }
    b(t) {
      t != this.hg && (t && t.a(), (this.hg = t));
    }
    r(t) {
      const e = this.n;
      switch (
        (0 == t
          ? e.disable(e.BLEND)
          : (e.enable(e.BLEND), e.blendEquation(e.FUNC_ADD)),
        t)
      ) {
        case 0:
          break;
        case 1:
          e.blendFuncSeparate(e.ONE, e.ZERO, e.ONE, e.ONE);
          break;
        case 2:
          e.blendFuncSeparate(e.SRC_ALPHA, e.ONE_MINUS_SRC_ALPHA, e.ONE, e.ONE);
          break;
        case 3:
          e.blendFuncSeparate(e.SRC_ALPHA, e.ONE, e.ONE, e.ONE);
          break;
        case 4:
          e.blendFuncSeparate(e.DST_COLOR, e.ZERO, e.ONE, e.ONE);
          break;
        case 5:
          e.blendFuncSeparate(e.DST_COLOR, e.SRC_COLOR, e.ONE, e.ONE);
          break;
        case 6:
          e.blendFuncSeparate(e.DST_COLOR, e.ONE, e.ONE, e.ONE);
          break;
        case 10:
          e.blendFunc(e.ONE, e.ONE);
          break;
        case 7:
          e.blendFuncSeparate(e.ONE_MINUS_SRC_ALPHA, e.ONE, e.ONE, e.ONE);
          break;
        case 8:
          e.blendFuncSeparate(e.ONE_MINUS_SRC_ALPHA, e.ZERO, e.ONE, e.ONE);
          break;
        case 13:
          e.blendFuncSeparate(e.ONE, e.ONE_MINUS_SRC_ALPHA, e.ONE, e.ONE);
          break;
        default:
          throw 3735927486;
      }
    }
    fe(t) {
      this.p != t && (t.b(this), (this.p = t));
    }
  };
  const er = class {
    constructor(t, e) {
      (this.i = t),
        (this.h = e),
        (this.l = !1),
        (this.m = !1),
        (this.n = t.getExtension("OES_vertex_array_object")),
        (this.g =
          t.getExtension("EXT_texture_filter_anisotropic") ||
          t.getExtension("MOZ_EXT_texture_filter_anisotropic") ||
          t.getExtension("WEBKIT_EXT_texture_filter_anisotropic")),
        this.g
          ? ((this.j = t.getParameter(this.g.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),
            WH.debug("Texture anisotropy enabled", this.j))
          : WH.debug("Texture anisotropy disabled (not supported)"),
        (this.l = t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS) > 0),
        (this.o = t.getExtension("OES_texture_float")),
        (this.m = this.l && null != this.o),
        this.m
          ? WH.debug("(float texture) Skinning in shader is supported")
          : WH.debug("(float texture) Skinning in shader is (not supported) "),
        (this.fe = new Js(this, e)),
        (this.k = new tr(t));
    }
    ba() {
      return this.i;
    }
    dc() {
      return this.n;
    }
    c() {
      return this.fe;
    }
    b(t) {
      const e = this.k,
        i = this.ba();
      e.f(t.c), e.fe(t.g), i.drawElements(t.h, t.e, i.UNSIGNED_SHORT, t.f);
    }
    d() {
      this.k.ba();
    }
    e() {
      this.k.f(null);
    }
    a(t) {
      this.d(),
        t.forEach((t) => {
          this.b(t);
        }),
        this.e();
    }
  };
  const ir = class {
      constructor(t, e) {
        (this.f = t),
          (this.j = e),
          (this.e = null),
          (this.c = !1),
          (this.g = 0),
          (this.i = 0),
          0 != e &&
            ((this.b =
              t.options.contentPath +
              "textures/" +
              e +
              WH.WebP.getImageExtension()),
            (this.a = new Image()),
            (this.a.onload = () => {
              this.h();
            }),
            (this.a.onerror = () => {
              this.a = null;
            }),
            this.d(this.a, this.b));
      }
      d(t, e) {
        var i = new XMLHttpRequest();
        i.open("GET", e, !0),
          (i.responseType = "arraybuffer"),
          (i.onload = (e) => {
            var s = new Blob([i.response]);
            t.src = window.URL.createObjectURL(s);
          }),
          i.addEventListener("progress", (t) => {
            const i = this.f;
            i &&
              t.lengthComputable &&
              (i.downloads[e]
                ? (i.downloads[e].loaded = t.loaded)
                : (i.downloads[e] = { loaded: t.loaded, total: t.total }),
              i.updateProgress());
          }),
          i.addEventListener("load", () => {
            const t = this.f;
            t && (delete t.downloads[e], t.updateProgress());
          }),
          i.send();
      }
      k() {
        return this.c;
      }
      l() {
        this.e = null;
      }
      h() {
        (this.g = this.a.width),
          (this.i = this.a.height),
          (this.e = this.f.renderer.k(this.a)),
          (this.c = !0),
          (this.a = null);
      }
    },
    sr = { 147259: !0 },
    rr = [
      1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0,
      0, 1, 0, 1, 0, 0, 0, 2, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1,
    ],
    nr = {
      2: { GeosetType: 15, Original: 2, Override: 11 },
      3: { GeosetType: 15, Original: 3, Override: 12 },
      4: { GeosetType: 15, Original: 4, Override: 13 },
      5: { GeosetType: 15, Original: 5, Override: 14 },
      6: { GeosetType: 15, Original: 6, Override: 15 },
      7: { GeosetType: 15, Original: 7, Override: 16 },
      8: { GeosetType: 15, Original: 8, Override: 17 },
      9: { GeosetType: 15, Original: 9, Override: 18 },
      10: { GeosetType: 15, Original: 10, Override: 19 },
      11: { GeosetType: 12, Original: 2, Override: 0 },
      12: { GeosetType: 12, Original: 3, Override: 0 },
      13: { GeosetType: 12, Original: 1, Override: 5 },
      14: { GeosetType: 12, Original: 2, Override: 3 },
      15: { GeosetType: 12, Original: 2, Override: 2 },
      16: { GeosetType: 22, Original: 2, Override: 1 },
      17: { GeosetType: 22, Original: 1, Override: 2 },
      18: { GeosetType: 22, Original: 1, Override: 3 },
      19: { GeosetType: 22, Original: 2, Override: 3 },
      20: { GeosetType: 12, Original: 1, Override: 1 },
      21: { GeosetType: 12, Original: 1, Override: 9 },
      22: { GeosetType: 12, Original: 2, Override: 10 },
      23: { GeosetType: 12, Original: 2, Override: 6 },
      24: { GeosetType: 12, Original: 1, Override: 5 },
      25: { GeosetType: 27, Original: 0, Override: 1 },
      26: { GeosetType: 27, Original: 0, Override: 1 },
      27: { GeosetType: 27, Original: 0, Override: 1 },
      28: { GeosetType: 13, Original: 1, Override: 0 },
      31: { GeosetType: 12, Original: 1, Override: 13 },
      32: { GeosetType: 12, Original: 2, Override: 14 },
      33: { GeosetType: 42, Original: 11, Override: 1 },
      38: { GeosetType: 20, Original: 1, Override: 9 },
    },
    ar = {
      ITEM: 1,
      HELM: 2,
      SHOULDER: 4,
      NPC: 8,
      CHARACTER: 16,
      HUMANOIDNPC: 32,
      OBJECT: 64,
      ARMOR: 128,
      PATH: 256,
      ITEMVISUAL: 512,
      COLLECTION: 1024,
    },
    or = [
      0, 1, 0, 3, 4, 5, 6, 7, 8, 9, 10, 0, 0, 21, 22, 22, 16, 21, 0, 19, 5, 21,
      22, 22, 0, 21, 21, 27,
    ],
    hr = [
      0, 16, 0, 15, 1, 7, 10, 5, 6, 6, 8, 0, 0, 17, 18, 19, 14, 20, 0, 9, 7, 21,
      22, 23, 0, 24, 25, 0,
    ],
    lr = [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 22, 0, 0, 0, 22, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0,
    ],
    ur = [
      0, 2, 0, 4, 128, 128, 128, 128, 128, 128, 128, 0, 0, 1, 1, 1, 128, 1, 0,
      128, 128, 1, 1, 1, 0, 1, 1, 2,
    ],
    cr = [13, 14, 15, 16, 17, 88, 89],
    dr = [8, 9, 10, 11, 12, 86, 87],
    fr = {
      86: [4, 0, 4, 1, 4, 0, 4, 1],
      85: [84, 0, 84, 1, 84, 0, 84, 1],
      84: [3, 0, 3, 1, 3, 0, 3, 1],
      77: [5, 1, 0, -1, 5, 0, 0, -1],
      76: [10, 0, 1, 1, 10, 0, 1, 1],
      75: [10, 0, 1, 1, 10, 0, 1, 1],
      74: [5, 1, 0, -1, 5, 0, 0, -1],
      73: [5, 1, 0, -1, 5, 0, 0, -1],
      72: [5, 1, 0, -1, 5, 0, 0, -1],
      71: [5, 1, 0, -1, 5, 0, 0, -1],
      37: [7, 0, 7, 1, 7, 0, 7, 1],
      36: [2, 0, 2, 1, 2, 0, 2, 1],
      34: [3, 0, 3, 1, 3, 0, 3, 1],
      33: [5, 1, 0, -1, 5, 0, 0, -1],
      31: [0, -1, 8, 1, 0, -1, 8, 1],
      30: [11, 0, 11, 1, 11, 0, 11, 1],
      29: [10, 0, 10, 1, 10, 0, 10, 1],
      28: [6, 0, 6, 1, 6, 0, 6, 1],
      27: [4, 0, 4, 1, 4, 0, 4, 1],
      26: [24, 0, 24, 1, 24, 0, 24, 1],
      25: [24, 0, 24, 1, 24, 0, 24, 1],
      23: [1, 0, 1, 1, 1, 0, 1, 1],
      15: [5, 0, 5, 1, 5, 0, 5, 1],
      1: [0, -1, 0, -1, 0, -1, 0, 3],
    },
    gr = {
      21: 26,
      22: 27,
      15: 28,
      17: 26,
      25: 32,
      13: 32,
      23: 33,
      14: 28,
      26: 26,
    },
    br = {
      0: { 21: 26, 22: 27 },
      1: { 21: 26, 22: 27 },
      2: { 21: 30, 22: 31 },
      3: { 21: 32, 22: 33 },
      4: { 21: 26, 22: 27, 15: 28 },
      5: { 21: 26 },
      6: { 21: 26, 22: 27 },
      7: { 21: 26, 22: 27 },
      8: { 21: 26, 22: 27 },
      9: { 21: 33, 22: 28 },
    },
    _r = 5300,
    pr =
      "precision mediump float;\r\n\r\nuniform float x;\r\nuniform float y;\r\nuniform float width;\r\nuniform float height;\r\n\r\nattribute vec2 aTextCoord;\r\nvarying vec2 vTextCoords;\r\nvoid main() {\r\n    vTextCoords = aTextCoord;\r\n\r\n    vec2 pos = vec2(\r\n        (x + aTextCoord.x*width)* 2.0 - 1.0,\r\n        (y + aTextCoord.y*height)* 2.0 - 1.0\r\n    );\r\n\r\n    gl_Position = vec4(pos.x, pos.y, 0, 1);\r\n}";
  class mr {
    constructor() {
      (this.b = null), (this.a = null), (this.e = null);
    }
    c() {
      null != this.b && this.b.l(),
        null != this.a && this.a.l(),
        null != this.e && this.e.l();
    }
    d() {
      return (
        !(this.b && !this.b.k()) &&
        !(this.a && !this.a.k()) &&
        !(this.e && !this.e.k())
      );
    }
  }
  class xr {
    constructor() {
      (this.h = null),
        (this.e = null),
        (this.f = null),
        (this.d = {}),
        (this.c = new li()),
        (this.a = null),
        (this.g = null);
    }
  }
  const vr = {
    uDiffuseTexture: null,
    uSpecularTexture: null,
    uEmissiveTexture: null,
  };
  class Tr {
    constructor(t, e, i) {
      (this.h = e),
        (this.o = i),
        (this.l = null),
        (this.p = null),
        (this.m = null),
        (this.e = null),
        (this.d = null),
        (this.n = !1),
        (this.g = t),
        (this.d = (function (t) {
          let e = t.createTexture();
          t.bindTexture(t.TEXTURE_2D, e),
            t.texImage2D(
              t.TEXTURE_2D,
              0,
              t.RGBA,
              1,
              1,
              0,
              t.RGBA,
              t.UNSIGNED_BYTE,
              new Uint8Array([0, 0, 0, 0])
            ),
            t.bindTexture(t.TEXTURE_2D, null);
          let i = t.createTexture();
          t.bindTexture(t.TEXTURE_2D, i),
            t.texImage2D(
              t.TEXTURE_2D,
              0,
              t.RGBA,
              1,
              1,
              0,
              t.RGBA,
              t.UNSIGNED_BYTE,
              new Uint8Array([0, 0, 0, 255])
            ),
            t.bindTexture(t.TEXTURE_2D, null);
          let s = new xr();
          return (
            (s.a = e),
            (s.g = i),
            (s.h = $e(
              t,
              [
                pr,
                "precision mediump float;\r\n\r\nvarying vec2 vTextCoords;\r\nuniform sampler2D uDiffuseTexture;\r\nuniform sampler2D uSpecularTexture;\r\nuniform sampler2D uEmissiveTexture;\r\nuniform sampler2D renderResultTexture;\r\nuniform int uBlendMode;\r\nuniform vec2 screenResolution;\r\nuniform int layer;\r\n\r\nuniform float diffuseTexWidth;\r\nuniform float diffuseTexHeight;\r\n\r\nfloat overlayBlend(float a, float b) {\r\n    if (b > 0.5) {\r\n        return (1.0 - (1.0 - 2.0 * (a - 0.5)) * (1.0 - b));\r\n    } else {\r\n        return ((2.0 * a) * b);\r\n    }\r\n}\r\n\r\nfloat alphaStraightBlend(float a, float b, float alpha) {\r\n    return (a * alpha) + (b * (1.0 - alpha));\r\n}\r\n\r\nvoid main() {\r\n    vec2 l_texCoord = vTextCoords.xy;\r\n\r\n\r\n    l_texCoord.x = max(min(l_texCoord.x, (diffuseTexWidth-0.5)/diffuseTexWidth), 0.5/diffuseTexWidth);\r\n    l_texCoord.y = max(min(l_texCoord.y, (diffuseTexHeight-0.5)/diffuseTexHeight), 0.5/diffuseTexHeight);\r\n\r\n    vec4 diffuse = texture2D( uDiffuseTexture, l_texCoord );\r\n    vec4 backGround = texture2D( renderResultTexture, gl_FragCoord.xy / screenResolution );\r\n\r\n    if (uBlendMode == 1) {\r\n        // Blit (we do nothing?)\r\n        //if (diffuse.a < 0.001) discard;\r\n\r\n        //vec4 finalColor = diffuse;\r\n\r\n        //diffuse = vec4(finalColor.rgb, finalColor.a);\r\n    } else if (uBlendMode == 2) {\r\n        // Multiply\r\n        if (diffuse.a < 0.001) discard;\r\n\r\n        vec4 multTexture = diffuse;\r\n        vec3 finalColor = (backGround.rgb * multTexture.rgb);\r\n\r\n        diffuse = vec4(finalColor.rgb, 1.0);\r\n    } else if (uBlendMode == 3) {\r\n        // Overlay\r\n        if (diffuse.a < 0.001) discard;\r\n\r\n        vec4 overlayTex = diffuse;\r\n\r\n        vec3 finalColor = vec3(\r\n            overlayBlend(overlayTex.r, backGround.r),\r\n            overlayBlend(overlayTex.g, backGround.g),\r\n            overlayBlend(overlayTex.b, backGround.b)\r\n        );\r\n\r\n        vec3 mainTexVisible = backGround.rgb * (1.0 - overlayTex.a);\r\n        vec3 overlayTexVisible = finalColor.rgb * (overlayTex.a);\r\n        finalColor = (mainTexVisible + overlayTexVisible);\r\n\r\n        diffuse = vec4(finalColor, backGround.a);\r\n    } else if (uBlendMode == 5) {\r\n        // AlphaStraight\r\n        vec4 overlayTex = diffuse;\r\n\r\n        //float alphaMult = 1.0;\r\n        //vec3 finalColor = vec3(\r\n        //    alphaStraightBlend(overlayTex.r, backGround.r, alphaMult*overlayTex.a),\r\n        //    alphaStraightBlend(overlayTex.g, backGround.g, alphaMult*overlayTex.a),\r\n        //    alphaStraightBlend(overlayTex.b, backGround.b, alphaMult*overlayTex.a)\r\n        //);\r\n        vec3 finalColor = overlayTex.rgb * overlayTex.a + backGround.rgb * (1.0 - overlayTex.a);\r\n\r\n        diffuse = vec4(finalColor.rgb, 1.0);\r\n    } else if (uBlendMode == 0 || uBlendMode == 4 || uBlendMode == 6 || uBlendMode == 7) {\r\n        // default, Screen, InferAlphaBlend, Unknown1\r\n        if (diffuse.a < 0.001) discard;\r\n\r\n        vec3 finalColor = mix(backGround.rgb, diffuse.rgb, diffuse.a);\r\n\r\n        diffuse = vec4(finalColor.rgb, 1.0);\r\n    }\r\n\r\n    gl_FragColor = diffuse;\r\n}",
              ],
              null,
              null
            )),
            (s.e = $e(
              t,
              [
                pr,
                "precision mediump float;\r\n\r\nvarying vec2 vTextCoords;\r\nuniform sampler2D uDiffuseTexture;\r\nuniform sampler2D uSpecularTexture;\r\nuniform sampler2D uEmissiveTexture;\r\nuniform sampler2D renderResultTexture;\r\nuniform int uBlendMode;\r\n\r\nvoid main() {\r\n    vec4 diffuse = texture2D( uDiffuseTexture, vTextCoords.xy );\r\n    vec4 specular = texture2D( uSpecularTexture, vTextCoords.xy );\r\n    if (diffuse.a < 0.001) discard;\r\n    gl_FragColor = vec4(specular.rgb, 1.0);\r\n}",
              ],
              null,
              null
            )),
            (s.f = $e(
              t,
              [
                pr,
                "precision mediump float;\r\n\r\nvarying vec2 vTextCoords;\r\nuniform sampler2D uDiffuseTexture;\r\nuniform sampler2D uSpecularTexture;\r\nuniform sampler2D uEmissiveTexture;\r\nuniform sampler2D renderResultTexture;\r\nuniform int uBlendMode;\r\nuniform vec2 screenResolution;\r\nuniform float emissiveAlphaOverride;\r\nuniform int layer;\r\n\r\nvoid main() {\r\n    vec4 diffuse = texture2D( uDiffuseTexture, vTextCoords.xy );\r\n    vec4 emissive = texture2D( uEmissiveTexture, vTextCoords.xy );\r\n    vec4 backGround = texture2D( renderResultTexture, gl_FragCoord.xy / screenResolution );\r\n\r\n    if (diffuse.a < 0.001) discard;\r\n//    if (emissive.a < 0.001) discard;\r\n\r\n    //TODO: This is a hack from what was observed in Nightborne texture customization with tatoos.\r\n    //TODO: But Maybe switch should be over layer or something else instead of blend\r\n    float alpha = 1.0;\r\n\r\n    if (emissiveAlphaOverride > -1.0) {\r\n        alpha = emissiveAlphaOverride;\r\n    } else if (layer <= 1) {\r\n        alpha = 0.0;\r\n    } else {\r\n        alpha = emissive.a;\r\n    }\r\n\r\n    gl_FragColor = vec4(emissive.rgb, alpha);\r\n}",
              ],
              null,
              null
            )),
            (s.d = {}),
            (s.k = t.createBuffer()),
            t.bindBuffer(t.ARRAY_BUFFER, s.k),
            t.bufferData(
              t.ARRAY_BUFFER,
              new Float32Array([0, 0, 1, 0, 0, 1, 1, 1]),
              t.STATIC_DRAW
            ),
            t.bindBuffer(t.ARRAY_BUFFER, null),
            (s.j = t.createBuffer()),
            t.bindBuffer(t.ELEMENT_ARRAY_BUFFER, s.j),
            t.bufferData(
              t.ELEMENT_ARRAY_BUFFER,
              new Int16Array([0, 1, 2, 1, 3, 2]),
              t.STATIC_DRAW
            ),
            t.bindBuffer(t.ELEMENT_ARRAY_BUFFER, null),
            (s.b = t.createFramebuffer()),
            (s.i = {
              loc: t.getAttribLocation(s.h.program, "aTextCoord"),
              type: t.FLOAT,
              size: 2,
              offset: 0,
              stride: 0,
            }),
            s
          );
        })(t));
    }
    c() {
      let t = this.g;
      this.e ||
        ((this.e = t.createTexture()),
        t.bindTexture(t.TEXTURE_2D, this.e),
        t.texImage2D(
          t.TEXTURE_2D,
          0,
          t.RGBA,
          this.h,
          this.o,
          0,
          t.RGBA,
          t.UNSIGNED_BYTE,
          null
        ),
        t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, t.LINEAR)),
        this.l ||
          ((this.l = t.createTexture()),
          t.bindTexture(t.TEXTURE_2D, this.l),
          t.texImage2D(
            t.TEXTURE_2D,
            0,
            t.RGBA,
            this.h,
            this.o,
            0,
            t.RGBA,
            t.UNSIGNED_BYTE,
            null
          ),
          t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, t.LINEAR)),
        this.p ||
          ((this.p = t.createTexture()),
          t.bindTexture(t.TEXTURE_2D, this.p),
          t.texImage2D(
            t.TEXTURE_2D,
            0,
            t.RGBA,
            this.h,
            this.o,
            0,
            t.RGBA,
            t.UNSIGNED_BYTE,
            null
          ),
          t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, t.LINEAR)),
        this.m ||
          ((this.m = t.createTexture()),
          t.bindTexture(t.TEXTURE_2D, this.m),
          t.texImage2D(
            t.TEXTURE_2D,
            0,
            t.RGBA,
            this.h,
            this.o,
            0,
            t.RGBA,
            t.UNSIGNED_BYTE,
            null
          ),
          t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, t.LINEAR),
          t.bindTexture(t.TEXTURE_2D, null)),
        t.bindFramebuffer(t.FRAMEBUFFER, this.d.b),
        t.framebufferTexture2D(
          t.FRAMEBUFFER,
          t.COLOR_ATTACHMENT0,
          t.TEXTURE_2D,
          this.l,
          0
        ),
        t.clear(t.COLOR_BUFFER_BIT | t.DEPTH_BUFFER_BIT),
        t.framebufferTexture2D(
          t.FRAMEBUFFER,
          t.COLOR_ATTACHMENT0,
          t.TEXTURE_2D,
          this.p,
          0
        ),
        t.clear(t.COLOR_BUFFER_BIT | t.DEPTH_BUFFER_BIT),
        t.framebufferTexture2D(
          t.FRAMEBUFFER,
          t.COLOR_ATTACHMENT0,
          t.TEXTURE_2D,
          this.m,
          0
        ),
        t.clear(t.COLOR_BUFFER_BIT | t.DEPTH_BUFFER_BIT),
        t.useProgram(this.d.e.program),
        t.bindBuffer(t.ARRAY_BUFFER, this.d.k),
        t.bindBuffer(t.ELEMENT_ARRAY_BUFFER, this.d.j),
        this.d.c.disableAll(),
        this.d.c.enable(t, [this.d.i]),
        t.viewport(0, 0, this.h, this.o);
    }
    i(t, e, i, s, r, n, a, o) {
      let h = this.g;
      (this.d.d.x = e),
        (this.d.d.y = i),
        (this.d.d.width = s),
        (this.d.d.height = r),
        (this.d.d.diffuseTexWidth = t.b.g),
        (this.d.d.diffuseTexHeight = t.b.i),
        (null == t.a && null == t.e) || (this.n = !0);
      let l = 0;
      1 == n
        ? (l = 1)
        : 4 == n
        ? (l = 2)
        : 6 == n
        ? (l = 3)
        : 7 == n
        ? (l = 4)
        : 9 == n
        ? (l = 5)
        : 15 == n
        ? (l = 6)
        : 16 == n && (l = 7),
        (this.d.d.uBlendMode = l),
        (this.d.d.screenResolution = new Float32Array([this.h, this.o])),
        (this.d.d.uDiffuseTexture = null != t.b ? t.b.e : this.d.a),
        (this.d.d.uSpecularTexture = null != t.a ? t.a.e : this.d.a),
        (this.d.d.uEmissiveTexture = null != t.e ? t.e.e : this.d.g),
        (this.d.d.renderResultTexture = null != this.e ? this.e : this.d.a),
        (this.d.d.layer = a),
        (this.d.d.emissiveAlphaOverride = o),
        h.disable(h.CULL_FACE),
        h.disable(h.DEPTH_TEST),
        h.disable(h.BLEND),
        h.useProgram(this.d.h.program),
        h.framebufferTexture2D(
          h.FRAMEBUFFER,
          h.COLOR_ATTACHMENT0,
          h.TEXTURE_2D,
          this.l,
          0
        ),
        h.bindTexture(h.TEXTURE_2D, this.e),
        h.copyTexImage2D(h.TEXTURE_2D, 0, h.RGBA, 0, 0, this.h, this.o, 0),
        h.bindTexture(h.TEXTURE_2D, null),
        Ke(this.d.h, this.d.d),
        h.drawElements(h.TRIANGLES, 6, h.UNSIGNED_SHORT, 0),
        Ke(this.d.h, vr),
        h.useProgram(this.d.e.program),
        h.framebufferTexture2D(
          h.FRAMEBUFFER,
          h.COLOR_ATTACHMENT0,
          h.TEXTURE_2D,
          this.p,
          0
        ),
        h.bindTexture(h.TEXTURE_2D, this.e),
        h.copyTexImage2D(h.TEXTURE_2D, 0, h.RGBA, 0, 0, this.h, this.o, 0),
        h.bindTexture(h.TEXTURE_2D, null),
        Ke(this.d.e, this.d.d),
        h.drawElements(h.TRIANGLES, 6, h.UNSIGNED_SHORT, 0),
        Ke(this.d.e, vr),
        h.useProgram(this.d.f.program),
        h.framebufferTexture2D(
          h.FRAMEBUFFER,
          h.COLOR_ATTACHMENT0,
          h.TEXTURE_2D,
          this.m,
          0
        ),
        h.bindTexture(h.TEXTURE_2D, this.e),
        h.copyTexImage2D(h.TEXTURE_2D, 0, h.RGBA, 0, 0, this.h, this.o, 0),
        h.bindTexture(h.TEXTURE_2D, null),
        Ke(this.d.f, this.d.d),
        h.drawElements(h.TRIANGLES, 6, h.UNSIGNED_SHORT, 0),
        Ke(this.d.f, vr),
        h.useProgram(null);
    }
    a() {
      let t = this.g;
      t.bindFramebuffer(t.FRAMEBUFFER, null),
        t.bindTexture(t.TEXTURE_2D, null),
        t.enable(t.CULL_FACE),
        t.enable(t.DEPTH_TEST);
    }
    b(t) {
      if (0 == t) return this.l;
      if (1 == t) return this.p;
      if (2 == t) return this.m;
      throw new Error("unknown usage " + t);
    }
    f(t) {
      let e = null;
      return (e = { e: t, g: this.h, i: this.o, c: !0 }), e;
    }
    k() {
      let t = this.g;
      this.e && t.deleteTexture(this.e),
        this.l && t.deleteTexture(this.l),
        this.p && t.deleteTexture(this.p),
        this.m && t.deleteTexture(this.m),
        (this.l = null),
        (this.p = null),
        (this.m = null),
        (this.e = null),
        (this.d = null),
        (this.g = null);
    }
    j(t) {
      switch (t) {
        case 0:
          return this.f(this.l);
        case 1:
          return this.f(this.p);
        case 2:
          return this.f(this.m);
        default:
          return null;
      }
    }
  }
  function wr() {
    var t = new fi(2);
    return fi != Float32Array && ((t[0] = 0), (t[1] = 0)), t;
  }
  function yr(t, e) {
    var i = new fi(2);
    return (i[0] = t), (i[1] = e), i;
  }
  function Ar(t, e, i) {
    return (t[0] = e), (t[1] = i), t;
  }
  function Er(t, e, i) {
    return (t[0] = e[0] * i[0]), (t[1] = e[1] * i[1]), t;
  }
  function Mr(t, e, i) {
    return (t[0] = e[0] * i), (t[1] = e[1] * i), t;
  }
  !(function () {
    var t = wr();
  })();
  function Cr() {
    var t = new fi(9);
    return (
      fi != Float32Array &&
        ((t[1] = 0),
        (t[2] = 0),
        (t[3] = 0),
        (t[5] = 0),
        (t[6] = 0),
        (t[7] = 0)),
      (t[0] = 1),
      (t[4] = 1),
      (t[8] = 1),
      t
    );
  }
  function Sr(t, e) {
    return (
      (t[0] = e[0]),
      (t[1] = e[1]),
      (t[2] = e[2]),
      (t[3] = e[4]),
      (t[4] = e[5]),
      (t[5] = e[6]),
      (t[6] = e[8]),
      (t[7] = e[9]),
      (t[8] = e[10]),
      t
    );
  }
  function Fr(t, e, i) {
    var s = e[0],
      r = e[1],
      n = e[2],
      a = e[3],
      o = e[4],
      h = e[5],
      l = e[6],
      u = e[7],
      c = e[8],
      d = i[0],
      f = i[1],
      g = i[2],
      b = i[3],
      _ = i[4],
      p = i[5],
      m = i[6],
      x = i[7],
      v = i[8];
    return (
      (t[0] = d * s + f * a + g * l),
      (t[1] = d * r + f * o + g * u),
      (t[2] = d * n + f * h + g * c),
      (t[3] = b * s + _ * a + p * l),
      (t[4] = b * r + _ * o + p * u),
      (t[5] = b * n + _ * h + p * c),
      (t[6] = m * s + x * a + v * l),
      (t[7] = m * r + x * o + v * u),
      (t[8] = m * n + x * h + v * c),
      t
    );
  }
  function Ir() {
    var t = new fi(4);
    return (
      fi != Float32Array && ((t[0] = 0), (t[1] = 0), (t[2] = 0)), (t[3] = 1), t
    );
  }
  function kr(t, e, i) {
    i *= 0.5;
    var s = Math.sin(i);
    return (
      (t[0] = s * e[0]),
      (t[1] = s * e[1]),
      (t[2] = s * e[2]),
      (t[3] = Math.cos(i)),
      t
    );
  }
  function Dr(t, e, i, s) {
    var r,
      n,
      a,
      o,
      h,
      l = e[0],
      u = e[1],
      c = e[2],
      d = e[3],
      f = i[0],
      g = i[1],
      b = i[2],
      _ = i[3];
    return (
      (n = l * f + u * g + c * b + d * _) < 0 &&
        ((n = -n), (f = -f), (g = -g), (b = -b), (_ = -_)),
      1 - n > di
        ? ((r = Math.acos(n)),
          (a = Math.sin(r)),
          (o = Math.sin((1 - s) * r) / a),
          (h = Math.sin(s * r) / a))
        : ((o = 1 - s), (h = s)),
      (t[0] = o * l + h * f),
      (t[1] = o * u + h * g),
      (t[2] = o * c + h * b),
      (t[3] = o * d + h * _),
      t
    );
  }
  var Rr,
    Ur,
    Or,
    Br,
    Pr,
    zr,
    Nr = Ms,
    Gr = Cs,
    Lr = Ds;
  (Rr = gi()),
    (Ur = _i(1, 0, 0)),
    (Or = _i(0, 1, 0)),
    (Br = Ir()),
    (Pr = Ir()),
    (zr = Cr());
  class jr {
    constructor() {
      (this.a = -1),
        (this.e = null),
        (this.b = 0),
        (this.d = -1),
        (this.c = !1);
    }
  }
  class Yr {
    constructor() {
      (this.c = new jr()),
        (this.e = new jr()),
        (this.d = new jr()),
        (this.b = 0),
        (this.f = 1),
        (this.a = !1);
    }
  }
  class Hr {
    j() {
      var t = this;
      if (t.k) for (var e = 0; e < t.k.length; ++e) t.k[e] = null;
      return (t.e = null), (t.k = null), null;
    }
    i(t, e, i, s) {
      let r = this;
      if (
        (null == s && (s = this.c()),
        this.d >= 0 && (t = this.d < e.length ? e[this.d] : e[0]),
        0 != r.a || r.k.length > 1)
      ) {
        if (r.e.length > 1) {
          var n = r.e[r.e.length - 1];
          n > 0 && t > n && this.d < 0 && (t %= n);
          for (var a = -1, o = r.e.length, h = 0; h < o; ++h)
            if (t >= r.e[h] && t <= r.e[h + 1]) {
              a = h;
              break;
            }
          -1 == a && (a = r.e.length - 1);
          var l = r.e[a],
            u = r.e[a + 1],
            c = 0;
          return (
            l != u && (c = (t - l) / (u - l)),
            1 == r.a ? r.h(r.k[a], r.k[a + 1], c, s) : (s = r.b(s, r.k[a]))
          );
        }
        return r.k.length > 0 ? (s = r.b(s, r.k[0])) : i;
      }
      return 0 == r.k.length ? s : (s = r.b(s, r.k[0]));
    }
    f(t) {
      var e,
        i = this;
      (i.a = t.getInt16()), (i.d = t.getInt16()), (i.l = t.getBool());
      var s = t.getInt32();
      for (i.e = new Array(s), e = 0; e < s; ++e) i.e[e] = t.getInt32();
      var r = t.getInt32();
      for (i.k = new Array(r), e = 0; e < r; ++e) i.k[e] = i.g(t);
    }
  }
  class qr extends Hr {
    constructor(t) {
      super();
      (this.ba = gi()), this.f(t);
    }
    c() {
      return gi();
    }
    h(t, e, i, s) {
      return ki(s, t, e, i);
    }
    b(t, e) {
      return pi(t, e), t;
    }
    g(t) {
      return mi(gi(), t.getFloat(), t.getFloat(), t.getFloat());
    }
  }
  class Vr extends Hr {
    constructor(t) {
      super();
      this.f(t), (this.ba = Ir());
    }
    c() {
      return Ir();
    }
    h(t, e, i, s) {
      return Dr(s, t, e, i);
    }
    b(t, e) {
      return Nr(t, e), t;
    }
    g(t) {
      return Gr(
        Ir(),
        -t.getFloat(),
        -t.getFloat(),
        -t.getFloat(),
        t.getFloat()
      );
    }
  }
  class Xr extends Hr {
    constructor(t) {
      super();
      this.f(t);
    }
    g(t) {
      return t.getUint16();
    }
    c() {
      return 0;
    }
    h(t, e, i, s) {
      return t + (e - t) * i;
    }
    b(t, e) {
      return e;
    }
  }
  class Kr extends Xr {
    g(t) {
      return t.getFloat();
    }
  }
  class Wr extends Xr {
    g(t) {
      return t.getUint8();
    }
  }
  class Zr {
    d() {
      for (var t = this, e = 0; e < t.g.length; ++e) t.g[e] = null;
      return (t.i = null), (t.g = null), (t.c = null), null;
    }
    f(t, e, i, s) {
      let r = this;
      i || (i = this.a());
      let n = s || r.g;
      if (r.g.length > 1 && r.i.length > 1) {
        var a = r.i[r.i.length - 1];
        a > 0 && t > a && (t %= a);
        for (var o = -1, h = r.i.length, l = 0; l < h - 1; ++l)
          if (t >= r.i[l] && t <= r.i[l + 1]) {
            o = l;
            break;
          }
        -1 == o && (o = r.i.length - 1);
        var u = r.i[o],
          c = r.i[o + 1],
          d = 0;
        return u != c && (d = (t - u) / (c - u)), r.b(n[o], n[o + 1], d, i);
      }
      return n.length > 0 ? (i = r.e(i, n[0])) : e;
    }
    h(t) {
      var e,
        i = this,
        s = t.getInt32();
      for (i.i = new Array(s), e = 0; e < s; ++e) i.i[e] = t.getInt16() / 32767;
      var r = t.getInt32();
      for (i.g = new Array(r), e = 0; e < r; ++e) i.g[e] = i.j(t);
    }
  }
  class Jr extends Zr {
    constructor(t) {
      super();
      (this.ba = wr()), this.h(t);
    }
    a() {
      return wr();
    }
    b(t, e, i, s) {
      return (
        (r = s),
        (a = e),
        (o = i),
        (h = (n = t)[0]),
        (l = n[1]),
        (r[0] = h + o * (a[0] - h)),
        (r[1] = l + o * (a[1] - l)),
        r
      );
      var r, n, a, o, h, l;
    }
    e(t, e) {
      var i, s;
      return (s = e), ((i = t)[0] = s[0]), (i[1] = s[1]), t;
    }
    j(t) {
      return Ar(wr(), t.getFloat(), t.getFloat());
    }
  }
  class $r extends Zr {
    constructor(t) {
      super();
      this.h(t);
    }
    a() {
      return gi();
    }
    b(t, e, i, s) {
      return ki(s, t, e, i);
    }
    e(t, e) {
      return pi(t, e), t;
    }
    j(t) {
      return mi(gi(), t.getFloat(), t.getFloat(), t.getFloat());
    }
  }
  class Qr extends Zr {
    constructor(t) {
      super();
      this.h(t);
    }
    a() {
      return 0;
    }
    b(t, e, i, s) {
      return t + (e - t) * i;
    }
    e(t, e) {
      return t;
    }
    j(t) {
      return t.getUint16();
    }
  }
  class tn {
    constructor(t, e) {
      this.b(t, e);
    }
    b(t, e) {
      var i = t.getInt32();
      this.d = new Array(i);
      for (let s = 0; s < i; ++s) this.d[s] = new e(t);
    }
    a(t) {
      return (
        !(!this.d || 0 == this.d.length) &&
        (t >= this.d.length && (t = 0), this.d[t].l)
      );
    }
    c(t, e, i, s) {
      if (!this.d || 0 == this.d.length) return i;
      let r = t.e.a;
      r >= this.d.length && (r = 0);
      let n = this.d[r].i(t.e.b, e, i, s);
      if (t.b > 0 && t.b < 1) {
        let r = this.d[0].c(),
          a = t.d.a;
        a >= this.d.length && (a = 0);
        let o = this.d[a].i(t.d.b, e, i, r);
        o || (o = r),
          (r = this.d[0].c()),
          (n = this.d[0].h(o, n, t.b, r)),
          s && this.d[0].b(s, r);
      }
      if (t.f > 0 && t.f <= 1 && t.c.a != t.e.a && -1 != t.c.a) {
        let r = this.d[0].c(),
          a = t.c.a;
        a >= this.d.length && (a = 0);
        let o = this.d[a].i(t.c.b, e, i, s);
        o || (o = r), (r = this.d[0].c()), (n = this.d[0].h(o, n, 1 - t.f, r));
      }
      return n;
    }
    e() {
      if (this.d && 0 != this.d.length) {
        for (var t = 0; t < this.d.length; ++t)
          this.d[t].j(), (this.d[t] = null);
        return null;
      }
    }
  }
  function en(t, e) {
    return Es(t[4 * e + 0], t[4 * e + 1], t[4 * e + 2], 0);
  }
  function sn(t, e, i) {
    for (let s = 0; s < 4; s++) t[4 * e + s] = i[s];
  }
  const rn = class {
    constructor(t, e, i) {
      (this.b = t),
        (this.l = i),
        (this.f = null),
        (this.A = null),
        (this.g = null),
        (this.a = Pi()),
        (this.n = Pi()),
        (this.s = Pi());
      const s = this;
      (s.r = e),
        (s.k = gi()),
        (s.c = Pi()),
        (s.m = Pi()),
        (s.w = Pi()),
        (s.x = gi()),
        (s.y = Ir()),
        (s.u = Pi()),
        (s.z = !1),
        (s.i = !1),
        (s.j = !1);
    }
    o() {
      var t = this;
      (t.k = null), (t.c = null), (t.x = null), (t.y = null), (t.u = null);
    }
    v() {
      this.z = !0;
      for (var t = 0; t < 16; ++t) this.c[t] = 0;
    }
    t(t) {
      t
        ? (null == this.f && (this.f = new Yr()), this.b.t(t, this.f))
        : (this.f = null);
      let e = this.b.A[this.r];
      for (let i = 0; i < e.length; i++) this.b.T[e[i]].t(t);
    }
    q(t) {
      t
        ? (null == this.A && (this.A = new Yr()), this.b.t(t, this.A))
        : (this.A = null);
      let e = this.b.A[this.r];
      for (let i = 0; i < e.length; i++) this.b.T[e[i]].q(t);
    }
    p(t) {
      const e = this.l;
      var i = this;
      if (i.z) return void i.v();
      if ((null != this.f && this.b.n(this.f, t), i.i || i.j)) return;
      if (((i.i = !0), !i.b)) return;
      Gi(i.c);
      var s = i.b.ah;
      if (!s) return;
      let r = this.n;
      if (
        (Gi(r),
        Yi(r, r, this.b.M.viewMatrix),
        Yi(r, r, this.b.aB),
        Yi(i.c, i.c, r),
        e.i > -1)
      ) {
        i.b.T[e.i].p(t);
        let s = this.s;
        if ((zi(s, i.b.T[e.i].c), Yi(s, r, s), 1 & e.c || 2 & e.c || 4 & e.c)) {
          if (4 & e.c && 2 & e.c)
            sn(s, 0, en(r, 0)), sn(s, 1, en(r, 1)), sn(s, 2, en(r, 2));
          else if (4 & e.c) {
            {
              let t = en(r, 0),
                e = ks(t);
              Is(t, t, ks(en(s, 0)) / e), sn(s, 0, t);
            }
            {
              let t = en(r, 1),
                e = ks(t);
              Is(t, t, ks(en(s, 1)) / e), sn(s, 1, t);
            }
            {
              let t = en(r, 2),
                e = ks(t);
              Is(t, t, ks(en(s, 2)) / e), sn(s, 2, t);
            }
          } else if (2 & e.c) {
            {
              let t = en(r, 0);
              Is(t, t, 1 / ks(en(s, 0))), Is(t, t, ks(en(r, 0))), sn(s, 0, t);
            }
            {
              let t = en(r, 1);
              Is(t, t, 1 / ks(en(s, 1))), Is(t, t, ks(en(r, 1))), sn(s, 1, t);
            }
            {
              let t = en(r, 2);
              Is(t, t, 1 / ks(en(s, 2))), Is(t, t, ks(en(r, 2))), sn(s, 2, t);
            }
          }
          if (1 & e.c) sn(s, 3, en(r, 3));
          else {
            let t = Es(e.h[0], e.h[1], e.h[2], 1),
              n = As();
            Ms(n, t), (n[3] = 0);
            let a = As(),
              o = As();
            Rs(a, t, i.b.T[i.l.i].c),
              Rs(a, a, r),
              Rs(o, n, s),
              Fs(a, a, o),
              (a[3] = 1),
              sn(s, 3, a);
          }
        }
        let n = this.a;
        ji(n, r), Yi(s, n, s), Yi(i.c, i.c, s);
      }
      let n = null;
      if (null != this.f) {
        let t = this.e(this.f);
        this.b.G || (this.h = t), this.b.Y || (n = this.b.G ? this.h : t);
      } else {
        let t = this.e(s);
        this.b.G || (this.h = t), this.b.Y || (n = this.b.G ? this.h : t);
      }
      let a = null;
      if (null != this.A) {
        let t = this.e(this.A);
        this.b.G || (this.d = t), (a = this.b.G ? this.d : t);
      }
      let o = null != n || null != a,
        h = Pi();
      o && (null != n && Yi(h, h, n), null != a && Yi(h, h, a)),
        null != this.g &&
          (Hi(h, h, this.l.h),
          Yi(h, h, this.g),
          Hi(h, h, Ci(this.x, this.l.h))),
        Yi(i.c, i.c, h);
      let l = 120 & e.c;
      if (l) {
        let t = Pi();
        zi(t, i.c);
        let e = i.c,
          s = gi();
        Zi(s, i.c);
        let r = As();
        if (16 == l) {
          let t = en(i.c, 0);
          Is(t, t, 1 / bi(t)), sn(i.c, 0, t);
          let s = Es(e[4], -e[0], 0, 0);
          sn(e, 1, Ds(s, s)), Ii(r, s, t), (r[3] = 0), sn(e, 2, r);
        } else if (l > 16) {
          if (32 == l) {
            let t = en(e, 1);
            Is(t, t, 1 / ks(t)), sn(i.c, 1, t);
            let s = Es(-e[5], e[1], 0, 0);
            sn(e, 0, Ds(s, s)), (r[3] = 0), sn(e, 2, r);
          } else if (64 == l) {
            let t = en(e, 2);
            Ds(t, t), sn(e, 2, t);
            let i = Es(t[1], -t[0], 0, 0);
            Ds(i, i), sn(e, 1, i), Ii(r, t, i), (r[3] = 0), sn(e, 0, r);
          }
        } else if (8 == l) {
          let t = this.b.isMirrored;
          if (o) {
            let i = en(h, 0);
            (i = Es(i[1], i[2], -i[0], 0)), Ds(i, i), sn(e, 0, i);
            let s = en(h, 1);
            (s = Es(t ? -s[1] : s[1], t ? -s[2] : s[2], t ? s[0] : -s[0], 0)),
              Ds(s, s),
              sn(e, 1, s);
            let r = en(h, 2);
            (r = Es(r[1], r[2], -r[0], 0)), Ds(r, r), sn(e, 2, r);
          } else {
            sn(e, 0, Es(0, 0, -1, 0)),
              sn(e, 1, Es(t ? -1 : 1, 0, 0, 0)),
              sn(e, 2, Es(0, 1, 0, 0));
          }
        }
        let n = Es(this.l.h[0], this.l.h[1], this.l.h[2], 1),
          a = Es(this.l.h[0], this.l.h[1], this.l.h[2], 0),
          u = en(e, 0),
          c = en(e, 1),
          d = en(e, 2);
        Is(u, u, s[0]),
          Is(c, c, s[1]),
          Is(d, d, s[2]),
          sn(e, 0, u),
          sn(e, 1, c),
          sn(e, 2, d),
          Rs(n, n, t),
          Rs(a, a, e);
        let f = As();
        Fs(f, n, a), (f[3] = 1), sn(e, 3, f);
      }
      ji(r, r),
        Yi(i.c, r, i.c),
        ji(i.m, i.c),
        Li(i.w, i.m),
        Di(i.k, i.l.h, i.c);
    }
    e(t) {
      const e = this.l;
      var i = e.d.a(t.e.a),
        s = e.e.a(t.e.a),
        r = e.g.a(t.e.a);
      if (0 != (640 & e.c)) {
        let y = Pi();
        return (
          Gi(y),
          Hi(y, y, this.l.h),
          i && ((this.x = e.d.c(t, this.b.q)), Hi(y, y, this.x)),
          s &&
            ((this.y = e.e.c(t, this.b.q, Ir())),
            (n = this.u),
            (a = this.y),
            (o = a[0]),
            (h = a[1]),
            (l = a[2]),
            (u = a[3]),
            (g = o * (c = o + o)),
            (b = h * c),
            (_ = h * (d = h + h)),
            (p = l * c),
            (m = l * d),
            (x = l * (f = l + l)),
            (v = u * c),
            (T = u * d),
            (w = u * f),
            (n[0] = 1 - _ - x),
            (n[1] = b + w),
            (n[2] = p - T),
            (n[3] = 0),
            (n[4] = b - w),
            (n[5] = 1 - g - x),
            (n[6] = m + v),
            (n[7] = 0),
            (n[8] = p + T),
            (n[9] = m - v),
            (n[10] = 1 - g - _),
            (n[11] = 0),
            (n[12] = 0),
            (n[13] = 0),
            (n[14] = 0),
            (n[15] = 1),
            Yi(y, y, this.u)),
          r && ((this.x = e.g.c(t, this.b.q)), qi(y, y, this.x)),
          Hi(y, y, Ci(this.x, this.l.h)),
          y
        );
      }
      var n, a, o, h, l, u, c, d, f, g, b, _, p, m, x, v, T, w;
      return null;
    }
  };
  const nn = class {
    constructor(t) {
      (this.d = t), (this.b = 267320826 ^ t);
      let e = new ArrayBuffer(4);
      this.f = new DataView(e);
    }
    c() {
      let t = this.b;
      return (t ^= t << 13), (t ^= t >> 17), (t ^= t << 5), (this.b = t), t;
    }
    e() {
      let t,
        e = this.c();
      return (
        this.f.setInt32(0, 1065353216 | (8388607 & e)),
        (t =
          2147483648 & e ? 2 - this.f.getFloat32(0) : this.f.getFloat32(0) - 2),
        t
      );
    }
    a() {
      let t = this.c();
      return (
        this.f.setInt32(0, 1065353216 | (8388607 & t)), this.f.getFloat32(0) - 1
      );
    }
  };
  const an = class {
    constructor() {
      (this.a = 0),
        (this.j = 0),
        (this.b = 0),
        (this.d = 0),
        (this.i = gi()),
        (this.c = 0),
        (this.h = 0),
        (this.e = 0),
        (this.g = 0),
        (this.f = 0);
    }
  };
  const on = class {
    constructor(t, e) {
      (this.a = t), (this.c = e), (this.b = new an());
    }
    f() {
      return this.b.d + this.a.e() * this.c.x;
    }
    e() {
      return this.b.d + this.c.x;
    }
    d() {
      return this.b.b + this.c.P;
    }
    h(t) {
      return this.b.b + 30518509e-12 * t * this.c.P;
    }
    g() {
      let t = this.b.a;
      return (t *= 1 + this.b.j * this.a.e()), t;
    }
    k() {
      return this.b;
    }
    i(t) {
      pi(t, this.b.i);
    }
  };
  const hn = class extends on {
    j(t, e) {
      let i,
        s = e * this.a.a(),
        r = this.a.e();
      (i = r < 1 ? (r > -1 ? Math.trunc(32767 * r + 0.5) : -32767) : 32767),
        (t.e = i);
      let n = this.h(i);
      n < 0.001 && (n = 0.001),
        (t.c = (function (t, e) {
          let i = Math.abs(t),
            s = Math.abs(e);
          return (
            Number((i - Math.floor(i / s) * s).toPrecision(8)) * Math.sign(t)
          );
        })(s, n)),
        (t.d = 65535 & this.a.c()),
        mi(t.b, this.a.e() * this.b.h * 0.5, this.a.e() * this.b.e * 0.5, 0);
      let a = this.g(),
        o = this.b.c;
      if (o < 0.001) {
        let e = this.b.g * this.a.e(),
          i = this.b.f * this.a.e(),
          s = Math.sin(e),
          r = Math.sin(i),
          n = Math.cos(e),
          o = Math.cos(i);
        mi(t.f, o * s * a, r * s * a, n * a);
      } else {
        let e = gi();
        pi(e, t.b),
          (e[2] = e[2] - o),
          bi(e) > 1e-4 && (Si(e, e), Ai(t.f, e, a));
      }
    }
  };
  const ln = class extends on {
    constructor(t, e, i) {
      super(t, e), (this.ba = i);
    }
    j(t, e) {
      let i,
        s = e * this.a.a(),
        r = this.a.e();
      (i = r < 1 ? (r > -1 ? Math.trunc(32767 * r + 0.5) : -32767) : 32767),
        (t.e = i);
      let n = this.h(i);
      n < 0.001 && (n = 0.001),
        (t.c = (function (t, e) {
          let i = Math.abs(t),
            s = Math.abs(e);
          return (
            Number((i - Math.floor(i / s) * s).toPrecision(8)) * Math.sign(t)
          );
        })(s, n)),
        (t.d = 65535 & this.a.c());
      let a = this.b.e - this.b.h,
        o = this.b.h + a * this.a.a(),
        h = this.b.g * this.a.e(),
        l = this.b.f * this.a.e(),
        u = Math.cos(h),
        c = _i(u * Math.cos(l), u * Math.sin(l), Math.sin(h));
      Ai(t.b, c, o);
      let d = this.g(),
        f = this.b.c,
        g = _i(0.5, 0.5, 0.5);
      0 == f
        ? this.ba
          ? mi(g, 0, 0, 1)
          : mi(g, u * Math.cos(l), u * Math.sin(l), Math.sin(h))
        : (mi(g, 0, 0, f), vi(g, t.b, g), bi(g) > 1e-4 && Si(g, g)),
        Ai(t.f, g, d);
    }
  };
  const un = class {
    constructor() {
      (this.b = gi()),
        (this.c = 0),
        (this.f = gi()),
        (this.e = 0),
        (this.d = (2147483647 * Math.random()) >> 0),
        (this.a = [wr(), wr()]),
        (this.g = [wr(), wr()]);
    }
  };
  const cn = class {
    constructor(t, e, i, s, r, n) {
      (this.b = t),
        (this.d = e),
        (this.f = i),
        (this.e = s),
        (this.a = r),
        (this.c = n);
    }
  };
  const dn = class {
    constructor(t, e, i) {
      (this.b = t), (this.c = e), (this.a = i);
    }
  };
  let fn = new Array(128);
  for (let t = 0; t < 128; t++) fn[t] = Math.random();
  const gn = Ni(0, 1, 0, 0, -1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1),
    bn = 1e3;
  class _n {}
  class pn {
    constructor() {
      (this.c = gi()),
        (this.b = 0),
        (this.a = { c: wr(), b: gi(), a: 0, d: 0, f: 1, e: 0 });
    }
  }
  function mn(t) {
    return Es(
      ((t >> 16) & 255) / 255,
      ((t >> 8) & 255) / 255,
      ((t >> 0) & 255) / 255,
      ((t >> 24) & 255) / 255
    );
  }
  const xn = [0, 0, 1, 2, 3, 4];
  const vn = class {
    constructor(t, e) {
      (this.c = t),
        (this.e = e),
        (this.X = null),
        (this.am = 0),
        (this.x = !0),
        (this.f = null),
        (this.C = new Date().getTime()),
        (this.Y = e),
        (this.G = Pi()),
        (this.ak = Pi()),
        (this.aq = Pi()),
        (this.H = Pi()),
        (this.an = As()),
        (this.ae = Cr()),
        (this.P = gi()),
        (this.as = 1),
        (this.F = gi()),
        (this.K = 0),
        (this.ab = gi()),
        (this.h = gi()),
        (this.aj = []),
        (this.av = gi()),
        (this.aa = 0),
        (this.V = 0),
        (this.M = 0),
        (this.t = 0),
        (this.B = gi()),
        (this.z = gi()),
        (this.I = 0),
        (this.j = 0),
        (this.J = 0),
        (this.T = 0),
        (this.D = 0),
        (this.d = 0),
        (this.at = 0),
        (this.al = []),
        (this.U = []);
      for (let t = 0; t < bn; t++)
        this.U.push(4 * t + 0),
          this.U.push(4 * t + 1),
          this.U.push(4 * t + 2),
          this.U.push(4 * t + 3),
          this.U.push(4 * t + 2),
          this.U.push(4 * t + 1);
      switch (
        ((this.S = new nn((2147483647 * Math.random()) >> 0)), this.Y.G)
      ) {
        case 1:
          this.E = new hn(this.S, e);
          break;
        case 2:
          this.E = new ln(this.S, e, 0 != (256 & this.Y.K));
          break;
        default:
          (this.E = null), WH.debug("Found unimplemented generator ", this.Y.G);
      }
      const i = this.Y.E - this.Y.c;
      0 != i
        ? ((this.V = (this.Y.b - this.Y.Z) / i),
          (this.M = this.Y.Z - this.Y.c * this.V))
        : ((this.V = 0), (this.M = 0));
      let s = this.Y.F;
      s <= 0 && (s = 1);
      let r = this.Y.N;
      r <= 0 && (r = 1), (this.j = s * r - 1), (this.J = 0);
      let n = s,
        a = -1;
      do {
        ++a, (n >>= 1);
      } while (n);
      if (
        ((this.T = a), (this.D = s - 1), (this.J = 0), (32768 & this.Y.K) > 0)
      ) {
        let t = (this.j + 1) * this.S.c();
        this.J = (t / 4294967296) | 0;
      }
      (this.d = 1 / s), (this.at = 1 / r);
      let o = !1;
      (269484032 & this.Y.K) > 0
        ? ((o = 0 != (1 & (this.Y.K >> 28))), (this.aa = o ? 2 : 3))
        : (this.aa = 0);
      let h = !1,
        l = !1;
      (268435456 & this.Y.K) > 0
        ? (l = (1073741824 & this.Y.K) > 0)
        : 0 == (1048576 & this.Y.K) && (h = 0 == (1 & this.Y.K)),
        2 == this.aa || (4 == this.aa && o)
          ? (this.ar = l ? 3 : 2)
          : 3 == this.aa
          ? (this.ar = 5)
          : (this.ar = h ? 1 : 0),
        (this.o = e.n > 1),
        (this.v = this.c.K.d(224e3)),
        (this.g = this.c.K.l(8e3)),
        (this.ao = this.c.K.e(this.v, this.g));
    }
    a() {
      var t = this;
      (t.Y.V = null),
        (t.Y.L = null),
        (t.Y.aa = null),
        (t.Y.u = t.Y.u.e()),
        (t.Y.q = t.Y.q.e()),
        (t.Y.S = t.Y.S.e()),
        (t.Y.m = t.Y.m.e()),
        (t.Y.v = t.Y.v.e()),
        (t.Y.A = t.Y.A.e()),
        (t.Y.f = t.Y.f.e()),
        (t.Y.J = t.Y.J.e()),
        (t.Y.e = t.Y.e.e()),
        (t.Y.C = t.Y.C.e()),
        (t.Y.O = t.Y.O.e()),
        (t.Y.y = t.Y.y.d()),
        (t.Y.l = t.Y.l.d()),
        (t.Y.r = t.Y.r.d()),
        (t.Y.T = t.Y.T.d()),
        (t.Y.p = t.Y.p.d()),
        (t.aj = null);
    }
    l(t) {
      const e = this.e;
      e.M >= 11 &&
        e.M <= 13 &&
        t &&
        ((this.s = [As(), As(), As()]),
        Ms(this.s[0], mn(t.Start[e.M - 11])),
        Ms(this.s[1], mn(t.Mid[e.M - 11])),
        Ms(this.s[2], mn(t.End[e.M - 11])));
    }
    O(t) {
      this.X = t;
    }
    m() {
      if (this.f) return;
      this.c.M.context;
      if (!this.N)
        if (((this.N = [null, null, null]), 0 != (268435456 & this.Y.K)))
          for (let t = 0; t < this.Y.j.length; t++) {
            const e = this.Y.j[t];
            e > -1 && e < this.c.I.length && (this.N[t] = this.c.I[e]);
          }
        else
          this.Y.H > -1 &&
            this.Y.H < this.c.I.length &&
            (this.N[0] = this.c.I[this.Y.H]);
      let t = !0;
      for (let e of this.N) t = t && (!e || (e.f && e.f.c));
      if (!t) return;
      const e = this.c.K;
      let i = this.Y.n;
      4 == i && (i = 3);
      let s = {};
      (s.uViewMatrix = this.c.M.viewMatrix),
        (s.uProjMatrix = this.c.M.projMatrix),
        (s.uBlendMode = this.Y.n),
        (s.uPixelShader = xn[this.ar]),
        (s.colorMult = this.X ? this.X.c : 1),
        (s.alphaMult = this.X ? this.X.a : 1);
      let r = [
        this.N[0] && this.N[0].f && this.N[0].f.c,
        this.N[1] && this.N[1].f && this.N[1].f.c,
        this.N[2] && this.N[2].f && this.N[2].f.c,
      ];
      (s.uTexture = this.N[0].f.e),
        (s.uTexture2 = r[1] ? this.N[1].f.e : null),
        (s.uTexture3 = r[2] ? this.N[2].f.e : null),
        (s.uHasTexture = r[0] ? 1 : 0),
        (s.uHasTexture2 = r[1] ? 1 : 0),
        (s.uHasTexture3 = r[2] ? 1 : 0);
      let n = -1;
      1 == i ? (n = 0.501960814) : i > 1 && (n = 1 / 255),
        (s.uAlphaTreshold = n);
      const a = e.c(
        this.c.p,
        new cn(!1, !this.c.z, i, !0, !1, 15),
        new cs(
          this.N.map((t) => t && t.f),
          s
        )
      );
      this.f = e.b(new dn(this.ao, 0, 0), a, 0, this.Y.D);
    }
    y(t, e) {
      if (!this.E) return;
      let i = Pi(),
        s = this.E.k(),
        r = !0;
      this.Y.O.a(t.e.a) && (r = this.Y.O.c(t, this.c.q) > 0), (this.A = r);
      const n = _i(0, 0, 0);
      r &&
        ((s.a = this.Y.u.c(t, this.c.q, 0)),
        (s.j = this.Y.q.c(t, this.c.q, 0)),
        (s.g = this.Y.S.c(t, this.c.q, 0)),
        (s.f = this.Y.m.c(t, this.c.q, 0)),
        this.Y.v.c(t, this.c.q, n, s.i),
        (s.b = this.Y.A.c(t, this.c.q, 0)),
        (s.d = this.Y.f.c(t, this.c.q, 0)),
        (s.e = this.Y.e.c(t, this.c.q, 0)),
        (s.h = this.Y.J.c(t, this.c.q, 0)),
        this.X ? (s.c = this.X.d) : (s.c = this.Y.C.c(t, this.c.q, 0))),
        Yi(i, i, this.c.aB),
        Yi(i, i, this.c.T[this.Y.g].c);
      let a = Pi();
      var o, h;
      (o = a),
        (h = _i(this.Y.V[0], this.Y.V[1], this.Y.V[2])),
        (o[0] = 1),
        (o[1] = 0),
        (o[2] = 0),
        (o[3] = 0),
        (o[4] = 0),
        (o[5] = 1),
        (o[6] = 0),
        (o[7] = 0),
        (o[8] = 0),
        (o[9] = 0),
        (o[10] = 1),
        (o[11] = 0),
        (o[12] = h[0]),
        (o[13] = h[1]),
        (o[14] = h[2]),
        (o[15] = 1),
        Yi(i, i, a),
        Yi(i, i, gn);
      let l = Pi(),
        u = gi();
      ji(l, this.c.M.viewMatrix),
        Wi(u, l),
        this.W(e, i, u, null, this.c.M.viewMatrix),
        this.b(this.c.M.viewMatrix),
        this.v.a(new Float32Array(this.al)),
        this.g.a(new Uint16Array(this.U)),
        this.f && ((this.f.e = (6 * this.am) >> 0), (this.f.f = 0));
    }
    ag(t) {
      if (this.aj.length <= 0) return;
      if ((this.f || this.m(), !this.f)) return;
      if (!t && this.f.g.a() > Qs.GxBlend_AlphaKey) return;
      this.c.K.j().b(this.f);
    }
    R(t, e) {
      if (0 == (16 & this.Y.K))
        for (let i = 0; i < this.aj.length; i++) {
          const s = this.aj[i];
          Di(s.b, s.b, t), Ri(s.f, s.f, e);
        }
    }
    W(t, e, i, s, r) {
      if (null == this.E) return;
      if (this.c.G) return;
      Wi(this.F, this.G);
      let n = As();
      Wi(n, e), (n[3] = 1), Rs(n, n, r), (this.K = n[2]);
      let a = gi();
      if ((Wi(a, r), this.i(e, a, s), t > 0)) {
        let e = gi();
        if ((Wi(e, this.G), 16384 & this.Y.K)) {
          vi(this.h, e, this.F);
          let i = this.V * (bi(this.h) / t) + this.M;
          i >= 0 && (i = Math.min(i, 1)), Ai(this.ab, this.h, i);
        }
        if (64 & this.Y.K) {
          this.t += t;
          let i = 0.03;
          if (this.t > i)
            if (((this.t = 0), 0 == this.aj.length)) {
              let t = i / this.t,
                s = gi();
              vi(s, e, this.F);
              let r = t * this.Y.s;
              Ti(this.B, s, _i(r, r, r));
            } else mi(this.B, 0, 0, 0);
        }
        this.u(t);
      }
    }
    i(t, e, i) {
      if ((pi(this.z, e), null == i || 16 & this.Y.K)) zi(this.G, t);
      else {
        let e = Pi();
        ji(e, i), Yi(this.G, e, t);
      }
      let s = gi();
      Zi(s, t), (this.as = s[0]);
    }
    u(t) {
      if ((t = Math.max(t, 0)) < 0.1) pi(this.ab, this.h);
      else {
        let e = Math.floor(t / 0.1);
        t = -0.1 * e + t;
        let i = Math.min(Math.floor(this.E.k().b / 0.1), e),
          s = i + 1,
          r = 1;
        (r = s < 0 ? ((1 & s) | (s >> 1)) + ((1 & s) | (s >> 1)) : s),
          Ai(this.ab, this.h, 1 / r);
        for (let t = 0; t < i; t++) this.L(0.1);
      }
      this.L(t);
    }
    L(t) {
      let e = new _n();
      if (t < 0) return;
      this.Y.K, this.Z(e, t), this.q(t);
      let i = 0;
      for (; i < this.aj.length; ) {
        let s = this.aj[i];
        (s.c = s.c + t),
          s.c > Math.max(this.E.h(s.d), 0.001)
            ? (this.af(i), i--)
            : this.r(s, t, e) || (this.af(i), i--),
          i++;
      }
    }
    Z(t, e) {
      (t.a = gi()), (t.b = gi()), (t.d = gi()), (t.c = 0);
      let i = _i(e, e, e),
        s = e * e * 0.5,
        r = _i(s, s, s);
      Ti(t.a, this.Y.h, i);
      let n = gi();
      this.E.i(n), Ti(t.b, n, i), Ti(t.d, n, r), (t.c = this.Y.X * e);
    }
    q(t) {
      if (!this.A && this.x) return;
      let e = this.E.f();
      for (this.I = this.I + t * e; this.I > 1; ) this.w(t), (this.I -= 1);
    }
    w(t) {
      let e = this.ac();
      if ((this.E.j(e, t), !(16 & this.Y.K))) {
        let t = Es(e.b[0], e.b[1], e.b[2], 1),
          i = Es(e.f[0], e.f[1], e.f[2], 0);
        Rs(t, t, this.G),
          Rs(i, i, this.G),
          pi(e.b, t),
          pi(e.f, i),
          8192 & this.Y.K && (e.b[2] = 0);
      }
      if (64 & this.Y.K) {
        let t = 1 + this.E.k().j * this.S.e(),
          i = gi();
        Ai(i, this.B, t), xi(e.f, e.f, i);
      }
      if (this.aa >= 2)
        for (let t = 0; t < 2; t++) {
          (e.a[t][0] = this.S.a()), (e.a[t][1] = this.S.a());
          let n = wr();
          Mr(n, this.Y.w[t], this.S.e()),
            (i = e.g[t]),
            (s = n),
            (r = this.Y.R[t]),
            (i[0] = s[0] + r[0]),
            (i[1] = s[1] + r[1]);
        }
      var i, s, r;
    }
    ac() {
      let t = new un();
      return this.aj.push(t), t;
    }
    af(t) {
      this.aj.splice(t, 1);
    }
    r(t, e, i) {
      if (this.aa >= 2)
        for (let i = 0; i < 2; i++) {
          let s = t.a[i][0] + e * t.g[i][0];
          (t.a[i][0] = s - Math.floor(s)),
            (s = t.a[i][1] + e * t.g[i][1]),
            (t.a[i][1] = s - Math.floor(s));
        }
      xi(t.f, t.f, i.a),
        16384 & this.Y.K && 2 * e < t.c && xi(t.b, t.b, this.ab);
      let s = _i(e, e, e),
        r = gi();
      if (
        (Ti(r, t.f, s),
        xi(t.f, t.f, i.b),
        Ai(t.f, t.f, 1 - i.c),
        xi(t.b, t.b, r),
        xi(t.b, t.b, i.d),
        2 == this.Y.G && 128 & this.Y.K)
      ) {
        let e = gi();
        if ((pi(e, t.b), 16 & this.Y.K)) {
          if (Fi(e, r) > 0) return !1;
        } else {
          let i = gi();
          if ((Wi(i, this.G), vi(e, t.b, i), Fi(e, r) > 0)) return !1;
        }
      }
      return !0;
    }
    b(t) {
      if (((this.al.length = 0), 0 == this.aj.length && null != this.E)) return;
      ji(this.aq, t), Sr(Cr(), t), this.ah(null, t);
      let e = 0;
      for (let t = 0; t < this.aj.length; t++) {
        let i = this.aj[t],
          s = new pn();
        if (
          (this.au(i, s) &&
            (131072 & this.Y.K && (this.ai(i, s), e++),
            262144 & this.Y.K && (this.p(i, s), e++)),
          e >= bn)
        )
          break;
      }
      this.am = e;
    }
    ah(t, e) {
      var i, s, r;
      16 & this.Y.K
        ? Yi(this.H, e, this.G)
        : null != t
        ? Yi(this.H, e, t)
        : zi(this.H, e),
        Wi(this.an, e),
        4096 & this.Y.K &&
          (Sr(this.ae, this.H),
          16 & this.Y.K &&
            Math.abs(this.as) > 0 &&
            ((i = this.ae),
            (s = this.ae),
            (r = 1 / this.as),
            (i[0] = s[0] * r),
            (i[1] = s[1] * r),
            (i[2] = s[2] * r),
            (i[3] = s[3] * r),
            (i[4] = s[4] * r),
            (i[5] = s[5] * r),
            (i[6] = s[6] * r),
            (i[7] = s[7] * r),
            (i[8] = s[8] * r)),
          mi(this.P, this.ae[6], this.ae[7], this.ae[8]),
          Mi(this.P) <= 2.3841858e-7
            ? mi(this.P, 0, 0, 1)
            : Si(this.P, this.P));
    }
    Q(t) {
      let e = 0,
        i = 0;
      if (0 != this.Y.I || 0 != this.Y.z) {
        let s = new nn(t.d);
        (e = 0 == this.Y.d ? this.Y.I : this.Y.I + s.e() * this.Y.d),
          (i = 0 == this.Y.z ? this.Y.i : this.Y.i + s.e() * this.Y.z);
      } else (e = this.Y.I), (i = this.Y.i);
      return { deltaSpin: i, baseSpin: e };
    }
    au(t, e) {
      let i = this.Y.B,
        s = this.Y.Q,
        r = s[0],
        n = s[1] - r,
        a = 0,
        o = t.d,
        h = t.c;
      if (((i < 1 || 0 != n) && (a = 127 & (h * this.Y.W + o)), i < fn[a]))
        return 0;
      this.ad(t, e, o);
      let l = n * fn[a] + r;
      Mr(e.a.c, e.a.c, l), 32 & this.Y.K && Mr(e.a.c, e.a.c, this.as);
      let u = Es(t.b[0], t.b[1], t.b[2], 1);
      return Rs(u, u, this.H), pi(e.c, u), (e.b = 1), 1;
    }
    ad(t, e, i) {
      let s = t.c / this.E.d(),
        r = new nn(i);
      Math.min(s, 1) <= 0 ? (s = 0) : s >= 1 && (s = 1);
      let n = _i(255, 255, 255),
        a = yr(1, 1),
        o = 1,
        h = e.a;
      this.Y.y.f(s, n, h.b, this.s),
        this.s || Ai(h.b, h.b, 1 / 255),
        this.Y.r.f(s, a, h.c),
        (h.f = this.Y.l.f(s, 32767) / 32767),
        this.X ? (h.e = this.X.b.f(s, 0) / 32767) : (h.e = 0);
      let l = 0;
      this.Y.T.i.length > 0
        ? ((o = 0), (h.a = this.Y.T.f(s, o)), (h.a = this.j & (h.a + this.J)))
        : 65536 & this.Y.K
        ? ((l = (this.j + 1) * r.c()), (h.a = (l / 4294967296) | 0))
        : (h.a = 0),
        (o = 0),
        (h.d = this.Y.p.f(s, o)),
        (h.d = (h.d + this.J) & this.j);
      let u = 1;
      524288 & this.Y.K
        ? ((u = Math.max(1 + r.e() * this.Y.Y[1], 99999997e-12)),
          (h.c[0] = Math.max(1 + r.e() * this.Y.Y[0], 99999997e-12) * h.c[0]))
        : ((u = Math.max(1 + r.e() * this.Y.Y[0], 99999997e-12)),
          (h.c[0] = u * h.c[0])),
        (h.c[1] = u * h.c[1]);
    }
    ai(t, e) {
      let i = yr((e.a.a & this.D) * this.d, (e.a.a >> this.T) * this.at),
        s = 0,
        r = 0,
        n = this.Q(t);
      (s = n.baseSpin), (r = n.deltaSpin);
      let a = 0,
        o = _i(0, 0, 0),
        h = _i(0, 0, 0),
        l = !1,
        u = !1;
      if (4 & this.Y.K && Mi(t.f) > 2.3841858e-7)
        if (((a = 1), 4096 & this.Y.K)) l = !0;
        else {
          let i = Es(-t.f[0], -t.f[1], -t.f[2], 0);
          Rs(i, i, this.H);
          let s = gi();
          pi(s, i);
          let r = 0,
            n = Mi(s);
          r = n <= 2.3841858e-7 ? 0 : 1 / Math.sqrt(n);
          let a = gi();
          pi(a, s),
            Ai(a, a, r),
            pi(o, a),
            Ai(o, o, e.a.c[0]),
            (h = _i(a[1], -a[0], 0)),
            Ai(h, h, e.a.c[1]),
            (u = !0),
            (l = !1);
        }
      if ((4096 & this.Y.K || l) && !u) {
        let i = Cr();
        (c = i),
          (d = this.ae),
          (c[0] = d[0]),
          (c[1] = d[1]),
          (c[2] = d[2]),
          (c[3] = d[3]),
          (c[4] = d[4]),
          (c[5] = d[5]),
          (c[6] = d[6]),
          (c[7] = d[7]),
          (c[8] = d[8]);
        let n = e.a.c[0];
        if (a) {
          let s = 0,
            r = _i(-t.f[0], -t.f[1], -t.f[2]),
            a = Mi(r);
          (s = a <= 2.3841858e-7 ? 0 : 1 / Math.sqrt(a)),
            Fr(
              i,
              this.ae,
              (function (t, e, i, s, r, n, a, o, h) {
                var l = new fi(9);
                return (
                  (l[0] = t),
                  (l[1] = e),
                  (l[2] = i),
                  (l[3] = s),
                  (l[4] = r),
                  (l[5] = n),
                  (l[6] = a),
                  (l[7] = o),
                  (l[8] = h),
                  l
                );
              })(r[0] * s, r[1] * s, 0, -r[1] * s, r[0] * s, 0, 0, 0, 1)
            ),
            s > 2.3841858e-7 && (n = e.a.c[0] * (1 / Math.sqrt(Mi(t.f)) / s));
        }
        if (
          (this.aa,
          mi(o, i[0], i[1], i[2]),
          Ai(o, o, n),
          mi(h, i[3], i[4], i[5]),
          Ai(h, h, e.a.c[1]),
          (r = h[0]),
          (u = !0),
          0 != this.Y.i || 0 != this.Y.z)
        ) {
          let e = s + r * t.c;
          512 & this.Y.K && 1 & t.d && (e = -e);
          let i = gi();
          pi(i, this.P), this.aa;
          let n = Cr(),
            a = Ir();
          kr(a, i, e),
            (function (t, e) {
              var i = e[0],
                s = e[1],
                r = e[2],
                n = e[3],
                a = i + i,
                o = s + s,
                h = r + r,
                l = i * a,
                u = s * a,
                c = s * o,
                d = r * a,
                f = r * o,
                g = r * h,
                b = n * a,
                _ = n * o,
                p = n * h;
              (t[0] = 1 - c - g),
                (t[3] = u - p),
                (t[6] = d + _),
                (t[1] = u + p),
                (t[4] = 1 - l - g),
                (t[7] = f - b),
                (t[2] = d - _),
                (t[5] = f + b),
                (t[8] = 1 - l - c);
            })(n, a),
            Ri(o, o, n),
            mi(h, r, h[1], h[2]),
            Ri(h, h, n);
        }
      }
      var c, d;
      if (!u)
        if (0 != this.Y.i || 0 != this.Y.z) {
          let i = s + r * t.c;
          512 & this.Y.K && 1 & t.d && (i = -i);
          let n = Math.cos(i),
            a = Math.sin(i);
          mi(o, n, a, 0),
            Ai(o, o, e.a.c[0]),
            mi(h, -a, n, 0),
            Ai(h, h, e.a.c[1]),
            134217728 & this.Y.K && xi(e.c, e.c, _i(h[0], h[1], 0));
        } else mi(o, e.a.c[0], 0, 0), mi(h, 0, e.a.c[1], 0);
      return this.n(o, h, e.c, e.a.b, e.a.f, e.a.e, i[0], i[1], t.a), 0;
    }
    p(t, e) {
      let i = yr((e.a.d & this.D) * this.d, (e.a.d >> this.T) * this.at),
        s = _i(0, 0, 0),
        r = _i(0, 0, 0),
        n = this.Y.a;
      1024 & this.Y.K && (n = Math.min(t.c, n));
      let a = As();
      Ai(a, t.f, -1), (a[3] = 0), Rs(a, a, this.H), Ai(a, a, n);
      let o = _i(a[0], a[1], 0);
      if (Fi(o, o) > 1e-4) {
        let t = 1 / bi(o);
        Mr(e.a.c, e.a.c, t),
          Er(o, o, e.a.c),
          (r = _i(-o[1], o[0], 0)),
          Ai(s, a, 0.5),
          xi(e.c, e.c, s);
      } else (s = _i(0.05 * e.a.c[0], 0, 0)), (r = _i(0, 0.05 * e.a.c[1], 0));
      return this.n(s, r, e.c, e.a.b, e.a.f, e.a.e, i[0], i[1], t.a), 1;
    }
    n(t, e, i, s, r, n, a, o, h) {
      const l = [-1, -1, 1, 1],
        u = [1, -1, 1, -1],
        c = [0, 0, 1, 1],
        d = [0, 1, 0, 1];
      let f = gi(),
        g = wr(),
        b = wr(),
        _ = wr();
      for (let p = 0; p < 4; p++)
        mi(f, 0, 0, 0),
          Ei(f, f, t, l[p]),
          Ei(f, f, e, u[p]),
          xi(f, f, i),
          Ar(g, c[p] * this.d + a, d[p] * this.at + o),
          Ar(b, c[p] * this.Y.t[0] + h[0][0], d[p] * this.Y.t[0] + h[0][1]),
          Ar(_, c[p] * this.Y.t[1] + h[1][0], d[p] * this.Y.t[1] + h[1][1]),
          this.al.push(f[0]),
          this.al.push(f[1]),
          this.al.push(f[2]),
          this.al.push(s[0]),
          this.al.push(s[1]),
          this.al.push(s[2]),
          this.al.push(r),
          this.al.push(g[0]),
          this.al.push(g[1]),
          this.al.push(b[0]),
          this.al.push(b[1]),
          this.al.push(_[0]),
          this.al.push(_[1]),
          this.al.push(n);
    }
  };
  class Tn {
    constructor() {
      (this.c = gi()), (this.b = As()), (this.a = wr());
    }
  }
  class wn {}
  const yn = [0, 1, 2, 10, 3, 4, 5, 13];
  function An(t, e) {
    return _i(t[4 * e + 0], t[4 * e + 1], t[4 * e + 2]);
  }
  const En = class {
    constructor(t, e) {
      (this.aq = t),
        (this.af = e),
        (this.d = gi()),
        (this.ab = gi()),
        (this.u = new wn()),
        (this.au = gi()),
        (this.M = gi()),
        (this.an = gi()),
        (this.K = gi()),
        (this.ao = gi()),
        (this.I = gi()),
        (this.G = gi()),
        (this.U = gi()),
        (this.C = gi()),
        (this.b = gi()),
        (this.at = gi()),
        (this.m = gi()),
        (this.a = gi()),
        (this.A = t.M.context),
        (this.t = new Array(e.e.length)),
        (this.w = new Array(e.e.length));
      for (let i = 0; i < e.e.length; i++) this.w[i] = t.aC.f[e.e[i]];
      let i = Es(255, 255, 255, 255),
        s = new wn();
      (s.d = 0),
        (s.b = 0),
        (s.a = 1),
        (s.c = 1),
        this.ad(e.b, e.i, i, s, e.p, e.o),
        this.ac(e.f),
        this.L(!1);
    }
    L(t) {
      (this.f = t), this.f || (this.aa = !1);
    }
    ac(t) {
      this.H = t;
    }
    k() {
      return this.R == this.o;
    }
    l(t) {
      this.Z = t;
    }
    r(t) {
      this.F = t;
    }
    z(t) {
      this.x[3] = Math.max(t, 0);
    }
    P() {
      let t = gi();
      Oi(t, this.d, this.a);
      let e = Mi(t);
      Ai(t, this.au, this.Z),
        vi(this.G, this.d, t),
        Ai(t, this.M, this.Z),
        vi(this.U, this.a, t),
        Ai(t, this.au, this.F),
        xi(this.C, this.d, t),
        Ai(t, this.M, this.F),
        xi(this.b, this.a, t),
        Ai(this.ao, this.an, e),
        Ai(this.I, this.K, e);
    }
    g(t, e, i) {
      let s;
      if (this.e && this.f) {
        s = t;
        let i = gi();
        Wi(i, s),
          xi(i, i, e),
          pi(this.ab, e),
          this.aa
            ? (pi(this.d, this.a), pi(this.an, this.K), pi(this.au, this.M))
            : (pi(this.d, i),
              (this.an = An(s, 2)),
              (this.au = An(s, 1)),
              (this.i = 0),
              (this.aa = !0)),
          (this.a = i),
          (this.K = An(s, 2)),
          (this.M = An(s, 1));
      }
    }
    B(t) {
      var e = Cr();
      Sr(e, t),
        (this.an = Ri(this.an, this.an, e)),
        (this.au = Ri(this.au, this.au, e)),
        (this.K = Ri(this.K, this.K, e)),
        (this.M = Ri(this.M, this.M, e)),
        (this.d = Di(this.d, this.d, t)),
        (this.a = Di(this.a, this.a, t));
      for (var i = 0; i < this.h.length; i++) Di(this.h[i].c, this.h[i].c, t);
    }
    T(t, e, i) {
      (this.x[2] = i), (this.x[1] = e), (this.x[0] = t);
    }
    q(t) {
      if (this.p != t) {
        this.p = t;
        let e = t % this.ak,
          i = e;
        0 != (2147483648 & e) &&
          (i = ((1 & e) | (e >> 1)) + ((1 & e) | (e >> 1)));
        let s = i * this.s + this.as.b;
        this.u.b = s;
        let r = t / this.ak,
          n = r;
        0 != (2147483648 & r) &&
          ((r = (1 & r) | (r >> 1)), (n = r + r), (s = this.u.b));
        let a = n * this.al + this.as.d;
        (this.u.d = a), (this.u.c = s + this.s), (this.u.a = a + this.al);
      }
    }
    ah(t, e, i) {
      let s,
        r = this.h[2 * this.o],
        n = this.h[2 * this.o + 1],
        a = gi();
      Ai(a, this.I, 1 - e),
        vi(a, this.U, a),
        Ai(r.c, a, e),
        Ai(a, this.ao, e),
        xi(a, this.G, a),
        Ai(a, a, 1 - e),
        xi(r.c, r.c, a),
        Ai(a, this.I, 1 - e),
        vi(a, this.b, a),
        Ai(n.c, a, e),
        Ai(a, this.ao, e),
        xi(a, this.C, a),
        Ai(a, a, 1 - e),
        xi(n.c, n.c, a),
        (this.J[this.o] = t),
        (s = i),
        (this.o = this.o + s),
        this.o >= this.J.length && (this.o -= this.J.length);
    }
    Y(t, e) {
      if (this.aq.G) return;
      let i = gi(),
        s = 1;
      (i = this.af.d.c(t, this.aq.q, i)),
        (s = this.af.a.c(t, this.aq.q)),
        this.T(i[0], i[1], i[2]),
        this.z(s / 32767);
      let r = this.af.j.c(t, this.aq.q);
      this.r(r);
      let n = this.af.h.c(t, this.aq.q);
      this.l(n);
      let a = this.af.m.c(t, this.aq.q);
      this.q(a);
      let o = this.af.k.c(t, this.aq.q, 1);
      this.L(0 != o);
      let h = Pi();
      $i(h, this.aq.aB, this.aq.T[this.af.q].c), Hi(h, h, this.af.n);
      let l = gi();
      this.g(h, l, null), this.y(e, !1);
    }
    y(t, e) {
      let i,
        s,
        r,
        n,
        a,
        o,
        h,
        l,
        u,
        c,
        d,
        f,
        g,
        b,
        _,
        p,
        m,
        x,
        v,
        T,
        w,
        y,
        A,
        E,
        M,
        C,
        S,
        F,
        I,
        k,
        D,
        R,
        U,
        O,
        B,
        P,
        z,
        N,
        G,
        L,
        j,
        Y,
        H,
        q,
        V,
        X,
        K,
        W;
      for (
        this.c || (this.ar > 0 && (t = 1 / this.ar + 99999997e-12)),
          t >= 0 ? this.N <= t && (t = this.N) : (t = 0),
          x = this.R;
        x != this.o && !(t + this.J[x] <= this.N);
        x = this.R
      )
        this.R = this.j(this.R, 1);
      if (!e && this.e && this.f && this.aa) {
        (D = t * this.ar + this.i), (W = this.x), this.P();
        let e = !1;
        if (
          ((O = 0),
          D < 1
            ? (e = !0)
            : ((K = this.i),
              (U = 1 / (D - K)),
              (m = Math.floor(D - 1)),
              (O = Math.ceil(Math.max(m, 0)))),
          -1 == O || e)
        );
        else
          for (
            R = 1, x = 1;
            (k = this.o),
              (N = this.h.length),
              (this.h[2 * k].b = W),
              (v = 2 * this.o + 1),
              (G = this.h.length),
              (this.h[v].b = W),
              this.ah((x - K) * U * -t, (x - K) * U, 1),
              -1 != --O;
            x = R
          )
            (R += 1), (K = this.i);
        (T = Math.floor(D)),
          (this.i = D - T),
          this.ah(0, 1, 0),
          (I = this.o),
          (L = this.h.length),
          (w = this.h[2 * I]),
          (y = this.u.b),
          (w.a[1] = this.u.d),
          (w.a[0] = y),
          (A = 2 * this.o + 1),
          (j = this.h.length),
          (E = this.h[A]),
          (M = this.u.b),
          (E.a[1] = this.u.a),
          (E.a[0] = M),
          (F = this.o),
          (Y = this.h.length),
          (this.h[2 * F].b = W),
          (C = 2 * this.o + 1),
          (H = this.h.length),
          (this.h[C].b = W);
      }
      (this.at[2] = 34028235e31),
        (this.at[1] = 34028235e31),
        (this.at[0] = 34028235e31),
        (this.m[2] = -34028235e31),
        (this.m[1] = -34028235e31),
        (this.m[0] = -34028235e31),
        (B = this.R);
      for (let e = this.R; e != this.o; B = e)
        (p = 2 * e),
          (X = this.h.length),
          (S = B),
          (z = this.h[2 * e]),
          (i = p + 1),
          (s = this.h[2 * e + 1]),
          (r = (this.H + this.H) * this.J[S] * t + t * this.H * t),
          (z.c[2] = z.c[2] + r),
          (s.c[2] = r + s.c[2]),
          (n = z.c[0]),
          (a = this.at[0]),
          a > z.c[0] && ((a = z.c[0]), (this.at[0] = n), (n = z.c[0])),
          (o = z.c[1]),
          (h = this.at[1]),
          h > o && ((h = z.c[1]), (this.at[1] = o), (o = z.c[1])),
          (l = z.c[2]),
          (u = this.at[2]),
          u > l && ((u = z.c[2]), (this.at[2] = l), (l = z.c[2])),
          n > this.m[0] && (this.m[0] = n),
          o > this.m[1] && (this.m[1] = o),
          l > this.m[2] && (this.m[2] = l),
          (c = s.c[0]),
          a > s.c[0] && ((this.at[0] = c), (c = s.c[0])),
          (d = s.c[1]),
          h > d && ((this.at[1] = d), (d = s.c[1])),
          (f = s.c[2]),
          u > f && ((this.at[2] = f), (f = s.c[2])),
          c > this.m[0] && (this.m[0] = c),
          d > this.m[1] && (this.m[1] = d),
          f > this.m[2] && (this.m[2] = f),
          (q = this.J.length),
          (this.J[S] = t + this.J[S]),
          (g = this.s),
          (V = this.J.length),
          (b = g * this.J[S] * this.D + this.u.b),
          (z.a[1] = this.u.d),
          (z.a[0] = b),
          (s.a[1] = this.u.a),
          (s.a[0] = b),
          (_ = this.J.length),
          (P = B + 1),
          (e = P - _),
          _ > P && (e = P);
      this.c = !0;
    }
    j(t, e) {
      let i = e + t;
      t = i;
      let s = this.J.length;
      return i >= s && (t = i - s), t;
    }
    ad(t, e, i, s, r, n) {
      let a, o, h, l, u, c, d, f;
      (d = Math.ceil(t)),
        (f = Math.max(0.25, e)),
        (a = Math.ceil(f * d)),
        (o = Math.ceil(Math.max(a + 1 + 1, 0))),
        (this.J = new Array(o)),
        (this.R = 0),
        (this.o = 0),
        (this.i = 0),
        (this.aa = !1),
        (this.h = new Array(2 * o));
      for (let t = 0; t < this.h.length; t++) {
        this.h[t] = new Tn();
        let e = this.h[t];
        (e.c[0] = 0),
          (e.c[1] = 0),
          (e.c[2] = 0),
          (e.b = Es(0, 0, 0, 0)),
          (e.a[0] = 0),
          (e.a[1] = 0);
      }
      this.Q = new Array(4 * o);
      for (let t = 0; t < this.Q.length; t++) this.Q[t] = t % (2 * o);
      (this.D = 1 / f),
        (h = n),
        0 != (2147483648 & n) &&
          (h = ((1 & n) | (n >> 1)) + ((1 & n) | (n >> 1))),
        (this.s = (s.c - s.b) / h),
        (l = r),
        0 != (2147483648 & r) &&
          (l = ((1 & r) | (r >> 1)) + ((1 & r) | (r >> 1))),
        (this.al = (s.a - s.d) / l),
        (this.av = 1 / this.s),
        (this.ag = 1 / this.al),
        (this.ar = d),
        (this.N = f),
        Is(i, i, 1 / 255),
        (this.x = i),
        (this.as = s),
        (this.W = r),
        (this.ak = n),
        (this.p = 0),
        (u = 0 * this.s + this.as.b),
        (this.u.b = u),
        (c = 0 * this.al + this.as.d),
        (this.u.d = c),
        (this.u.c = u + this.s),
        (this.u.a = c + this.al),
        (this.F = 10),
        (this.Z = 10),
        (this.H = 0),
        (this.e = !0),
        (this.f = !0),
        (this.S = !0),
        (this.v = this.aq.K.g(0)),
        (this.ai = this.aq.K.l(0)),
        (this.O = this.aq.K.h(this.v, this.ai));
    }
    ap() {
      let t = new Array(this.h.length);
      for (let e = 0, i = 0; e < this.h.length; ++e)
        (t[i++] = this.h[e].c[0]),
          (t[i++] = this.h[e].c[1]),
          (t[i++] = this.h[e].c[2]),
          (t[i++] = this.h[e].b[0]),
          (t[i++] = this.h[e].b[1]),
          (t[i++] = this.h[e].b[2]),
          (t[i++] = this.h[e].b[3]),
          (t[i++] = this.h[e].a[0]),
          (t[i++] = this.h[e].a[1]);
      this.k() ||
        (this.v.a(new Float32Array(t)), this.ai.a(new Uint16Array(this.Q)));
    }
    V(t) {
      const e = this.aq.K;
      var i = this.af.r[t];
      if (i <= -1 || i > this.aq.I.length) return null;
      let s = this.aq.I[i];
      if (!s.f || !s.f.c) return null;
      let r = t;
      r >= this.af.e.length && (r = 0);
      let n = this.aq.aC.f[this.af.e[r]],
        a = Object.assign({}, this.aq.af);
      const o = e.a(
        this.aq.p,
        new cn(!1, !this.aq.z, yn[n.c], !0, !1, 15),
        new ds([s.f], a)
      );
      return e.m(new dn(this.O, 0, 0), o, 0, 0);
    }
    ae(t) {
      if (this.k()) return;
      const e = this.aq.K.j();
      for (let i = 0; i < this.af.r.length; i++) {
        if ((this.t[i] || (this.t[i] = this.V(i)), !this.t[i])) continue;
        if (!t && this.t[i].g.a() > Qs.GxBlend_AlphaKey) continue;
        let s =
          this.o > this.R
            ? 2 * (this.o - this.R) + 2
            : 2 * (this.J.length + this.o - this.R) + 2;
        (this.t[i].e = s), (this.t[i].f = 2 * this.R * 2), e.b(this.t[i]);
      }
    }
  };
  const Mn = class {
    constructor(t) {
      var e = this;
      (e.e = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (e.b = Es(t.getFloat(), t.getFloat(), t.getFloat(), 0)),
        (e.f = t.getFloat()),
        (e.i = t.getFloat()),
        (e.a = t.getFloat()),
        (e.h = t.getFloat()),
        (e.d = [t.getUint8(), t.getUint8(), t.getUint8(), t.getUint8()]),
        (e.g = [t.getUint8(), t.getUint8(), t.getUint8(), t.getUint8()]);
    }
    c() {
      var t = this;
      (t.e = null), (t.b = null), (t.d = null), (t.g = null);
    }
  };
  const Cn = class {
    constructor(t) {
      var e = this;
      (e.h = t.getUint16()),
        (e.e = t.getUint16()),
        (e.j = t.getUint16()),
        (e.b = t.getUint16()),
        (e.a = t.getUint16() + 65536 * e.e),
        (e.i = t.getUint16()),
        (e.g = t.getUint16()),
        (e.c = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (e.k = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (e.f = t.getFloat());
    }
    d() {
      (this.c = null), (this.k = null);
    }
  };
  const Sn = class {
    constructor(t) {
      (this.a = t.getUint16()), (this.c = t.getUint16());
    }
    static b(t) {
      const e = t.b.aC,
        i = t.i;
      e.f && i.l < e.f.length ? (t.B = e.f[i.l]) : (t.B = { a: 0, c: 0 }),
        (t.r = 0 != (1 & t.B.a)),
        (t.n = 0 == (4 & t.B.a)),
        (t.p = 0 != (16 & t.B.a));
    }
  };
  const Fn = class {
    constructor(t) {
      (this.b = new tn(t, qr)),
        (this.d = new tn(t, Vr)),
        (this.a = new tn(t, qr));
    }
    c() {
      var t = this;
      t.b && (t.b.e(), (t.b = null)),
        t.d && (t.d.e(), (t.d = null)),
        t.a && (t.a.e(), (t.a = null));
    }
  };
  const In = class {
    constructor(t) {
      var e = this;
      (e.c = t.getInt32()),
        (e.e = t.getInt32()),
        (e.a = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (e.d = -1);
    }
    b() {
      this.a = null;
    }
  };
  const kn = class {
    constructor(t) {
      (this.f = new tn(t, qr)), (this.e = new tn(t, Xr));
    }
    c() {
      var t = this;
      t.f && t.f.e(), t.e && t.e.e();
    }
    a(t) {
      return !!this.f && this.f.a(t);
    }
    g(t) {
      return !!this.e && this.e.a(t);
    }
    b(t) {
      return this.a(t) || this.g(t);
    }
    d(t, e, i) {
      var s = this;
      i ? (i[0] = i[1] = i[2] = i[3] = 1) : (i = Es(1, 1, 1, 1));
      let r = _i(1, 1, 1);
      return (
        s.a(t.e.a) && s.f.c(t, e, r, r),
        s.g(t.e.a) && (i[3] = s.e.c(t, e, i[3]) / 32767),
        (i[0] = r[0]),
        (i[1] = r[1]),
        (i[2] = r[2]),
        i
      );
    }
  };
  const Dn = class {
    constructor(t) {
      this.c = new tn(t, Xr);
    }
    b() {
      this.c.e(), (this.c = null);
    }
    a(t) {
      return this.c.a(t);
    }
    d(t, e) {
      var i = 1;
      this.a(t.e.a) && (i = this.c.c(t, e, i) / 32767);
      return i > 1 ? (i = 1) : i < 0 && (i = 0), i;
    }
  };
  const Rn = class {
    constructor(t) {
      var e = this;
      (e.d = t.getFloat()),
        (e.c = t.getFloat()),
        (e.a = t.getFloat()),
        (e.b = new Qr(t));
    }
  };
  const Un = class {
    constructor(t) {
      (this.o = t.getInt32()),
        (this.K = t.getUint32()),
        (this.V = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (this.g = t.getInt16()),
        (this.H = t.getInt16()),
        0 != (268435456 & this.K) &&
          ((this.j = [0, 0, 0]),
          (this.j[0] = 31 & this.H),
          (this.j[1] = (this.H >> 5) & 31),
          (this.j[2] = (this.H >> 10) & 31)),
        (this.n = t.getUint8()),
        (this.G = t.getUint8()),
        (this.M = t.getUint16()),
        (this.D = t.getUint16()),
        (this.N = t.getUint16()),
        (this.F = t.getUint16()),
        (this.u = new tn(t, Kr)),
        (this.q = new tn(t, Kr)),
        (this.S = new tn(t, Kr)),
        (this.m = new tn(t, Kr)),
        (this.v = new tn(t, qr)),
        (this.A = new tn(t, Kr)),
        (this.P = t.getFloat()),
        (this.f = new tn(t, Kr)),
        (this.x = t.getFloat()),
        (this.J = new tn(t, Kr)),
        (this.e = new tn(t, Kr)),
        (this.C = new tn(t, Kr)),
        (this.y = new $r(t)),
        (this.l = new Qr(t)),
        (this.r = new Jr(t)),
        (this.Y = [t.getFloat(), t.getFloat()]),
        (this.T = new Qr(t)),
        (this.p = new Qr(t)),
        (this.a = t.getFloat()),
        (this.W = t.getFloat()),
        (this.B = t.getFloat()),
        (this.Q = [t.getFloat(), t.getFloat()]),
        (this.s = t.getFloat()),
        (this.X = t.getFloat()),
        (this.I = t.getFloat()),
        (this.d = t.getFloat()),
        (this.i = t.getFloat()),
        (this.z = t.getFloat()),
        (this.L = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (this.aa = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (this.h = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (this.k = t.getFloat()),
        (this.c = t.getFloat()),
        (this.Z = t.getFloat()),
        (this.E = t.getFloat()),
        (this.b = t.getFloat());
      var e = t.getInt32();
      this.U = new Array(e);
      for (var i = 0; i < e; i++)
        this.U[i] = _i(t.getFloat(), t.getFloat(), t.getFloat());
      (this.O = new tn(t, Wr)),
        (this.t = yr(t.getFloat(), t.getFloat())),
        (this.R = [
          yr(t.getFloat(), t.getFloat()),
          yr(t.getFloat(), t.getFloat()),
        ]),
        (this.w = [
          yr(t.getFloat(), t.getFloat()),
          yr(t.getFloat(), t.getFloat()),
        ]);
    }
  };
  class On {
    constructor(t) {
      (this.a = t.getInt32()),
        (this.c = t.getUint32()),
        (this.i = t.getInt16()),
        (this.b = t.getUint16()),
        (this.f = t.getUint32()),
        (this.h = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (this.d = new tn(t, qr)),
        (this.e = new tn(t, Vr)),
        (this.g = new tn(t, qr));
    }
  }
  const Bn = class {
    constructor(t) {
      (this.buffer = new DataView(t)), (this.position = 0);
    }
    getBool() {
      var t = 0 != this.buffer.getUint8(this.position);
      return (this.position += 1), t;
    }
    getUint8() {
      var t = this.buffer.getUint8(this.position);
      return (this.position += 1), t;
    }
    getInt8() {
      var t = this.buffer.getInt8(this.position);
      return (this.position += 1), t;
    }
    getUint16() {
      var t = this.buffer.getUint16(this.position, !0);
      return (this.position += 2), t;
    }
    getInt16() {
      var t = this.buffer.getInt16(this.position, !0);
      return (this.position += 2), t;
    }
    getUint32() {
      var t = this.buffer.getUint32(this.position, !0);
      return (this.position += 4), t;
    }
    getInt32() {
      var t = this.buffer.getInt32(this.position, !0);
      return (this.position += 4), t;
    }
    getFloat() {
      var t = this.buffer.getFloat32(this.position, !0);
      return (this.position += 4), t;
    }
    getString(t) {
      void 0 === t && (t = this.getUint16());
      for (var e = "", i = 0; i < t; ++i)
        e += String.fromCharCode(this.getUint8());
      return e;
    }
    setBool(t) {
      this.buffer.setUint8(this.position, t ? 1 : 0), (this.position += 1);
    }
    setUint8(t) {
      this.buffer.setUint8(this.position, t), (this.position += 1);
    }
    setInt8(t) {
      this.buffer.setInt8(this.position, t), (this.position += 1);
    }
    setUint16(t) {
      this.buffer.setUint16(this.position, t, !0), (this.position += 2);
    }
    setInt16(t) {
      this.buffer.setInt16(this.position, t, !0), (this.position += 2);
    }
    setUint32(t) {
      this.buffer.setUint32(this.position, t, !0), (this.position += 4);
    }
    setInt32(t) {
      this.buffer.setInt32(this.position, t, !0), (this.position += 4);
    }
    setFloat(t) {
      this.buffer.setFloat32(this.position, t, !0), (this.position += 4);
    }
  };
  function Pn(t) {
    let e = t.length;
    for (; --e >= 0; ) t[e] = 0;
  }
  const zn = 256,
    Nn = 286,
    Gn = 30,
    Ln = 15,
    jn = new Uint8Array([
      0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5,
      5, 5, 5, 0,
    ]),
    Yn = new Uint8Array([
      0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10,
      11, 11, 12, 12, 13, 13,
    ]),
    Hn = new Uint8Array([
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 3, 7,
    ]),
    qn = new Uint8Array([
      16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15,
    ]),
    Vn = new Array(576);
  Pn(Vn);
  const Xn = new Array(60);
  Pn(Xn);
  const Kn = new Array(512);
  Pn(Kn);
  const Wn = new Array(256);
  Pn(Wn);
  const Zn = new Array(29);
  Pn(Zn);
  const Jn = new Array(Gn);
  function $n(t, e, i, s, r) {
    (this.static_tree = t),
      (this.extra_bits = e),
      (this.extra_base = i),
      (this.elems = s),
      (this.max_length = r),
      (this.has_stree = t && t.length);
  }
  let Qn, ta, ea;
  function ia(t, e) {
    (this.dyn_tree = t), (this.max_code = 0), (this.stat_desc = e);
  }
  Pn(Jn);
  const sa = (t) => (t < 256 ? Kn[t] : Kn[256 + (t >>> 7)]),
    ra = (t, e) => {
      (t.pending_buf[t.pending++] = 255 & e),
        (t.pending_buf[t.pending++] = (e >>> 8) & 255);
    },
    na = (t, e, i) => {
      t.bi_valid > 16 - i
        ? ((t.bi_buf |= (e << t.bi_valid) & 65535),
          ra(t, t.bi_buf),
          (t.bi_buf = e >> (16 - t.bi_valid)),
          (t.bi_valid += i - 16))
        : ((t.bi_buf |= (e << t.bi_valid) & 65535), (t.bi_valid += i));
    },
    aa = (t, e, i) => {
      na(t, i[2 * e], i[2 * e + 1]);
    },
    oa = (t, e) => {
      let i = 0;
      do {
        (i |= 1 & t), (t >>>= 1), (i <<= 1);
      } while (--e > 0);
      return i >>> 1;
    },
    ha = (t, e, i) => {
      const s = new Array(16);
      let r,
        n,
        a = 0;
      for (r = 1; r <= Ln; r++) (a = (a + i[r - 1]) << 1), (s[r] = a);
      for (n = 0; n <= e; n++) {
        let e = t[2 * n + 1];
        0 !== e && (t[2 * n] = oa(s[e]++, e));
      }
    },
    la = (t) => {
      let e;
      for (e = 0; e < Nn; e++) t.dyn_ltree[2 * e] = 0;
      for (e = 0; e < Gn; e++) t.dyn_dtree[2 * e] = 0;
      for (e = 0; e < 19; e++) t.bl_tree[2 * e] = 0;
      (t.dyn_ltree[512] = 1),
        (t.opt_len = t.static_len = 0),
        (t.sym_next = t.matches = 0);
    },
    ua = (t) => {
      t.bi_valid > 8
        ? ra(t, t.bi_buf)
        : t.bi_valid > 0 && (t.pending_buf[t.pending++] = t.bi_buf),
        (t.bi_buf = 0),
        (t.bi_valid = 0);
    },
    ca = (t, e, i, s) => {
      const r = 2 * e,
        n = 2 * i;
      return t[r] < t[n] || (t[r] === t[n] && s[e] <= s[i]);
    },
    da = (t, e, i) => {
      const s = t.heap[i];
      let r = i << 1;
      for (
        ;
        r <= t.heap_len &&
        (r < t.heap_len && ca(e, t.heap[r + 1], t.heap[r], t.depth) && r++,
        !ca(e, s, t.heap[r], t.depth));

      )
        (t.heap[i] = t.heap[r]), (i = r), (r <<= 1);
      t.heap[i] = s;
    },
    fa = (t, e, i) => {
      let s,
        r,
        n,
        a,
        o = 0;
      if (0 !== t.sym_next)
        do {
          (s = 255 & t.pending_buf[t.sym_buf + o++]),
            (s += (255 & t.pending_buf[t.sym_buf + o++]) << 8),
            (r = t.pending_buf[t.sym_buf + o++]),
            0 === s
              ? aa(t, r, e)
              : ((n = Wn[r]),
                aa(t, n + zn + 1, e),
                (a = jn[n]),
                0 !== a && ((r -= Zn[n]), na(t, r, a)),
                s--,
                (n = sa(s)),
                aa(t, n, i),
                (a = Yn[n]),
                0 !== a && ((s -= Jn[n]), na(t, s, a)));
        } while (o < t.sym_next);
      aa(t, 256, e);
    },
    ga = (t, e) => {
      const i = e.dyn_tree,
        s = e.stat_desc.static_tree,
        r = e.stat_desc.has_stree,
        n = e.stat_desc.elems;
      let a,
        o,
        h,
        l = -1;
      for (t.heap_len = 0, t.heap_max = 573, a = 0; a < n; a++)
        0 !== i[2 * a]
          ? ((t.heap[++t.heap_len] = l = a), (t.depth[a] = 0))
          : (i[2 * a + 1] = 0);
      for (; t.heap_len < 2; )
        (h = t.heap[++t.heap_len] = l < 2 ? ++l : 0),
          (i[2 * h] = 1),
          (t.depth[h] = 0),
          t.opt_len--,
          r && (t.static_len -= s[2 * h + 1]);
      for (e.max_code = l, a = t.heap_len >> 1; a >= 1; a--) da(t, i, a);
      h = n;
      do {
        (a = t.heap[1]),
          (t.heap[1] = t.heap[t.heap_len--]),
          da(t, i, 1),
          (o = t.heap[1]),
          (t.heap[--t.heap_max] = a),
          (t.heap[--t.heap_max] = o),
          (i[2 * h] = i[2 * a] + i[2 * o]),
          (t.depth[h] =
            (t.depth[a] >= t.depth[o] ? t.depth[a] : t.depth[o]) + 1),
          (i[2 * a + 1] = i[2 * o + 1] = h),
          (t.heap[1] = h++),
          da(t, i, 1);
      } while (t.heap_len >= 2);
      (t.heap[--t.heap_max] = t.heap[1]),
        ((t, e) => {
          const i = e.dyn_tree,
            s = e.max_code,
            r = e.stat_desc.static_tree,
            n = e.stat_desc.has_stree,
            a = e.stat_desc.extra_bits,
            o = e.stat_desc.extra_base,
            h = e.stat_desc.max_length;
          let l,
            u,
            c,
            d,
            f,
            g,
            b = 0;
          for (d = 0; d <= Ln; d++) t.bl_count[d] = 0;
          for (
            i[2 * t.heap[t.heap_max] + 1] = 0, l = t.heap_max + 1;
            l < 573;
            l++
          )
            (u = t.heap[l]),
              (d = i[2 * i[2 * u + 1] + 1] + 1),
              d > h && ((d = h), b++),
              (i[2 * u + 1] = d),
              u > s ||
                (t.bl_count[d]++,
                (f = 0),
                u >= o && (f = a[u - o]),
                (g = i[2 * u]),
                (t.opt_len += g * (d + f)),
                n && (t.static_len += g * (r[2 * u + 1] + f)));
          if (0 !== b) {
            do {
              for (d = h - 1; 0 === t.bl_count[d]; ) d--;
              t.bl_count[d]--,
                (t.bl_count[d + 1] += 2),
                t.bl_count[h]--,
                (b -= 2);
            } while (b > 0);
            for (d = h; 0 !== d; d--)
              for (u = t.bl_count[d]; 0 !== u; )
                (c = t.heap[--l]),
                  c > s ||
                    (i[2 * c + 1] !== d &&
                      ((t.opt_len += (d - i[2 * c + 1]) * i[2 * c]),
                      (i[2 * c + 1] = d)),
                    u--);
          }
        })(t, e),
        ha(i, l, t.bl_count);
    },
    ba = (t, e, i) => {
      let s,
        r,
        n = -1,
        a = e[1],
        o = 0,
        h = 7,
        l = 4;
      for (
        0 === a && ((h = 138), (l = 3)), e[2 * (i + 1) + 1] = 65535, s = 0;
        s <= i;
        s++
      )
        (r = a),
          (a = e[2 * (s + 1) + 1]),
          (++o < h && r === a) ||
            (o < l
              ? (t.bl_tree[2 * r] += o)
              : 0 !== r
              ? (r !== n && t.bl_tree[2 * r]++, t.bl_tree[32]++)
              : o <= 10
              ? t.bl_tree[34]++
              : t.bl_tree[36]++,
            (o = 0),
            (n = r),
            0 === a
              ? ((h = 138), (l = 3))
              : r === a
              ? ((h = 6), (l = 3))
              : ((h = 7), (l = 4)));
    },
    _a = (t, e, i) => {
      let s,
        r,
        n = -1,
        a = e[1],
        o = 0,
        h = 7,
        l = 4;
      for (0 === a && ((h = 138), (l = 3)), s = 0; s <= i; s++)
        if (((r = a), (a = e[2 * (s + 1) + 1]), !(++o < h && r === a))) {
          if (o < l)
            do {
              aa(t, r, t.bl_tree);
            } while (0 != --o);
          else
            0 !== r
              ? (r !== n && (aa(t, r, t.bl_tree), o--),
                aa(t, 16, t.bl_tree),
                na(t, o - 3, 2))
              : o <= 10
              ? (aa(t, 17, t.bl_tree), na(t, o - 3, 3))
              : (aa(t, 18, t.bl_tree), na(t, o - 11, 7));
          (o = 0),
            (n = r),
            0 === a
              ? ((h = 138), (l = 3))
              : r === a
              ? ((h = 6), (l = 3))
              : ((h = 7), (l = 4));
        }
    };
  let pa = !1;
  const ma = (t, e, i, s) => {
    na(t, 0 + (s ? 1 : 0), 3),
      ua(t),
      ra(t, i),
      ra(t, ~i),
      i && t.pending_buf.set(t.window.subarray(e, e + i), t.pending),
      (t.pending += i);
  };
  var xa = (t) => {
      pa ||
        ((() => {
          let t, e, i, s, r;
          const n = new Array(16);
          for (i = 0, s = 0; s < 28; s++)
            for (Zn[s] = i, t = 0; t < 1 << jn[s]; t++) Wn[i++] = s;
          for (Wn[i - 1] = s, r = 0, s = 0; s < 16; s++)
            for (Jn[s] = r, t = 0; t < 1 << Yn[s]; t++) Kn[r++] = s;
          for (r >>= 7; s < Gn; s++)
            for (Jn[s] = r << 7, t = 0; t < 1 << (Yn[s] - 7); t++)
              Kn[256 + r++] = s;
          for (e = 0; e <= Ln; e++) n[e] = 0;
          for (t = 0; t <= 143; ) (Vn[2 * t + 1] = 8), t++, n[8]++;
          for (; t <= 255; ) (Vn[2 * t + 1] = 9), t++, n[9]++;
          for (; t <= 279; ) (Vn[2 * t + 1] = 7), t++, n[7]++;
          for (; t <= 287; ) (Vn[2 * t + 1] = 8), t++, n[8]++;
          for (ha(Vn, 287, n), t = 0; t < Gn; t++)
            (Xn[2 * t + 1] = 5), (Xn[2 * t] = oa(t, 5));
          (Qn = new $n(Vn, jn, 257, Nn, Ln)),
            (ta = new $n(Xn, Yn, 0, Gn, Ln)),
            (ea = new $n(new Array(0), Hn, 0, 19, 7));
        })(),
        (pa = !0)),
        (t.l_desc = new ia(t.dyn_ltree, Qn)),
        (t.d_desc = new ia(t.dyn_dtree, ta)),
        (t.bl_desc = new ia(t.bl_tree, ea)),
        (t.bi_buf = 0),
        (t.bi_valid = 0),
        la(t);
    },
    va = (t, e, i, s) => {
      let r,
        n,
        a = 0;
      t.level > 0
        ? (2 === t.strm.data_type &&
            (t.strm.data_type = ((t) => {
              let e,
                i = 4093624447;
              for (e = 0; e <= 31; e++, i >>>= 1)
                if (1 & i && 0 !== t.dyn_ltree[2 * e]) return 0;
              if (
                0 !== t.dyn_ltree[18] ||
                0 !== t.dyn_ltree[20] ||
                0 !== t.dyn_ltree[26]
              )
                return 1;
              for (e = 32; e < zn; e++) if (0 !== t.dyn_ltree[2 * e]) return 1;
              return 0;
            })(t)),
          ga(t, t.l_desc),
          ga(t, t.d_desc),
          (a = ((t) => {
            let e;
            for (
              ba(t, t.dyn_ltree, t.l_desc.max_code),
                ba(t, t.dyn_dtree, t.d_desc.max_code),
                ga(t, t.bl_desc),
                e = 18;
              e >= 3 && 0 === t.bl_tree[2 * qn[e] + 1];
              e--
            );
            return (t.opt_len += 3 * (e + 1) + 5 + 5 + 4), e;
          })(t)),
          (r = (t.opt_len + 3 + 7) >>> 3),
          (n = (t.static_len + 3 + 7) >>> 3),
          n <= r && (r = n))
        : (r = n = i + 5),
        i + 4 <= r && -1 !== e
          ? ma(t, e, i, s)
          : 4 === t.strategy || n === r
          ? (na(t, 2 + (s ? 1 : 0), 3), fa(t, Vn, Xn))
          : (na(t, 4 + (s ? 1 : 0), 3),
            ((t, e, i, s) => {
              let r;
              for (
                na(t, e - 257, 5), na(t, i - 1, 5), na(t, s - 4, 4), r = 0;
                r < s;
                r++
              )
                na(t, t.bl_tree[2 * qn[r] + 1], 3);
              _a(t, t.dyn_ltree, e - 1), _a(t, t.dyn_dtree, i - 1);
            })(t, t.l_desc.max_code + 1, t.d_desc.max_code + 1, a + 1),
            fa(t, t.dyn_ltree, t.dyn_dtree)),
        la(t),
        s && ua(t);
    },
    Ta = (t, e, i) => (
      (t.pending_buf[t.sym_buf + t.sym_next++] = e),
      (t.pending_buf[t.sym_buf + t.sym_next++] = e >> 8),
      (t.pending_buf[t.sym_buf + t.sym_next++] = i),
      0 === e
        ? t.dyn_ltree[2 * i]++
        : (t.matches++,
          e--,
          t.dyn_ltree[2 * (Wn[i] + zn + 1)]++,
          t.dyn_dtree[2 * sa(e)]++),
      t.sym_next === t.sym_end
    ),
    wa = {
      _tr_init: xa,
      _tr_stored_block: ma,
      _tr_flush_block: va,
      _tr_tally: Ta,
      _tr_align: (t) => {
        na(t, 2, 3),
          aa(t, 256, Vn),
          ((t) => {
            16 === t.bi_valid
              ? (ra(t, t.bi_buf), (t.bi_buf = 0), (t.bi_valid = 0))
              : t.bi_valid >= 8 &&
                ((t.pending_buf[t.pending++] = 255 & t.bi_buf),
                (t.bi_buf >>= 8),
                (t.bi_valid -= 8));
          })(t);
      },
    };
  var ya = (t, e, i, s) => {
    let r = (65535 & t) | 0,
      n = ((t >>> 16) & 65535) | 0,
      a = 0;
    for (; 0 !== i; ) {
      (a = i > 2e3 ? 2e3 : i), (i -= a);
      do {
        (r = (r + e[s++]) | 0), (n = (n + r) | 0);
      } while (--a);
      (r %= 65521), (n %= 65521);
    }
    return r | (n << 16) | 0;
  };
  const Aa = new Uint32Array(
    (() => {
      let t,
        e = [];
      for (var i = 0; i < 256; i++) {
        t = i;
        for (var s = 0; s < 8; s++)
          t = 1 & t ? 3988292384 ^ (t >>> 1) : t >>> 1;
        e[i] = t;
      }
      return e;
    })()
  );
  var Ea = (t, e, i, s) => {
      const r = Aa,
        n = s + i;
      t ^= -1;
      for (let i = s; i < n; i++) t = (t >>> 8) ^ r[255 & (t ^ e[i])];
      return -1 ^ t;
    },
    Ma = {
      2: "need dictionary",
      1: "stream end",
      0: "",
      "-1": "file error",
      "-2": "stream error",
      "-3": "data error",
      "-4": "insufficient memory",
      "-5": "buffer error",
      "-6": "incompatible version",
    },
    Ca = {
      Z_NO_FLUSH: 0,
      Z_PARTIAL_FLUSH: 1,
      Z_SYNC_FLUSH: 2,
      Z_FULL_FLUSH: 3,
      Z_FINISH: 4,
      Z_BLOCK: 5,
      Z_TREES: 6,
      Z_OK: 0,
      Z_STREAM_END: 1,
      Z_NEED_DICT: 2,
      Z_ERRNO: -1,
      Z_STREAM_ERROR: -2,
      Z_DATA_ERROR: -3,
      Z_MEM_ERROR: -4,
      Z_BUF_ERROR: -5,
      Z_NO_COMPRESSION: 0,
      Z_BEST_SPEED: 1,
      Z_BEST_COMPRESSION: 9,
      Z_DEFAULT_COMPRESSION: -1,
      Z_FILTERED: 1,
      Z_HUFFMAN_ONLY: 2,
      Z_RLE: 3,
      Z_FIXED: 4,
      Z_DEFAULT_STRATEGY: 0,
      Z_BINARY: 0,
      Z_TEXT: 1,
      Z_UNKNOWN: 2,
      Z_DEFLATED: 8,
    };
  const {
      _tr_init: Sa,
      _tr_stored_block: Fa,
      _tr_flush_block: Ia,
      _tr_tally: ka,
      _tr_align: Da,
    } = wa,
    {
      Z_NO_FLUSH: Ra,
      Z_PARTIAL_FLUSH: Ua,
      Z_FULL_FLUSH: Oa,
      Z_FINISH: Ba,
      Z_BLOCK: Pa,
      Z_OK: za,
      Z_STREAM_END: Na,
      Z_STREAM_ERROR: Ga,
      Z_DATA_ERROR: La,
      Z_BUF_ERROR: ja,
      Z_DEFAULT_COMPRESSION: Ya,
      Z_FILTERED: Ha,
      Z_HUFFMAN_ONLY: qa,
      Z_RLE: Va,
      Z_FIXED: Xa,
      Z_DEFAULT_STRATEGY: Ka,
      Z_UNKNOWN: Wa,
      Z_DEFLATED: Za,
    } = Ca,
    Ja = 258,
    $a = 262,
    Qa = 42,
    to = 113,
    eo = 666,
    io = (t, e) => ((t.msg = Ma[e]), e),
    so = (t) => 2 * t - (t > 4 ? 9 : 0),
    ro = (t) => {
      let e = t.length;
      for (; --e >= 0; ) t[e] = 0;
    },
    no = (t) => {
      let e,
        i,
        s,
        r = t.w_size;
      (e = t.hash_size), (s = e);
      do {
        (i = t.head[--s]), (t.head[s] = i >= r ? i - r : 0);
      } while (--e);
      (e = r), (s = e);
      do {
        (i = t.prev[--s]), (t.prev[s] = i >= r ? i - r : 0);
      } while (--e);
    };
  let ao = (t, e, i) => ((e << t.hash_shift) ^ i) & t.hash_mask;
  const oo = (t) => {
      const e = t.state;
      let i = e.pending;
      i > t.avail_out && (i = t.avail_out),
        0 !== i &&
          (t.output.set(
            e.pending_buf.subarray(e.pending_out, e.pending_out + i),
            t.next_out
          ),
          (t.next_out += i),
          (e.pending_out += i),
          (t.total_out += i),
          (t.avail_out -= i),
          (e.pending -= i),
          0 === e.pending && (e.pending_out = 0));
    },
    ho = (t, e) => {
      Ia(
        t,
        t.block_start >= 0 ? t.block_start : -1,
        t.strstart - t.block_start,
        e
      ),
        (t.block_start = t.strstart),
        oo(t.strm);
    },
    lo = (t, e) => {
      t.pending_buf[t.pending++] = e;
    },
    uo = (t, e) => {
      (t.pending_buf[t.pending++] = (e >>> 8) & 255),
        (t.pending_buf[t.pending++] = 255 & e);
    },
    co = (t, e, i, s) => {
      let r = t.avail_in;
      return (
        r > s && (r = s),
        0 === r
          ? 0
          : ((t.avail_in -= r),
            e.set(t.input.subarray(t.next_in, t.next_in + r), i),
            1 === t.state.wrap
              ? (t.adler = ya(t.adler, e, r, i))
              : 2 === t.state.wrap && (t.adler = Ea(t.adler, e, r, i)),
            (t.next_in += r),
            (t.total_in += r),
            r)
      );
    },
    fo = (t, e) => {
      let i,
        s,
        r = t.max_chain_length,
        n = t.strstart,
        a = t.prev_length,
        o = t.nice_match;
      const h = t.strstart > t.w_size - $a ? t.strstart - (t.w_size - $a) : 0,
        l = t.window,
        u = t.w_mask,
        c = t.prev,
        d = t.strstart + Ja;
      let f = l[n + a - 1],
        g = l[n + a];
      t.prev_length >= t.good_match && (r >>= 2),
        o > t.lookahead && (o = t.lookahead);
      do {
        if (
          ((i = e),
          l[i + a] === g &&
            l[i + a - 1] === f &&
            l[i] === l[n] &&
            l[++i] === l[n + 1])
        ) {
          (n += 2), i++;
          do {} while (
            l[++n] === l[++i] &&
            l[++n] === l[++i] &&
            l[++n] === l[++i] &&
            l[++n] === l[++i] &&
            l[++n] === l[++i] &&
            l[++n] === l[++i] &&
            l[++n] === l[++i] &&
            l[++n] === l[++i] &&
            n < d
          );
          if (((s = Ja - (d - n)), (n = d - Ja), s > a)) {
            if (((t.match_start = e), (a = s), s >= o)) break;
            (f = l[n + a - 1]), (g = l[n + a]);
          }
        }
      } while ((e = c[e & u]) > h && 0 != --r);
      return a <= t.lookahead ? a : t.lookahead;
    },
    go = (t) => {
      const e = t.w_size;
      let i, s, r;
      do {
        if (
          ((s = t.window_size - t.lookahead - t.strstart),
          t.strstart >= e + (e - $a) &&
            (t.window.set(t.window.subarray(e, e + e - s), 0),
            (t.match_start -= e),
            (t.strstart -= e),
            (t.block_start -= e),
            t.insert > t.strstart && (t.insert = t.strstart),
            no(t),
            (s += e)),
          0 === t.strm.avail_in)
        )
          break;
        if (
          ((i = co(t.strm, t.window, t.strstart + t.lookahead, s)),
          (t.lookahead += i),
          t.lookahead + t.insert >= 3)
        )
          for (
            r = t.strstart - t.insert,
              t.ins_h = t.window[r],
              t.ins_h = ao(t, t.ins_h, t.window[r + 1]);
            t.insert &&
            ((t.ins_h = ao(t, t.ins_h, t.window[r + 3 - 1])),
            (t.prev[r & t.w_mask] = t.head[t.ins_h]),
            (t.head[t.ins_h] = r),
            r++,
            t.insert--,
            !(t.lookahead + t.insert < 3));

          );
      } while (t.lookahead < $a && 0 !== t.strm.avail_in);
    },
    bo = (t, e) => {
      let i,
        s,
        r,
        n =
          t.pending_buf_size - 5 > t.w_size ? t.w_size : t.pending_buf_size - 5,
        a = 0,
        o = t.strm.avail_in;
      do {
        if (((i = 65535), (r = (t.bi_valid + 42) >> 3), t.strm.avail_out < r))
          break;
        if (
          ((r = t.strm.avail_out - r),
          (s = t.strstart - t.block_start),
          i > s + t.strm.avail_in && (i = s + t.strm.avail_in),
          i > r && (i = r),
          i < n &&
            ((0 === i && e !== Ba) || e === Ra || i !== s + t.strm.avail_in))
        )
          break;
        (a = e === Ba && i === s + t.strm.avail_in ? 1 : 0),
          Fa(t, 0, 0, a),
          (t.pending_buf[t.pending - 4] = i),
          (t.pending_buf[t.pending - 3] = i >> 8),
          (t.pending_buf[t.pending - 2] = ~i),
          (t.pending_buf[t.pending - 1] = ~i >> 8),
          oo(t.strm),
          s &&
            (s > i && (s = i),
            t.strm.output.set(
              t.window.subarray(t.block_start, t.block_start + s),
              t.strm.next_out
            ),
            (t.strm.next_out += s),
            (t.strm.avail_out -= s),
            (t.strm.total_out += s),
            (t.block_start += s),
            (i -= s)),
          i &&
            (co(t.strm, t.strm.output, t.strm.next_out, i),
            (t.strm.next_out += i),
            (t.strm.avail_out -= i),
            (t.strm.total_out += i));
      } while (0 === a);
      return (
        (o -= t.strm.avail_in),
        o &&
          (o >= t.w_size
            ? ((t.matches = 2),
              t.window.set(
                t.strm.input.subarray(
                  t.strm.next_in - t.w_size,
                  t.strm.next_in
                ),
                0
              ),
              (t.strstart = t.w_size),
              (t.insert = t.strstart))
            : (t.window_size - t.strstart <= o &&
                ((t.strstart -= t.w_size),
                t.window.set(
                  t.window.subarray(t.w_size, t.w_size + t.strstart),
                  0
                ),
                t.matches < 2 && t.matches++,
                t.insert > t.strstart && (t.insert = t.strstart)),
              t.window.set(
                t.strm.input.subarray(t.strm.next_in - o, t.strm.next_in),
                t.strstart
              ),
              (t.strstart += o),
              (t.insert += o > t.w_size - t.insert ? t.w_size - t.insert : o)),
          (t.block_start = t.strstart)),
        t.high_water < t.strstart && (t.high_water = t.strstart),
        a
          ? 4
          : e !== Ra &&
            e !== Ba &&
            0 === t.strm.avail_in &&
            t.strstart === t.block_start
          ? 2
          : ((r = t.window_size - t.strstart),
            t.strm.avail_in > r &&
              t.block_start >= t.w_size &&
              ((t.block_start -= t.w_size),
              (t.strstart -= t.w_size),
              t.window.set(
                t.window.subarray(t.w_size, t.w_size + t.strstart),
                0
              ),
              t.matches < 2 && t.matches++,
              (r += t.w_size),
              t.insert > t.strstart && (t.insert = t.strstart)),
            r > t.strm.avail_in && (r = t.strm.avail_in),
            r &&
              (co(t.strm, t.window, t.strstart, r),
              (t.strstart += r),
              (t.insert += r > t.w_size - t.insert ? t.w_size - t.insert : r)),
            t.high_water < t.strstart && (t.high_water = t.strstart),
            (r = (t.bi_valid + 42) >> 3),
            (r =
              t.pending_buf_size - r > 65535 ? 65535 : t.pending_buf_size - r),
            (n = r > t.w_size ? t.w_size : r),
            (s = t.strstart - t.block_start),
            (s >= n ||
              ((s || e === Ba) &&
                e !== Ra &&
                0 === t.strm.avail_in &&
                s <= r)) &&
              ((i = s > r ? r : s),
              (a = e === Ba && 0 === t.strm.avail_in && i === s ? 1 : 0),
              Fa(t, t.block_start, i, a),
              (t.block_start += i),
              oo(t.strm)),
            a ? 3 : 1)
      );
    },
    _o = (t, e) => {
      let i, s;
      for (;;) {
        if (t.lookahead < $a) {
          if ((go(t), t.lookahead < $a && e === Ra)) return 1;
          if (0 === t.lookahead) break;
        }
        if (
          ((i = 0),
          t.lookahead >= 3 &&
            ((t.ins_h = ao(t, t.ins_h, t.window[t.strstart + 3 - 1])),
            (i = t.prev[t.strstart & t.w_mask] = t.head[t.ins_h]),
            (t.head[t.ins_h] = t.strstart)),
          0 !== i &&
            t.strstart - i <= t.w_size - $a &&
            (t.match_length = fo(t, i)),
          t.match_length >= 3)
        )
          if (
            ((s = ka(t, t.strstart - t.match_start, t.match_length - 3)),
            (t.lookahead -= t.match_length),
            t.match_length <= t.max_lazy_match && t.lookahead >= 3)
          ) {
            t.match_length--;
            do {
              t.strstart++,
                (t.ins_h = ao(t, t.ins_h, t.window[t.strstart + 3 - 1])),
                (i = t.prev[t.strstart & t.w_mask] = t.head[t.ins_h]),
                (t.head[t.ins_h] = t.strstart);
            } while (0 != --t.match_length);
            t.strstart++;
          } else
            (t.strstart += t.match_length),
              (t.match_length = 0),
              (t.ins_h = t.window[t.strstart]),
              (t.ins_h = ao(t, t.ins_h, t.window[t.strstart + 1]));
        else (s = ka(t, 0, t.window[t.strstart])), t.lookahead--, t.strstart++;
        if (s && (ho(t, !1), 0 === t.strm.avail_out)) return 1;
      }
      return (
        (t.insert = t.strstart < 2 ? t.strstart : 2),
        e === Ba
          ? (ho(t, !0), 0 === t.strm.avail_out ? 3 : 4)
          : t.sym_next && (ho(t, !1), 0 === t.strm.avail_out)
          ? 1
          : 2
      );
    },
    po = (t, e) => {
      let i, s, r;
      for (;;) {
        if (t.lookahead < $a) {
          if ((go(t), t.lookahead < $a && e === Ra)) return 1;
          if (0 === t.lookahead) break;
        }
        if (
          ((i = 0),
          t.lookahead >= 3 &&
            ((t.ins_h = ao(t, t.ins_h, t.window[t.strstart + 3 - 1])),
            (i = t.prev[t.strstart & t.w_mask] = t.head[t.ins_h]),
            (t.head[t.ins_h] = t.strstart)),
          (t.prev_length = t.match_length),
          (t.prev_match = t.match_start),
          (t.match_length = 2),
          0 !== i &&
            t.prev_length < t.max_lazy_match &&
            t.strstart - i <= t.w_size - $a &&
            ((t.match_length = fo(t, i)),
            t.match_length <= 5 &&
              (t.strategy === Ha ||
                (3 === t.match_length && t.strstart - t.match_start > 4096)) &&
              (t.match_length = 2)),
          t.prev_length >= 3 && t.match_length <= t.prev_length)
        ) {
          (r = t.strstart + t.lookahead - 3),
            (s = ka(t, t.strstart - 1 - t.prev_match, t.prev_length - 3)),
            (t.lookahead -= t.prev_length - 1),
            (t.prev_length -= 2);
          do {
            ++t.strstart <= r &&
              ((t.ins_h = ao(t, t.ins_h, t.window[t.strstart + 3 - 1])),
              (i = t.prev[t.strstart & t.w_mask] = t.head[t.ins_h]),
              (t.head[t.ins_h] = t.strstart));
          } while (0 != --t.prev_length);
          if (
            ((t.match_available = 0),
            (t.match_length = 2),
            t.strstart++,
            s && (ho(t, !1), 0 === t.strm.avail_out))
          )
            return 1;
        } else if (t.match_available) {
          if (
            ((s = ka(t, 0, t.window[t.strstart - 1])),
            s && ho(t, !1),
            t.strstart++,
            t.lookahead--,
            0 === t.strm.avail_out)
          )
            return 1;
        } else (t.match_available = 1), t.strstart++, t.lookahead--;
      }
      return (
        t.match_available &&
          ((s = ka(t, 0, t.window[t.strstart - 1])), (t.match_available = 0)),
        (t.insert = t.strstart < 2 ? t.strstart : 2),
        e === Ba
          ? (ho(t, !0), 0 === t.strm.avail_out ? 3 : 4)
          : t.sym_next && (ho(t, !1), 0 === t.strm.avail_out)
          ? 1
          : 2
      );
    };
  function mo(t, e, i, s, r) {
    (this.good_length = t),
      (this.max_lazy = e),
      (this.nice_length = i),
      (this.max_chain = s),
      (this.func = r);
  }
  const xo = [
    new mo(0, 0, 0, 0, bo),
    new mo(4, 4, 8, 4, _o),
    new mo(4, 5, 16, 8, _o),
    new mo(4, 6, 32, 32, _o),
    new mo(4, 4, 16, 16, po),
    new mo(8, 16, 32, 32, po),
    new mo(8, 16, 128, 128, po),
    new mo(8, 32, 128, 256, po),
    new mo(32, 128, 258, 1024, po),
    new mo(32, 258, 258, 4096, po),
  ];
  function vo() {
    (this.strm = null),
      (this.status = 0),
      (this.pending_buf = null),
      (this.pending_buf_size = 0),
      (this.pending_out = 0),
      (this.pending = 0),
      (this.wrap = 0),
      (this.gzhead = null),
      (this.gzindex = 0),
      (this.method = Za),
      (this.last_flush = -1),
      (this.w_size = 0),
      (this.w_bits = 0),
      (this.w_mask = 0),
      (this.window = null),
      (this.window_size = 0),
      (this.prev = null),
      (this.head = null),
      (this.ins_h = 0),
      (this.hash_size = 0),
      (this.hash_bits = 0),
      (this.hash_mask = 0),
      (this.hash_shift = 0),
      (this.block_start = 0),
      (this.match_length = 0),
      (this.prev_match = 0),
      (this.match_available = 0),
      (this.strstart = 0),
      (this.match_start = 0),
      (this.lookahead = 0),
      (this.prev_length = 0),
      (this.max_chain_length = 0),
      (this.max_lazy_match = 0),
      (this.level = 0),
      (this.strategy = 0),
      (this.good_match = 0),
      (this.nice_match = 0),
      (this.dyn_ltree = new Uint16Array(1146)),
      (this.dyn_dtree = new Uint16Array(122)),
      (this.bl_tree = new Uint16Array(78)),
      ro(this.dyn_ltree),
      ro(this.dyn_dtree),
      ro(this.bl_tree),
      (this.l_desc = null),
      (this.d_desc = null),
      (this.bl_desc = null),
      (this.bl_count = new Uint16Array(16)),
      (this.heap = new Uint16Array(573)),
      ro(this.heap),
      (this.heap_len = 0),
      (this.heap_max = 0),
      (this.depth = new Uint16Array(573)),
      ro(this.depth),
      (this.sym_buf = 0),
      (this.lit_bufsize = 0),
      (this.sym_next = 0),
      (this.sym_end = 0),
      (this.opt_len = 0),
      (this.static_len = 0),
      (this.matches = 0),
      (this.insert = 0),
      (this.bi_buf = 0),
      (this.bi_valid = 0);
  }
  const To = (t) => {
      if (!t) return 1;
      const e = t.state;
      return !e ||
        e.strm !== t ||
        (e.status !== Qa &&
          57 !== e.status &&
          69 !== e.status &&
          73 !== e.status &&
          91 !== e.status &&
          103 !== e.status &&
          e.status !== to &&
          e.status !== eo)
        ? 1
        : 0;
    },
    wo = (t) => {
      if (To(t)) return io(t, Ga);
      (t.total_in = t.total_out = 0), (t.data_type = Wa);
      const e = t.state;
      return (
        (e.pending = 0),
        (e.pending_out = 0),
        e.wrap < 0 && (e.wrap = -e.wrap),
        (e.status = 2 === e.wrap ? 57 : e.wrap ? Qa : to),
        (t.adler = 2 === e.wrap ? 0 : 1),
        (e.last_flush = -2),
        Sa(e),
        za
      );
    },
    yo = (t) => {
      const e = wo(t);
      var i;
      return (
        e === za &&
          (((i = t.state).window_size = 2 * i.w_size),
          ro(i.head),
          (i.max_lazy_match = xo[i.level].max_lazy),
          (i.good_match = xo[i.level].good_length),
          (i.nice_match = xo[i.level].nice_length),
          (i.max_chain_length = xo[i.level].max_chain),
          (i.strstart = 0),
          (i.block_start = 0),
          (i.lookahead = 0),
          (i.insert = 0),
          (i.match_length = i.prev_length = 2),
          (i.match_available = 0),
          (i.ins_h = 0)),
        e
      );
    },
    Ao = (t, e, i, s, r, n) => {
      if (!t) return Ga;
      let a = 1;
      if (
        (e === Ya && (e = 6),
        s < 0 ? ((a = 0), (s = -s)) : s > 15 && ((a = 2), (s -= 16)),
        r < 1 ||
          r > 9 ||
          i !== Za ||
          s < 8 ||
          s > 15 ||
          e < 0 ||
          e > 9 ||
          n < 0 ||
          n > Xa ||
          (8 === s && 1 !== a))
      )
        return io(t, Ga);
      8 === s && (s = 9);
      const o = new vo();
      return (
        (t.state = o),
        (o.strm = t),
        (o.status = Qa),
        (o.wrap = a),
        (o.gzhead = null),
        (o.w_bits = s),
        (o.w_size = 1 << o.w_bits),
        (o.w_mask = o.w_size - 1),
        (o.hash_bits = r + 7),
        (o.hash_size = 1 << o.hash_bits),
        (o.hash_mask = o.hash_size - 1),
        (o.hash_shift = ~~((o.hash_bits + 3 - 1) / 3)),
        (o.window = new Uint8Array(2 * o.w_size)),
        (o.head = new Uint16Array(o.hash_size)),
        (o.prev = new Uint16Array(o.w_size)),
        (o.lit_bufsize = 1 << (r + 6)),
        (o.pending_buf_size = 4 * o.lit_bufsize),
        (o.pending_buf = new Uint8Array(o.pending_buf_size)),
        (o.sym_buf = o.lit_bufsize),
        (o.sym_end = 3 * (o.lit_bufsize - 1)),
        (o.level = e),
        (o.strategy = n),
        (o.method = i),
        yo(t)
      );
    };
  var Eo = (t, e) => {
      if (To(t) || e > Pa || e < 0) return t ? io(t, Ga) : Ga;
      const i = t.state;
      if (
        !t.output ||
        (0 !== t.avail_in && !t.input) ||
        (i.status === eo && e !== Ba)
      )
        return io(t, 0 === t.avail_out ? ja : Ga);
      const s = i.last_flush;
      if (((i.last_flush = e), 0 !== i.pending)) {
        if ((oo(t), 0 === t.avail_out)) return (i.last_flush = -1), za;
      } else if (0 === t.avail_in && so(e) <= so(s) && e !== Ba)
        return io(t, ja);
      if (i.status === eo && 0 !== t.avail_in) return io(t, ja);
      if (
        (i.status === Qa && 0 === i.wrap && (i.status = to), i.status === Qa)
      ) {
        let e = (Za + ((i.w_bits - 8) << 4)) << 8,
          s = -1;
        if (
          ((s =
            i.strategy >= qa || i.level < 2
              ? 0
              : i.level < 6
              ? 1
              : 6 === i.level
              ? 2
              : 3),
          (e |= s << 6),
          0 !== i.strstart && (e |= 32),
          (e += 31 - (e % 31)),
          uo(i, e),
          0 !== i.strstart && (uo(i, t.adler >>> 16), uo(i, 65535 & t.adler)),
          (t.adler = 1),
          (i.status = to),
          oo(t),
          0 !== i.pending)
        )
          return (i.last_flush = -1), za;
      }
      if (57 === i.status)
        if (((t.adler = 0), lo(i, 31), lo(i, 139), lo(i, 8), i.gzhead))
          lo(
            i,
            (i.gzhead.text ? 1 : 0) +
              (i.gzhead.hcrc ? 2 : 0) +
              (i.gzhead.extra ? 4 : 0) +
              (i.gzhead.name ? 8 : 0) +
              (i.gzhead.comment ? 16 : 0)
          ),
            lo(i, 255 & i.gzhead.time),
            lo(i, (i.gzhead.time >> 8) & 255),
            lo(i, (i.gzhead.time >> 16) & 255),
            lo(i, (i.gzhead.time >> 24) & 255),
            lo(i, 9 === i.level ? 2 : i.strategy >= qa || i.level < 2 ? 4 : 0),
            lo(i, 255 & i.gzhead.os),
            i.gzhead.extra &&
              i.gzhead.extra.length &&
              (lo(i, 255 & i.gzhead.extra.length),
              lo(i, (i.gzhead.extra.length >> 8) & 255)),
            i.gzhead.hcrc &&
              (t.adler = Ea(t.adler, i.pending_buf, i.pending, 0)),
            (i.gzindex = 0),
            (i.status = 69);
        else if (
          (lo(i, 0),
          lo(i, 0),
          lo(i, 0),
          lo(i, 0),
          lo(i, 0),
          lo(i, 9 === i.level ? 2 : i.strategy >= qa || i.level < 2 ? 4 : 0),
          lo(i, 3),
          (i.status = to),
          oo(t),
          0 !== i.pending)
        )
          return (i.last_flush = -1), za;
      if (69 === i.status) {
        if (i.gzhead.extra) {
          let e = i.pending,
            s = (65535 & i.gzhead.extra.length) - i.gzindex;
          for (; i.pending + s > i.pending_buf_size; ) {
            let r = i.pending_buf_size - i.pending;
            if (
              (i.pending_buf.set(
                i.gzhead.extra.subarray(i.gzindex, i.gzindex + r),
                i.pending
              ),
              (i.pending = i.pending_buf_size),
              i.gzhead.hcrc &&
                i.pending > e &&
                (t.adler = Ea(t.adler, i.pending_buf, i.pending - e, e)),
              (i.gzindex += r),
              oo(t),
              0 !== i.pending)
            )
              return (i.last_flush = -1), za;
            (e = 0), (s -= r);
          }
          let r = new Uint8Array(i.gzhead.extra);
          i.pending_buf.set(r.subarray(i.gzindex, i.gzindex + s), i.pending),
            (i.pending += s),
            i.gzhead.hcrc &&
              i.pending > e &&
              (t.adler = Ea(t.adler, i.pending_buf, i.pending - e, e)),
            (i.gzindex = 0);
        }
        i.status = 73;
      }
      if (73 === i.status) {
        if (i.gzhead.name) {
          let e,
            s = i.pending;
          do {
            if (i.pending === i.pending_buf_size) {
              if (
                (i.gzhead.hcrc &&
                  i.pending > s &&
                  (t.adler = Ea(t.adler, i.pending_buf, i.pending - s, s)),
                oo(t),
                0 !== i.pending)
              )
                return (i.last_flush = -1), za;
              s = 0;
            }
            (e =
              i.gzindex < i.gzhead.name.length
                ? 255 & i.gzhead.name.charCodeAt(i.gzindex++)
                : 0),
              lo(i, e);
          } while (0 !== e);
          i.gzhead.hcrc &&
            i.pending > s &&
            (t.adler = Ea(t.adler, i.pending_buf, i.pending - s, s)),
            (i.gzindex = 0);
        }
        i.status = 91;
      }
      if (91 === i.status) {
        if (i.gzhead.comment) {
          let e,
            s = i.pending;
          do {
            if (i.pending === i.pending_buf_size) {
              if (
                (i.gzhead.hcrc &&
                  i.pending > s &&
                  (t.adler = Ea(t.adler, i.pending_buf, i.pending - s, s)),
                oo(t),
                0 !== i.pending)
              )
                return (i.last_flush = -1), za;
              s = 0;
            }
            (e =
              i.gzindex < i.gzhead.comment.length
                ? 255 & i.gzhead.comment.charCodeAt(i.gzindex++)
                : 0),
              lo(i, e);
          } while (0 !== e);
          i.gzhead.hcrc &&
            i.pending > s &&
            (t.adler = Ea(t.adler, i.pending_buf, i.pending - s, s));
        }
        i.status = 103;
      }
      if (103 === i.status) {
        if (i.gzhead.hcrc) {
          if (i.pending + 2 > i.pending_buf_size && (oo(t), 0 !== i.pending))
            return (i.last_flush = -1), za;
          lo(i, 255 & t.adler), lo(i, (t.adler >> 8) & 255), (t.adler = 0);
        }
        if (((i.status = to), oo(t), 0 !== i.pending))
          return (i.last_flush = -1), za;
      }
      if (
        0 !== t.avail_in ||
        0 !== i.lookahead ||
        (e !== Ra && i.status !== eo)
      ) {
        let s =
          0 === i.level
            ? bo(i, e)
            : i.strategy === qa
            ? ((t, e) => {
                let i;
                for (;;) {
                  if (0 === t.lookahead && (go(t), 0 === t.lookahead)) {
                    if (e === Ra) return 1;
                    break;
                  }
                  if (
                    ((t.match_length = 0),
                    (i = ka(t, 0, t.window[t.strstart])),
                    t.lookahead--,
                    t.strstart++,
                    i && (ho(t, !1), 0 === t.strm.avail_out))
                  )
                    return 1;
                }
                return (
                  (t.insert = 0),
                  e === Ba
                    ? (ho(t, !0), 0 === t.strm.avail_out ? 3 : 4)
                    : t.sym_next && (ho(t, !1), 0 === t.strm.avail_out)
                    ? 1
                    : 2
                );
              })(i, e)
            : i.strategy === Va
            ? ((t, e) => {
                let i, s, r, n;
                const a = t.window;
                for (;;) {
                  if (t.lookahead <= Ja) {
                    if ((go(t), t.lookahead <= Ja && e === Ra)) return 1;
                    if (0 === t.lookahead) break;
                  }
                  if (
                    ((t.match_length = 0),
                    t.lookahead >= 3 &&
                      t.strstart > 0 &&
                      ((r = t.strstart - 1),
                      (s = a[r]),
                      s === a[++r] && s === a[++r] && s === a[++r]))
                  ) {
                    n = t.strstart + Ja;
                    do {} while (
                      s === a[++r] &&
                      s === a[++r] &&
                      s === a[++r] &&
                      s === a[++r] &&
                      s === a[++r] &&
                      s === a[++r] &&
                      s === a[++r] &&
                      s === a[++r] &&
                      r < n
                    );
                    (t.match_length = Ja - (n - r)),
                      t.match_length > t.lookahead &&
                        (t.match_length = t.lookahead);
                  }
                  if (
                    (t.match_length >= 3
                      ? ((i = ka(t, 1, t.match_length - 3)),
                        (t.lookahead -= t.match_length),
                        (t.strstart += t.match_length),
                        (t.match_length = 0))
                      : ((i = ka(t, 0, t.window[t.strstart])),
                        t.lookahead--,
                        t.strstart++),
                    i && (ho(t, !1), 0 === t.strm.avail_out))
                  )
                    return 1;
                }
                return (
                  (t.insert = 0),
                  e === Ba
                    ? (ho(t, !0), 0 === t.strm.avail_out ? 3 : 4)
                    : t.sym_next && (ho(t, !1), 0 === t.strm.avail_out)
                    ? 1
                    : 2
                );
              })(i, e)
            : xo[i.level].func(i, e);
        if (((3 !== s && 4 !== s) || (i.status = eo), 1 === s || 3 === s))
          return 0 === t.avail_out && (i.last_flush = -1), za;
        if (
          2 === s &&
          (e === Ua
            ? Da(i)
            : e !== Pa &&
              (Fa(i, 0, 0, !1),
              e === Oa &&
                (ro(i.head),
                0 === i.lookahead &&
                  ((i.strstart = 0), (i.block_start = 0), (i.insert = 0)))),
          oo(t),
          0 === t.avail_out)
        )
          return (i.last_flush = -1), za;
      }
      return e !== Ba
        ? za
        : i.wrap <= 0
        ? Na
        : (2 === i.wrap
            ? (lo(i, 255 & t.adler),
              lo(i, (t.adler >> 8) & 255),
              lo(i, (t.adler >> 16) & 255),
              lo(i, (t.adler >> 24) & 255),
              lo(i, 255 & t.total_in),
              lo(i, (t.total_in >> 8) & 255),
              lo(i, (t.total_in >> 16) & 255),
              lo(i, (t.total_in >> 24) & 255))
            : (uo(i, t.adler >>> 16), uo(i, 65535 & t.adler)),
          oo(t),
          i.wrap > 0 && (i.wrap = -i.wrap),
          0 !== i.pending ? za : Na);
    },
    Mo = (t, e) => {
      let i = e.length;
      if (To(t)) return Ga;
      const s = t.state,
        r = s.wrap;
      if (2 === r || (1 === r && s.status !== Qa) || s.lookahead) return Ga;
      if (
        (1 === r && (t.adler = ya(t.adler, e, i, 0)),
        (s.wrap = 0),
        i >= s.w_size)
      ) {
        0 === r &&
          (ro(s.head), (s.strstart = 0), (s.block_start = 0), (s.insert = 0));
        let t = new Uint8Array(s.w_size);
        t.set(e.subarray(i - s.w_size, i), 0), (e = t), (i = s.w_size);
      }
      const n = t.avail_in,
        a = t.next_in,
        o = t.input;
      for (
        t.avail_in = i, t.next_in = 0, t.input = e, go(s);
        s.lookahead >= 3;

      ) {
        let t = s.strstart,
          e = s.lookahead - 2;
        do {
          (s.ins_h = ao(s, s.ins_h, s.window[t + 3 - 1])),
            (s.prev[t & s.w_mask] = s.head[s.ins_h]),
            (s.head[s.ins_h] = t),
            t++;
        } while (--e);
        (s.strstart = t), (s.lookahead = 2), go(s);
      }
      return (
        (s.strstart += s.lookahead),
        (s.block_start = s.strstart),
        (s.insert = s.lookahead),
        (s.lookahead = 0),
        (s.match_length = s.prev_length = 2),
        (s.match_available = 0),
        (t.next_in = a),
        (t.input = o),
        (t.avail_in = n),
        (s.wrap = r),
        za
      );
    },
    Co = {
      deflateInit: (t, e) => Ao(t, e, Za, 15, 8, Ka),
      deflateInit2: Ao,
      deflateReset: yo,
      deflateResetKeep: wo,
      deflateSetHeader: (t, e) =>
        To(t) || 2 !== t.state.wrap ? Ga : ((t.state.gzhead = e), za),
      deflate: Eo,
      deflateEnd: (t) => {
        if (To(t)) return Ga;
        const e = t.state.status;
        return (t.state = null), e === to ? io(t, La) : za;
      },
      deflateSetDictionary: Mo,
      deflateInfo: "pako deflate (from Nodeca project)",
    };
  const So = (t, e) => Object.prototype.hasOwnProperty.call(t, e);
  var Fo = {
    assign: function (t) {
      const e = Array.prototype.slice.call(arguments, 1);
      for (; e.length; ) {
        const i = e.shift();
        if (i) {
          if ("object" != typeof i)
            throw new TypeError(i + "must be non-object");
          for (const e in i) So(i, e) && (t[e] = i[e]);
        }
      }
      return t;
    },
    flattenChunks: (t) => {
      let e = 0;
      for (let i = 0, s = t.length; i < s; i++) e += t[i].length;
      const i = new Uint8Array(e);
      for (let e = 0, s = 0, r = t.length; e < r; e++) {
        let r = t[e];
        i.set(r, s), (s += r.length);
      }
      return i;
    },
  };
  let Io = !0;
  try {
    String.fromCharCode.apply(null, new Uint8Array(1));
  } catch (t) {
    Io = !1;
  }
  const ko = new Uint8Array(256);
  for (let t = 0; t < 256; t++)
    ko[t] =
      t >= 252
        ? 6
        : t >= 248
        ? 5
        : t >= 240
        ? 4
        : t >= 224
        ? 3
        : t >= 192
        ? 2
        : 1;
  ko[254] = ko[254] = 1;
  var Do = {
    string2buf: (t) => {
      if ("function" == typeof TextEncoder && TextEncoder.prototype.encode)
        return new TextEncoder().encode(t);
      let e,
        i,
        s,
        r,
        n,
        a = t.length,
        o = 0;
      for (r = 0; r < a; r++)
        (i = t.charCodeAt(r)),
          55296 == (64512 & i) &&
            r + 1 < a &&
            ((s = t.charCodeAt(r + 1)),
            56320 == (64512 & s) &&
              ((i = 65536 + ((i - 55296) << 10) + (s - 56320)), r++)),
          (o += i < 128 ? 1 : i < 2048 ? 2 : i < 65536 ? 3 : 4);
      for (e = new Uint8Array(o), n = 0, r = 0; n < o; r++)
        (i = t.charCodeAt(r)),
          55296 == (64512 & i) &&
            r + 1 < a &&
            ((s = t.charCodeAt(r + 1)),
            56320 == (64512 & s) &&
              ((i = 65536 + ((i - 55296) << 10) + (s - 56320)), r++)),
          i < 128
            ? (e[n++] = i)
            : i < 2048
            ? ((e[n++] = 192 | (i >>> 6)), (e[n++] = 128 | (63 & i)))
            : i < 65536
            ? ((e[n++] = 224 | (i >>> 12)),
              (e[n++] = 128 | ((i >>> 6) & 63)),
              (e[n++] = 128 | (63 & i)))
            : ((e[n++] = 240 | (i >>> 18)),
              (e[n++] = 128 | ((i >>> 12) & 63)),
              (e[n++] = 128 | ((i >>> 6) & 63)),
              (e[n++] = 128 | (63 & i)));
      return e;
    },
    buf2string: (t, e) => {
      const i = e || t.length;
      if ("function" == typeof TextDecoder && TextDecoder.prototype.decode)
        return new TextDecoder().decode(t.subarray(0, e));
      let s, r;
      const n = new Array(2 * i);
      for (r = 0, s = 0; s < i; ) {
        let e = t[s++];
        if (e < 128) {
          n[r++] = e;
          continue;
        }
        let a = ko[e];
        if (a > 4) (n[r++] = 65533), (s += a - 1);
        else {
          for (e &= 2 === a ? 31 : 3 === a ? 15 : 7; a > 1 && s < i; )
            (e = (e << 6) | (63 & t[s++])), a--;
          a > 1
            ? (n[r++] = 65533)
            : e < 65536
            ? (n[r++] = e)
            : ((e -= 65536),
              (n[r++] = 55296 | ((e >> 10) & 1023)),
              (n[r++] = 56320 | (1023 & e)));
        }
      }
      return ((t, e) => {
        if (e < 65534 && t.subarray && Io)
          return String.fromCharCode.apply(
            null,
            t.length === e ? t : t.subarray(0, e)
          );
        let i = "";
        for (let s = 0; s < e; s++) i += String.fromCharCode(t[s]);
        return i;
      })(n, r);
    },
    utf8border: (t, e) => {
      (e = e || t.length) > t.length && (e = t.length);
      let i = e - 1;
      for (; i >= 0 && 128 == (192 & t[i]); ) i--;
      return i < 0 || 0 === i ? e : i + ko[t[i]] > e ? i : e;
    },
  };
  var Ro = function () {
    (this.input = null),
      (this.next_in = 0),
      (this.avail_in = 0),
      (this.total_in = 0),
      (this.output = null),
      (this.next_out = 0),
      (this.avail_out = 0),
      (this.total_out = 0),
      (this.msg = ""),
      (this.state = null),
      (this.data_type = 2),
      (this.adler = 0);
  };
  const Uo = Object.prototype.toString,
    {
      Z_NO_FLUSH: Oo,
      Z_SYNC_FLUSH: Bo,
      Z_FULL_FLUSH: Po,
      Z_FINISH: zo,
      Z_OK: No,
      Z_STREAM_END: Go,
      Z_DEFAULT_COMPRESSION: Lo,
      Z_DEFAULT_STRATEGY: jo,
      Z_DEFLATED: Yo,
    } = Ca;
  function Ho(t) {
    this.options = Fo.assign(
      {
        level: Lo,
        method: Yo,
        chunkSize: 16384,
        windowBits: 15,
        memLevel: 8,
        strategy: jo,
      },
      t || {}
    );
    let e = this.options;
    e.raw && e.windowBits > 0
      ? (e.windowBits = -e.windowBits)
      : e.gzip && e.windowBits > 0 && e.windowBits < 16 && (e.windowBits += 16),
      (this.err = 0),
      (this.msg = ""),
      (this.ended = !1),
      (this.chunks = []),
      (this.strm = new Ro()),
      (this.strm.avail_out = 0);
    let i = Co.deflateInit2(
      this.strm,
      e.level,
      e.method,
      e.windowBits,
      e.memLevel,
      e.strategy
    );
    if (i !== No) throw new Error(Ma[i]);
    if ((e.header && Co.deflateSetHeader(this.strm, e.header), e.dictionary)) {
      let t;
      if (
        ((t =
          "string" == typeof e.dictionary
            ? Do.string2buf(e.dictionary)
            : "[object ArrayBuffer]" === Uo.call(e.dictionary)
            ? new Uint8Array(e.dictionary)
            : e.dictionary),
        (i = Co.deflateSetDictionary(this.strm, t)),
        i !== No)
      )
        throw new Error(Ma[i]);
      this._dict_set = !0;
    }
  }
  function qo(t, e) {
    const i = new Ho(e);
    if ((i.push(t, !0), i.err)) throw i.msg || Ma[i.err];
    return i.result;
  }
  (Ho.prototype.push = function (t, e) {
    const i = this.strm,
      s = this.options.chunkSize;
    let r, n;
    if (this.ended) return !1;
    for (
      n = e === ~~e ? e : !0 === e ? zo : Oo,
        "string" == typeof t
          ? (i.input = Do.string2buf(t))
          : "[object ArrayBuffer]" === Uo.call(t)
          ? (i.input = new Uint8Array(t))
          : (i.input = t),
        i.next_in = 0,
        i.avail_in = i.input.length;
      ;

    )
      if (
        (0 === i.avail_out &&
          ((i.output = new Uint8Array(s)), (i.next_out = 0), (i.avail_out = s)),
        (n === Bo || n === Po) && i.avail_out <= 6)
      )
        this.onData(i.output.subarray(0, i.next_out)), (i.avail_out = 0);
      else {
        if (((r = Co.deflate(i, n)), r === Go))
          return (
            i.next_out > 0 && this.onData(i.output.subarray(0, i.next_out)),
            (r = Co.deflateEnd(this.strm)),
            this.onEnd(r),
            (this.ended = !0),
            r === No
          );
        if (0 !== i.avail_out) {
          if (n > 0 && i.next_out > 0)
            this.onData(i.output.subarray(0, i.next_out)), (i.avail_out = 0);
          else if (0 === i.avail_in) break;
        } else this.onData(i.output);
      }
    return !0;
  }),
    (Ho.prototype.onData = function (t) {
      this.chunks.push(t);
    }),
    (Ho.prototype.onEnd = function (t) {
      t === No && (this.result = Fo.flattenChunks(this.chunks)),
        (this.chunks = []),
        (this.err = t),
        (this.msg = this.strm.msg);
    });
  var Vo = {
    Deflate: Ho,
    deflate: qo,
    deflateRaw: function (t, e) {
      return ((e = e || {}).raw = !0), qo(t, e);
    },
    gzip: function (t, e) {
      return ((e = e || {}).gzip = !0), qo(t, e);
    },
    constants: Ca,
  };
  const Xo = 16209;
  var Ko = function (t, e) {
    let i, s, r, n, a, o, h, l, u, c, d, f, g, b, _, p, m, x, v, T, w, y, A, E;
    const M = t.state;
    (i = t.next_in),
      (A = t.input),
      (s = i + (t.avail_in - 5)),
      (r = t.next_out),
      (E = t.output),
      (n = r - (e - t.avail_out)),
      (a = r + (t.avail_out - 257)),
      (o = M.dmax),
      (h = M.wsize),
      (l = M.whave),
      (u = M.wnext),
      (c = M.window),
      (d = M.hold),
      (f = M.bits),
      (g = M.lencode),
      (b = M.distcode),
      (_ = (1 << M.lenbits) - 1),
      (p = (1 << M.distbits) - 1);
    t: do {
      f < 15 && ((d += A[i++] << f), (f += 8), (d += A[i++] << f), (f += 8)),
        (m = g[d & _]);
      e: for (;;) {
        if (
          ((x = m >>> 24),
          (d >>>= x),
          (f -= x),
          (x = (m >>> 16) & 255),
          0 === x)
        )
          E[r++] = 65535 & m;
        else {
          if (!(16 & x)) {
            if (0 == (64 & x)) {
              m = g[(65535 & m) + (d & ((1 << x) - 1))];
              continue e;
            }
            if (32 & x) {
              M.mode = 16191;
              break t;
            }
            (t.msg = "invalid literal/length code"), (M.mode = Xo);
            break t;
          }
          (v = 65535 & m),
            (x &= 15),
            x &&
              (f < x && ((d += A[i++] << f), (f += 8)),
              (v += d & ((1 << x) - 1)),
              (d >>>= x),
              (f -= x)),
            f < 15 &&
              ((d += A[i++] << f), (f += 8), (d += A[i++] << f), (f += 8)),
            (m = b[d & p]);
          i: for (;;) {
            if (
              ((x = m >>> 24),
              (d >>>= x),
              (f -= x),
              (x = (m >>> 16) & 255),
              !(16 & x))
            ) {
              if (0 == (64 & x)) {
                m = b[(65535 & m) + (d & ((1 << x) - 1))];
                continue i;
              }
              (t.msg = "invalid distance code"), (M.mode = Xo);
              break t;
            }
            if (
              ((T = 65535 & m),
              (x &= 15),
              f < x &&
                ((d += A[i++] << f),
                (f += 8),
                f < x && ((d += A[i++] << f), (f += 8))),
              (T += d & ((1 << x) - 1)),
              T > o)
            ) {
              (t.msg = "invalid distance too far back"), (M.mode = Xo);
              break t;
            }
            if (((d >>>= x), (f -= x), (x = r - n), T > x)) {
              if (((x = T - x), x > l && M.sane)) {
                (t.msg = "invalid distance too far back"), (M.mode = Xo);
                break t;
              }
              if (((w = 0), (y = c), 0 === u)) {
                if (((w += h - x), x < v)) {
                  v -= x;
                  do {
                    E[r++] = c[w++];
                  } while (--x);
                  (w = r - T), (y = E);
                }
              } else if (u < x) {
                if (((w += h + u - x), (x -= u), x < v)) {
                  v -= x;
                  do {
                    E[r++] = c[w++];
                  } while (--x);
                  if (((w = 0), u < v)) {
                    (x = u), (v -= x);
                    do {
                      E[r++] = c[w++];
                    } while (--x);
                    (w = r - T), (y = E);
                  }
                }
              } else if (((w += u - x), x < v)) {
                v -= x;
                do {
                  E[r++] = c[w++];
                } while (--x);
                (w = r - T), (y = E);
              }
              for (; v > 2; )
                (E[r++] = y[w++]),
                  (E[r++] = y[w++]),
                  (E[r++] = y[w++]),
                  (v -= 3);
              v && ((E[r++] = y[w++]), v > 1 && (E[r++] = y[w++]));
            } else {
              w = r - T;
              do {
                (E[r++] = E[w++]),
                  (E[r++] = E[w++]),
                  (E[r++] = E[w++]),
                  (v -= 3);
              } while (v > 2);
              v && ((E[r++] = E[w++]), v > 1 && (E[r++] = E[w++]));
            }
            break;
          }
        }
        break;
      }
    } while (i < s && r < a);
    (v = f >> 3),
      (i -= v),
      (f -= v << 3),
      (d &= (1 << f) - 1),
      (t.next_in = i),
      (t.next_out = r),
      (t.avail_in = i < s ? s - i + 5 : 5 - (i - s)),
      (t.avail_out = r < a ? a - r + 257 : 257 - (r - a)),
      (M.hold = d),
      (M.bits = f);
  };
  const Wo = 15,
    Zo = new Uint16Array([
      3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31, 35, 43, 51, 59,
      67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0,
    ]),
    Jo = new Uint8Array([
      16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 18, 18, 18, 18, 19, 19,
      19, 19, 20, 20, 20, 20, 21, 21, 21, 21, 16, 72, 78,
    ]),
    $o = new Uint16Array([
      1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193, 257, 385, 513,
      769, 1025, 1537, 2049, 3073, 4097, 6145, 8193, 12289, 16385, 24577, 0, 0,
    ]),
    Qo = new Uint8Array([
      16, 16, 16, 16, 17, 17, 18, 18, 19, 19, 20, 20, 21, 21, 22, 22, 23, 23,
      24, 24, 25, 25, 26, 26, 27, 27, 28, 28, 29, 29, 64, 64,
    ]);
  var th = (t, e, i, s, r, n, a, o) => {
    const h = o.bits;
    let l,
      u,
      c,
      d,
      f,
      g,
      b = 0,
      _ = 0,
      p = 0,
      m = 0,
      x = 0,
      v = 0,
      T = 0,
      w = 0,
      y = 0,
      A = 0,
      E = null;
    const M = new Uint16Array(16),
      C = new Uint16Array(16);
    let S,
      F,
      I,
      k = null;
    for (b = 0; b <= Wo; b++) M[b] = 0;
    for (_ = 0; _ < s; _++) M[e[i + _]]++;
    for (x = h, m = Wo; m >= 1 && 0 === M[m]; m--);
    if ((x > m && (x = m), 0 === m))
      return (r[n++] = 20971520), (r[n++] = 20971520), (o.bits = 1), 0;
    for (p = 1; p < m && 0 === M[p]; p++);
    for (x < p && (x = p), w = 1, b = 1; b <= Wo; b++)
      if (((w <<= 1), (w -= M[b]), w < 0)) return -1;
    if (w > 0 && (0 === t || 1 !== m)) return -1;
    for (C[1] = 0, b = 1; b < Wo; b++) C[b + 1] = C[b] + M[b];
    for (_ = 0; _ < s; _++) 0 !== e[i + _] && (a[C[e[i + _]]++] = _);
    if (
      (0 === t
        ? ((E = k = a), (g = 20))
        : 1 === t
        ? ((E = Zo), (k = Jo), (g = 257))
        : ((E = $o), (k = Qo), (g = 0)),
      (A = 0),
      (_ = 0),
      (b = p),
      (f = n),
      (v = x),
      (T = 0),
      (c = -1),
      (y = 1 << x),
      (d = y - 1),
      (1 === t && y > 852) || (2 === t && y > 592))
    )
      return 1;
    for (;;) {
      (S = b - T),
        a[_] + 1 < g
          ? ((F = 0), (I = a[_]))
          : a[_] >= g
          ? ((F = k[a[_] - g]), (I = E[a[_] - g]))
          : ((F = 96), (I = 0)),
        (l = 1 << (b - T)),
        (u = 1 << v),
        (p = u);
      do {
        (u -= l), (r[f + (A >> T) + u] = (S << 24) | (F << 16) | I | 0);
      } while (0 !== u);
      for (l = 1 << (b - 1); A & l; ) l >>= 1;
      if ((0 !== l ? ((A &= l - 1), (A += l)) : (A = 0), _++, 0 == --M[b])) {
        if (b === m) break;
        b = e[i + a[_]];
      }
      if (b > x && (A & d) !== c) {
        for (
          0 === T && (T = x), f += p, v = b - T, w = 1 << v;
          v + T < m && ((w -= M[v + T]), !(w <= 0));

        )
          v++, (w <<= 1);
        if (((y += 1 << v), (1 === t && y > 852) || (2 === t && y > 592)))
          return 1;
        (c = A & d), (r[c] = (x << 24) | (v << 16) | (f - n) | 0);
      }
    }
    return (
      0 !== A && (r[f + A] = ((b - T) << 24) | (64 << 16) | 0), (o.bits = x), 0
    );
  };
  const {
      Z_FINISH: eh,
      Z_BLOCK: ih,
      Z_TREES: sh,
      Z_OK: rh,
      Z_STREAM_END: nh,
      Z_NEED_DICT: ah,
      Z_STREAM_ERROR: oh,
      Z_DATA_ERROR: hh,
      Z_MEM_ERROR: lh,
      Z_BUF_ERROR: uh,
      Z_DEFLATED: ch,
    } = Ca,
    dh = 16180,
    fh = 16190,
    gh = 16191,
    bh = 16192,
    _h = 16194,
    ph = 16199,
    mh = 16200,
    xh = 16206,
    vh = 16209,
    Th = (t) =>
      ((t >>> 24) & 255) +
      ((t >>> 8) & 65280) +
      ((65280 & t) << 8) +
      ((255 & t) << 24);
  function wh() {
    (this.strm = null),
      (this.mode = 0),
      (this.last = !1),
      (this.wrap = 0),
      (this.havedict = !1),
      (this.flags = 0),
      (this.dmax = 0),
      (this.check = 0),
      (this.total = 0),
      (this.head = null),
      (this.wbits = 0),
      (this.wsize = 0),
      (this.whave = 0),
      (this.wnext = 0),
      (this.window = null),
      (this.hold = 0),
      (this.bits = 0),
      (this.length = 0),
      (this.offset = 0),
      (this.extra = 0),
      (this.lencode = null),
      (this.distcode = null),
      (this.lenbits = 0),
      (this.distbits = 0),
      (this.ncode = 0),
      (this.nlen = 0),
      (this.ndist = 0),
      (this.have = 0),
      (this.next = null),
      (this.lens = new Uint16Array(320)),
      (this.work = new Uint16Array(288)),
      (this.lendyn = null),
      (this.distdyn = null),
      (this.sane = 0),
      (this.back = 0),
      (this.was = 0);
  }
  const yh = (t) => {
      if (!t) return 1;
      const e = t.state;
      return !e || e.strm !== t || e.mode < dh || e.mode > 16211 ? 1 : 0;
    },
    Ah = (t) => {
      if (yh(t)) return oh;
      const e = t.state;
      return (
        (t.total_in = t.total_out = e.total = 0),
        (t.msg = ""),
        e.wrap && (t.adler = 1 & e.wrap),
        (e.mode = dh),
        (e.last = 0),
        (e.havedict = 0),
        (e.flags = -1),
        (e.dmax = 32768),
        (e.head = null),
        (e.hold = 0),
        (e.bits = 0),
        (e.lencode = e.lendyn = new Int32Array(852)),
        (e.distcode = e.distdyn = new Int32Array(592)),
        (e.sane = 1),
        (e.back = -1),
        rh
      );
    },
    Eh = (t) => {
      if (yh(t)) return oh;
      const e = t.state;
      return (e.wsize = 0), (e.whave = 0), (e.wnext = 0), Ah(t);
    },
    Mh = (t, e) => {
      let i;
      if (yh(t)) return oh;
      const s = t.state;
      return (
        e < 0 ? ((i = 0), (e = -e)) : ((i = 5 + (e >> 4)), e < 48 && (e &= 15)),
        e && (e < 8 || e > 15)
          ? oh
          : (null !== s.window && s.wbits !== e && (s.window = null),
            (s.wrap = i),
            (s.wbits = e),
            Eh(t))
      );
    },
    Ch = (t, e) => {
      if (!t) return oh;
      const i = new wh();
      (t.state = i), (i.strm = t), (i.window = null), (i.mode = dh);
      const s = Mh(t, e);
      return s !== rh && (t.state = null), s;
    };
  let Sh,
    Fh,
    Ih = !0;
  const kh = (t) => {
      if (Ih) {
        (Sh = new Int32Array(512)), (Fh = new Int32Array(32));
        let e = 0;
        for (; e < 144; ) t.lens[e++] = 8;
        for (; e < 256; ) t.lens[e++] = 9;
        for (; e < 280; ) t.lens[e++] = 7;
        for (; e < 288; ) t.lens[e++] = 8;
        for (th(1, t.lens, 0, 288, Sh, 0, t.work, { bits: 9 }), e = 0; e < 32; )
          t.lens[e++] = 5;
        th(2, t.lens, 0, 32, Fh, 0, t.work, { bits: 5 }), (Ih = !1);
      }
      (t.lencode = Sh), (t.lenbits = 9), (t.distcode = Fh), (t.distbits = 5);
    },
    Dh = (t, e, i, s) => {
      let r;
      const n = t.state;
      return (
        null === n.window &&
          ((n.wsize = 1 << n.wbits),
          (n.wnext = 0),
          (n.whave = 0),
          (n.window = new Uint8Array(n.wsize))),
        s >= n.wsize
          ? (n.window.set(e.subarray(i - n.wsize, i), 0),
            (n.wnext = 0),
            (n.whave = n.wsize))
          : ((r = n.wsize - n.wnext),
            r > s && (r = s),
            n.window.set(e.subarray(i - s, i - s + r), n.wnext),
            (s -= r)
              ? (n.window.set(e.subarray(i - s, i), 0),
                (n.wnext = s),
                (n.whave = n.wsize))
              : ((n.wnext += r),
                n.wnext === n.wsize && (n.wnext = 0),
                n.whave < n.wsize && (n.whave += r))),
        0
      );
    };
  var Rh = (t, e) => {
      let i,
        s,
        r,
        n,
        a,
        o,
        h,
        l,
        u,
        c,
        d,
        f,
        g,
        b,
        _,
        p,
        m,
        x,
        v,
        T,
        w,
        y,
        A = 0;
      const E = new Uint8Array(4);
      let M, C;
      const S = new Uint8Array([
        16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15,
      ]);
      if (yh(t) || !t.output || (!t.input && 0 !== t.avail_in)) return oh;
      (i = t.state),
        i.mode === gh && (i.mode = bh),
        (a = t.next_out),
        (r = t.output),
        (h = t.avail_out),
        (n = t.next_in),
        (s = t.input),
        (o = t.avail_in),
        (l = i.hold),
        (u = i.bits),
        (c = o),
        (d = h),
        (y = rh);
      t: for (;;)
        switch (i.mode) {
          case dh:
            if (0 === i.wrap) {
              i.mode = bh;
              break;
            }
            for (; u < 16; ) {
              if (0 === o) break t;
              o--, (l += s[n++] << u), (u += 8);
            }
            if (2 & i.wrap && 35615 === l) {
              0 === i.wbits && (i.wbits = 15),
                (i.check = 0),
                (E[0] = 255 & l),
                (E[1] = (l >>> 8) & 255),
                (i.check = Ea(i.check, E, 2, 0)),
                (l = 0),
                (u = 0),
                (i.mode = 16181);
              break;
            }
            if (
              (i.head && (i.head.done = !1),
              !(1 & i.wrap) || (((255 & l) << 8) + (l >> 8)) % 31)
            ) {
              (t.msg = "incorrect header check"), (i.mode = vh);
              break;
            }
            if ((15 & l) !== ch) {
              (t.msg = "unknown compression method"), (i.mode = vh);
              break;
            }
            if (
              ((l >>>= 4),
              (u -= 4),
              (w = 8 + (15 & l)),
              0 === i.wbits && (i.wbits = w),
              w > 15 || w > i.wbits)
            ) {
              (t.msg = "invalid window size"), (i.mode = vh);
              break;
            }
            (i.dmax = 1 << i.wbits),
              (i.flags = 0),
              (t.adler = i.check = 1),
              (i.mode = 512 & l ? 16189 : gh),
              (l = 0),
              (u = 0);
            break;
          case 16181:
            for (; u < 16; ) {
              if (0 === o) break t;
              o--, (l += s[n++] << u), (u += 8);
            }
            if (((i.flags = l), (255 & i.flags) !== ch)) {
              (t.msg = "unknown compression method"), (i.mode = vh);
              break;
            }
            if (57344 & i.flags) {
              (t.msg = "unknown header flags set"), (i.mode = vh);
              break;
            }
            i.head && (i.head.text = (l >> 8) & 1),
              512 & i.flags &&
                4 & i.wrap &&
                ((E[0] = 255 & l),
                (E[1] = (l >>> 8) & 255),
                (i.check = Ea(i.check, E, 2, 0))),
              (l = 0),
              (u = 0),
              (i.mode = 16182);
          case 16182:
            for (; u < 32; ) {
              if (0 === o) break t;
              o--, (l += s[n++] << u), (u += 8);
            }
            i.head && (i.head.time = l),
              512 & i.flags &&
                4 & i.wrap &&
                ((E[0] = 255 & l),
                (E[1] = (l >>> 8) & 255),
                (E[2] = (l >>> 16) & 255),
                (E[3] = (l >>> 24) & 255),
                (i.check = Ea(i.check, E, 4, 0))),
              (l = 0),
              (u = 0),
              (i.mode = 16183);
          case 16183:
            for (; u < 16; ) {
              if (0 === o) break t;
              o--, (l += s[n++] << u), (u += 8);
            }
            i.head && ((i.head.xflags = 255 & l), (i.head.os = l >> 8)),
              512 & i.flags &&
                4 & i.wrap &&
                ((E[0] = 255 & l),
                (E[1] = (l >>> 8) & 255),
                (i.check = Ea(i.check, E, 2, 0))),
              (l = 0),
              (u = 0),
              (i.mode = 16184);
          case 16184:
            if (1024 & i.flags) {
              for (; u < 16; ) {
                if (0 === o) break t;
                o--, (l += s[n++] << u), (u += 8);
              }
              (i.length = l),
                i.head && (i.head.extra_len = l),
                512 & i.flags &&
                  4 & i.wrap &&
                  ((E[0] = 255 & l),
                  (E[1] = (l >>> 8) & 255),
                  (i.check = Ea(i.check, E, 2, 0))),
                (l = 0),
                (u = 0);
            } else i.head && (i.head.extra = null);
            i.mode = 16185;
          case 16185:
            if (
              1024 & i.flags &&
              ((f = i.length),
              f > o && (f = o),
              f &&
                (i.head &&
                  ((w = i.head.extra_len - i.length),
                  i.head.extra ||
                    (i.head.extra = new Uint8Array(i.head.extra_len)),
                  i.head.extra.set(s.subarray(n, n + f), w)),
                512 & i.flags && 4 & i.wrap && (i.check = Ea(i.check, s, f, n)),
                (o -= f),
                (n += f),
                (i.length -= f)),
              i.length)
            )
              break t;
            (i.length = 0), (i.mode = 16186);
          case 16186:
            if (2048 & i.flags) {
              if (0 === o) break t;
              f = 0;
              do {
                (w = s[n + f++]),
                  i.head &&
                    w &&
                    i.length < 65536 &&
                    (i.head.name += String.fromCharCode(w));
              } while (w && f < o);
              if (
                (512 & i.flags &&
                  4 & i.wrap &&
                  (i.check = Ea(i.check, s, f, n)),
                (o -= f),
                (n += f),
                w)
              )
                break t;
            } else i.head && (i.head.name = null);
            (i.length = 0), (i.mode = 16187);
          case 16187:
            if (4096 & i.flags) {
              if (0 === o) break t;
              f = 0;
              do {
                (w = s[n + f++]),
                  i.head &&
                    w &&
                    i.length < 65536 &&
                    (i.head.comment += String.fromCharCode(w));
              } while (w && f < o);
              if (
                (512 & i.flags &&
                  4 & i.wrap &&
                  (i.check = Ea(i.check, s, f, n)),
                (o -= f),
                (n += f),
                w)
              )
                break t;
            } else i.head && (i.head.comment = null);
            i.mode = 16188;
          case 16188:
            if (512 & i.flags) {
              for (; u < 16; ) {
                if (0 === o) break t;
                o--, (l += s[n++] << u), (u += 8);
              }
              if (4 & i.wrap && l !== (65535 & i.check)) {
                (t.msg = "header crc mismatch"), (i.mode = vh);
                break;
              }
              (l = 0), (u = 0);
            }
            i.head && ((i.head.hcrc = (i.flags >> 9) & 1), (i.head.done = !0)),
              (t.adler = i.check = 0),
              (i.mode = gh);
            break;
          case 16189:
            for (; u < 32; ) {
              if (0 === o) break t;
              o--, (l += s[n++] << u), (u += 8);
            }
            (t.adler = i.check = Th(l)), (l = 0), (u = 0), (i.mode = fh);
          case fh:
            if (0 === i.havedict)
              return (
                (t.next_out = a),
                (t.avail_out = h),
                (t.next_in = n),
                (t.avail_in = o),
                (i.hold = l),
                (i.bits = u),
                ah
              );
            (t.adler = i.check = 1), (i.mode = gh);
          case gh:
            if (e === ih || e === sh) break t;
          case bh:
            if (i.last) {
              (l >>>= 7 & u), (u -= 7 & u), (i.mode = xh);
              break;
            }
            for (; u < 3; ) {
              if (0 === o) break t;
              o--, (l += s[n++] << u), (u += 8);
            }
            switch (((i.last = 1 & l), (l >>>= 1), (u -= 1), 3 & l)) {
              case 0:
                i.mode = 16193;
                break;
              case 1:
                if ((kh(i), (i.mode = ph), e === sh)) {
                  (l >>>= 2), (u -= 2);
                  break t;
                }
                break;
              case 2:
                i.mode = 16196;
                break;
              case 3:
                (t.msg = "invalid block type"), (i.mode = vh);
            }
            (l >>>= 2), (u -= 2);
            break;
          case 16193:
            for (l >>>= 7 & u, u -= 7 & u; u < 32; ) {
              if (0 === o) break t;
              o--, (l += s[n++] << u), (u += 8);
            }
            if ((65535 & l) != ((l >>> 16) ^ 65535)) {
              (t.msg = "invalid stored block lengths"), (i.mode = vh);
              break;
            }
            if (
              ((i.length = 65535 & l),
              (l = 0),
              (u = 0),
              (i.mode = _h),
              e === sh)
            )
              break t;
          case _h:
            i.mode = 16195;
          case 16195:
            if (((f = i.length), f)) {
              if ((f > o && (f = o), f > h && (f = h), 0 === f)) break t;
              r.set(s.subarray(n, n + f), a),
                (o -= f),
                (n += f),
                (h -= f),
                (a += f),
                (i.length -= f);
              break;
            }
            i.mode = gh;
            break;
          case 16196:
            for (; u < 14; ) {
              if (0 === o) break t;
              o--, (l += s[n++] << u), (u += 8);
            }
            if (
              ((i.nlen = 257 + (31 & l)),
              (l >>>= 5),
              (u -= 5),
              (i.ndist = 1 + (31 & l)),
              (l >>>= 5),
              (u -= 5),
              (i.ncode = 4 + (15 & l)),
              (l >>>= 4),
              (u -= 4),
              i.nlen > 286 || i.ndist > 30)
            ) {
              (t.msg = "too many length or distance symbols"), (i.mode = vh);
              break;
            }
            (i.have = 0), (i.mode = 16197);
          case 16197:
            for (; i.have < i.ncode; ) {
              for (; u < 3; ) {
                if (0 === o) break t;
                o--, (l += s[n++] << u), (u += 8);
              }
              (i.lens[S[i.have++]] = 7 & l), (l >>>= 3), (u -= 3);
            }
            for (; i.have < 19; ) i.lens[S[i.have++]] = 0;
            if (
              ((i.lencode = i.lendyn),
              (i.lenbits = 7),
              (M = { bits: i.lenbits }),
              (y = th(0, i.lens, 0, 19, i.lencode, 0, i.work, M)),
              (i.lenbits = M.bits),
              y)
            ) {
              (t.msg = "invalid code lengths set"), (i.mode = vh);
              break;
            }
            (i.have = 0), (i.mode = 16198);
          case 16198:
            for (; i.have < i.nlen + i.ndist; ) {
              for (
                ;
                (A = i.lencode[l & ((1 << i.lenbits) - 1)]),
                  (_ = A >>> 24),
                  (p = (A >>> 16) & 255),
                  (m = 65535 & A),
                  !(_ <= u);

              ) {
                if (0 === o) break t;
                o--, (l += s[n++] << u), (u += 8);
              }
              if (m < 16) (l >>>= _), (u -= _), (i.lens[i.have++] = m);
              else {
                if (16 === m) {
                  for (C = _ + 2; u < C; ) {
                    if (0 === o) break t;
                    o--, (l += s[n++] << u), (u += 8);
                  }
                  if (((l >>>= _), (u -= _), 0 === i.have)) {
                    (t.msg = "invalid bit length repeat"), (i.mode = vh);
                    break;
                  }
                  (w = i.lens[i.have - 1]),
                    (f = 3 + (3 & l)),
                    (l >>>= 2),
                    (u -= 2);
                } else if (17 === m) {
                  for (C = _ + 3; u < C; ) {
                    if (0 === o) break t;
                    o--, (l += s[n++] << u), (u += 8);
                  }
                  (l >>>= _),
                    (u -= _),
                    (w = 0),
                    (f = 3 + (7 & l)),
                    (l >>>= 3),
                    (u -= 3);
                } else {
                  for (C = _ + 7; u < C; ) {
                    if (0 === o) break t;
                    o--, (l += s[n++] << u), (u += 8);
                  }
                  (l >>>= _),
                    (u -= _),
                    (w = 0),
                    (f = 11 + (127 & l)),
                    (l >>>= 7),
                    (u -= 7);
                }
                if (i.have + f > i.nlen + i.ndist) {
                  (t.msg = "invalid bit length repeat"), (i.mode = vh);
                  break;
                }
                for (; f--; ) i.lens[i.have++] = w;
              }
            }
            if (i.mode === vh) break;
            if (0 === i.lens[256]) {
              (t.msg = "invalid code -- missing end-of-block"), (i.mode = vh);
              break;
            }
            if (
              ((i.lenbits = 9),
              (M = { bits: i.lenbits }),
              (y = th(1, i.lens, 0, i.nlen, i.lencode, 0, i.work, M)),
              (i.lenbits = M.bits),
              y)
            ) {
              (t.msg = "invalid literal/lengths set"), (i.mode = vh);
              break;
            }
            if (
              ((i.distbits = 6),
              (i.distcode = i.distdyn),
              (M = { bits: i.distbits }),
              (y = th(2, i.lens, i.nlen, i.ndist, i.distcode, 0, i.work, M)),
              (i.distbits = M.bits),
              y)
            ) {
              (t.msg = "invalid distances set"), (i.mode = vh);
              break;
            }
            if (((i.mode = ph), e === sh)) break t;
          case ph:
            i.mode = mh;
          case mh:
            if (o >= 6 && h >= 258) {
              (t.next_out = a),
                (t.avail_out = h),
                (t.next_in = n),
                (t.avail_in = o),
                (i.hold = l),
                (i.bits = u),
                Ko(t, d),
                (a = t.next_out),
                (r = t.output),
                (h = t.avail_out),
                (n = t.next_in),
                (s = t.input),
                (o = t.avail_in),
                (l = i.hold),
                (u = i.bits),
                i.mode === gh && (i.back = -1);
              break;
            }
            for (
              i.back = 0;
              (A = i.lencode[l & ((1 << i.lenbits) - 1)]),
                (_ = A >>> 24),
                (p = (A >>> 16) & 255),
                (m = 65535 & A),
                !(_ <= u);

            ) {
              if (0 === o) break t;
              o--, (l += s[n++] << u), (u += 8);
            }
            if (p && 0 == (240 & p)) {
              for (
                x = _, v = p, T = m;
                (A = i.lencode[T + ((l & ((1 << (x + v)) - 1)) >> x)]),
                  (_ = A >>> 24),
                  (p = (A >>> 16) & 255),
                  (m = 65535 & A),
                  !(x + _ <= u);

              ) {
                if (0 === o) break t;
                o--, (l += s[n++] << u), (u += 8);
              }
              (l >>>= x), (u -= x), (i.back += x);
            }
            if (
              ((l >>>= _), (u -= _), (i.back += _), (i.length = m), 0 === p)
            ) {
              i.mode = 16205;
              break;
            }
            if (32 & p) {
              (i.back = -1), (i.mode = gh);
              break;
            }
            if (64 & p) {
              (t.msg = "invalid literal/length code"), (i.mode = vh);
              break;
            }
            (i.extra = 15 & p), (i.mode = 16201);
          case 16201:
            if (i.extra) {
              for (C = i.extra; u < C; ) {
                if (0 === o) break t;
                o--, (l += s[n++] << u), (u += 8);
              }
              (i.length += l & ((1 << i.extra) - 1)),
                (l >>>= i.extra),
                (u -= i.extra),
                (i.back += i.extra);
            }
            (i.was = i.length), (i.mode = 16202);
          case 16202:
            for (
              ;
              (A = i.distcode[l & ((1 << i.distbits) - 1)]),
                (_ = A >>> 24),
                (p = (A >>> 16) & 255),
                (m = 65535 & A),
                !(_ <= u);

            ) {
              if (0 === o) break t;
              o--, (l += s[n++] << u), (u += 8);
            }
            if (0 == (240 & p)) {
              for (
                x = _, v = p, T = m;
                (A = i.distcode[T + ((l & ((1 << (x + v)) - 1)) >> x)]),
                  (_ = A >>> 24),
                  (p = (A >>> 16) & 255),
                  (m = 65535 & A),
                  !(x + _ <= u);

              ) {
                if (0 === o) break t;
                o--, (l += s[n++] << u), (u += 8);
              }
              (l >>>= x), (u -= x), (i.back += x);
            }
            if (((l >>>= _), (u -= _), (i.back += _), 64 & p)) {
              (t.msg = "invalid distance code"), (i.mode = vh);
              break;
            }
            (i.offset = m), (i.extra = 15 & p), (i.mode = 16203);
          case 16203:
            if (i.extra) {
              for (C = i.extra; u < C; ) {
                if (0 === o) break t;
                o--, (l += s[n++] << u), (u += 8);
              }
              (i.offset += l & ((1 << i.extra) - 1)),
                (l >>>= i.extra),
                (u -= i.extra),
                (i.back += i.extra);
            }
            if (i.offset > i.dmax) {
              (t.msg = "invalid distance too far back"), (i.mode = vh);
              break;
            }
            i.mode = 16204;
          case 16204:
            if (0 === h) break t;
            if (((f = d - h), i.offset > f)) {
              if (((f = i.offset - f), f > i.whave && i.sane)) {
                (t.msg = "invalid distance too far back"), (i.mode = vh);
                break;
              }
              f > i.wnext
                ? ((f -= i.wnext), (g = i.wsize - f))
                : (g = i.wnext - f),
                f > i.length && (f = i.length),
                (b = i.window);
            } else (b = r), (g = a - i.offset), (f = i.length);
            f > h && (f = h), (h -= f), (i.length -= f);
            do {
              r[a++] = b[g++];
            } while (--f);
            0 === i.length && (i.mode = mh);
            break;
          case 16205:
            if (0 === h) break t;
            (r[a++] = i.length), h--, (i.mode = mh);
            break;
          case xh:
            if (i.wrap) {
              for (; u < 32; ) {
                if (0 === o) break t;
                o--, (l |= s[n++] << u), (u += 8);
              }
              if (
                ((d -= h),
                (t.total_out += d),
                (i.total += d),
                4 & i.wrap &&
                  d &&
                  (t.adler = i.check =
                    i.flags
                      ? Ea(i.check, r, d, a - d)
                      : ya(i.check, r, d, a - d)),
                (d = h),
                4 & i.wrap && (i.flags ? l : Th(l)) !== i.check)
              ) {
                (t.msg = "incorrect data check"), (i.mode = vh);
                break;
              }
              (l = 0), (u = 0);
            }
            i.mode = 16207;
          case 16207:
            if (i.wrap && i.flags) {
              for (; u < 32; ) {
                if (0 === o) break t;
                o--, (l += s[n++] << u), (u += 8);
              }
              if (4 & i.wrap && l !== (4294967295 & i.total)) {
                (t.msg = "incorrect length check"), (i.mode = vh);
                break;
              }
              (l = 0), (u = 0);
            }
            i.mode = 16208;
          case 16208:
            y = nh;
            break t;
          case vh:
            y = hh;
            break t;
          case 16210:
            return lh;
          default:
            return oh;
        }
      return (
        (t.next_out = a),
        (t.avail_out = h),
        (t.next_in = n),
        (t.avail_in = o),
        (i.hold = l),
        (i.bits = u),
        (i.wsize ||
          (d !== t.avail_out && i.mode < vh && (i.mode < xh || e !== eh))) &&
          Dh(t, t.output, t.next_out, d - t.avail_out),
        (c -= t.avail_in),
        (d -= t.avail_out),
        (t.total_in += c),
        (t.total_out += d),
        (i.total += d),
        4 & i.wrap &&
          d &&
          (t.adler = i.check =
            i.flags
              ? Ea(i.check, r, d, t.next_out - d)
              : ya(i.check, r, d, t.next_out - d)),
        (t.data_type =
          i.bits +
          (i.last ? 64 : 0) +
          (i.mode === gh ? 128 : 0) +
          (i.mode === ph || i.mode === _h ? 256 : 0)),
        ((0 === c && 0 === d) || e === eh) && y === rh && (y = uh),
        y
      );
    },
    Uh = {
      inflateReset: Eh,
      inflateReset2: Mh,
      inflateResetKeep: Ah,
      inflateInit: (t) => Ch(t, 15),
      inflateInit2: Ch,
      inflate: Rh,
      inflateEnd: (t) => {
        if (yh(t)) return oh;
        let e = t.state;
        return e.window && (e.window = null), (t.state = null), rh;
      },
      inflateGetHeader: (t, e) => {
        if (yh(t)) return oh;
        const i = t.state;
        return 0 == (2 & i.wrap) ? oh : ((i.head = e), (e.done = !1), rh);
      },
      inflateSetDictionary: (t, e) => {
        const i = e.length;
        let s, r, n;
        return yh(t)
          ? oh
          : ((s = t.state),
            0 !== s.wrap && s.mode !== fh
              ? oh
              : s.mode === fh && ((r = 1), (r = ya(r, e, i, 0)), r !== s.check)
              ? hh
              : ((n = Dh(t, e, i, i)),
                n ? ((s.mode = 16210), lh) : ((s.havedict = 1), rh)));
      },
      inflateInfo: "pako inflate (from Nodeca project)",
    };
  var Oh = function () {
    (this.text = 0),
      (this.time = 0),
      (this.xflags = 0),
      (this.os = 0),
      (this.extra = null),
      (this.extra_len = 0),
      (this.name = ""),
      (this.comment = ""),
      (this.hcrc = 0),
      (this.done = !1);
  };
  const Bh = Object.prototype.toString,
    {
      Z_NO_FLUSH: Ph,
      Z_FINISH: zh,
      Z_OK: Nh,
      Z_STREAM_END: Gh,
      Z_NEED_DICT: Lh,
      Z_STREAM_ERROR: jh,
      Z_DATA_ERROR: Yh,
      Z_MEM_ERROR: Hh,
    } = Ca;
  function qh(t) {
    this.options = Fo.assign(
      { chunkSize: 65536, windowBits: 15, to: "" },
      t || {}
    );
    const e = this.options;
    e.raw &&
      e.windowBits >= 0 &&
      e.windowBits < 16 &&
      ((e.windowBits = -e.windowBits),
      0 === e.windowBits && (e.windowBits = -15)),
      !(e.windowBits >= 0 && e.windowBits < 16) ||
        (t && t.windowBits) ||
        (e.windowBits += 32),
      e.windowBits > 15 &&
        e.windowBits < 48 &&
        0 == (15 & e.windowBits) &&
        (e.windowBits |= 15),
      (this.err = 0),
      (this.msg = ""),
      (this.ended = !1),
      (this.chunks = []),
      (this.strm = new Ro()),
      (this.strm.avail_out = 0);
    let i = Uh.inflateInit2(this.strm, e.windowBits);
    if (i !== Nh) throw new Error(Ma[i]);
    if (
      ((this.header = new Oh()),
      Uh.inflateGetHeader(this.strm, this.header),
      e.dictionary &&
        ("string" == typeof e.dictionary
          ? (e.dictionary = Do.string2buf(e.dictionary))
          : "[object ArrayBuffer]" === Bh.call(e.dictionary) &&
            (e.dictionary = new Uint8Array(e.dictionary)),
        e.raw &&
          ((i = Uh.inflateSetDictionary(this.strm, e.dictionary)), i !== Nh)))
    )
      throw new Error(Ma[i]);
  }
  function Vh(t, e) {
    const i = new qh(e);
    if ((i.push(t), i.err)) throw i.msg || Ma[i.err];
    return i.result;
  }
  (qh.prototype.push = function (t, e) {
    const i = this.strm,
      s = this.options.chunkSize,
      r = this.options.dictionary;
    let n, a, o;
    if (this.ended) return !1;
    for (
      a = e === ~~e ? e : !0 === e ? zh : Ph,
        "[object ArrayBuffer]" === Bh.call(t)
          ? (i.input = new Uint8Array(t))
          : (i.input = t),
        i.next_in = 0,
        i.avail_in = i.input.length;
      ;

    ) {
      for (
        0 === i.avail_out &&
          ((i.output = new Uint8Array(s)), (i.next_out = 0), (i.avail_out = s)),
          n = Uh.inflate(i, a),
          n === Lh &&
            r &&
            ((n = Uh.inflateSetDictionary(i, r)),
            n === Nh ? (n = Uh.inflate(i, a)) : n === Yh && (n = Lh));
        i.avail_in > 0 && n === Gh && i.state.wrap > 0 && 0 !== t[i.next_in];

      )
        Uh.inflateReset(i), (n = Uh.inflate(i, a));
      switch (n) {
        case jh:
        case Yh:
        case Lh:
        case Hh:
          return this.onEnd(n), (this.ended = !0), !1;
      }
      if (((o = i.avail_out), i.next_out && (0 === i.avail_out || n === Gh)))
        if ("string" === this.options.to) {
          let t = Do.utf8border(i.output, i.next_out),
            e = i.next_out - t,
            r = Do.buf2string(i.output, t);
          (i.next_out = e),
            (i.avail_out = s - e),
            e && i.output.set(i.output.subarray(t, t + e), 0),
            this.onData(r);
        } else
          this.onData(
            i.output.length === i.next_out
              ? i.output
              : i.output.subarray(0, i.next_out)
          );
      if (n !== Nh || 0 !== o) {
        if (n === Gh)
          return (
            (n = Uh.inflateEnd(this.strm)), this.onEnd(n), (this.ended = !0), !0
          );
        if (0 === i.avail_in) break;
      }
    }
    return !0;
  }),
    (qh.prototype.onData = function (t) {
      this.chunks.push(t);
    }),
    (qh.prototype.onEnd = function (t) {
      t === Nh &&
        ("string" === this.options.to
          ? (this.result = this.chunks.join(""))
          : (this.result = Fo.flattenChunks(this.chunks))),
        (this.chunks = []),
        (this.err = t),
        (this.msg = this.strm.msg);
    });
  var Xh = {
    Inflate: qh,
    inflate: Vh,
    inflateRaw: function (t, e) {
      return ((e = e || {}).raw = !0), Vh(t, e);
    },
    ungzip: Vh,
    constants: Ca,
  };
  const { Deflate: Kh, deflate: Wh, deflateRaw: Zh, gzip: Jh } = Vo,
    { Inflate: $h, inflate: Qh, inflateRaw: tl, ungzip: el } = Xh;
  var il = Qh;
  class sl {
    constructor(t) {
      var e = this;
      (e.c = t.getUint16()),
        (e.l = t.getUint16()),
        (e.f = t.getUint32()),
        (e.m = t.getUint32()),
        (e.h = t.getUint16()),
        (e.e = t.getUint16()),
        (e.i = t.getUint16()),
        (e.a = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (e.b = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (e.d = t.getInt16()),
        (e.j = t.getUint16()),
        t.getBool() && (e.g = t.getString());
    }
    k() {}
  }
  class rl {
    constructor(t) {
      var e;
      if (
        ((this.l = t.getInt32()),
        (this.q = t.getInt32()),
        (this.n = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (e = t.getInt32()) > 0)
      ) {
        this.r = new Array(e);
        for (let i = 0; i < e; ++i) this.r[i] = t.getInt16();
      }
      if ((e = t.getInt32()) > 0) {
        this.e = new Array(e);
        for (let i = 0; i < e; ++i) this.e[i] = t.getInt16();
      }
      (this.d = new tn(t, qr)),
        (this.a = new tn(t, Xr)),
        (this.j = new tn(t, Kr)),
        (this.h = new tn(t, Kr)),
        (this.b = t.getFloat()),
        (this.i = t.getFloat()),
        (this.f = t.getFloat()),
        (this.o = t.getInt16()),
        (this.p = t.getInt16()),
        (this.m = new tn(t, Xr)),
        (this.k = new tn(t, Wr)),
        (this.g = t.getInt16());
    }
  }
  class nl {
    constructor(t) {
      (this.b = t.getInt32()),
        (this.c = t.getUint32()),
        (this.a = t.getUint32());
    }
  }
  class al {
    constructor(t) {
      (this.f = t.getUint8()),
        (this.m = t.getInt8()),
        (this.d = t.getUint16()),
        (this.i = t.getUint16()),
        (this.k = t.getUint16()),
        (this.g = t.getInt16()),
        (this.l = t.getUint16()),
        (this.a = t.getUint16()),
        (this.j = t.getUint16()),
        (this.h = t.getInt16()),
        (this.b = t.getUint16()),
        (this.e = t.getInt16()),
        (this.c = t.getInt16());
    }
  }
  class ol {
    constructor(t) {
      (this.a = t.getInt16()),
        (this.b = t.getInt16()),
        (this.e = _i(t.getFloat(), t.getFloat(), t.getFloat())),
        (this.g = new tn(t, qr)),
        (this.c = new tn(t, Kr)),
        (this.i = new tn(t, qr)),
        (this.f = new tn(t, Kr)),
        (this.h = new tn(t, Kr)),
        (this.d = new tn(t, Kr)),
        (this.j = new tn(t, Wr));
    }
  }
  const hl = class {
    constructor(t) {
      var e = this;
      (e.a = t.getInt16()),
        (e.b = t.getFloat()),
        (e.e = t.getFloat()),
        (e.c = t.getUint16()),
        (e.d = t.getUint32());
    }
  };
  class ll {
    constructor(t) {
      if (
        ((this.c = []),
        (this.v = []),
        (this.j = []),
        (this.e = []),
        (this.z = []),
        (this.I = []),
        (this.y = []),
        (this.x = []),
        (this.o = []),
        (this.C = []),
        (this.B = []),
        (this.s = []),
        (this.i = []),
        (this.F = []),
        (this.p = []),
        (this.l = []),
        (this.a = []),
        (this.A = []),
        (this.w = []),
        (this.n = []),
        (this.K = []),
        (this.b = []),
        (this.u = []),
        (this.g = []),
        (this.D = []),
        (this.h = []),
        (this.k = []),
        (this.q = []),
        (this.J = []),
        (this.m = []),
        !t)
      )
        return void console.error("Bad buffer for DataView");
      let e = new Bn(t);
      if (604210112 != e.getUint32())
        return void console.log("Bad magic value");
      if (e.getUint32() < 2e3) return void console.log("Bad version");
      this.H = e.getUint32();
      var i = e.getUint32(),
        s = e.getUint32(),
        r = e.getUint32(),
        n = e.getUint32(),
        a = e.getUint32(),
        o = e.getUint32(),
        h = e.getUint32(),
        l = e.getUint32(),
        u = e.getUint32(),
        c = e.getUint32(),
        d = e.getUint32(),
        f = e.getUint32(),
        g = e.getUint32(),
        b = e.getUint32(),
        _ = e.getUint32(),
        p = e.getUint32(),
        m = e.getUint32(),
        x = e.getUint32(),
        v = e.getUint32(),
        T = e.getUint32(),
        w = e.getUint32(),
        y = e.getUint32(),
        A = e.getUint32(),
        E = e.getUint32(),
        M = e.getUint32(),
        C = e.getUint32(),
        S = e.getUint32(),
        F = e.getUint32(),
        I = e.getUint32(),
        k = e.getUint32(),
        D = e.getUint32(),
        R = e.getUint32(),
        U = e.getUint32();
      let O = new Uint8Array(t, e.position),
        B = null;
      try {
        B = il(O);
      } catch (t) {
        return void console.log("Decompression error: " + t);
      }
      if (B.length < U) console.log("Unexpected data size", B.length, U);
      else {
        (e = new Bn(B.buffer)), (e.position = i);
        var P = e.getInt32();
        if (P > 0) {
          this.c = new Array(P);
          for (let t = 0; t < P; ++t) this.c[t] = new Mn(e);
        }
        e.position = s;
        var z = e.getInt32();
        if (z > 0) {
          this.v = new Array(z);
          for (let t = 0; t < z; ++t) this.v[t] = e.getUint16();
        }
        e.position = r;
        var N = e.getInt32();
        if (N > 0) {
          this.j = new Array(N);
          for (let t = 0; t < N; ++t) this.j[t] = e.getUint32();
        }
        e.position = n;
        var G = e.getInt32();
        if (G > 0) {
          this.e = new Array(G);
          for (let t = 0; t < G; ++t) this.e[t] = new sl(e);
        }
        e.position = a;
        var L = e.getInt32();
        if (L > 0) {
          this.z = new Array(L);
          for (let t = 0; t < L; ++t) this.z[t] = e.getInt16();
        }
        e.position = o;
        var j = e.getInt32();
        if (j > 0) {
          this.I = new Array(j);
          for (let t = 0; t < j; ++t) this.I[t] = new On(e);
        }
        e.position = h;
        var Y = e.getInt32();
        if (Y > 0) {
          this.y = new Array(Y);
          for (let t = 0; t < Y; ++t) this.y[t] = e.getInt16();
        }
        e.position = l;
        var H = e.getInt32();
        if (H > 0) {
          this.x = new Array(H);
          for (let t = 0; t < H; ++t) this.x[t] = e.getInt16();
        }
        e.position = u;
        var q = e.getInt32();
        if (q > 0) {
          this.o = new Array(q);
          for (let t = 0; t < q; ++t) this.o[t] = new Cn(e);
        }
        e.position = c;
        var V = e.getInt32();
        if (V > 0) {
          this.C = new Array(V);
          for (let t = 0; t < V; ++t) this.C[t] = new al(e);
        }
        e.position = d;
        var X = e.getInt32();
        if (X > 0) {
          this.B = new Array(X);
          for (let t = 0; t < X; ++t) this.B[t] = e.getInt16();
        }
        e.position = f;
        var K = e.getInt32();
        if (K > 0) {
          this.f = new Array(K);
          for (let t = 0; t < K; ++t) this.f[t] = new Sn(e);
        }
        e.position = g;
        var W = e.getInt32();
        if (W > 0) {
          this.s = new Array(W);
          for (let t = 0; t < W; ++t) this.s[t] = new nl(e);
        }
        e.position = b;
        var Z = e.getInt32();
        if (Z > 0) {
          this.i = new Array(Z);
          for (let t = 0; t < Z; ++t) this.i[t] = e.getInt16();
        }
        e.position = _;
        var J = e.getInt32();
        if (J > 0) {
          this.a = new Array(J);
          for (let t = 0; t < J; ++t) this.a[t] = new Fn(e);
        }
        e.position = p;
        var $ = e.getInt32();
        if ($ > 0) {
          this.A = new Array($);
          for (let t = 0; t < $; ++t) this.A[t] = e.getInt16();
        }
        (e.position = m),
          (this.L = _i(e.getFloat(), e.getFloat(), e.getFloat())),
          (this.d = _i(e.getFloat(), e.getFloat(), e.getFloat())),
          (this.r = e.getFloat()),
          (this.t = _i(e.getFloat(), e.getFloat(), e.getFloat())),
          (this.E = _i(e.getFloat(), e.getFloat(), e.getFloat())),
          (this.G = e.getFloat()),
          (e.position = x);
        var Q = e.getInt32();
        if (Q > 0) {
          this.F = new Array(Q);
          for (let t = 0; t < Q; ++t) this.F[t] = e.getUint16();
        }
        e.position = v;
        var tt = e.getInt32();
        if (tt > 0) {
          this.p = new Array(tt);
          for (let t = 0; t < tt; ++t)
            this.p[t] = _i(e.getFloat(), e.getFloat(), e.getFloat());
        }
        e.position = T;
        var et = e.getInt32();
        if (et > 0) {
          this.l = new Array(et);
          for (let t = 0; t < et; ++t)
            this.l[t] = _i(e.getFloat(), e.getFloat(), e.getFloat());
        }
        e.position = w;
        var it = e.getInt32();
        if (it > 0) {
          this.w = new Array(it);
          for (let t = 0; t < it; ++t) this.w[t] = e.getInt16();
        }
        e.position = y;
        var st = e.getInt32();
        if (st > 0) {
          this.n = new Array(st);
          for (let t = 0; t < st; ++t) this.n[t] = new In(e);
        }
        e.position = A;
        var rt = e.getInt32();
        if (rt > 0) {
          this.K = new Array(rt);
          for (let t = 0; t < rt; ++t) this.K[t] = e.getInt16();
        }
        e.position = E;
        var nt = e.getInt32();
        if (nt > 0) {
          this.b = new Array(nt);
          for (let t = 0; t < nt; ++t) this.b[t] = new kn(e);
        }
        e.position = M;
        var at = e.getInt32();
        if (at > 0) {
          this.u = new Array(at);
          for (let t = 0; t < at; ++t) this.u[t] = new Dn(e);
        }
        e.position = C;
        var ot = e.getInt32();
        if (ot > 0) {
          this.g = new Array(ot);
          for (let t = 0; t < ot; ++t) this.g[t] = e.getInt16();
        }
        e.position = S;
        var ht = e.getInt32();
        if (ht > 0) {
          this.D = new Array(ht);
          for (let t = 0; t < ht; ++t) this.D[t] = new ol(e);
        }
        e.position = F;
        var lt = e.getInt32();
        if (lt > 0) {
          this.h = new Array(lt);
          for (let t = 0; t < lt; ++t) this.h[t] = new Un(e);
        }
        e.position = k;
        var ut = e.getInt32();
        if (ut > 0) {
          this.q = new Array(ut);
          for (let t = 0; t < ut; ++t) this.q[t] = new Rn(e);
        }
        e.position = D;
        var ct = e.getInt32();
        if (ct > 0) {
          this.J = new Array(ct);
          for (let t = 0; t < ut; ++t) this.J[t] = e.getInt16();
        }
        e.position = R;
        var dt = e.getInt32();
        if (dt > 0) {
          this.m = new Array(dt);
          for (let t = 0; t < dt; ++t) this.m[t] = new hl(e);
        }
        e.position = I;
        var ft = e.getInt32();
        if (ft > 0) {
          this.k = new Array(ft);
          for (let t = 0; t < ft; ++t) this.k[t] = new rl(e);
        }
      }
    }
  }
  const ul = class {
    constructor(t) {
      (this.i = t),
        (this.j = new Float32Array([1, 1, 1, 1])),
        (this.e = !1),
        (this.E = !0),
        (this.b = null),
        (this.l = null),
        (this.g = 0),
        (this.B = null),
        (this.t = []),
        (this.f = []),
        (this.d = new Array()),
        (this.c = null),
        (this.z = []),
        (this.q = t.d),
        (this.x = t.j),
        (this.r = !1),
        (this.n = !1),
        (this.p = !1),
        (this.F = As()),
        (this.k = gi()),
        (this.v = Ir());
    }
    C(t) {
      this.b = t;
      const e = t.aC,
        i = this.i;
      (this.l = e.o[this.i.i]), (this.g = this.l.h), Sn.b(this);
      let s = e.i[i.h];
      1 == i.j && s > -1 && 1 == e.s[s].b && ((this.q = -1e3), (this.x = 3));
      for (let s = 0; s < this.x; s++) {
        if (i.h > -1 && i.h < e.i.length) {
          let r = e.i[i.h + s];
          r > -1 && r < e.s.length && this.t.splice(s, 0, t.I[r]);
        }
        if (i.c > -1 && i.c < e.A.length) {
          let t = e.A[i.c + s];
          t > -1 && e.a && t < e.a.length
            ? this.f.splice(s, 0, e.a[t])
            : this.f.splice(s, 0, null);
        }
        if (i.e > -1 && i.e < e.g.length) {
          let t = e.g[i.e + s];
          t > -1 && t < e.u.length
            ? this.z.splice(s, 0, e.u[t])
            : this.z.splice(s, 0, null);
        }
      }
      this.d = new Array(this.f.length);
      for (let t = 0; t < this.d.length; t++) this.d[t] = Pi();
      e.b && i.g > -1 && i.g < e.b.length && (this.c = e.b[i.g]);
    }
    w() {
      this.b.aC;
      let t = Es(this.l.k[0], this.l.k[1], this.l.k[2], 1),
        e = this.b.T[this.l.g].c,
        i = Pi();
      Yi(i, i, this.b.M.viewMatrix),
        Yi(i, i, this.b.aB),
        Yi(i, i, e),
        Rs(t, t, i),
        (t[3] = 0);
      let s = Us(t);
      if ((3 & this.i.f) > 0) {
        let e = As();
        s > 0 ? Is(e, t, 1 / s) : Ms(e, t),
          Is(e, e, bi(_i(i[8], i[9], i[10])) * this.l.f),
          1 & this.i.f ? Fs(e, t, e) : Ss(e, t, e),
          (s = ks(e));
      }
      return s;
    }
    s() {
      this.b, this.b.M.context;
      const t = this.b.ah;
      if (
        ((this.F[0] = this.F[1] = this.F[2] = this.F[3] = 1),
        this.c && this.c.d(t, this.b.q, this.F),
        this.z[0] && (this.F[3] *= this.z[0].d(t, this.b.q)),
        (this.F[3] *= this.b.aj[3]),
        !(this.F[3] <= 0.001))
      ) {
        for (let e = 0; e < this.z.length; e++) {
          const i = this.z[e];
          i && (this.j[e] = i.d(t, this.b.q));
        }
        if (!this.e || this.b.e) {
          const t = this.a();
          let e = !0;
          for (const i of t) {
            const t = i.e;
            e = e && null != t;
          }
          if (((this.e = e), !e)) return;
          (this.D = this.m(!1, !1)),
            (this.y = this.m(!0, !1)),
            (this.h = this.m(!1, !0));
        }
        if (
          (this.f.forEach((e, i) => {
            if (!this.b.G && (Gi(this.d[i]), this.f[i])) {
              let e = !1,
                s = !1;
              this.f[i].b && this.f[i].b.a(t.e.a)
                ? ((this.k = this.f[i].b.c(t, this.b.q)), (s = !0))
                : mi(this.k, 0, 0, 0),
                this.f[i].d && this.f[i].d.a(t.e.a)
                  ? ((this.v = this.f[i].d.c(t, this.b.q)), (e = !0))
                  : Gr(this.v, 0, 0, 0, 1);
              let r,
                n = !1;
              if (
                (this.f[i].a &&
                  this.f[i].a.a(t.e.a) &&
                  ((r = this.f[i].a.c(t, this.b.q)), (n = !0)),
                Gi(this.d[i]),
                Hi(this.d[i], this.d[i], _i(0.5, 0.5, 0)),
                n && qi(this.d[i], this.d[i], r),
                e)
              ) {
                let t = Pi();
                Ki(t, this.v, [0, 0, 0]), Yi(this.d[i], this.d[i], t);
              }
              s && Hi(this.d[i], this.d[i], this.k),
                Hi(this.d[i], this.d[i], _i(-0.5, -0.5, 0));
            }
          }),
          this.e)
        ) {
          (this.F[3] < 1 ? this.y : this.D).d = this.w();
        }
      }
    }
    o(t, e) {
      if (!this.D) return;
      const i = this.b.K.j();
      if (e) i.b(this.h);
      else {
        const e = this.D.g.a() <= Qs.GxBlend_AlphaKey,
          s = null != this.b.gradientEffect,
          r = this.F[3] < 1;
        t && e && (r || s)
          ? (i.b(this.h), i.b(this.y))
          : ((!t && e) || (t && !e)) && i.b(this.D);
      }
    }
    m(t, e) {
      const i = this,
        s = t && i.B.c < 2 ? Qs.GxBlend_Alpha : i.B.c,
        r = [0, 1, 2, 10, 3, 4, 5, 13],
        n = r[s],
        a = this.b.K,
        o = this.b,
        h = Object.assign(Object.assign({}, this.b.af), this.b.l);
      for (let t = 0; t < this.f.length; t++)
        h["uTextureMatrix" + (t + 1).toString()] = this.d[t];
      (h.uColor = this.F),
        (h.uTexSampleAlpha = this.j),
        (h.uBlendMode = n),
        (h.uHasSpecEmiss = o.j[0] && o.j[1]),
        (h.uHasEmissiveGlowing = o.L),
        (h.uUnlit = this.r ? 1 : 0),
        this.b.gradientEffect && (h.u_mulLum_OpaqMat = [0, 1, 0, 0]);
      let l = !this.b.z;
      const u = a.i(
        this.b.p,
        new cn(i.n, l, r[s], !0, !i.p, e ? 0 : 15),
        new us(this.q, i.a(), h, null != this.b.gradientEffect && s <= 2)
      );
      return a.b(new dn(o.H, 2 * i.l.a, i.l.i), u, this.i.a, this.i.m);
    }
    u() {
      return this.t;
    }
    a() {
      const t = [],
        e = this.b;
      return (
        this.t.forEach((i, s) => {
          let r = null;
          i &&
            (-1e3 == this.q
              ? e.j
                ? ((r = e.j[s]), r || (r = { e: null, c: !1 }))
                : (r = { e: null, c: !1 })
              : (r =
                  0 == i.c.b
                    ? i.f
                    : i.c.b > 0 && this.b.F[i.c.b]
                    ? this.b.F[i.c.b]
                    : { e: null, c: !1 }),
            r ||
              (this.t[s].e ||
                (WH.debug(
                  "can't find texture for material",
                  s,
                  "type",
                  this.t[s].type,
                  "index",
                  this.t[s].a
                ),
                (this.t[s].e = !0)),
              (r = { e: this.b.M.greenPixelTexture }))),
            (t[s] = r);
        }),
        t
      );
    }
    get show() {
      return this.E;
    }
    set show(t) {
      this.E = t;
    }
    get meshId() {
      return this.g;
    }
    A() {
      (this.b = null),
        (this.l = null),
        (this.B = null),
        (this.t = null),
        (this.f = null),
        (this.c = null),
        (this.z = null),
        (this.F = null),
        (this.d = null),
        (this.k = null),
        (this.v = null);
    }
  };
  class cl {
    constructor(t, e) {
      (this.c = e), (this.a = t), (this.f = null), (this.e = !1);
    }
    b() {
      this.f && this.f.l(), (this.f = null);
    }
    d(t) {
      0 != this.c.a && (this.f || (this.f = t.getTexture(this.c.a)));
    }
    get type() {
      return this.c.b;
    }
  }
  const dl = function (t, e) {
      const i = Math.abs(t),
        s = Math.abs(e);
      return Number((i - Math.floor(i / s) * s).toPrecision(8)) * Math.sign(t);
    },
    fl = "DressingRoom",
    gl = "Stand";
  class bl {
    constructor() {
      (this.c = null), (this.a = -1), (this.d = Pi()), (this.b = 1);
    }
  }
  class _l {
    constructor(t, e, i) {
      (this.M = t),
        (this.K = e),
        (this.ab = i),
        (this.aI = !1),
        (this.q = []),
        (this.z = !1),
        (this.aL = !0),
        (this.aH = !0),
        (this.G = !1),
        (this.x = !1),
        (this.ah = new Yr()),
        (this.J = null),
        (this.y = 0),
        (this.X = null),
        (this.aq = null),
        (this.F = {}),
        (this.j = []),
        (this.L = !1),
        (this.e = !1),
        (this.ak = 1),
        (this.ai = gi()),
        (this.U = gi()),
        (this.as = null),
        (this.au = null),
        (this.S = new Set()),
        (this.H = null),
        (this.aB = Pi()),
        (this.aw = Pi()),
        (this.R = Pi()),
        (this.az = Pi()),
        (this.aj = Es(1, 1, 1, 1)),
        (this.ag = null),
        (this.l = {}),
        (this.aD = -1),
        (this.Y = !1),
        (this.aA = Pi()),
        (this.o = gi()),
        (this.aE = gi()),
        (this.C = As()),
        (this.a = As()),
        (this.s = !1),
        (this.w = null),
        (this.D = []),
        (this.ah.b = 0),
        (this.ah.e.a = -1),
        this.aM(i);
    }
    f(t) {
      this.D.push(t);
    }
    aM(t) {
      const e = this.M.options.contentPath + "mo3/" + t + ".mo3";
      $.ajax({
        url: e,
        type: "GET",
        dataType: "binary",
        responseType: "arraybuffer",
        processData: !1,
        renderer: this.M,
        success: (t) => {
          this.ao(t);
        },
        error: function (t, e, i) {
          console.log(i);
        },
      });
    }
    ao(t) {
      (this.aC = new ll(t)), this.m();
    }
    O(t) {
      this.ak = t;
    }
    m() {
      const t = this.aC,
        e = t.s.length,
        i = t.I.length,
        s = t.j.length,
        r = t.h.length,
        n = t.k.length;
      this.q = new Array(s);
      for (let t = 0; t < s; ++t) this.q[t] = 0;
      if (i > 0) {
        this.T = new Array(i);
        for (let e = 0; e < i; e++) this.T[e] = new rn(this, e, t.I[e]);
        this.A = new Array(i);
        for (let e = 0; e < i; e++) {
          this.A[e] = [];
          for (let s = 0; s < i; s++) t.I[s].i == e && this.A[e].push(s);
        }
      }
      this.I = new Array();
      for (let i = 0; i < e; i++)
        (this.I[i] = new cl(i, t.s[i])), this.I[i].d(this.M);
      this.Q = new Array(r);
      for (let e = 0; e < r; e++)
        (this.Q[e] = new vn(this, t.h[e])),
          t.q && t.q.length && e < t.q.length && this.Q[e].O(t.q[e]);
      this.W = new Array(n);
      for (let e = 0; e < n; e++) this.W[e] = new En(this, t.k[e]);
      if ((this.J && this.am(this.J), t.C)) {
        const e = t.C.length;
        this.aK = new Array(e);
        for (let i = 0; i < e; ++i)
          (this.aK[i] = new ul(t.C[i])), this.aK[i].C(this);
        this.ar = this.aK.concat();
      }
      this.aC.c &&
        t.v &&
        ((this.as = this.K.o(t.c)),
        (this.au = this.K.l(t.v.length)),
        (this.H = this.K.n(this.as, this.au)),
        this.au.a(new Uint16Array(t.v))),
        (this.p = this.K.f(t.I.length, t.b.length, t.u.length, t.a.length)),
        (this.af = {
          uInvTranspViewModelMat: this.az,
          uModelMatrix: this.aB,
          uDiffuseColor: this.aj,
        }),
        this.ac("Stand");
      for (let t of this.D) t();
      (this.D = []),
        mi(this.aE, this.ak, this.ak, this.ak),
        Gi(this.aB),
        this.s && Xi(this.aB, this.aB, Math.PI / 2),
        qi(this.aB, this.aB, this.aE),
        (this.M.doUpdateBounds = !0),
        (this.aI = !0);
    }
    Z() {
      this.s = !0;
    }
    k(t) {
      const e = this.aC;
      return e && e.e && t > -1 && t < e.e.length
        ? e.e[t].g
        : t == e.e.length
        ? fl
        : "";
    }
    aO() {
      this.ac(gl);
    }
    get isMirrored() {
      return this.i;
    }
    set isMirrored(t) {
      (this.e = this.i != t), (this.i = t);
    }
    u(t, e, i, s = 1) {
      null != t || null != i
        ? (this.w || (this.w = new bl()),
          (this.w.c = t),
          (this.w.a = e),
          i ? zi(this.w.d, i) : Gi(this.w.d),
          (this.w.b = s),
          (this.M.doUpdateBounds = !0))
        : (this.w = null);
    }
    ae() {
      this.M.context;
      this.aC.c &&
        this.aC.v &&
        this.aD != this.M.currFrame &&
        (this.as && this.as.ba(this.T, this.S),
        this.p.a(this.T),
        (this.aD = this.M.currFrame));
    }
    c(t, e, i) {
      const s = [
          _i(t[0], t[1], t[2]),
          _i(t[0], t[1], e[2]),
          _i(t[0], e[1], t[2]),
          _i(t[0], e[1], e[2]),
          _i(e[0], t[1], t[2]),
          _i(e[0], t[1], e[2]),
          _i(e[0], e[1], t[2]),
          _i(e[0], e[1], e[2]),
        ].map((t) => {
          const e = gi();
          return Di(e, t, i), e;
        }),
        r = _i(
          Number.POSITIVE_INFINITY,
          Number.POSITIVE_INFINITY,
          Number.POSITIVE_INFINITY
        ),
        n = _i(
          Number.NEGATIVE_INFINITY,
          Number.NEGATIVE_INFINITY,
          Number.NEGATIVE_INFINITY
        );
      return (
        s.forEach((t) => {
          wi(r, r, t), yi(n, n, t);
        }),
        [r, n]
      );
    }
    al() {
      var t, e, i, s, r, n;
      if (!this.aK) return null;
      let a = this.ai,
        o = this.U;
      return (
        mi(a, 9999, 9999, 999),
        mi(o, -9999, -9999, -9999),
        wi(
          a,
          a,
          null ===
            (i =
              null ===
                (e = null === (t = this.ah) || void 0 === t ? void 0 : t.e) ||
              void 0 === e
                ? void 0
                : e.e) || void 0 === i
            ? void 0
            : i.a
        ),
        yi(
          o,
          o,
          null ===
            (n =
              null ===
                (r = null === (s = this.ah) || void 0 === s ? void 0 : s.e) ||
              void 0 === r
                ? void 0
                : r.e) || void 0 === n
            ? void 0
            : n.b
        ),
        this.c(a, o, this.aB)
      );
    }
    g() {
      const t = this.aC;
      if (!this.aI) return;
      if (this.w) {
        mi(this.aE, this.ak, this.ak, this.ak);
        const t = this.w.c,
          s = this.w;
        if (!t.aI) return;
        Ai(this.aE, this.aE, s.b),
          (e = this.aB),
          (i = this.aE),
          (e[0] = i[0]),
          (e[1] = 0),
          (e[2] = 0),
          (e[3] = 0),
          (e[4] = 0),
          (e[5] = i[1]),
          (e[6] = 0),
          (e[7] = 0),
          (e[8] = 0),
          (e[9] = 0),
          (e[10] = i[2]),
          (e[11] = 0),
          (e[12] = 0),
          (e[13] = 0),
          (e[14] = 0),
          (e[15] = 1),
          Yi(this.aB, s.d, this.aB),
          s.a >= 0 && s.a < t.T.length && Yi(this.aB, t.T[s.a].c, this.aB),
          Yi(this.aB, t.aB, this.aB);
      }
      var e, i;
      Yi(this.aw, this.M.viewMatrix, this.aB),
        ji(this.R, this.aw),
        Li(this.az, this.R),
        this.gradientEffect && this.ap();
      let s = 1e3 * this.M.delta;
      if (!this.G && this.ah.e.a > -1) {
        let e = s;
        for (let i = 0; i < this.q.length; i++)
          (this.q[i] += e), t.j[i] > 0 && (this.q[i] %= t.j[i]);
        this.n(this.ah, e);
      }
      let r = this.aK ? this.aK.length : 0;
      this.S.clear();
      for (let t = 0; t < r; ++t) {
        let e = this.aK[t];
        if (!e.show) continue;
        let i = e.l.i,
          s = e.l.a;
        for (let t = 0; t < i; ++t) this.S.add(this.aC.v[s + t]);
      }
      let n = t.I.length;
      if (this.T) {
        for (let t = 0; t < n; ++t) this.T[t].i = !1;
        for (let t = 0; t < n; ++t) this.T[t].p(s);
        this.ae();
      }
      if (
        (this.aK && this.aK.forEach((t) => t.s()),
        this.ar &&
          this.ar.sort(function (t, e) {
            return t.i.m != e.i.m ? t.i.m - e.i.m : t.meshId - e.meshId;
          }),
        (this.e = !1),
        this.Q && this.aL)
      )
        for (let t = 0; t < this.Q.length; ++t)
          this.Q[t].y(this.ah, this.M.delta);
      if (this.W && this.aH)
        for (let t = 0; t < this.W.length; ++t)
          this.W[t].Y(this.ah, this.M.delta), this.W[t].ap();
    }
    aJ(t, e) {
      (this.F[t] = e), (this.e = !0);
    }
    aF(t, e, i) {
      (this.j = [t, e, i]), (this.e = !0);
    }
    P(t) {
      this.L = t;
    }
    r(t) {
      this.x = !!t;
    }
    V(t) {
      this.aL = !!t;
    }
    aG(t) {
      this.aH = !!t;
    }
    ad(t, e) {
      const i = this;
      if (!i.aI) return;
      let s = 100 * e,
        r = s + rr[e] + t,
        n = i.aK.some((t) => t.meshId == r);
      (r = n ? r : 100 * e + 1), i.ax(s, s + 99, !1), i.ax(r, r, !0);
    }
    ax(t, e, i) {
      const s = this.aC;
      if (!this.aK || 0 == this.aK.length) return !1;
      for (let s = 0; s < this.aK.length; ++s) {
        const r = this.aK[s];
        r.meshId >= t && r.meshId <= e && (r.show = i);
      }
      if (s.J && s.J.length > 0)
        for (let r = 0; r < s.J.length; ++r) {
          let n = s.J[r];
          n >= t && n <= e && (this.Q[r].x = i);
        }
      return !0;
    }
    v(t, e) {
      if (!this.aK) return;
      const i = e + 1;
      let s = t > 0 ? e + t : -2 == t ? e + 0 : i,
        r = this.aK.some((t) => t.meshId == s);
      (s = r || -2 == t ? s : i), this.ax(s, s, !0);
    }
    aa(t) {
      this.G = t;
    }
    B(t) {
      this.aC.e &&
        (this.t(t, this.ah),
        (this.ah.a = !1),
        (this.ah.e.c = !1),
        (this.ah.e.b = 0));
    }
    n(t, e) {
      const i = this.aC;
      if (((t.e.b += e), t.d.a < 0 && !this.x && !t.a))
        if (t.e.e.d > -1) {
          let e = 32767 * Math.random(),
            s = 0,
            r = t.e.a,
            n = i.e[r];
          for (s += n.h; s < e && n.d > -1; )
            (r = n.d), (n = i.e[r]), (s += n.h);
          (t.d.a = r), (t.d.e = i.e[r]), (t.d.b = 0);
        } else {
          let e = i.e.find((e) => e.c == t.e.e.c && 0 == e.l);
          e && ((t.d.a = e.j), (t.d.e = e), (t.d.b = 0));
        }
      let s = t.e,
        r = t.d,
        n = s.e.f - s.b,
        a = 0,
        o = null;
      if (
        (r.a > -1 && ((o = i.e[r.a]), (a = o.e)),
        a > 0 && n < a ? ((r.b = dl(a - n, o.f)), (t.b = n / a)) : (t.b = 1),
        t.f > 0)
      ) {
        let i = e / 1e3;
        (t.c.b += e), (t.f -= i / this.M.crossFadeDuration);
      }
      if (s.b >= s.e.f)
        if (r.a > -1 && !s.c) {
          if (r.a > -1)
            for (
              ;
              0 == (32 & i.e[r.a].m) &&
              (64 & i.e[r.a].m) > 0 &&
              ((r.a = i.e[r.a].j), (r.e = i.e[r.a]), !(r.a < 0));

            );
          (t.e = r), (t.d = new jr()), (t.b = 1);
        } else s.e.f > 0 && (s.b = dl(s.b, s.e.f));
    }
    ac(t, e = !0) {
      this.t(t, this.ah, e);
    }
    t(t, e, i = !0) {
      const s = this.aC;
      let r = !1,
        n = !1;
      const a = t == fl;
      a && ((t = gl), this.r(!0));
      for (let o = 0; o < s.e.length; ++o) {
        const h = s.e[o];
        if (h.g && h.g == t && 0 == h.l) {
          (r = !0),
            i &&
              null != e.e &&
              (null != e.c && (e.f = 1),
              (e.c = new jr()),
              (e.c.a = e.e.a),
              (e.c.e = e.e.e),
              (e.c.b = e.e.b)),
            (n = e.e.a != o),
            (e.e.a = o),
            (e.e.e = h),
            (e.e.b = 0),
            (e.d = new jr()),
            (e.b = 0),
            (e.a = a),
            WH.debug("Set animation to", h.c, h.g);
          break;
        }
      }
      return t == gl || r ? n : this.t(gl, e);
    }
    av(t) {
      this.Y = t;
    }
    an(t) {
      const e = this.aC;
      let i = null;
      if (!e.K || !e.K.length) return null;
      if (t < e.K.length) i = e.n[e.K[t]];
      else
        for (let t = 0; t < e.K.length; t++) {
          const s = e.K[t];
          if (-1 != s) {
            i = e.n[s];
            break;
          }
        }
      return i;
    }
    get gradientEffect() {
      return this.ag;
    }
    set gradientEffect(t) {
      (this.e = !0), (this.ag = t), this.N();
    }
    aN(t) {
      if (this.w) {
        if (!this.w.c.aI) return;
      }
      if (this.as && this.ar)
        if (this.gradientEffect) {
          if (t)
            for (let t = 0; t < this.ar.length; ++t)
              this.ar[t].show && this.ar[t].o(!1, !0);
          for (let e = 0; e < this.ar.length; ++e)
            this.ar[e].show && this.ar[e].o(t, !1);
        } else
          for (let e = 0; e < this.ar.length; ++e)
            this.ar[e].show && this.ar[e].o(t, !1);
      if (this.Q && this.aL)
        for (let e = 0; e < this.Q.length; ++e) this.Q[e].ag(t);
      if (this.W && this.aH)
        for (let e = 0; e < this.W.length; ++e) this.W[e].ae(t);
    }
    E(t) {
      if (this.y == t) return;
      if (this.aI) for (let t = 0; t < this.T.length; t++) this.T[t].g = null;
      if (((this.y = t), t <= 0)) return;
      let e = this.M.options.contentPath + "bone/" + t + ".bone",
        i = this;
      $.ajax({
        url: e,
        type: "GET",
        dataType: "binary",
        responseType: "arraybuffer",
        processData: !1,
        renderer: this.M,
        success: function (t) {
          i.ay(t);
        },
        error: function (t, e, i) {
          console.log(i);
        },
      });
    }
    ay(t) {
      let e = new Bn(t);
      e.getInt32();
      for (; e.position < e.buffer.byteLength; ) {
        let t = String.fromCharCode(
            e.getUint8(),
            e.getUint8(),
            e.getUint8(),
            e.getUint8()
          ),
          i = e.getUint32();
        if ("BIDA" == t) {
          let t = i / 2;
          this.X = new Array(t);
          for (let i = 0; i < t; i++) this.X[i] = e.getUint16();
        }
        if ("BOMT" == t) {
          let t = i / 64;
          this.aq = new Array(t);
          for (let i = 0; i < t; i++) {
            let t = Ni(
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat(),
              e.getFloat()
            );
            this.aq[i] = t;
          }
        }
      }
      this.aI && this.h();
    }
    h() {
      if (!(this.y <= 0) && this.X && this.X.length)
        for (let t = 0; t < this.X.length; t++)
          this.T[this.X[t]].g = this.aq[t];
    }
    N() {
      if (!this.gradientEffect) return;
      const t = this.gradientEffect,
        e = this.l;
      (e.u_gradGradientColors_0 = [...t.Colors0, 0]),
        (e.u_gradGradientColors_1 = [...t.Colors1, 0]),
        (e.u_gradGradientColors_2 = [...t.Colors2, t.Alpha[0]]),
        (e.u_gradEdgeColor = [...t.EdgeColor, t.Alpha[1]]),
        (e.u_gradBoundingBox = [
          this.C[0],
          this.C[1],
          this.C[2],
          1 / (this.U[2] - this.ai[2]),
        ]),
        (e.u_gradUpVec = [this.aE[0], this.aE[1], this.aE[2], 0]),
        (e.u_gradFlags = [
          (1 & t.gradFlags) > 0 ? 1 : 0,
          0.7,
          (4 & t.gradFlags) > 0 ? 1 : 0,
          (8 & t.gradFlags) > 0 ? 1 : 0,
        ]);
    }
    ap() {
      if (!this.gradientEffect) return;
      this.gradientEffect;
      const t = this.l;
      Cs(this.C, this.ai[2], this.ai[2], this.ai[2], 1),
        Rs(this.C, this.C, this.aw),
        Cs(this.a, 0, 0, 1, 0),
        Rs(this.a, this.a, this.az),
        mi(this.aE, this.a[0], this.a[1], this.a[2]),
        Si(this.aE, this.aE),
        (t.u_gradBoundingBox[0] = this.C[0]),
        (t.u_gradBoundingBox[1] = this.C[1]),
        (t.u_gradBoundingBox[2] = this.C[2]),
        (t.u_gradBoundingBox[3] = 1 / (this.U[2] - this.ai[2])),
        (t.u_gradUpVec[0] = this.aE[0]),
        (t.u_gradUpVec[1] = this.aE[1]),
        (t.u_gradUpVec[2] = this.aE[2]);
    }
    at(t) {
      let e = Cr();
      if ((Sr(e, t), this.Q))
        for (let i = 0; i < this.Q.length; i++) this.Q[i].R(t, e);
      if (this.W) for (let e = 0; e < this.W.length; e++) this.W[e].B(t);
    }
    b() {
      return this.w;
    }
    am(t) {
      if (this.Q) for (let e = 0; e < this.Q.length; e++) this.Q[e].l(t);
      this.J = t;
    }
  }
  class pl {
    static c(t, e, i) {
      const s = fr[e];
      if (s) {
        const e = i ? 4 : 0;
        return s.slice(2 * t + e, 2 * t + e + 2);
      }
    }
    static a(t, e, i, s) {
      let r = [
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      ];
      if (!t) return WH.debug("selectBestTexture:", "textures are null"), null;
      for (let n = 0; n < t.length; n++) {
        let a = t[n],
          o = a.Gender,
          h = a.Class,
          l = a.Race,
          u = a.ExtraData,
          c = 0;
        if (e > 1 || o != e) {
          if (o < 2) continue;
          c = 0;
        } else c = 2;
        let d = 1;
        if (i > 0 && h == i) d = 0;
        else if (h > 0) continue;
        let f = 1;
        if (s > 0 && l == s) f = 0;
        else if (l > 0) continue;
        r[u + 3 * (f + 2 * (c + d))] = a.FileDataId;
      }
      for (let t = 0; t < 2; t++)
        for (let e = 0; e < 2; e++)
          for (let i = 0; i < 2; i++) {
            let s = 3 * (t + 2 * (e + 2 * i));
            if (r[s] > 0) {
              let t;
              return (t = { b: r[s], a: r[s + 1], c: r[s + 2] }), t;
            }
          }
      const n = pl.c(e, s, !0);
      return n && 0 != n[0] ? ((s = n[0]), (e = n[1]), pl.a(t, e, i, s)) : null;
    }
    static b(t, e, i, s, r) {
      let n = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
      for (let a = 0; a < t.length; a++) {
        let o = t[a],
          h = o.Gender,
          l = o.Class,
          u = o.Race,
          c = o.ExtraData,
          d = 0;
        if (i > 1 || h != i) {
          if (h < 2) continue;
          d = 0;
        } else d = 2;
        let f = 1;
        if (s > 0 && l == s) f = 0;
        else if (l > 0) continue;
        let g = 1;
        if (r > 0 && u == r) g = 0;
        else if (u > 0) continue;
        let b = 1;
        if (-1 == e || c != e) {
          if (-1 != c && -1 != e) continue;
        } else b = 0;
        n[b + 2 * (g + 2 * (d + f))] = o.FileDataId;
      }
      for (let t = 0; t < 2; t++)
        for (let e = 0; e < 2; e++)
          for (let i = 0; i < 2; i++)
            for (let s = 0; s < 2; s++) {
              let r = s + 2 * (t + 2 * (e + 2 * i));
              if (n[r]) return n[r];
            }
      const a = pl.c(i, r, !1);
      return a && 0 != a[0] ? ((r = a[0]), (i = a[1]), pl.b(t, e, i, s, r)) : 0;
    }
  }
  class ml {
    constructor() {
      (this.d = !1), (this.a = []);
    }
    get loaded() {
      let t = !!this.e && this.e.aI;
      if (t && this.a.length > 0) {
        for (let t of this.a) t();
        this.a = [];
      }
      return t;
    }
    isLoaded() {
      return this.loaded;
    }
    i(t) {
      this.a.push(t);
    }
    g() {
      return this.e;
    }
    f(t) {
      t.b(this.e, this.d);
    }
    getNumAnimations() {
      var t;
      return (null === (t = this.e) || void 0 === t ? void 0 : t.aI)
        ? this.e.aC.e.length
        : 0;
    }
    getAnimation(t) {
      var e;
      return (null === (e = this.e) || void 0 === e ? void 0 : e.aI)
        ? this.e.k(t)
        : "";
    }
    resetAnimation() {
      var t;
      if (null === (t = this.e) || void 0 === t ? void 0 : t.aI)
        return this.e.aO();
    }
    setAnimPaused(t) {
      var e;
      if (null === (e = this.e) || void 0 === e ? void 0 : e.aI)
        return this.e.aa(t);
    }
    setTPose(t) {
      var e;
      if (null === (e = this.e) || void 0 === e ? void 0 : e.aI)
        return this.e.av(t);
    }
    setAnimation(t, e) {
      var i;
      (null === (i = this.e) || void 0 === i ? void 0 : i.aI) &&
        this.e.ac(t, !!e);
    }
    setParticlesEnabled(t) {
      var e;
      (null === (e = this.e) || void 0 === e ? void 0 : e.aI) && this.e.V(t);
    }
    setRibbonsEnabled(t) {
      var e;
      (null === (e = this.e) || void 0 === e ? void 0 : e.aI) && this.e.aG(t);
    }
    getTexUnits() {
      var t;
      return (null === (t = this.e) || void 0 === t ? void 0 : t.aI)
        ? this.e.aK
        : null;
    }
    setAnimNoSubAnim(t) {
      this.e && this.e.r(t);
    }
    attachList(t) {}
    setItems(t) {}
    clearSlots(t) {}
    setSheath(t, e) {}
    setAppearance(t) {}
    setShouldersOverride(t) {}
    setCustomizationsLoadedCallback(t) {}
    setModelLoadedCallback(t) {
      throw new Error("Method not implemented.");
    }
    setAnimationOverride(t, e) {
      throw new Error("Method not implemented.");
    }
    resetAnimationOverride(t) {
      throw new Error("Method not implemented.");
    }
    getAnimationDuration(t) {
      throw new Error("Method not implemented.");
    }
    getModelBounds() {
      throw new Error("Method not implemented.");
    }
    isRenderReady() {
      throw new Error("Method not implemented.");
    }
  }
  class xl extends ml {
    constructor(t, e, i, s, r, n) {
      super(),
        (this.k = t),
        (this.m = e),
        (this.fe = i),
        (this.dc = s),
        (this.ba = r),
        (this.d = n);
    }
    get fileDataId() {
      return this.e ? this.e.ab : 0;
    }
    get modelInstance() {
      return this.e;
    }
    hg(t, e, i) {
      this.e && this.e.u(t, e, i);
    }
    l(t, e) {
      this.e && this.e.ad(t, e);
    }
    ji(t, e, i) {
      this.e && this.e.ax(t, e, i);
    }
    setParticlesEnabled(t) {
      this.e && this.e.V(t);
    }
    get winding() {
      return !!this.e && this.e.z;
    }
    set winding(t) {
      this.e && (this.e.z = t);
    }
    get isMirrored() {
      return !!this.e && this.e.isMirrored;
    }
    set isMirrored(t) {
      this.e && (this.e.isMirrored = t);
    }
    b() {
      return this.modelInstance.aI ? this.modelInstance.al() : [null, null];
    }
    c() {
      this.e && this.e.g();
    }
    h(t) {
      this.e && this.e.aN(t);
    }
  }
  class vl extends xl {
    constructor(t, e, i, s) {
      if ((super(t, null, 0, 0, 0, s), (this.e = new _l(t, t.renderer, e)), i))
        for (let e in i) 0 != i[e] && this.e.aJ(+e, t.getTexture(i[e]));
    }
  }
  class Tl {
    constructor() {
      this.a = !1;
    }
  }
  const wl = class {
    constructor(t, e) {
      (this.a = t), (this.n = []), (this.m = !1), (this.c = !1), (this.d = e);
    }
    e(t) {
      for (let e = 0; e < this.d.length; e++)
        this.n[e] && this.n[e].c && this.n[e].c.loaded && this.n[e].c.g().ac(t);
    }
    h(t) {
      this.m = t;
    }
    g() {
      if (this.a.loaded)
        for (let t = 0; t < this.d.length; t++)
          switch (this.d[t].EffectType) {
            case 1:
              this.j(t);
              break;
            case 2:
              this.b(t);
              break;
            case 6:
            case 7:
            case 11:
            case 12:
            case 13:
              break;
            case 16:
              this.i(t);
          }
    }
    j(t) {
      let e = this.a.g();
      if (1 == this.d[t].ProcEffectType) {
        let i = this.d[t].Value[0];
        e.aj = Es(
          ((i >> 16) & 255) / 255,
          ((i >> 8) & 255) / 255,
          (255 & i) / 255,
          e.aj[3]
        );
      } else if (14 == this.d[t].ProcEffectType) {
        let i = Math.min(Math.max(this.d[t].Value[0], 0), 1);
        e.aj[3] = i;
      } else if (22 == this.d[t].ProcEffectType) {
        let i = this.d[t].Value[3];
        e.aj = Es(
          ((i >> 16) & 255) / 255,
          ((i >> 8) & 255) / 255,
          (255 & i) / 255,
          e.aj[3]
        );
      }
    }
    b(t) {
      if (!this.a) return;
      if (!this.a.loaded) return;
      let e = this.a.g();
      if (!this.n[t]) {
        const i = new Tl();
        if (((this.n[t] = i), 0 == this.d[t].ModelType)) {
          const s = new vl(e.M, this.d[t].Model, { 2: this.d[t].Texture }, !1);
          i.c = s;
        } else
          1 == this.d[t].ModelType ||
            (2 == this.d[t].ModelType &&
              Ll.b(e.M, ar.NPC, this.d[t].Model).then((t) => {
                i.c = t;
              }));
      }
      const i = this.n[t];
      if (!i.a) {
        if (!i.c && !i.b) return;
        if (i.c && !i.c.loaded) return;
        if (i.b && !i.b.g) return;
        let _ = this.d[t].AttachmentID;
        this.d[t].Positioner > -1 && (_ = this.d[t].Positioner),
          _ < 0 && (_ = 19);
        let p = e.an(_);
        const m = p ? p.e : -1;
        let x = Pi();
        if (p) {
          let t = p.a;
          Hi(x, x, _i(t[0], t[1], t[2]));
        }
        if (
          (Hi(
            x,
            x,
            _i(this.d[t].Offset[0], -this.d[t].Offset[1], this.d[t].Offset[2])
          ),
          Xi(x, x, -this.d[t].Yaw),
          (s = x),
          (r = x),
          (n = this.d[t].Pitch),
          (a = Math.sin(n)),
          (o = Math.cos(n)),
          (h = r[0]),
          (l = r[1]),
          (u = r[2]),
          (c = r[3]),
          (d = r[8]),
          (f = r[9]),
          (g = r[10]),
          (b = r[11]),
          r !== s &&
            ((s[4] = r[4]),
            (s[5] = r[5]),
            (s[6] = r[6]),
            (s[7] = r[7]),
            (s[12] = r[12]),
            (s[13] = r[13]),
            (s[14] = r[14]),
            (s[15] = r[15])),
          (s[0] = h * o - d * a),
          (s[1] = l * o - f * a),
          (s[2] = u * o - g * a),
          (s[3] = c * o - b * a),
          (s[8] = h * a + d * o),
          (s[9] = l * a + f * o),
          (s[10] = u * a + g * o),
          (s[11] = c * a + b * o),
          Vi(x, x, this.d[t].Roll),
          qi(x, x, [this.d[t].Scale1, this.d[t].Scale1, this.d[t].Scale1]),
          qi(x, x, [this.d[t].Scale2, this.d[t].Scale2, this.d[t].Scale2]),
          i.c)
        ) {
          const e = i.c.g();
          e.aa(this.m),
            this.d[t].ModelAlpha && (e.aj[3] = this.d[t].ModelAlpha),
            e.u(this.a.g(), m, x);
        }
        this.n[t].a = !0;
      }
      var s, r, n, a, o, h, l, u, c, d, f, g, b;
      this.n[t].c && this.n[t].c.c(), this.n[t].b && this.n[t].b.G();
    }
    i(t) {
      const e = this.a.g();
      e.gradientEffect || (e.gradientEffect = this.d[t]);
    }
    l(t) {
      for (const e of this.n) e && e.a && (e.c && e.c.h(t), e.b && e.b.y(t));
    }
    f() {
      for (const t of this.n)
        t &&
          ((t.a = !1),
          t.c && t.c.loaded && t.c.g().u(null, -1, null),
          t.b && t.b && t.b.j());
    }
    k(t) {
      this.n.forEach((e) => {
        e.c && e.c.f(t), e.b && e.b.v(t);
      });
    }
  };
  class yl extends ml {
    constructor(t, e) {
      super(),
        (this.m = t),
        (this.B = e),
        (this.ji = !1),
        (this.s = !1),
        (this.A = !1),
        (this.q = -1),
        (this.hg = -1),
        (this.t = []),
        (this.k = {}),
        (this.x = []),
        (this.l = !1),
        (this.z = null),
        (this.D = 0),
        this.r(e);
    }
    r(t) {
      if (this.l) return;
      this.m.options;
      if (
        (t.StateKit && this.x.push(new wl(this, t.StateKit.effects)),
        t.Creature &&
          ((this.z = t.Creature.CreatureGeosetData),
          (this.D = t.Creature.CreatureGeosetDataID)),
        t.Model &&
          ((this.e = new _l(this.m, this.m.renderer, t.Model)),
          this.e.Z(),
          t.Creature &&
            t.Creature.ParticleColor &&
            this.e.am(t.Creature.ParticleColor),
          t.Scale && this.e.O(t.Scale)),
        this.B.Creature &&
          this.B.Creature.Texture &&
          ((this.u = this.w(
            -1,
            pl.a(this.B.TextureFiles[this.B.Creature.Texture], 3, 0, 0)
          )),
          this.e.aF(this.u.b, this.u.a, this.u.e)),
        t.Textures)
      )
        for (let e in t.Textures)
          0 != t.Textures[e] && this.e.aJ(+e, this.m.getTexture(t.Textures[e]));
      (this.A = !0), this.dc();
    }
    w(t, e) {
      let i = new mr();
      return (
        e.b > 0 && (i.b = this.m.getTexture(e.b)),
        e.a > 0 && (i.a = this.m.getTexture(e.a)),
        e.c > 0 && (i.e = this.m.getTexture(e.c)),
        i
      );
    }
    dc() {
      this.l || ((this.A = !0), this.u || (this.s = !0));
    }
    C(t) {
      (this.fe = null),
        t <= 0 ||
          ((this.ji = !1),
          Ll.b(this.m, ar.NPC, t).then((t) => {
            t instanceof yl && (this.fe = t);
          }));
    }
    o() {
      this.e, this.fe;
    }
    setAnimation(t, e = !0) {
      this.fe && (this.fe.setAnimation(t), (t = "Mount")),
        this.e
          ? this.e.ac(t, e)
          : this.i(() => {
              var i;
              null === (i = this.e) || void 0 === i || i.ac(t, e);
            });
    }
    p() {
      const t = this.e;
      if ((t.ax(0, 0, !0), 0 != this.D && (t.ax(1, 1699, !1), this.z)))
        for (let e of this.z) {
          let i = 100 * (e.GeosetIndex + 1),
            s = i + e.GeosetValue;
          t.ax(i, i + 99, !1), t.ax(s, s, !0);
        }
    }
    n() {
      this.p();
    }
    ba() {
      const t = this.e;
      t.aI && this.A && t.aK && 0 != t.aK.length && (this.n(), (this.A = !1));
    }
    setParticlesEnabled(t) {
      this.e && this.e.V(t);
    }
    b() {
      if (this.e && this.e.aI) {
        const [t, e] = this.e.al();
        if (this.fe && this.fe.loaded && this.ji) {
          const [i, s] = this.fe.b();
          yi(i, i, _i(0, 0, 0)), wi(t, t, i), yi(e, e, s);
        }
        return [t, e];
      }
      return [null, null];
    }
    c() {
      if (!this.l && this.loaded) {
        if (!this.ji && this.e && this.fe && this.fe.loaded) {
          const t = this.fe.e.aC,
            e = t.n[t.K[0]],
            i = Pi();
          Hi(i, i, e.a),
            this.e.u(this.fe.e, e.e, i, 1 / this.fe.e.ak),
            this.e.ac("Mount", !1),
            (this.ji = !0);
        }
        this.v && this.v.c(),
          this.fe && this.fe.c(),
          this.x && this.x.forEach((t) => t.g()),
          this.ba(),
          this.e.g();
      }
    }
    h(t) {
      this.e.aN(t),
        this.fe && this.fe.h(t),
        this.x && this.x.forEach((e) => e.l(t));
    }
    f(t) {
      super.f(t),
        this.fe && this.fe.f(t),
        this.v && this.v.f(t),
        this.x && this.x.forEach((e) => e.k(t));
    }
  }
  function Al(t) {
    return new Promise((e, i) => {
      $.getJSON(t)
        .done(function (t) {
          e(t);
        })
        .fail(function (t, e, s) {
          let r = e + ", " + s;
          console.log("Error loading metadata: " + r), i(e);
        });
    });
  }
  function El(t, e, i) {
    let s;
    return e == ar.HELM
      ? Ml(t, 1, i)
      : e == ar.SHOULDER
      ? Ml(t, 3, i)
      : e == ar.ITEM
      ? Ml(t, -1, i)
      : (e == ar.NPC || e == ar.HUMANOIDNPC
          ? (s = "meta/npc/")
          : e == ar.OBJECT
          ? (s = "meta/object/")
          : e == ar.CHARACTER
          ? (s = "meta/character/")
          : e == ar.ITEMVISUAL && (s = "meta/itemvisual/"),
        Al(t + s + i + ".json"));
  }
  function Ml(t, e, i) {
    let s = "meta/item/";
    return (
      (1 != e &&
        3 != e &&
        4 != e &&
        5 != e &&
        6 != e &&
        7 != e &&
        8 != e &&
        9 != e &&
        10 != e &&
        16 != e &&
        19 != e &&
        20 != e) ||
        (s = "meta/armor/" + e + "/"),
      Al(t + s + i + ".json")
    );
  }
  class Cl {
    constructor() {
      (this.b = null), (this.d = 1), (this.c = -1), (this.a = !1);
    }
  }
  class Sl {
    constructor(t, e) {
      (this.a = t), (this.b = e);
    }
  }
  class Fl extends Cl {
    constructor() {
      super(...arguments), (this.ba = []);
    }
  }
  class Il {
    constructor(t, e) {
      (this.b = t), (this.a = e);
    }
  }
  function kl(t, e) {
    return (
      t == e ||
      (!!t &&
        !!e &&
        t.a == e.a &&
        (t.b == e.b ||
          (!!t.b &&
            !!e.b &&
            t.b.b == e.b.b &&
            t.b.c == e.b.c &&
            t.b.a == e.b.a)))
    );
  }
  class Dl {
    constructor(t, e) {
      (this.b = t), (this.a = []), (this.h = e), (this.f = {}), (this.e = {});
    }
    c() {
      const t = [];
      for (let e of this.h.Options)
        for (let i of e.Choices)
          for (let e of i.Elements)
            e.SkinnedModel && t.push(e.SkinnedModel.CollectionFileDataID);
      const e = new Set(t),
        i = this.b.m;
      i.renderer;
      if (0 != e.size)
        for (let t of e) {
          const e = new Fl();
          (e.b = new vl(i, t, {}, !0)), (this.b.j[t] = e);
        }
    }
    g(t) {
      return pl.a(this.h.TextureFiles[t], this.b.vu, this.b.zy, this.b.L);
    }
    d(t) {
      WH.debug("applyCustomization options", t), (this.a = []), (this.b.t = []);
      for (const t in this.b.j) {
        this.b.j[t].ba = [];
      }
      let e = 0,
        i = {},
        s = {};
      for (let r = 0; r < t.length; r++) {
        let n = this.h.Options.find((e) => e.Id == t[r].optionId);
        if ((WH.debug("option", n), n)) {
          let a = n.Choices.find((e) => e.Id == t[r].choiceId);
          if ((WH.debug("choice", a), a)) {
            let r = a.Elements.filter(
              (e) =>
                e.BoneSet &&
                e.BoneSet.BoneFileDataID &&
                (0 == e.VariationChoiceID ||
                  t.some((t) => t.choiceId == e.VariationChoiceID))
            );
            r.length > 0 && (e = r[0].BoneSet.BoneFileDataID);
            let o = a.Elements.filter(
              (e) =>
                e.Material &&
                (0 == e.VariationChoiceID ||
                  t.some((t) => t.choiceId == e.VariationChoiceID))
            );
            o.sort((t, e) => e.VariationChoiceID - t.VariationChoiceID),
              o.forEach((t) => {
                WH.debug("element material", t);
                let e = this.g(t.Material.MaterialResourcesID);
                if (!e)
                  return void WH.debug(
                    "element material: can't get texture files for material",
                    t
                  );
                let r = this.h.TextureLayers.find(
                  (e) => e.ChrModelTextureTargetID == t.Material.TextureTarget
                );
                if (!r)
                  return void WH.debug(
                    "element material: can't get texture layer for material",
                    t
                  );
                const n = new Il(e, r.TextureType);
                kl(n, this.e[t.Material.TextureTarget])
                  ? ((i[t.Material.TextureTarget] =
                      this.f[t.Material.TextureTarget]),
                    (s[t.Material.TextureTarget] =
                      this.e[t.Material.TextureTarget]))
                  : ((i[t.Material.TextureTarget] = this.b.w(r.TextureType, e)),
                    (s[t.Material.TextureTarget] = n));
              }),
              a.Elements.filter(
                (e) =>
                  e.Geoset &&
                  (0 == e.VariationChoiceID ||
                    t.some((t) => t.choiceId == e.VariationChoiceID))
              )
                .sort(
                  (t, e) =>
                    t.Geoset.GeosetType - e.Geoset.GeosetType ||
                    t.Geoset.GeosetID - e.Geoset.GeosetID
                )
                .forEach((t) => {
                  WH.debug("element geoset", t),
                    this.a.push(100 * t.Geoset.GeosetType + t.Geoset.GeosetID);
                }),
              a.Elements.filter(
                (e) =>
                  e.SkinnedModel &&
                  (0 == e.VariationChoiceID ||
                    t.some((t) => t.choiceId == e.VariationChoiceID))
              ).forEach((t) => {
                WH.debug("element skinnedmodel", t), t.ChrCustItemGeoModifyID;
                const e = this.b.j[t.SkinnedModel.CollectionFileDataID];
                t.SkinnedModel.GeosetID < 100 &&
                  e.ba.push(
                    new Sl(
                      100 * t.SkinnedModel.GeosetType + t.SkinnedModel.GeosetID,
                      (1 & t.SkinnedModel.Flags) > 0
                    )
                  );
              });
            let h = a.Elements.find(
              (e) =>
                0 != e.CondModelFileDataId &&
                (0 == e.VariationChoiceID ||
                  t.some((t) => t.choiceId == e.VariationChoiceID))
            );
            (24 != n.Id && 353 != n.Id) ||
              (h && !this.b.overrideModelFile
                ? (this.b.overrideModelFile = h.CondModelFileDataId)
                : !h &&
                  this.b.overrideModelFile &&
                  (this.b.overrideModelFile = 0)),
              a.Elements.filter(
                (e) =>
                  e.ChrCustItemGeoModifyID &&
                  (0 == e.VariationChoiceID ||
                    t.some((t) => t.choiceId == e.VariationChoiceID))
              ).forEach((t) => {
                WH.debug("element ChrCustItemGeoModify", t),
                  this.b && this.b.t.push(t.ChrCustItemGeoModifyID);
              });
          }
        }
      }
      if (!this.f[10]) {
        let e = this.h.Options.find((t) => t.Id == this.h.HairStyleOptionId);
        if (e) {
          let r = e.Choices[1];
          if (r) {
            let e = r.Elements.filter(
              (e) =>
                e.Material &&
                10 == e.Material.TextureTarget &&
                (0 == e.VariationChoiceID ||
                  t.some((t) => t.choiceId == e.VariationChoiceID))
            );
            if (e.length > 0) {
              let t = this.g(e[0].Material.MaterialResourcesID);
              if (t) {
                const r = new Il(t, 0);
                kl(r, this.e[e[0].Material.TextureTarget])
                  ? ((i[e[0].Material.TextureTarget] =
                      this.f[e[0].Material.TextureTarget]),
                    (s[e[0].Material.TextureTarget] =
                      this.e[e[0].Material.TextureTarget]))
                  : ((i[e[0].Material.TextureTarget] = this.b.w(6, t)),
                    (s[e[0].Material.TextureTarget] = r));
              }
            }
          }
        }
      }
      (this.f = i), (this.e = s), this.b.g().E(e), (this.b.s = !0);
    }
    i() {
      let t = [];
      for (let e = 0; e < this.h.Options.length; e++) {
        let i = this.h.Options[e];
        if (i) {
          let e = i.Choices[0];
          e && t.push({ optionId: i.Id, choiceId: e.Id });
        }
      }
      this.d(t);
    }
    j(t) {
      let e = { options: t, sheathMain: -1, sheathOff: -1 };
      for (let t of this.h.Options)
        e.options.some((e) => e.optionId == t.Id) ||
          e.options.push({ optionId: t.Id, choiceId: t.Choices[0].Id });
      return e;
    }
  }
  class Rl {
    constructor() {
      (this.c = null), (this.a = 1), (this.b = !1);
    }
  }
  const Ul = class {
    constructor(t, e, i) {
      (this.m = t),
        (this.h = e),
        (this.d = []),
        (this.l = !1),
        (this.a = []),
        i && this.b(i);
    }
    j() {}
    b(t) {
      this.k = t;
      El(this.m.k.options.contentPath, ar.ITEMVISUAL, t).then((t) => {
        this.c(t);
      });
    }
    c(t) {
      if (((this.d = new Array(7)), t.ItemEffects))
        for (let e = 0; e < t.ItemEffects.length; ++e) {
          let i = t.ItemEffects[e];
          if (-1 == i.SubClass || this.h == i.SubClass) {
            if (i.Model) {
              const t = new Rl();
              (this.d[i.Slot - 1] = t),
                (t.c = new _l(this.m.k, this.m.k.renderer, i.Model)),
                (t.a = i.Scale && 1 != i.Scale ? i.Scale : 1);
            }
            if (i.kit) {
              const t = new wl(this.m, i.kit.effects);
              this.a.push(t);
            }
          }
        }
      for (var e = 0; e < this.d.length; ++e)
        t.Equipment[e] &&
          null == this.d[e] &&
          ((this.d[e] = new Rl()),
          (this.d[e].c = new _l(this.m.k, this.m.k.renderer, t.Equipment[e])));
      this.l = !0;
    }
    e(t) {
      for (let e = 0; e < this.d.length; e++) {
        const i = this.d[e];
        i && i.b && i.c.aN(t);
      }
    }
    g(t) {
      for (let e = 0; e < this.d.length; e++) {
        const i = this.d[e];
        i && i.b && i.c && i.c.aI && t.b(i.c, !1);
      }
    }
    i(t, e, i) {
      if (t.b) return;
      if (!i.loaded) return;
      if (!t.c || !t.c.aI) return;
      const s = i.modelInstance.aC;
      let r = null;
      if (e < 5) {
        if (!s.n[e]) return;
        r = s.n[e];
      } else r = i.modelInstance.an(19);
      let n = Pi();
      Hi(n, n, r.a),
        qi(n, n, _i(t.a, t.a, t.a)),
        t.c.u(i.modelInstance, r.e, n),
        (t.b = !0);
    }
    f() {
      if (this.m.loaded) {
        for (const t of this.a) t && t.g();
        for (let t = 0; t < this.d.length; t++) {
          const e = this.d[t];
          e && (this.i(e, t, this.m), e.c.g());
        }
      }
    }
  };
  class Ol {
    constructor(t, e, i) {
      (this.L = t),
        (this.b = []),
        (this.g = !1),
        (this.e = null),
        (this.E = []),
        (this.i = Pi()),
        WH.debug("Creating item", i),
        (this.z = e),
        (this.q = i),
        (this.H = t.L),
        (this.h = t.vu),
        (this.c = t.zy),
        (this.o = or[e]),
        (this.s = hr[e]),
        (this.D = null),
        (this.l = null),
        (this.n = null),
        (this.A = 0),
        (this.k = 0),
        (this.g = !1),
        (this.d = !1),
        (this.F = 0),
        (this.w = 3),
        (this.p = 0),
        i && this.m();
    }
    r() {
      var t = this;
      if (t.b) {
        for (let e = 0; e < t.b.length; ++e)
          t.b[e] && ((t.b[e].b = null), (t.b[e] = null));
        t.b = null;
      }
      if (t.D) {
        for (let e = 0; e < t.D.length; ++e)
          t.D[e].texture && t.D[e].texture.l(),
            (t.D[e].texture = null),
            (t.D[e] = null);
        t.D = null;
      }
      if (((t.l = null), (t.n = null), t.E)) {
        for (let e = 0; e < t.E.length; e++) t.E[e].j();
        t.E = null;
      }
      (t.g = !1), WH.debug("Destroyed item", this.q);
    }
    m() {
      let t = this,
        e = this.L.m.options;
      WH.debug("Loading item", this.q),
        Ml(e.contentPath, this.z, this.q)
          .then((t) => {
            this.K(t);
          })
          .catch(() => {
            t.d = !0;
          });
    }
    K(t) {
      if (!this.L)
        return void WH.debug(
          "Char model was destroyed before it was loaded",
          this.q
        );
      const e = this.L.m,
        i = (e.options, this.h),
        s = this.H,
        r = this.c;
      if (
        ((this.k = t.Item.Flags),
        (this.A = t.Item.InventoryType),
        (this.u = t.Item.ItemClass),
        (this.C = t.Item.ItemSubClass),
        t.ComponentTextures)
      ) {
        this.D = [];
        for (let n in t.ComponentTextures) {
          const a = parseInt(n),
            o = pl.a(t.TextureFiles[t.ComponentTextures[n]], i, r, s);
          if (o) {
            let t;
            (t = { region: a, gender: this.h, file: o.b, texture: null }),
              12 != a
                ? (t.texture = e.getTexture(o.b))
                : 16 == this.z && this.L.g().aJ(2, e.getTexture(o.b)),
              this.D.push(t);
          }
        }
      }
      if (
        ((this.l = t.Item.GeosetGroup),
        (this.n = t.Item.AttachGeosetGroup),
        (this.p = t.Item.GeosetGroupOverride),
        1 == this.z &&
          (0 == i
            ? (this.x = t.Item.HideGeosetMale)
            : (this.B = t.Item.HideGeosetFemale)),
        3 == this.z
          ? (this.b = new Array(2))
          : ur[this.z] != ar.ARMOR && (this.b = new Array(1)),
        this.b && t.ComponentModels)
      )
        for (let i = 0; i < this.b.length; ++i) {
          const s = new Cl();
          (s.b = Ll.c(e, t, ur[this.z], this.H, this.h, this.c)),
            3 == this.z && s.b.gf(i + 1),
            t.Item &&
              t.Item.ParticleColor &&
              s.b.modelInstance.am(t.Item.ParticleColor),
            (this.b[i] = s);
        }
      if ((6 == this.z || 16 == this.z) && t.ComponentModels) {
        let n = 0;
        if ((16 == this.z && (n = 1), t.ComponentModels[n])) {
          const a = t.ComponentModels[n],
            o = pl.b(t.ModelFiles[a], -1, i, r, s),
            h = new Cl(),
            l = 0 == n ? t.Textures : t.Textures2;
          (h.b = new vl(e, o, l, !1)), (this.b = [h]);
        }
      }
      const n = this.z;
      if (
        (4 == n ||
          5 == n ||
          20 == n ||
          6 == n ||
          7 == n ||
          10 == n ||
          8 == n ||
          1 == n ||
          9 == n ||
          19 == n ||
          16 == n) &&
        t.ComponentModels
      ) {
        let a = 0;
        if (((1 != n && 6 != n) || (a = 1), t.ComponentModels[a])) {
          const n = t.ComponentModels[a];
          if (n && t.ModelFiles && t.ModelFiles[n]) {
            const o = pl.b(t.ModelFiles[n], -1, i, r, s);
            if (o) {
              const i = 0 == a ? t.Textures : t.Textures2;
              (this.e = new Cl()),
                (this.e.b = new vl(e, o, i, !0)),
                this.e.b.i(() => {
                  this.L.A = !0;
                });
            }
          }
        }
      }
      7 == n && this.l[2] > 0 && (this.s += 2);
      const a =
        0 != this.F ? this.F : 0 != t.Item.ItemVisual ? t.Item.ItemVisual : 0;
      if (0 != a) {
        const t = 2 == this.u ? this.C : -1;
        for (let e = 0; e < this.b.length; e++)
          this.E.push(new Ul(this.b[e].b, t, a));
      }
      (this.g = !0),
        WH.debug("Loaded item:", "DisplayId", this.q, "InventoryType", this.A),
        (this.L.A = !0);
    }
    J(t) {
      for (let t = 0; t < this.E.length; t++) this.E[t].j();
      (this.E = []), (this.F = t);
    }
    f(t) {
      this.w = t;
    }
    a(t) {
      if (3 == this.z) {
        const e = t.b.shoulderIndex;
        if (1 == e && 0 == (1 & this.w)) return !0;
        if (2 == e && 0 == (2 & this.w)) return !0;
      }
      return !1;
    }
    y(t) {
      for (let e = 0; e < this.E.length; ++e) this.E[e] && this.E[e].e(t);
      for (let e = 0; e < this.b.length; ++e) {
        const i = this.b[e];
        if (i && i.b) {
          if (this.a(i)) continue;
          i.b.h(t);
        }
      }
    }
    j() {
      if (this.b)
        for (let t = 0; t < this.b.length; ++t)
          (this.b[t].a = !1), this.b[t].b && this.b[t].b.hg(null, -1, null);
      this.e && (this.e.a = !1);
    }
    t(t, e, i, s) {
      if (!t) return;
      if (!t.b) return;
      if (t.b.modelInstance.aI) {
        if (e < s.length) {
          let r = i.n[s[e]];
          if (t.a && r.e == t.c) return;
          let n = !1,
            a = sr[t.b.fileDataId],
            o = gi(),
            h = Pi();
          if (
            (Gi(h),
            a && (mi(o, 1, 1, -1), qi(h, h, o), (n = !0)),
            (22 != this.z && 23 != this.z && 22 != this.o) ||
              0 == (256 & this.k) ||
              (mi(o, 1, -1, 1), qi(h, h, o), (n = !0), (t.b.isMirrored = !0)),
            (t.b.winding = n),
            5 == this.L.q &&
              26 == this.z &&
              2 == this.u &&
              18 == this.C &&
              (Gi(h), Vi(h, h, -Math.PI / 2)),
            Hi(h, h, r.a),
            Yi(h, h, this.i),
            27 == this.z)
          ) {
            let e = t.b.m.Scale;
            mi(o, e, e, e), qi(h, h, o);
          }
          t.b.hg(this.L.g(), r.e, h), (t.a = !0), (t.c = r.e);
        }
        t.a = !0;
      }
    }
    I(t) {
      zi(this.i, t);
      for (let t = 0; t < this.b.length; ++t) this.b[t].a = !1;
    }
    G() {
      if (!this.L.loaded) return;
      const t = this.L.g().aC,
        e = this.L.BA(this.o, this);
      for (let i = 0; i < this.b.length; ++i)
        this.t(this.b[i], i, t, e), this.E[i] && this.E[i].f();
      this.e && this.L.lk(this.e);
      for (let t = 0; t < this.b.length; ++t) {
        const e = this.b[t];
        if (e && e.b) {
          if (this.a(e)) continue;
          e.b.c();
        }
      }
    }
    v(t) {
      this.b.forEach((e) => {
        e.b.f(t);
      }),
        this.e && this.e.b.f(t);
    }
  }
  class Bl extends yl {
    constructor(t, e) {
      super(t, e),
        (this.F = new Map()),
        (this.O = []),
        (this.j = {}),
        (this.J = null),
        t.options.charCustomization && (this.P = t.options.charCustomization),
        (this.po = new Array(52));
      for (let t = 0; t < 52; t++) this.po[t] = 100 * t + rr[t];
    }
    get overrideModelFile() {
      return this.H;
    }
    set overrideModelFile(t) {
      const e = this.H;
      (this.H = t), e != t && (this.DC(), this.gf(), (this.A = !0));
    }
    DC() {
      let t = this.H ? this.H : this.cba.Model;
      (this.e = new _l(this.m, this.m.renderer, t)),
        this.e.Z(),
        this.e.P(27 == this.L || 30 == this.L),
        (this.J = null),
        (this.A = !0);
    }
    r(t) {
      const e = this.m.options;
      (this.L = t.Character.Race),
        (this.vu = t.Character.Gender),
        (this.zy = e.cls ? e.cls : 0);
      const i = e && e.items;
      El(e.contentPath, ar.CHARACTER, t.Character.ChrModelId).then((s) => {
        var r, n;
        (this.cba = s),
          this.DC(),
          ((r = e.contentPath),
          (n = t.Character.ChrModelId),
          new Promise((t, e) => {
            const i = r + "meta/charactercustomization/" + n + ".json";
            $.getJSON(i, function (e) {
              t(e);
            });
          })).then((e) => {
            var s, r;
            if (
              (WH.debug("Got customization data v2", e),
              (this.ed = new Dl(this, e)),
              null === (s = this.M) || void 0 === s || s.call(this, this.ed.h),
              this.ed.c(),
              this.P)
            )
              this.setAppearance(this.P);
            else if (
              t.Character.Race > 0 &&
              (null === (r = null == t ? void 0 : t.Creature) || void 0 === r
                ? void 0
                : r.CreatureCustomizations)
            ) {
              let e = this.ed.j(t.Creature.CreatureCustomizations);
              this.setAppearance(e);
            } else this.ed.i();
            this.s && this.dc(),
              t.Equipment && this.ts(t.Equipment),
              i && this.ts(i);
          });
      }),
        (this.s = !0);
    }
    gf() {
      for (const [t, e] of this.F) e.j();
      for (const t in this.j) {
        this.j[t].a = !1;
      }
      for (const t of this.x) t.f();
    }
    nm(t, e, i) {
      if (!this.F) return;
      if (3 == t && this.O && this.O[0]) return;
      let s = new Ol(this, t, e);
      i && s.J(i);
      let r = s.o,
        n = lr[t];
      this.F.get(r) && 0 != n
        ? ((s.o = n), this.F.set(n, s))
        : this.F.set(r, s);
    }
    G(t) {
      var e = this.F.get(t);
      e || ((t = or[t]), (e = this.F.get(t))), e && (this.F.delete(t), e.r());
    }
    BA(t, e) {
      const i = this.e.aC,
        s = [],
        r = { 14: (t) => [0], 26: (t) => (2 == t.u && 18 == t.C ? [1] : null) };
      if (i.n && i.K) {
        const n = {
          1: (t) => [11],
          3: (t) => [6, 5],
          22: (t) => {
            var e;
            return (
              (null === (e = r[t.z]) || void 0 === e
                ? void 0
                : e.call(r, t)) || [2]
            );
          },
          21: (t) => [1],
          17: (t) => [1],
          15: (t) => [2],
          25: (t) => [1],
          13: (t) => [1],
          14: (t) => [0],
          23: (t) => [2],
          6: (t) => [53],
          26: (t) => [1],
          16: (t) => [57],
          27: (t) => [55],
        };
        if (n[t]) {
          const r = n[t](e);
          for (let n = 0; n < r.length; ++n) {
            let a = r[n];
            (this.q >= 0 || this.hg >= 0 || this.fe) && gr[t] && (a = gr[t]),
              this.q >= 0 && 21 == t && br[this.q][t] && (a = br[this.q][t]),
              this.hg >= 0 && 22 == t && br[this.hg][t] && (a = br[this.hg][t]),
              15 == e.A &&
                this.hg >= 0 &&
                22 == t &&
                br[this.hg][e.z] &&
                (a = br[this.hg][e.z]),
              a >= i.K.length || -1 == i.K[a] || s.push(i.K[a]);
          }
        }
      }
      return s;
    }
    ts(t) {
      if ($.isArray(t))
        for (let e = 0; e < t.length; ++e) this.nm(t[e][0], t[e][1], t[e][2]);
      else for (let e in t) this.nm(parseInt(e), t[e]);
      (this.A = !0), this.I();
    }
    N(t, e, i) {
      for (const s in this.j) {
        this.j[s].b.ji(t, e, i);
      }
    }
    n() {
      var t;
      const e = this.e;
      for (let t = 0; t < 52; t++) this.po[t] = 100 * t + rr[t];
      for (const e of (null === (t = this.ed) || void 0 === t ? void 0 : t.a) ||
        [])
        e >= 0 && (this.po[Math.floor(e / 100)] = e);
      for (const t in this.j) {
        const e = this.j[t].ba,
          i = this.j[t].b;
        i.ji(0, _r, !1);
        for (const t of e)
          i.ji(t.a, t.a, !0), (this.po[Math.floor(t.a / 100)] = t.a);
      }
      e.ax(0, _r, !1), e.ax(0, 0, !0);
      for (let t = 0; t < this.po.length; t++) e.ax(this.po[t], this.po[t], !0);
      let i = this.F.get(1),
        s = this.F.get(3),
        r = this.F.get(4),
        n = this.F.get(5),
        a = this.F.get(6),
        o = this.F.get(7),
        h = this.F.get(8),
        l = this.F.get(9),
        u = this.F.get(10),
        c = this.F.get(19),
        d = this.F.get(16),
        f = !1,
        g = !1;
      n && n.l && n.l[2] ? (g = !0) : o && o.l && o.l[2] && (f = !0);
      let b = g || f;
      this.F.forEach((t) => {
        if (t && t.g && t.e) {
          let e = t.e.b.modelInstance;
          if (!e.aI) return;
          e.ax(0, _r, !1),
            1 == t.z
              ? (e.v(t.l[0], 2700), e.v(t.l[1], 2100))
              : 3 == t.z
              ? e.v(t.l[0], 2600)
              : 4 == t.z
              ? (e.v(t.l[0], 800), e.v(t.l[1], 1e3))
              : 5 == t.z || 20 == t.z
              ? (u && u.g && u.l[0] ? e.v(-2, 800) : e.v(t.l[0], 800),
                e.v(t.l[1], 1e3),
                b && e.v(t.l[2], 1300),
                e.v(t.l[3], 2200),
                e.v(t.l[4], 2800))
              : 6 == t.z
              ? e.v(t.l[0], 1800)
              : 7 == t.z
              ? (e.v(t.l[0], 1100), e.v(t.l[1], 900), b && e.v(t.l[2], 1300))
              : 8 == t.z
              ? (e.v(t.l[0], 500), e.v(t.l[1], 2e3))
              : 10 == t.z
              ? (0 == t.l[0] && n && n.g && n.l[0]
                  ? e.v(-2, 400)
                  : e.v(t.l[0], 400),
                e.v(t.l[1], 2300))
              : 16 == t.z
              ? e.v(t.l[0], 1500)
              : 19 == t.z
              ? e.v(t.l[0], 1200)
              : 9 == t.z &&
                ((u && u.g && u.l[0]) ||
                null != (null == u ? void 0 : u.e) ||
                (n && n.g && n.l[2] && n.l[0] > 0)
                  ? e.v(-2, 2300)
                  : e.v(t.l[0], 2300));
        }
      }),
        this.O.forEach((t) => {
          if (t && t.e) {
            const e = t.e.b.modelInstance;
            e.ax(0, _r, !1), e.v(t.l[0], 2600);
          }
        }),
        this.F.forEach((t) => {
          if (t && t.g && t.b)
            for (let e of t.b) {
              if (!e) continue;
              let i = e.b;
              1 == t.z
                ? (i.l(t.n[0], 27), i.l(t.n[1], 21))
                : 3 == t.z
                ? i.l(t.n[0], 26)
                : 4 == t.z
                ? (i.l(t.n[0], 8), i.l(t.n[1], 10))
                : 5 == t.z || 20 == t.z
                ? (i.l(t.n[0], 8),
                  i.l(t.n[1], 10),
                  i.l(t.n[2], 13),
                  i.l(t.n[3], 22),
                  i.l(t.n[4], 28))
                : 6 == t.z
                ? i.l(t.n[0], 18)
                : 7 == t.z
                ? (i.l(t.n[0], 11), i.l(t.n[1], 9), i.l(t.n[2], 13))
                : 8 == t.z
                ? (i.l(t.n[0], 5), i.l(t.n[1], 20))
                : 10 == t.z
                ? (i.l(t.n[0], 4), i.l(t.n[1], 23))
                : 16 == t.z
                ? i.l(t.n[0], 15)
                : 19 == t.z
                ? i.l(t.n[0], 12)
                : 9 == t.z && i.l(t.n[0], 23);
            }
        }),
        this.O.forEach((t) => {
          if (t && t.b)
            for (let e of t.b) {
              let i = e.b;
              i.l(t.n[0], 26), t.p > 0 && (i.ji(2600, 2699, !1), i.l(t.p, 26));
            }
        });
      if (i && i.g) {
        const t = i.e || i.b[0],
          s = this.L,
          r = 0 == this.vu ? i.x : i.B;
        if (t && r)
          for (let t = 0; t < r.length; t++)
            if (r[t].RaceId == s) {
              const i = r[t].GeosetGroup;
              if (5 == s && (1 == i || 2 == i)) continue;
              if (i < 52)
                if (0 == i) e.ax(1, 99, !1);
                else {
                  const t = 100 * i;
                  e.ax(t, t + 99, !1);
                }
            }
      }
      if (i && i.b && i.p > 0)
        for (let t of i.b) {
          let e = t.b;
          e.ji(2600, 2799, !1), e.l(i.p, 27);
        }
      if (s && s.b && s.p > 0)
        for (let t of s.b) {
          let e = t.b;
          e.ji(2600, 2699, !1), e.l(s.p, 26);
        }
      if (a && a.b && a.p > 0)
        for (let t of a.b) {
          let e = t.b;
          e.ji(1800, 1899, !1), e.l(a.p, 18);
        }
      let _ = 0;
      if ((c && (_ |= 16), u && u.g && u.l && u.l[0])) {
        let t = 401 + u.l[0];
        e.ax(401, 499, !1), e.ax(t, t, !0);
      } else if (n && n.g && n.l && n.l[0]) {
        let t = 801 + n.l[0];
        e.ax(t, t, !0),
          u &&
            u.l &&
            0 == u.l[0] &&
            ((u.s = 7),
            (n.s = 8),
            WH.debug("updating sorting for chest/gloves"));
      }
      if (!(n || a || l) && r && r.g && r.l && r.l[0]) {
        let t = 801 + r.l[0];
        e.ax(t, t, !0);
      }
      if (c && c.g)
        0 == (1048576 & c.k) && (e.ax(2200, 2299, !1), e.ax(2202, 2202, !0));
      else if (n && n.g && n.l && n.l[3]) {
        let t = 2201 + n.l[3];
        e.ax(2200, 2299, !1), e.ax(t, t, !0);
      }
      let p,
        m = !1;
      if ((a && a.g && a.l && a.l[0] && (m = 0 != (512 & a.k)), g)) {
        e.ax(501, 599, !1),
          e.ax(902, 999, !1),
          e.ax(1100, 1199, !1),
          e.ax(1300, 1399, !1);
        let t = 1301 + n.l[2];
        e.ax(t, t, !0);
      } else if (f) {
        e.ax(501, 599, !1),
          e.ax(902, 999, !1),
          e.ax(1100, 1199, !1),
          e.ax(1300, 1399, !1);
        let t = 1301 + o.l[2];
        e.ax(t, t, !0);
      } else if (h && h.g && h.l && h.l[0]) {
        e.ax(501, 599, !1), e.ax(901, 901, !0);
        let t = 501 + h.l[0];
        e.ax(t, t, !0);
      } else {
        let t;
        (t = o && o.g && o.l && o.l[1] ? 901 + o.l[1] : 901), e.ax(t, t, !0);
      }
      (p =
        h && h.g && h.l && h.l[1]
          ? 2e3 + h.l[1]
          : h && h.g && 0 == (1048576 & h.k)
          ? 2002
          : 2001),
        e.ax(2001, 2099, !1),
        e.ax(p, p, !0);
      let x = !1;
      if (!b && c && c.g && c.l && c.l[0]) {
        let t;
        (x = !1),
          m ? ((x = !0), (t = 1203)) : ((x = !0), (t = 1201 + c.l[0])),
          e.ax(t, t, !0);
      } else
        16 & _ && (e.ax(1201, 1201, !0), b || (e.ax(1202, 1202, !0), (x = !0)));
      if (!x && !g)
        if (n && n.g && n.l && n.l[1]) {
          let t = 1001 + n.l[1];
          e.ax(t, t, !0);
        } else if (r && r.g && r.l && r.l[1]) {
          let t = 1001 + r.l[1];
          e.ax(t, t, !0);
        }
      if (!g && o && o.g && o.l && o.l[0]) {
        let t = o.l[0],
          i = 1101 + t,
          s = e.aK.some((t) => t.meshId == i);
        t > 2
          ? (e.ax(1300, 1399, !1), s ? e.ax(i, i, !0) : e.ax(1301, 1301, !0))
          : x || e.ax(i, i, !0);
      }
      if (c && c.g && c.l && c.l[0] && this.t.length > 0)
        for (let t of this.t) {
          const i = nr[t];
          if (i && 12 == i.GeosetType && i.Original == c.l[0] + 1) {
            e.ax(1200, 1299, !1);
            let t = 1200 + i.Override;
            e.ax(t, t, !0);
            break;
          }
        }
      if (d && d.g && d.l && d.l[0]) {
        e.ax(1500, 1599, !1);
        let t = 1501 + d.l[0];
        if (this.t.length > 0)
          for (let e of this.t) {
            const i = nr[e];
            if (i && 15 == i.GeosetType && i.Original == d.l[0] + 1) {
              t = 1500 + i.Override;
              break;
            }
          }
        e.ax(t, t, !0);
      }
      if (a && a.g && a.l && a.l[0]) {
        e.ax(1800, 1899, !1);
        let t = 1801 + a.l[0];
        e.ax(t, t, !0);
      }
      o || g || f || x || m ? e.ax(1400, 1499, !1) : e.ax(1401, 1401, !0);
    }
    setParticlesEnabled(t) {
      super.setParticlesEnabled(t),
        this.F.forEach((e) => {
          if (e.b)
            for (let i = 0; i < e.b.length; ++i)
              e.b[i] && e.b[i].b.setParticlesEnabled(t);
        });
    }
    dc() {}
    E() {
      if (!this.s) return;
      let t = !1;
      if (
        (this.F.forEach((e) => {
          if (e.g || e.d) {
            if (e.D)
              for (let i = 0; i < e.D.length; ++i)
                if (e.D[i].texture && !e.D[i].texture.k()) return void (t = !0);
          } else t = !0;
        }),
        t)
      )
        return;
      if (!this.ed) return;
      const e = this.ed.h.Materials,
        i = this.ed.h.TextureLayers,
        s = this.ed.h.TextureSections;
      let r = !0,
        n = !0;
      (15 != this.L && 21 != this.L) || (n = !1),
        this.F.forEach((t) => {
          let e = t.o;
          (4 != e && 5 != e && 19 != e) || ((r = !1), null == t.D && (r = !0)),
            7 == e && ((n = !1), null == t.D && (n = !0));
        });
      let a = -1;
      if (27 == this.L)
        for (let t of i)
          9 == t.BlendMode &&
            1 == t.TextureType &&
            t.Layer > a &&
            (a = t.Layer);
      const o =
        ((h = (t) => t.TextureType),
        i.reduce((t, e) => {
          var i;
          return (t[(i = h(e))] || (t[i] = [])).push(e), t;
        }, {}));
      var h;
      for (const t in o) {
        const e = o[t];
        for (const t of e) {
          const e = this.ed.f[t.ChrModelTextureTargetID];
          if (e && !e.d()) return;
        }
      }
      for (const t in o) {
        const i = o[t],
          h = i[0].TextureType;
        if (!this.k[t]) {
          const i = e.find((t) => t.TextureType == h);
          if (!i) {
            WH.debug("unable to find material info", h);
            continue;
          }
          this.k[t] = new Tr(this.m.context, i.Width, i.Height);
        }
        const l = this.k[t];
        l.c();
        for (const t of i) {
          let e = -1;
          t.Layer == a && (e = 0);
          const i = this.ed.f[t.ChrModelTextureTargetID];
          if (!i) continue;
          const o = t.TextureSection;
          if ((3 != o && 5 != o) || (r && 3 == o) || (n && 5 == o)) {
            let r = 0,
              n = 0,
              a = 1,
              h = 1;
            if (-1 != o && s) {
              const t = s.find((t) => t.SectionType == o);
              if (!t) {
                WH.debug("can't find texture section data", o);
                continue;
              }
              (r = t.X), (n = t.Y), (a = t.Width), (h = t.Height);
            }
            l.i(i, r, n, a, h, t.BlendMode, t.Layer, e);
          }
        }
        1 == h && 52 != this.L && 70 != this.L && this.ih(l),
          26 != h || (52 != this.L && 70 != this.L) || this.ih(l),
          l.a();
      }
      this.rq(this.e);
      for (let t in this.j) {
        const e = this.j[t];
        e.b && e.b.loaded && this.rq(e.b.g());
      }
      this.s = !1;
    }
    rq(t) {
      if (this.k[1]) {
        const e = this.k[1];
        t.aF(e.j(0), e.j(1), e.j(2));
      }
      for (let e in this.k) {
        this.k[e];
        t.aJ(e, this.k[e].j(0));
      }
    }
    ih(t) {
      const e = [];
      this.F.forEach((t) => {
        e.push(t);
      }),
        e.sort(function (t, e) {
          return t.s - e.s;
        });
      const i = this.ed.h.TextureSections;
      for (let s = 0; s < e.length; s++) {
        const r = e[s];
        if (r.D)
          for (let e = 0; e < r.D.length; e++) {
            const s = r.D[e];
            if (
              s.gender == this.vu &&
              s.texture &&
              s.texture.k() &&
              12 != s.region
            ) {
              if (0 != (1 & this.B.Character.ChrModelFlags) && 7 == s.region)
                continue;
              const e = i.find((t) => t.SectionType == s.region);
              if (!e) {
                WH.debug("can't find texture section data", s.region);
                continue;
              }
              const r = new mr();
              (r.b = s.texture), t.i(r, e.X, e.Y, e.Width, e.Height, 0, -1, -1);
            }
          }
      }
    }
    setAppearance(t) {
      var e;
      (this.P = t),
        (this.q = t.sheathMain),
        (this.hg = t.sheathOff),
        null === (e = this.ed) || void 0 === e || e.d(t.options),
        (this.s = !0),
        (this.A = !0),
        this.dc(),
        this.I();
    }
    setCustomizationsLoadedCallback(t) {
      this.M = t;
    }
    setItems(t) {
      const e = this.m.options;
      WH.debug("setItems", t);
      const i = [];
      for (let e = 0; e < t.length; e++)
        i.push([t[e].slot, t[e].display, t[e].visual]);
      i.forEach((t) => {
        const i = [parseInt(t[0]), parseInt(t[1])];
        e.items.push(i);
      }),
        this.ts(i),
        (this.s = !0);
    }
    attachList(t) {
      const e = this.m.options;
      WH.debug("attachList", t);
      const i = t.split(","),
        s = [];
      for (let t = 0; t < i.length; t += 2) s.push([i[t], i[t + 1]]);
      s.forEach((t) => {
        const i = [parseInt(t[0]), parseInt(t[1])];
        e.items.push(i);
      }),
        this.ts(s),
        (this.s = !0);
    }
    clearSlots(t) {
      const e = this.m.options;
      WH.debug("clearSlots", t);
      const i = t.split(",");
      for (let t = 0; t < i.length; ++t) {
        this.G(parseInt(i[t]));
        const s = [];
        e.items.forEach((i) => {
          0 != e.items[t].indexOf(parseInt(i)) && s.push(i);
        }),
          (e.items = s);
      }
      this.I(), (this.s = !0);
    }
    setShouldersOverride(t) {
      if ((WH.debug("setShouldersOverride", t), !t || 2 != t.length)) return;
      for (let t = 0; t < 2; t++) {
        const e = this.O[t];
        e && e.r(), (this.O[t] = null);
      }
      for (let e = 0; e < 2; e++)
        if (null != t[e]) {
          const i = new Ol(this, 3, t[e]);
          let s = 0;
          (s = 0 == e ? 1 : 2), i.f(s), (this.O[e] = i);
        }
      const e = this.F.get(3);
      if (e) {
        let t = 3;
        for (let e = 0; e < 2; e++) this.O[e] && (t &= ~(1 << e));
        e.f(t);
      }
      this.O && (this.O[0] || this.O[1]) && this.G(3);
    }
    setSheath(t, e) {
      (this.q = t), (this.hg = e), this.I();
    }
    I() {
      if (!this.loaded) return;
      const t = this.e;
      let e = (-1 == this.hg || !this.hg) && null != this.F.get(22),
        i = !(
          (-1 != this.q && this.q) ||
          (null == this.F.get(13) && null == this.F.get(21))
        );
      for (let i of cr) {
        let s = t.aC.x[i];
        s > 0 && s < t.T.length && this.e.T[s].t(e ? "HandsClosed" : "");
      }
      for (let e of dr) {
        let s = t.aC.x[e];
        s > 0 && s < t.T.length && t.T[s].t(i ? "HandsClosed" : "");
      }
    }
    lk(t) {
      const e = this.e;
      if (!e.aI) return;
      const i = t.b.modelInstance;
      if (!i || !i.aI) return;
      t.a || (i.u(e, -1, null), (t.a = !0));
      let s = i.T;
      if (s) {
        for (let t = 0; t < s.length; t++) {
          let i = s[t],
            r = this.J[i.l.f];
          if ("number" != typeof r) continue;
          let n = s[t].c,
            a = e.T[r].c;
          (s[t].j = !0), zi(n, a);
        }
        i.g();
      }
    }
    K() {
      const t = this.e;
      let e = {};
      for (let i = 0; i < t.T.length; i++) e[t.T[i].l.f] = i;
      this.J = e;
    }
    c() {
      if (this.e && this.e.aI) {
        this.J || (this.K(), this.I()), super.c();
        for (const t in this.j) {
          const e = this.j[t];
          this.lk(e);
        }
        this.F.forEach((t) => {
          if (t) {
            if (2 == t.u && 13 == t.C) {
              if (21 == t.o && -1 != this.q) return;
              if (22 == t.o && -1 != this.hg) return;
            }
            t.G();
          }
        }),
          this.O.forEach((t) => {
            t && t.b && t.G();
          }),
          this.E();
      }
    }
    static xw(t, e) {
      const i = t.b;
      if (!i.loaded) return;
      const s = i.modelInstance;
      if (!s || !s.aI) return;
      s.T && s.aN(e);
    }
    h(t) {
      if (this.e && this.e.aI) {
        super.h(t);
        for (const e in this.j) {
          const i = this.j[e];
          Bl.xw(i, t);
        }
        if (
          (this.F.forEach((e) => {
            if (e) {
              if (2 == e.u && 13 == e.C) {
                if (21 == e.o && -1 != this.q) return;
                if (22 == e.o && -1 != this.hg) return;
              }
              e.y(t);
            }
          }),
          this.O.forEach((e) => {
            e && e.b && e.y(t);
          }),
          this.y)
        )
          for (let e = 0; e < this.y.length; e++) {
            let i = this.y[e];
            i.aI && i.aN(t);
          }
        this.F.forEach((e) => {
          e && e.e && e.e.b && e.e.a && Bl.xw(e.e, t);
        });
      }
    }
    f(t) {
      super.f(t);
      for (const e in this.j) {
        const i = this.j[e];
        i.a && i.b && i.b.loaded && i.b.f(t);
      }
      if (
        (this.F.forEach((e) => {
          if (e) {
            if (2 == e.u && 13 == e.C) {
              if (21 == e.o && -1 != this.q) return;
              if (22 == e.o && -1 != this.hg) return;
            }
            e.v(t);
          }
        }),
        this.O.forEach((e) => {
          e && e.b && e.v(t);
        }),
        this.y)
      )
        for (let e = 0; e < this.y.length; e++) {
          let i = this.y[e];
          i.aI && t.b(i, !1);
        }
    }
  }
  class Pl extends xl {
    constructor(t, e, i, s, r, n) {
      super(t, e, i, s, r, n), this.cba();
    }
    cba() {
      let t = this.fe;
      const e = this.dc,
        i = this.ba,
        s = this.m;
      if (s.ComponentModels) {
        let r = s.ComponentModels[0] || s.ComponentModels[1];
        r &&
          s.ModelFiles &&
          s.ModelFiles[r] &&
          (27 == s.Item.InventoryType
            ? (this.e = new _l(
                this.k,
                this.k.renderer,
                s.ModelFiles[r][0].FileDataId
              ))
            : (this.e = new _l(
                this.k,
                this.k.renderer,
                pl.b(s.ModelFiles[r], -1, e, i, t)
              )),
          this.e.Z()),
          this.e &&
            s.Item.AttachGeosetGroup &&
            (this.e.ad(s.Item.AttachGeosetGroup[0], 27),
            this.e.ad(s.Item.AttachGeosetGroup[1], 21));
      }
      if (s.Textures)
        for (let t in s.Textures)
          0 != s.Textures[t] &&
            this.e.aJ(parseInt(t), this.k.getTexture(s.Textures[t]));
    }
  }
  class zl extends xl {
    constructor(t, e, i, s, r, n) {
      super(t, e, i, s, r, n), (this.cba = 1), this.ed();
    }
    get shoulderIndex() {
      return this.cba;
    }
    gf(t) {
      this.cba != t && ((this.cba = t), this.ed());
    }
    ed() {
      let t = this.fe;
      const e = this.dc,
        i = this.ba,
        s = this.m;
      if (s.ComponentModels) {
        let r = s.ComponentModels[0],
          n = s.ComponentModels[1];
        if (1 == this.cba || (void 0 === this.cba && r)) {
          if (
            (r &&
              s.ModelFiles[r] &&
              ((this.e = new _l(
                this.k,
                this.k.renderer,
                pl.b(s.ModelFiles[r], 0, e, i, t)
              )),
              this.e.Z()),
            this.e && s.Textures)
          )
            for (let t in s.Textures)
              0 != s.Textures[t] &&
                this.e.aJ(+t, this.k.getTexture(s.Textures[t]));
        } else if (
          (2 == this.cba || (void 0 === this.cba && n)) &&
          (n &&
            s.ModelFiles[n] &&
            ((this.e = new _l(
              this.k,
              this.k.renderer,
              pl.b(s.ModelFiles[n], 1, e, i, t)
            )),
            this.e.Z()),
          s.Textures2 && this.e)
        )
          for (let t in s.Textures2)
            0 != s.Textures2[t] &&
              this.e.aJ(+t, this.k.getTexture(s.Textures2[t]));
      }
      s.Item.AttachGeosetGroup && this.e.ad(s.Item.AttachGeosetGroup[0], 26);
    }
    c() {
      this.e.g();
    }
    h(t) {
      this.e.aN(t);
    }
  }
  class Nl extends xl {
    constructor(t, e, i, s, r, n) {
      super(t, e, i, s, r, n), this.cba();
    }
    cba() {
      let t = this.fe;
      const e = this.dc,
        i = this.ba,
        s = this.m;
      if (s.ComponentModels) {
        let r = s.ComponentModels[0];
        r &&
          s.ModelFiles &&
          s.ModelFiles[r] &&
          (this.e = new _l(
            this.k,
            this.k.renderer,
            pl.b(s.ModelFiles[r], -1, e, i, t)
          ));
      }
      if (this.e && s.Textures)
        for (let t in s.Textures)
          0 != s.Textures[t] &&
            (this.e.F[+t] = this.k.getTexture(s.Textures[t]));
    }
  }
  class Gl extends ml {
    constructor(t, e) {
      super(), (this.dc = t), (this.ba = e), this.fe();
    }
    fe() {
      (this.e = new _l(this.dc, this.dc.renderer, this.ba.Model)),
        this.e.O(1 | this.ba.Scale);
    }
    c() {
      this.e && this.e.g();
    }
    b() {
      return this.e.aI ? this.e.al() : [null, null];
    }
    h(t) {
      this.e && this.e.aN(t);
    }
  }
  class Ll {
    static a(t, e, i) {
      if (e.Character || i == ar.CHARACTER) return new Bl(t, e);
      if (i == ar.NPC || i == ar.HUMANOIDNPC) return new yl(t, e);
      if (i == ar.HELM || i == ar.SHOULDER || i == ar.ITEM)
        return Ll.c(t, e, i, 1, 0, 0);
      if (i == ar.OBJECT) return new Gl(t, e);
      throw "Couldn't create actor";
    }
    static c(t, e, i, s, r, n) {
      if (i == ar.HELM) return new Pl(t, e, s, r, n, !1);
      if (i == ar.SHOULDER) return new zl(t, e, s, r, n, !1);
      if (i == ar.ITEM) return new Nl(t, e, s, r, n, !1);
      throw "Couldn't create item actor";
    }
    static b(t, e, i) {
      return El(t.options.contentPath, e, i).then((i) => Ll.a(t, i, e));
    }
  }
  const jl = class {
    constructor(t) {
      (this.currFrame = 0),
        (this.clearColor = _i(0, 0, 0)),
        (this.addedCss = !1),
        (this.progressShown = !1),
        (this.doUpdateBounds = !1),
        (this.attributeState = new li()),
        (this.gxDevice = null),
        (this.textureCache = new Map()),
        (this.crossFadeDuration = 0.3),
        (this.onContextMenu = function (t) {
          return !1;
        });
      var e = this;
      (e.viewer = t),
        (e.options = t.options),
        (e.downloads = {}),
        (e.context = null),
        (e.bgImgLoaded = !1),
        (e.width = 0),
        (e.height = 0),
        (e.time = 0),
        (e.delta = 0),
        (e.actors = []),
        (e.screenshotDataURL = null),
        (e.makeDataURL = !1),
        (e.screenshotCallback = null),
        (e.azimuth = 1.5 * Math.PI),
        (e.zenith = Math.PI / 2),
        (e.distance = 15),
        (e.fov = 30),
        (e.zoom = {
          rateStep: 0.1,
          rateAccelerationDecay: 0.4,
          interpolationRate: 0.3,
          range: [0.3, 4],
          rateCurrent: 0,
          target: 1,
          current: 1,
        }),
        (e.zoom.range = e.zoom.range.map(function (t) {
          return Math.log(t) / Math.log(1 + e.zoom.rateStep);
        })),
        (e.translation = _i(0, 0, 0)),
        (e.translationFromModel = _i(0, 0, 0)),
        (e.target = _i(0, 0, 0)),
        (e.eye = _i(0, 0, 0)),
        (e.up = _i(0, 0, 1)),
        (e.lookDir = gi()),
        (e.fullscreen = !1),
        (e.projMatrix = Pi()),
        (e.viewMatrix = Pi()),
        (e.panningMatrix = Pi()),
        (e.viewOffset = gi()),
        this.addedCss ||
          ((this.addedCss = !0),
          $("head").append(
            '<link rel="stylesheet" href="//wow.zamimg.com/modelviewer/viewer/viewer.css" type="text/css" />'
          ));
    }
    updateProgress() {
      if (!this.stop) {
        var t = this,
          e = 0,
          i = 0;
        for (var s in t.downloads)
          (e += t.downloads[s].total), (i += t.downloads[s].loaded);
        if (e <= 0)
          t.progressShown &&
            (t.progressBg.hide(), t.progressBar.hide(), (t.progressShown = !1));
        else {
          t.progressShown ||
            (t.progressBg.show(), t.progressBar.show(), (t.progressShown = !0));
          var r = i / e;
          t.progressBar.width(Math.round(t.width * r) + "px");
        }
      }
    }
    destroy() {
      var t = this;
      (t.stop = !0),
        t.canvas &&
          (t.canvas.detach(),
          t.progressBg.detach(),
          t.progressBar.detach(),
          (t.canvas = t.progressBg = t.progressBar = null)),
        t.clearBackground(),
        (t.actors = []);
    }
    method(t, e) {
      if ("isBackgroundLoaded" === t) return this.bgImgLoaded;
      if ("setBackground" !== t) {
        if (this.actors.length > 0 && this.actors[0]) {
          const i = this.actors[0][t];
          return i
            ? i.apply(this.actors[0], e)
            : void WH.debug("Unknown viewer method", t, "args", e);
        }
        this.actorPromises.length > 0 &&
          this.actorPromises[0] &&
          (this.actorPromises[0] = this.actorPromises[0].then((i) => {
            const s = i[t];
            if (s) return s.apply(i, e), i;
            WH.debug("Unknown viewer method", t, "args", e);
          }));
      } else this.setBackground(e[0]);
    }
    getTime() {
      return window.performance && window.performance.now
        ? window.performance.now()
        : Date.now();
    }
    draw(t) {
      var e,
        i = this,
        s = i.context;
      if (
        ((i.delta = 0.001 * (t - i.time)),
        (i.time = t),
        i.currFrame++,
        this.doUpdateBounds && i.actors.length > 0)
      ) {
        let [t, s] = [gi(), gi()];
        for (e = 0; e < i.actors.length; ++e) {
          const [r, n] = i.actors[e].b();
          r && wi(t, t, r), n && yi(s, s, n);
        }
        const r = gi(),
          n = gi();
        vi(r, s, t), Ei(n, t, r, 0.5);
        let a = r[2],
          o = r[0],
          h = r[1];
        const l = this.width / this.height,
          u = 2 * Math.tan((this.fov / 2) * 0.0174532925),
          c = (1.2 * a) / u,
          d = (1.2 * o) / (u * l);
        (this.distance = Math.max(Math.max(c, d), 2 * h)),
          mi(this.translationFromModel, n[0], -n[2], 0),
          (this.doUpdateBounds = !1);
      }
      for (
        i.updateCamera(),
          s.bindFramebuffer(s.FRAMEBUFFER, null),
          s.viewport(0, 0, i.width, i.height),
          s.clearColor(
            this.clearColor[0],
            this.clearColor[1],
            this.clearColor[2],
            0
          ),
          s.clear(s.COLOR_BUFFER_BIT | s.DEPTH_BUFFER_BIT),
          i.bgTexture &&
            i.program &&
            (s.useProgram(i.program),
            s.activeTexture(s.TEXTURE0),
            s.bindTexture(s.TEXTURE_2D, i.bgTexture),
            s.uniform1i(i.uTexture, 0),
            s.uniform4f(
              i.uBGTransform,
              i.viewer.options.bgPosition[0] || 0,
              i.viewer.options.bgPosition[1] || 0,
              i.viewer.options.bgScale[0] || 1,
              i.viewer.options.bgScale[1] || 1
            ),
            i.options.backgroundRotatation &&
              (s.uniform1f(i.uRotation, i.options.backgroundRotatation),
              s.uniform2f(i.uResolution, i.width, i.height)),
            s.bindBuffer(s.ARRAY_BUFFER, i.vb),
            s.bindBuffer(s.ELEMENT_ARRAY_BUFFER, null),
            s.enableVertexAttribArray(i.aPosition),
            s.vertexAttribPointer(i.aPosition, 2, s.FLOAT, !1, 16, 0),
            s.enableVertexAttribArray(i.aTexCoord),
            s.vertexAttribPointer(i.aTexCoord, 2, s.FLOAT, !1, 16, 8),
            s.depthMask(!1),
            s.disable(s.CULL_FACE),
            s.blendFunc(s.ONE, s.ZERO),
            s.drawArrays(s.TRIANGLE_STRIP, 0, 4),
            s.blendFunc(s.SRC_ALPHA, s.ONE_MINUS_SRC_ALPHA),
            s.enable(s.CULL_FACE),
            s.depthMask(!0),
            s.disableVertexAttribArray(i.aPosition),
            s.disableVertexAttribArray(i.aTexCoord)),
          e = 0;
        e < i.actors.length;
        ++e
      )
        i.actors[e].c();
      for (
        s.viewport(0, 0, i.width, i.height), this.gxDevice.d(), e = 0;
        e < i.actors.length;
        ++e
      )
        i.actors[e].h(!1);
      for (e = 0; e < i.actors.length; ++e) i.actors[e].h(!0);
      this.gxDevice.e();
    }
    setAdaptiveMode(t) {
      (this.addaptiveMode = t), t && $(window).trigger("resize");
    }
    setTranslation(t, e, i) {
      this.translation = _i(t, e, i);
    }
    setBackground(t) {
      var e = this;
      (e.bgImgLoaded = !1),
        (e.options.background = t),
        e.clearBackground(),
        e.loadBackground();
    }
    clearBackground() {
      var t = this;
      if (t.context) {
        var e = t.context;
        t.bgTexture && e.deleteTexture(t.bgTexture),
          (t.bgTexture = null),
          t.program && e.deleteProgram(t.program),
          (t.program = null),
          t.vb && e.deleteBuffer(t.vb),
          t.vs && e.deleteShader(t.vs),
          t.fs && e.deleteShader(t.fs),
          (t.vb = t.vs = t.fs = null);
      }
      t.bgImg && (t.bgImg = null);
    }
    updateCamera() {
      var t = this;
      (t.zoom.target += t.zoom.rateCurrent),
        (t.zoom.rateCurrent *= 1 - t.zoom.rateAccelerationDecay),
        (t.zoom.target = -Math.max(
          Math.min(-t.zoom.target, t.zoom.range[1]),
          t.zoom.range[0]
        )),
        (t.zoom.current +=
          (t.zoom.target - t.zoom.current) * t.zoom.interpolationRate);
      var e = t.distance * Math.pow(t.zoom.rateStep + 1, -t.zoom.current),
        i = t.azimuth,
        s = t.zenith;
      1 == t.up[2]
        ? ((t.eye[0] = -e * Math.sin(s) * Math.cos(i) + t.target[0]),
          (t.eye[1] = -e * Math.sin(s) * Math.sin(i) + t.target[1]),
          (t.eye[2] = -e * Math.cos(s) + t.target[2]))
        : ((t.eye[0] = -e * Math.sin(s) * Math.cos(i) + t.target[0]),
          (t.eye[1] = -e * Math.cos(s) + t.target[1]),
          (t.eye[2] = -e * Math.sin(s) * Math.sin(i) + t.target[2])),
        vi(t.lookDir, t.target, t.eye),
        Si(t.lookDir, t.lookDir),
        (function (t, e, i, s) {
          var r,
            n,
            a,
            o,
            h,
            l,
            u,
            c,
            d,
            f,
            g = e[0],
            b = e[1],
            _ = e[2],
            p = s[0],
            m = s[1],
            x = s[2],
            v = i[0],
            T = i[1],
            w = i[2];
          Math.abs(g - v) < di && Math.abs(b - T) < di && Math.abs(_ - w) < di
            ? Gi(t)
            : ((u = g - v),
              (c = b - T),
              (d = _ - w),
              (r = m * (d *= f = 1 / Math.hypot(u, c, d)) - x * (c *= f)),
              (n = x * (u *= f) - p * d),
              (a = p * c - m * u),
              (f = Math.hypot(r, n, a))
                ? ((r *= f = 1 / f), (n *= f), (a *= f))
                : ((r = 0), (n = 0), (a = 0)),
              (o = c * a - d * n),
              (h = d * r - u * a),
              (l = u * n - c * r),
              (f = Math.hypot(o, h, l))
                ? ((o *= f = 1 / f), (h *= f), (l *= f))
                : ((o = 0), (h = 0), (l = 0)),
              (t[0] = r),
              (t[1] = o),
              (t[2] = u),
              (t[3] = 0),
              (t[4] = n),
              (t[5] = h),
              (t[6] = c),
              (t[7] = 0),
              (t[8] = a),
              (t[9] = l),
              (t[10] = d),
              (t[11] = 0),
              (t[12] = -(r * g + n * b + a * _)),
              (t[13] = -(o * g + h * b + l * _)),
              (t[14] = -(u * g + c * b + d * _)),
              (t[15] = 1));
        })(t.viewMatrix, t.eye, t.target, t.up),
        Gi(t.panningMatrix),
        1 == t.up[2]
          ? mi(t.viewOffset, t.translation[0], -t.translation[1], 0)
          : mi(t.viewOffset, t.translation[0], 0, t.translation[1]),
        xi(t.viewOffset, t.viewOffset, this.translationFromModel),
        Hi(t.panningMatrix, t.panningMatrix, t.viewOffset),
        Yi(t.viewMatrix, t.panningMatrix, t.viewMatrix);
    }
    init() {
      var t,
        e = this,
        i = e.context;
      if (
        ((this.blackPixelTexture = i.createTexture()),
        i.bindTexture(i.TEXTURE_2D, this.blackPixelTexture),
        i.texImage2D(
          i.TEXTURE_2D,
          0,
          i.RGBA,
          1,
          1,
          0,
          i.RGBA,
          i.UNSIGNED_BYTE,
          new Uint8Array([0, 0, 0, 255])
        ),
        i.bindTexture(i.TEXTURE_2D, null),
        (this.greenPixelTexture = i.createTexture()),
        i.bindTexture(i.TEXTURE_2D, this.greenPixelTexture),
        i.texImage2D(
          i.TEXTURE_2D,
          0,
          i.RGBA,
          1,
          1,
          0,
          i.RGBA,
          i.UNSIGNED_BYTE,
          new Uint8Array([0, 255, 0, 255])
        ),
        i.bindTexture(i.TEXTURE_2D, null),
        Ji(e.projMatrix, 0.0174532925 * e.fov, e.viewer.aspect, 0.1, 500),
        e.updateCamera(),
        i.clearColor(
          this.clearColor[0],
          this.clearColor[1],
          this.clearColor[2],
          0
        ),
        i.enable(i.DEPTH_TEST),
        i.depthFunc(i.LEQUAL),
        i.blendFunc(i.SRC_ALPHA, i.ONE_MINUS_SRC_ALPHA),
        i.enable(i.BLEND),
        e.options.models || e.options.items)
      ) {
        e.actorPromises = [];
        var s = [].concat(e.options.models);
        if (s.length > 0) {
          const i = e.options.mount,
            r = e.options.shouldersOverride;
          for (t = 0; t < s.length; ++t) {
            const n = Ll.b(this, s[t].type, s[t].id)
              .then(
                (t) => (
                  i && i.id && t instanceof yl && t.C(i.id),
                  t instanceof Bl && t.setShouldersOverride(r),
                  e.actors.push(t),
                  t
                )
              )
              .then((t) => t);
            e.actorPromises.push(n);
          }
        }
      }
      !(function t() {
        if (!e.stop && (window.requestAnimationFrame(t), e.gxDevice)) {
          var s = e.getTime();
          if (!1 !== e.makeDataURL) {
            if (e.canvas[0].toDataURL) {
              var r = e.clearColor,
                n = e.bgTexture;
              e.options.transparent &&
                ((e.bgTexture = null), (e.clearColor = _i(0, 0, 0))),
                e.draw(s);
              var a = e.width * e.height * 4,
                o = new Uint8Array(a);
              i.readPixels(0, 0, e.width, e.height, i.RGBA, i.UNSIGNED_BYTE, o);
              let t = null;
              e.options.transparent
                ? ((e.clearColor = _i(1, 1, 1)),
                  e.draw(s),
                  (t = new Uint8Array(a)),
                  i.readPixels(
                    0,
                    0,
                    e.width,
                    e.height,
                    i.RGBA,
                    i.UNSIGNED_BYTE,
                    t
                  ))
                : (t = o);
              for (
                var h = new Uint8Array(a), l = 0, u = e.height - 1;
                u >= 0;
                u--
              )
                for (var c = 0; c < e.width; c++) {
                  var d = 4 * (u * e.width + c),
                    f = 255 - (t[l + 0] - o[l + 0]),
                    g = o[l + 0],
                    b = o[l + 1],
                    _ = o[l + 2];
                  o[l + 3];
                  (h[d + 0] = g),
                    (h[d + 1] = b),
                    (h[d + 2] = _),
                    (h[d + 3] = f),
                    (l += 4);
                }
              var p = document.createElement("canvas"),
                m = p.getContext("2d");
              (p.width = e.width), (p.height = e.height);
              var x = m.createImageData(e.width, e.height);
              x.data.set(h),
                m.putImageData(x, 0, 0),
                (e.screenshotDataURL = p.toDataURL.apply(p, e.makeDataURL)),
                e.screenshotCallback &&
                  (e.screenshotCallback(), (e.screenshotCallback = null)),
                (e.clearColor = r),
                (e.bgTexture = n);
            }
            e.makeDataURL = !1;
          }
          e.draw(s);
        }
      })();
    }
    onDoubleClick(t) {
      es.isFullscreen()
        ? es.exitFullscreen()
        : es.requestFullscreen(this.canvas[0]);
    }
    onFullscreen(t) {
      let e = this;
      if (e.viewer.container)
        if ((!e.fullscreen && es.isFullscreen()) || this.addaptiveMode) {
          if (
            ((e.restoreWidth = e.width),
            (e.restoreHeight = e.height),
            (e.fullscreen = !0),
            es.isFullscreen())
          ) {
            var i = $(window);
            let t = window.screen.width || i.width(),
              e = window.screen.height || i.height();
            this.onResize(t, e, t / e);
          } else if (this.addaptiveMode) {
            var s = e.viewer.container;
            this.onResize(s.width(), s.height(), s.width() / s.height());
          }
        } else
          e.fullscreen &&
            !es.isFullscreen() &&
            ((e.fullscreen = !1),
            this.onResize(e.restoreWidth, e.restoreHeight, e.viewer.aspect));
    }
    onResize(t, e, i) {
      this.resize(t, e),
        Ji(this.projMatrix, 0.0174532925 * this.fov, i, 0.1, 5e3);
    }
    onMouseDown(t) {
      let e = this;
      3 == t.which || t.ctrlKey ? (e.rightMouseDown = !0) : (e.mouseDown = !0),
        "touchstart" == t.type
          ? ((e.mouseX = t.originalEvent.touches[0].clientX),
            (e.mouseY = t.originalEvent.touches[0].clientY))
          : ((e.mouseX = t.clientX), (e.mouseY = t.clientY)),
        $("body").addClass("unselectable"),
        t.preventDefault();
    }
    onMouseWheel(t) {
      if (
        !this.options.wheelEventValidation ||
        this.options.wheelEventValidation.call(this, t)
      )
        return (
          (this.zoom.rateCurrent += t.originalEvent.wheelDelta > 0 ? 1 : -1),
          t.preventDefault(),
          !1
        );
    }
    onMouseUp(t) {
      let e = this;
      (e.mouseDown || e.rightMouseDown) &&
        ($("body").removeClass("unselectable"),
        (e.mouseDown = !1),
        (e.rightMouseDown = !1));
    }
    onMouseMove(t) {
      let e = this;
      if ((e.mouseDown || e.rightMouseDown) && void 0 !== e.mouseX) {
        var i, s;
        "touchmove" == t.type
          ? ((i = t.originalEvent.touches[0].clientX),
            (s = t.originalEvent.touches[0].clientY))
          : ((i = t.clientX), (s = t.clientY));
        var r = ((i - e.mouseX) / e.width) * Math.PI * 2,
          n = ((s - e.mouseY) / e.width) * Math.PI * 2;
        if (e.mouseDown) {
          1 == e.up[2] ? (e.azimuth -= r) : (e.azimuth += r), (e.zenith += n);
          for (var a = 2 * Math.PI; e.azimuth < 0; ) e.azimuth += a;
          for (; e.azimuth > a; ) e.azimuth -= a;
          e.zenith < 1e-4 && (e.zenith = 1e-4),
            e.zenith >= Math.PI && (e.zenith = Math.PI - 1e-4);
        } else (e.translation[0] += r), (e.translation[1] += n);
        (e.mouseX = i), (e.mouseY = s), t.stopPropagation();
      }
    }
    resize(t, e) {
      var i = this;
      if (i.width !== t || i.height !== e) {
        if (
          (i.fullscreen ||
            i.viewer.container.css({ height: e + "px", position: "relative" }),
          (i.width = t),
          (i.height = e),
          i.canvas)
        )
          i.canvas.attr({ width: t, height: e }),
            i.canvas.css({ width: t + "px", height: e + "px" }),
            i.context.viewport(0, 0, i.width, i.height);
        else {
          if (
            ((i.canvas = $("<canvas/>")),
            i.canvas.attr({ width: t, height: e }),
            i.viewer.container.append(i.canvas),
            (i.context =
              i.canvas[0].getContext("webgl", {
                alpha: !0,
                premultipliedAlpha: !1,
              }) ||
              i.canvas[0].getContext("experimental-webgl", {
                alpha: !0,
                premultipliedAlpha: !1,
              })),
            (i.progressBg = $("<div/>", {
              css: {
                display: "none",
                position: "absolute",
                bottom: 0,
                left: 0,
                right: 0,
                height: "10px",
                backgroundColor: "#000",
              },
            })),
            (i.progressBar = $("<div/>", {
              css: {
                display: "none",
                position: "absolute",
                bottom: 0,
                left: 0,
                width: 0,
                height: "10px",
                backgroundColor: "#ccc",
              },
            })),
            i.viewer.container.append(i.progressBg),
            i.viewer.container.append(i.progressBar),
            !i.context)
          )
            return (
              alert("No WebGL support, sorry! You should totally use Chrome."),
              i.canvas.detach(),
              void (i.canvas = null)
            );
          const s = [0.35, 0.35, 0.35, 1],
            r = [1, 1, 1, 1],
            n = [0.35, 0.35, 0.35, 1],
            a = gi(),
            o = gi(),
            h = gi();
          Si(a, [5, -3, 3]), Si(o, [5, 5, 5]), Si(h, [-5, -5, -5]);
          const l = {
            uCameraPos: i.eye,
            uViewMatrix: i.viewMatrix,
            uProjMatrix: i.projMatrix,
            uAmbientColor: s,
            uPrimaryColor: r,
            uSecondaryColor: n,
            uLightDir1: a,
            uLightDir2: o,
            uLightDir3: h,
          };
          (this.gxDevice = new er(i.context, l)),
            (this.renderer = this.gxDevice.c()),
            i.canvas
              .on("mousedown touchstart", i.onMouseDown.bind(i))
              .on("wheel", i.onMouseWheel.bind(i))
              .on("dblclick", i.onDoubleClick.bind(i))
              .on("contextmenu", i.onContextMenu.bind(i)),
            $(window).on("resize", i.onFullscreen.bind(i)),
            $(document)
              .on("mouseup touchend", i.onMouseUp.bind(i))
              .on("mousemove touchmove", i.onMouseMove.bind(i)),
            i.onFullscreen(null);
        }
        i.options.background && i.loadBackground();
      }
    }
    loadBackground() {
      var t = this,
        e = t.context;
      const i = function () {
          (t.vb = e.createBuffer()),
            e.bindBuffer(e.ARRAY_BUFFER, t.vb),
            e.bufferData(e.ARRAY_BUFFER, new Float32Array(16), e.DYNAMIC_DRAW);
          var i,
            s = t.compileShader(
              e.VERTEX_SHADER,
              "    attribute vec2 aPosition;    attribute vec2 aTexCoord;        varying vec2 vTexCoord;        void main(void) {        vTexCoord = aTexCoord;        gl_Position = vec4(aPosition, 0, 1);    }    "
            );
          i = t.options.backgroundRotatation
            ? t.compileShader(
                e.FRAGMENT_SHADER,
                "\tprecision mediump float;    varying vec2 vTexCoord;    uniform sampler2D uTexture;    uniform vec2 uResolution;    uniform vec4 uBGTransform;    uniform float uRotation;    mat3 getTransform(vec2 pos, vec2 scale, float rotation, vec2 center) {        float c = cos(rotation);        float s = sin(rotation);        return mat3(            scale.x * c, scale.x * s, - scale.x * ( c * center.x + s * center.y ) + center.x + pos.x,            -scale.y * s, scale.y * c, - scale.y * ( - s * center.x + c * center.y ) + center.y + pos.y,            0.0, 0.0, 1.0        );    }    void main(void) {        vec2 uv = gl_FragCoord.xy / uResolution.xy;        mat3 transform = getTransform(uBGTransform.xy, uBGTransform.zw, uRotation, vec2(0.5));        uv = (vec3(uv, 1.0) * transform).xy;        gl_FragColor = texture2D(uTexture, uv);\t}"
              )
            : t.compileShader(
                e.FRAGMENT_SHADER,
                "    precision mediump float;    varying vec2 vTexCoord;        uniform sampler2D uTexture;    uniform vec4 uBGTransform;        void main(void) {        gl_FragColor = texture2D(uTexture, vTexCoord.xy * uBGTransform.zw + uBGTransform.xy);    }    "
              );
          var r = e.createProgram();
          e.attachShader(r, s),
            e.attachShader(r, i),
            e.linkProgram(r),
            e.getProgramParameter(r, e.LINK_STATUS)
              ? ((t.vs = s),
                (t.fs = i),
                (t.program = r),
                (t.uTexture = e.getUniformLocation(r, "uTexture")),
                (t.aPosition = e.getAttribLocation(r, "aPosition")),
                (t.aTexCoord = e.getAttribLocation(r, "aTexCoord")),
                (t.uBGTransform = e.getUniformLocation(r, "uBGTransform")),
                (t.uRotation = e.getUniformLocation(r, "uRotation")),
                (t.uResolution = e.getUniformLocation(r, "uResolution")))
              : console.error("Error linking shaders");
        },
        s = function () {
          var i = t.width / t.bgImg.width,
            s = t.height / t.bgImg.height;
          const r = [-1, -1, 0, s, 1, -1, i, s, -1, 1, 0, 0, 1, 1, i, 0];
          e.bindBuffer(e.ARRAY_BUFFER, t.vb),
            e.bufferSubData(e.ARRAY_BUFFER, 0, new Float32Array(r));
        };
      t.bgImg
        ? t.bgImg.loaded && (t.vb || i(), s())
        : ((t.bgImg = new Image()),
          (t.bgImg.crossOrigin = ""),
          (t.bgImg.onload = function () {
            var r;
            null === (r = t.bgImg) || void 0 === r || (r.loaded = !0),
              t.bgImg &&
                ((t.bgTexture = e.createTexture()),
                e.bindTexture(e.TEXTURE_2D, t.bgTexture),
                e.texImage2D(
                  e.TEXTURE_2D,
                  0,
                  e.RGBA,
                  e.RGBA,
                  e.UNSIGNED_BYTE,
                  t.bgImg
                ),
                e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, e.LINEAR),
                t.vb || i(),
                s(),
                (t.bgImgLoaded = !0));
          }),
          (t.bgImg.onerror = function () {
            t.bgImg = null;
          }),
          (t.bgImg.src = t.options.contentPath + t.options.background),
          (t.viewer.options.bgPosition = t.options.bgPosition || [0, 0]),
          (t.viewer.options.bgScale = t.options.bgScale || [1, 1]));
    }
    compileShader(t, e) {
      var i = this.context,
        s = i.createShader(t);
      if (
        (i.shaderSource(s, e),
        i.compileShader(s),
        !i.getShaderParameter(s, i.COMPILE_STATUS))
      )
        throw "Shader compile error: " + i.getShaderInfoLog(s);
      return s;
    }
    getTexture(t) {
      if (this.textureCache.has(t)) {
        var e = this.textureCache.get(t);
        if (e.a || e.e) return e;
      }
      const i = new ir(this, t);
      return this.textureCache.set(t, i), i;
    }
  };
  let Yl = { Types: ar };
  const Hl = Object.assign(es, {
    Tools: ci,
    WebGL: jl,
    WEBGL: 1,
    WOW: 2,
    FLASH: 2,
    Wow: Yl,
  });
  window.ZamModelViewer = Hl;
})();
//# sourceMappingURL=viewer.min.js.map
